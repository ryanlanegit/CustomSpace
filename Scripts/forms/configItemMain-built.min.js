define("text",["module"],function(e){"use strict";var t,i,n,a,o,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],l=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,d="undefined"!=typeof location&&location.href,c=d&&location.protocol&&location.protocol.replace(/\:/,""),u=d&&location.hostname,p=d&&(location.port||void 0),m={},f=e.config&&e.config()||{};return t={version:"2.0.10",strip:function(e){if(e){e=e.replace(l,"");var t=e.match(s);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:f.createXhr||function(){var e,t,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;t<3;t+=1){i=r[t];try{e=new ActiveXObject(i)}catch(e){}if(e){r=[i];break}}return e},parseName:function(e){var t,i,n,a=!1,o=e.indexOf("."),r=0===e.indexOf("./")||0===e.indexOf("../");return-1!==o&&(!r||o>1)?(t=e.substring(0,o),i=e.substring(o+1,e.length)):t=e,n=i||t,o=n.indexOf("!"),-1!==o&&(a="strip"===n.substring(o+1),n=n.substring(0,o),i?i=n:t=n),{moduleName:t,ext:i,strip:a}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,i,n,a){var o,r,l,s=t.xdRegExp.exec(e);return!s||(o=s[2],r=s[3],r=r.split(":"),l=r[1],r=r[0],!(o&&o!==i||r&&r.toLowerCase()!==n.toLowerCase()||(l||r)&&l!==a))},finishLoad:function(e,i,n,a){n=i?t.strip(n):n,f.isBuild&&(m[e]=n),a(n)},load:function(e,i,n,a){if(a.isBuild&&!a.inlineText)return void n();f.isBuild=a.isBuild;var o=t.parseName(e),r=o.moduleName+(o.ext?"."+o.ext:""),l=i.toUrl(r),s=f.useXhr||t.useXhr;if(0===l.indexOf("empty:"))return void n();!d||s(l,c,u,p)?t.get(l,function(i){t.finishLoad(e,o.strip,i,n)},function(e){n.error&&n.error(e)}):i([r],function(e){t.finishLoad(o.moduleName+"."+o.ext,o.strip,e,n)})},write:function(e,i,n,a){if(m.hasOwnProperty(i)){var o=t.jsEscape(m[i]);n.asModule(e+"!"+i,"define(function () { return '"+o+"';});\n")}},writeFile:function(e,i,n,a,o){var r=t.parseName(i),l=r.ext?"."+r.ext:"",s=r.moduleName+l,d=n.toUrl(r.moduleName+l)+".js";t.load(s,n,function(i){var n=function(e){return a(d,e)};n.asModule=function(e,t){return a.asModule(e,d,t)},t.write(e,s,n,o)},o)}},"node"===f.env||!f.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(i=require.nodeRequire("fs"),t.get=function(e,t,n){try{var a=i.readFileSync(e,"utf8");0===a.indexOf("\ufeff")&&(a=a.substring(1)),t(a)}catch(e){n(e)}}):"xhr"===f.env||!f.env&&t.createXhr()?t.get=function(e,i,n,a){var o,r=t.createXhr();if(r.open("GET",e,!0),a)for(o in a)a.hasOwnProperty(o)&&r.setRequestHeader(o.toLowerCase(),a[o]);f.onXhr&&f.onXhr(r,e),r.onreadystatechange=function(t){var a,o;4===r.readyState&&(a=r.status,a>399&&a<600?(o=new Error(e+" HTTP status: "+a),o.xhr=r,n(o)):i(r.responseText),f.onXhrComplete&&f.onXhrComplete(r,e))},r.send(null)}:"rhino"===f.env||!f.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var i,n,a=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),r=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(a),"utf-8")),l="";try{for(i=new java.lang.StringBuffer,n=r.readLine(),n&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),null!==n&&i.append(n);null!==(n=r.readLine());)i.append(o),i.append(n);l=String(i.toString())}finally{r.close()}t(l)}:("xpconnect"===f.env||!f.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(n=Components.classes,a=Components.interfaces,Components.utils.import("resource://gre/modules/FileUtils.jsm"),o="@mozilla.org/windows-registry-key;1"in n,t.get=function(e,t){var i,r,l,s={};o&&(e=e.replace(/\//g,"\\")),l=new FileUtils.File(e);try{i=n["@mozilla.org/network/file-input-stream;1"].createInstance(a.nsIFileInputStream),i.init(l,1,0,!1),r=n["@mozilla.org/intl/converter-input-stream;1"].createInstance(a.nsIConverterInputStream),r.init(i,"utf-8",i.available(),a.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),r.readString(i.available(),s),r.close(),i.close(),t(s.value)}catch(e){throw new Error((l&&l.path||"")+": "+e)}}),t}),define("text!forms/tasks/anchor/view.html",[],function(){return'<li class="link" data-bind="click: <%= Target %>"><%= Label %></li>'}),define("forms/tasks/anchor/controller",["require","text!forms/tasks/anchor/view.html"],function(e){var t=e("text!forms/tasks/anchor/view.html");return{template:t,build:function(e,i){var n=_.template(t),a={};$.extend(!0,a,e),i(new kendo.View(n(a),{wrap:!1}).render())}}}),define("text!forms/tasks/analystByGroup/view.html",[],function(){return'<div id="AssignToAnalystByGroupWindow" class="cireson-window defined-form hide">\r\n    <div class="cireson-window--wrapper">\r\n        <div class="cireson-window--body">\r\n            <div>\r\n                <div id="groupPicker" />\r\n            </div>\r\n\r\n            <div class="form-group">\r\n                <div class="control-label">\r\n                    <label><%= localization.AssignedTo %></label>\r\n                </div>\r\n                <div class="editor-field">\r\n                    <input id="assignedToCombo"\r\n                           data-role="combobox"\r\n                           data-filter="contains"\r\n                           data-bind="source: assignToDataSource, enabled:userEnabled, events: { change: userChange }"\r\n                           data-text-field="Name"\r\n                           data-value-field="Id"\r\n                           data-placeholder="<%=localization.ChooseSupportGroup%>"></input>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="window-buttons cireson-window--footer">\r\n            <button data-role="button"\r\n                    class="btn btn-primary"\r\n                    data-bind="enabled: okEnabled, events: { click: okClick }">\r\n                <%= localization.OK %>\r\n            </button>\r\n            <button data-role="button"\r\n                    class="btn btn-default"\r\n                    data-bind="events: { click: cancelClick }">\r\n                <%= localization.Cancel %>\r\n            </button>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("text!forms/fields/enum/view.html",[],function(){return'<div class="form-group">\r\n    <label class="control-label" for="<%= PropertyName %>" data-localize="<%= PropertyDisplayName %>">\r\n        <span><% if ( Required ){ %> <%= \'(\' + localization.Required + \')\' %><% } %></span>\r\n    </label>\r\n\r\n    <div class="form-control form-control-picker input-sm"\r\n         data-url="/api/V3/Enum/GetList"\r\n         data-combourl="/api/V3/Enum/GetFlatList/"\r\n         data-showpath="<%= ShowPath %>"\r\n         data-mustselectleafnode="<%= LeafNodeOnly %>"\r\n         data-bind="ciresonDropDownTree: \'<%= EnumId %>\', value: <%= PropertyName %>"\r\n         data-disabled="<%= Disabled %>"\r\n         data-role="<%= PropertyName %>"\r\n         data-filter="<%= FilterIds%>",\r\n         data-visible="<%= Visible%>"\r\n        <% if ( Required ){ %>\r\n        required\r\n        <% } %>\r\n        >\r\n\r\n    </div>\r\n\r\n</div>'}),define("forms/fields/enum/controller",["require","text!forms/fields/enum/view.html"],function(e){var t=e("text!forms/fields/enum/view.html");return{template:t,build:function(e,i,n){var a=_.template(t),o={EnumId:"",Required:i.Required,Disabled:i.disabled,LeafNodeOnly:!1,ShowPath:!1,FilterIds:"",Visible:!0};$.extend(!0,o,i),o.Visible&&n(a(o))}}}),define("text!forms/tasks/drawerTask/view.html",[],function(){return'<span data-bind="visible: showTooltip" class="tooltip-container" rel="dynamictooltip" title="<%= toolTipMessage %>"></span>\r\n<li data-bind="click: <%= onClick %>, enabled: isEnabled"><a data-bind="localize: <%= titleKey %>"></a></li>'}),define("forms/tasks/analystByGroup/controller",["require","text!forms/tasks/anchor/view.html","text!forms/tasks/analystByGroup/view.html","forms/fields/enum/controller","text!forms/tasks/drawerTask/view.html"],function(e){var t=e("text!forms/tasks/anchor/view.html"),i=e("text!forms/tasks/analystByGroup/view.html"),n=e("forms/fields/enum/controller"),a=e("text!forms/tasks/drawerTask/view.html");return{template:i,build:function(e,o,r){var l,s,d=e.type,c="BulkEdit"==e.type,u=null,p=null,m=null,f="",v="00000000-0000-0000-0000-000000000000",g=function(t){var i=kendo.observable({analystByGroup:function(){c?(s=i.selectedWorkItem.groupPropertyName,l=i.selectedWorkItem.groupPropertyEnumId):(s=o.Configs.propertyName,l=o.Configs.enumId);var a=t.element.clone(),r=a.kendoCiresonWindow({title:localization.AssignToAnalystByGroup,width:500,height:300,actions:[]}).data("kendoWindow"),d=kendo.observable({propertyName:s,enumId:l,assignToDataSource:C("00000000-0000-0000-0000-000000000000"),userEnabled:!!(e.viewModel&&e.viewModel.SupportGroup&&e.viewModel.SupportGroup.Id||e.viewModel&&e.viewModel.TierQueue&&e.viewModel.TierQueue.Id||e.viewModel&&e.viewModel[pageForm.CRSupportGroupField]&&e.viewModel[pageForm.CRSupportGroupField].Id||e.viewModel&&e.viewModel[pageForm.PRSupportGroupField]&&e.viewModel[pageForm.PRSupportGroupField].Id||e.viewModel&&e.viewModel[pageForm.MASupportGroupField]&&e.viewModel[pageForm.MASupportGroupField].Id||e.viewModel&&e.viewModel.AssignedWorkItem&&e.viewModel.AssignedWorkItem.BaseId),okEnabled:!1,userChange:function(t){d.set("okEnabled",!0),c?(i.set("assignedWorkItem.displayName",t.sender.text()),i.set("assignedWorkItem.baseId",t.sender.value())):(e.viewModel.AssignedWorkItem.set("DisplayName",null),e.viewModel.AssignedWorkItem.set("BaseId",null),e.viewModel.AssignedWorkItem.set("DisplayName",t.sender.text()),e.viewModel.AssignedWorkItem.set("BaseId",t.sender.value()))},okClick:function(){if(r.close(),c){app.lib.mask.apply();var t={ProjectionId:i.selectedWorkItem.projectionId,UpdateServiceManagement:!0,ItemIds:_.pluck(i.currentSelection,"BaseId"),EditedFields:w(i)};$.ajax({url:"/api/v3/workitem/BulkEditWorkItems/",data:JSON.stringify(t),dataType:"json",contentType:"application/json",type:"POST",success:function(){k(i)},error:function(){y()}})}else u=e.viewModel.AssignedWorkItem.get("DisplayName"),p=e.viewModel.AssignedWorkItem.get("BaseId"),"Incident"!=e.type||_.isUndefined(e.viewModel.TierQueue)?"ServiceRequest"!=e.type||_.isUndefined(e.viewModel.SupportGroup)?"ChangeRequest"!=e.type||_.isUndefined(e.viewModel[pageForm.CRSupportGroupField])?"Problem"!=e.type||_.isUndefined(e.viewModel[pageForm.PRSupportGroupField])?"ManualActivity"!=e.type||_.isUndefined(e.viewModel[pageForm.MASupportGroupField])||(m=e.viewModel.get(pageForm.MASupportGroupField)):m=e.viewModel.get(pageForm.PRSupportGroupField):m=e.viewModel.get(pageForm.CRSupportGroupField):m=e.viewModel.get("SupportGroup"):m=e.viewModel.get("TierQueue")},cancelClick:function(){r.close(),c?(i.set("assignedWorkItem.displayName",null),i.set("assignedWorkItem.baseId",null)):(e.viewModel.AssignedWorkItem.set("DisplayName",null),e.viewModel.AssignedWorkItem.set("BaseId",null),e.viewModel.AssignedWorkItem.set("DisplayName",u),e.viewModel.AssignedWorkItem.set("BaseId",p),"Incident"!=e.type||_.isUndefined(e.viewModel.TierQueue)?"ServiceRequest"!=e.type||_.isUndefined(e.viewModel.SupportGroup)?"ChangeRequest"!=e.type||_.isUndefined(e.viewModel[pageForm.CRSupportGroupField])?"ManualActivity"!=e.type||_.isUndefined(e.viewModel[pageForm.MASupportGroupField])||e.viewModel.set(pageForm.MASupportGroupField,m):e.viewModel.set(pageForm.CRSupportGroupField,m):e.viewModel.set("SupportGroup",m):e.viewModel.set("TierQueue",m))}}),f=function(e,t,i){n.build(i,t,function(t){e.html(t),app.controls.apply(e,{localize:!0,vm:i,bind:!0})})};kendo.bind(a,d),function(t,n){var a={PropertyName:t.propertyName,PropertyDisplayName:"SupportGroup",EnumId:t.enumId};f(n.find("#groupPicker"),a,e.viewModel);var o=n.find('div[data-role="'+t.propertyName+'"]');if(o){var r=o.data().handler._dropdown,l=o.data().handler._treeview;r.bind("change",function(e){var a=this.dataItem(this.select()),o=n.find("#assignedToCombo").data("kendoComboBox");x(a,t,o),i.set("assignedSupportGroup",a)}),l.bind("change",function(e){var a=this.dataItem(this.current()),o=n.find("#assignedToCombo").data("kendoComboBox");x(a,t,o),i.set("assignedSupportGroup",a)});var s=e.viewModel&&e.viewModel[t.propertyName]?e.viewModel[t.propertyName]:null;if(s&&!_.isNull(s.Id)&&(t.set("assignToDataSource",C(s.Id)),e.viewModel.AssignedWorkItem.DisplayName)){n.find("#assignedToCombo").data("kendoComboBox").text(e.viewModel.AssignedWorkItem.DisplayName)}}}(d,a),a.removeClass("hide"),a.show(),r.refresh(),r.open()}});return i},b=function(e){var t=e;t.currentSelection=[],t.selectedWorkItem={type:"",projectionId:"",groupPropertyName:"",groupPropertyEnumId:""},t.assignedWorkItem={displayName:"",baseId:""},t.isEnabled=!1,t.showTooltip=!0,t.setEnabled=function(e){this.set("isEnabled",e),this.set("showTooltip",!e)},t.targetControlId="",t.onTargetControlChange=function(i){var n=[];if(n=app.isMobile()?i:i.select().map(function(e,t){return i.dataItem($(t))}).toArray(),n.length>10&&h(),e.set("currentSelection",n),n.length<=0||n.length>10)t.setEnabled(!1);else{var a=_.pluck(n,"WorkItemType"),o=_.pluck(n,"Status"),r=_.reduce(a,function(e,t){return e===t&&e});t.set("selectedWorkItem.type",r);var l=_.reduce(o,function(e,t){return e===t&&e});if(r)switch(r){case"System.WorkItem.ServiceRequest":t.setTrimmedWiType(),t.set("selectedWorkItem.projectionId",app.constants.projectionIds.SystemWorkItemServiceRequestViewModel),t.set("selectedWorkItem.groupPropertyName","SupportGroup"),t.set("selectedWorkItem.groupPropertyEnumId",app.constants.enumPickerIds.ServiceRequestSupportGroup),"Closed"===l?t.setEnabled(!1):t.setEnabled(!0);break;case"System.WorkItem.Incident":t.setTrimmedWiType(),t.set("selectedWorkItem.projectionId",app.constants.projectionIds.SystemWorkItemIncidentViewModel),t.set("selectedWorkItem.groupPropertyName","TierQueue"),t.set("selectedWorkItem.groupPropertyEnumId",app.constants.enumPickerIds.IncidentTierQueue),t.setEnabled(!0);break;case"System.WorkItem.ChangeRequest":t.setTrimmedWiType(),t.set("selectedWorkItem.projectionId",app.constants.projectionIds.SystemWorkItemChangeRequestViewModel),t.set("selectedWorkItem.groupPropertyName",pageForm.CRSupportGroupField),t.set("selectedWorkItem.groupPropertyEnumId",pageForm.CRSupportGroupGuid),t.setEnabled(!0);break;case"System.WorkItem.Problem":t.setTrimmedWiType(),t.set("selectedWorkItem.projectionId",app.constants.projectionIds.SystemWorkItemProblemViewModel),t.set("selectedWorkItem.groupPropertyName",pageForm.PRSupportGroupField),t.set("selectedWorkItem.groupPropertyEnumId",pageForm.PRSupportGroupGuid),t.setEnabled(!0);break;default:t.set("selectedWorkItem.projectionId",""),t.set("selectedWorkItem.groupPropertyName",""),t.set("selectedWorkItem.groupPropertyEnumId",""),t.setEnabled(!1)}else t.setEnabled(!1)}},e.setTrimmedWiType=function(){this.set("selectedWorkItem.trimmedType",this.selectedWorkItem.type.split(/[\s.]+/).pop())}},w=function(e){var t=[];switch(e.selectedWorkItem.trimmedType){case"Incident":t=[{PropertyName:"TierQueue",EditedValue:e.assignedSupportGroup.Id,PropertyType:"enum"},{PropertyName:"AssignedWorkItem",EditedValue:e.assignedWorkItem.baseId,PropertyType:"singleCardinalityObject",PropertyRelationshipId:"15e577a3-6bf9-6713-4eac-ba5a5b7c4722"},{PropertyName:"AppliesToTroubleTicket",PropertyType:"multiplecardinalityobject",PropertyRelationshipId:"a860c62e-e675-b121-f614-e52fcbd9ef2c",EditedValue:{ActionType:{Id:"b04370d9-3d4f-3981-61bb-ac9462a1fe65",Name:"Record Assigned"},Description:localization.RecordAssignedDescription.replace("{0}",session.user.Name).replace("{1}",e.assignedWorkItem.displayName),DescriptionDisplay:localization.RecordAssignedDescription.replace("{0}",session.user.Name).replace("{1}",e.assignedWorkItem.displayName),EnteredBy:session.user.Name,EnteredDate:(new Date).toISOString(),LastModified:(new Date).toISOString(),Title:localization.RecordAssigned,Image:app.config.iconPath+app.config.icons["Record Assigned"]}}];break;case"ServiceRequest":t=[{PropertyName:"SupportGroup",EditedValue:e.assignedSupportGroup.Id,PropertyType:"enum"},{PropertyName:"AssignedWorkItem",EditedValue:e.assignedWorkItem.baseId,PropertyType:"singleCardinalityObject",PropertyRelationshipId:"15e577a3-6bf9-6713-4eac-ba5a5b7c4722"},{PropertyName:"AppliesToWorkItem",PropertyType:"multiplecardinalityobject",PropertyRelationshipId:"79d27435-5917-b0a1-7911-fb2b678f32a6",EditedValue:{ActionType:{Id:"b04370d9-3d4f-3981-61bb-ac9462a1fe65",Name:"Record Assigned"},Description:localization.RecordAssignedDescription.replace("{0}",session.user.Name).replace("{1}",e.assignedWorkItem.displayName),DescriptionDisplay:localization.RecordAssignedDescription.replace("{0}",session.user.Name).replace("{1}",e.assignedWorkItem.displayName),EnteredBy:session.user.Name,EnteredDate:(new Date).toISOString(),LastModified:(new Date).toISOString(),Title:localization.RecordAssigned,Image:app.config.iconPath+app.config.icons["Record Assigned"]}}];break;case"ChangeRequest":t=[{PropertyName:pageForm.CRSupportGroupField,EditedValue:e.assignedSupportGroup.Id,PropertyType:"enum"},{PropertyName:"AssignedWorkItem",EditedValue:e.assignedWorkItem.baseId,PropertyType:"singleCardinalityObject",PropertyRelationshipId:"15e577a3-6bf9-6713-4eac-ba5a5b7c4722"},{PropertyName:"AppliesToWorkItem",PropertyType:"multiplecardinalityobject",PropertyRelationshipId:"79d27435-5917-b0a1-7911-fb2b678f32a6",EditedValue:{ActionType:{Id:"b04370d9-3d4f-3981-61bb-ac9462a1fe65",Name:"Record Assigned"},Description:localization.RecordAssignedDescription.replace("{0}",session.user.Name).replace("{1}",e.assignedWorkItem.displayName),DescriptionDisplay:localization.RecordAssignedDescription.replace("{0}",session.user.Name).replace("{1}",e.assignedWorkItem.displayName),EnteredBy:session.user.Name,EnteredDate:(new Date).toISOString(),LastModified:(new Date).toISOString(),Title:localization.RecordAssigned,Image:app.config.iconPath+app.config.icons["Record Assigned"]}}];break;case"Problem":t=[{PropertyName:pageForm.PRSupportGroupField,EditedValue:e.assignedSupportGroup.Id,PropertyType:"enum"},{PropertyName:"AssignedWorkItem",EditedValue:e.assignedWorkItem.baseId,PropertyType:"singleCardinalityObject",PropertyRelationshipId:"15e577a3-6bf9-6713-4eac-ba5a5b7c4722"},{PropertyName:"AppliesToWorkItem",PropertyType:"multiplecardinalityobject",PropertyRelationshipId:"79d27435-5917-b0a1-7911-fb2b678f32a6",EditedValue:{ActionType:{Id:"b04370d9-3d4f-3981-61bb-ac9462a1fe65",Name:"Record Assigned"},Description:localization.RecordAssignedDescription.replace("{0}",session.user.Name).replace("{1}",e.assignedWorkItem.displayName),DescriptionDisplay:localization.RecordAssignedDescription.replace("{0}",session.user.Name).replace("{1}",e.assignedWorkItem.displayName),EnteredBy:session.user.Name,EnteredDate:(new Date).toISOString(),LastModified:(new Date).toISOString(),Title:localization.RecordAssigned,Image:app.config.iconPath+app.config.icons["Record Assigned"]}}]}return t},h=function(){kendo.ui.ExtAlertDialog.show({title:localizationHelper.localize("Warning"),message:localizationHelper.localize("BulkEditExceedMessage")})},k=function(e){if(app.isMobile()){$("[data-control-id='"+e.targetControlId+"']").data("kendoListView").dataSource.query()}else{var t=$("#"+e.targetControlId).data("kendoGrid"),i=app.gridUtils.savedState.getCurrentState(e.targetControlId);app.lib.recheckGridState(i,t),t.dataSource.query(i)}app.lib.message.add(localizationHelper.localize("SaveSuccessMessage"),"success"),app.lib.mask.remove(),app.lib.message.show()},y=function(){app.lib.message.add(localizationHelper.localize("SaveErrorMessage"),"danger"),app.lib.mask.remove(),app.lib.message.show()},I=function(){_.isUndefined(e.viewModel.AssignedWorkItem)||(u=e.viewModel.AssignedWorkItem.DisplayName,p=e.viewModel.AssignedWorkItem.BaseId),"Incident"==d?(m=e.viewModel.TierQueue,f=_.isNull(e.viewModel.TierQueue)||_.isUndefined(e.viewModel.TierQueue)?"":e.viewModel.TierQueue.Name,v=_.isNull(e.viewModel.TierQueue)||_.isUndefined(e.viewModel.TierQueue)?"00000000-0000-0000-0000-000000000000":e.viewModel.TierQueue.Id):"ServiceRequest"==d?(m=e.viewModel.SupportGroup,f=_.isNull(e.viewModel.SupportGroup)||_.isUndefined(e.viewModel.SupportGroup)?"":e.viewModel.SupportGroup.Name,v=_.isNull(e.viewModel.SupportGroup)||_.isUndefined(e.viewModel.SupportGroup)?"00000000-0000-0000-0000-000000000000":e.viewModel.SupportGroup.Id):"ChangeRequest"==d?(m=e.viewModel[pageForm.CRSupportGroupField],f=_.isNull(e.viewModel[pageForm.CRSupportGroupField])||_.isUndefined(e.viewModel[pageForm.CRSupportGroupField])?"":e.viewModel[pageForm.CRSupportGroupField].Name,v=_.isNull(e.viewModel[pageForm.CRSupportGroupField])||_.isUndefined(e.viewModel[pageForm.CRSupportGroupField])?"00000000-0000-0000-0000-000000000000":e.viewModel[pageForm.CRSupportGroupField].Id):"Problem"==d?(m=e.viewModel[pageForm.PRSupportGroupField],f=_.isNull(e.viewModel[pageForm.PRSupportGroupField])||_.isUndefined(e.viewModel[pageForm.PRSupportGroupField])?"":e.viewModel[pageForm.PRSupportGroupField].Name,v=_.isNull(e.viewModel[pageForm.PRSupportGroupField])||_.isUndefined(e.viewModel[pageForm.PRSupportGroupField])?"00000000-0000-0000-0000-000000000000":e.viewModel[pageForm.PRSupportGroupField].Id):"ManualActivity"==d&&(m=e.viewModel[pageForm.MASupportGroupField],f=_.isNull(e.viewModel[pageForm.MASupportGroupField])||_.isUndefined(e.viewModel[pageForm.MASupportGroupField])?"":e.viewModel[pageForm.MASupportGroupField].Name,v=_.isNull(e.viewModel[pageForm.MASupportGroupField])||_.isUndefined(e.viewModel[pageForm.MASupportGroupField])?"00000000-0000-0000-0000-000000000000":e.viewModel[pageForm.MASupportGroupField].Id),_.isUndefined(m)||_.isNull(m)||(m.Text=m.Name)},C=function(e){return new kendo.data.DataSource({transport:{read:{url:app.lib.addUrlParam("/api/V3/User/GetSupportGroupUsers","id",e),dataType:"json"}},schema:{model:{fields:{Id:{type:"string"},Name:{type:"string"}}}}})},S=function(e){e.focus(),e.value(""),e.input.attr("placeholder",localization.ChooseOne)},x=function(t,i,n){_.isUndefined(t)||(c||("Incident"!=e.type||_.isUndefined(e.viewModel.TierQueue)?"ServiceRequest"!=e.type||_.isUndefined(e.viewModel.SupportGroup)?"ChangeRequest"!=e.type||_.isUndefined(e.viewModel[pageForm.CRSupportGroupField])?"Problem"!=e.type||_.isUndefined(e.viewModel[pageForm.PRSupportGroupField])||e.viewModel.set(pageForm.PRSupportGroupField,t):e.viewModel.set(pageForm.CRSupportGroupField,t):e.viewModel.set("SupportGroup",t):e.viewModel.set("TierQueue",t)),i.set("userEnabled",!0),i.set("okEnabled",!0),S(n),i.set("assignToDataSource",C(t.Id)),u&&($("#assignedToCombo-list").hide(),n.text(u),setTimeout(function(){0===n.items().length&&(S(n),e.viewModel.AssignedWorkItem.set("DisplayName",null),e.viewModel.AssignedWorkItem.set("BaseId",null))},250)))},T={windowEle:function(){var e=_.template(i),t=new kendo.View(e(),{wrap:!1});return r(t.render()),t.destroy(),t},taskListItem:function(e,t,i){$.extend(!0,e,o);var n=_.template(i),a=new kendo.View(n(e),{wrap:!1,model:t});return r(a.render()),a}};!function(){var e=T.windowEle();c||I();var i=g(e);c?(b(i),T.taskListItem({onClick:"analystByGroup",toolTipMessage:localizationHelper.localize("MustSelectSameType")},i,a),app.isMobile()?(app.events.subscribe("mobileWiListSelectionChange",function(e,t){_.isUndefined(t)||(i.onTargetControlChange(t.selectedCards),i.targetControlId=t.controlId)}),app.events.subscribe("mobileWiListInit",function(e,t){_.isUndefined(t)||(i.onTargetControlChange(t.selectedCards),i.targetControlId=t.controlId)})):(app.events.subscribe("gridChange",function(e,t){i.onTargetControlChange(t),i.targetControlId=$(t.wrapper).attr("id")}),app.events.subscribe("gridBound",function(e,t){i.onTargetControlChange(t),i.targetControlId=$(t.wrapper).attr("id")}))):T.taskListItem({Target:"analystByGroup"},i,t)}()}}}),define("text!forms/popups/notificationPopup/view.html",[],function(){return'<div class="popupNotification"></div>'}),define("forms/tasks/assignToMe/controller",["require","text!forms/tasks/anchor/view.html","text!forms/popups/notificationPopup/view.html"],function(e){var t=e("text!forms/tasks/anchor/view.html"),i=e("text!forms/popups/notificationPopup/view.html");return{notificationTemplate:i,build:function(e,n,a){var o=_.template(i),r=new kendo.View(o(d),{wrap:!1});a(r.render());var l=kendo.observable({displayName:n.Configs.displayName,baseId:n.Configs.baseId,target:n.Configs.target,assignToMe:function(){e.viewModel.AssignedWorkItem.set("BaseId",this.baseId),e.viewModel.AssignedWorkItem.set("DisplayName",this.displayName);var t=r.element,i=t.kendoNotification({height:"80px",templates:[{type:"info",template:"<div class='success k-ext-dialog-content'><div class='k-ext-dialog-icon fa fa-check'></div><div class='k-ext-dialog-message'>#= message #</div></div>"}]}).data("kendoNotification"),n=localizationHelper.localize(localization.AssignedToMeNotificationMessage,"This workitem is assigned to {0}");i.show({message:n.replace("{0}",session.user.Name)},"info")}}),s=_.template(t),d={Target:"assignToMe"};$.extend(!0,d,n),a(new kendo.View(s(d),{wrap:!1,model:l,init:function(e){}}).render())}}}),define("text!forms/tasks/changeStatus/view.html",[],function(){return'<div id="ChangeStatusWindow" class="cireson-window defined-form hide">\r\n    <div class="cireson-window--wrapper">\r\n        <div class="cireson-window--body">\r\n            <div id="statusPicker" />\r\n            <div id="resolutionPicker" data-bind="visible: showResolution" />\r\n            <div id="resolutionDescription" data-bind="visible: showResolution" />\r\n            <div id="comment" data-bind="visible: showComment" />\r\n            <div id="autoResolve" data-bind="visible: showAutoResolve" />\r\n            <div id="letAnalystDecide" data-bind="visible: letAnalystDecide" />\r\n        </div>\r\n        <div class="cireson-window--footer window-buttons">\r\n            <div id="changeStatusErrorWin" class="error"></div>\r\n            <button data-role="button"\r\n                    class="btn btn-primary"\r\n                    data-bind="enabled: okEnabled, events: { click: okClick }">\r\n                <%= localization.OK %>\r\n            </button>\r\n            <button data-role="button"\r\n                    class="btn btn-default"\r\n                    data-bind="events: { click: cancelClick }">\r\n                <%= localization.Cancel %>\r\n            </button>\r\n        </div>\r\n    </div>\r\n</div>'}),define("text!forms/tasks/changeStatus/view.drawer.html",[],function(){
return'<div class="cireson-window defined-form hide">\r\n    <div class="cireson-window--wrapper">\r\n        <div class="cireson-window--body">\r\n            \x3c!-- status picker for IR or SR statuses --\x3e\r\n            <div class="form-group">\r\n                <label class="control-label" data-bind="localize: Status">\r\n                </label>\r\n                <div class="form-control form-control-picker input-sm"\r\n                     data-role="Status"\r\n                     data-url="/api/V3/Enum/GetList"\r\n                     data-combourl="/api/V3/Enum/GetFlatList/"\r\n                     data-disabled="false"\r\n                     data-bind="ciresonDropDownTree: wiStatusTypeId, value: newStatusObj, options: { showPath: showPath,  mustSelectLeafNode: leafNodeOnly }"></div>\r\n            </div>\r\n            \x3c!-- resolution category picker for IR --\x3e\r\n            <div data-bind="visible: irStatusResolved">\r\n                <div class="form-group">\r\n                    <label class="control-label">\r\n                        <span data-bind="localize: ResolutionCategory"></span> (<span data-bind="localize: Required"></span>)\r\n                    </label>\r\n                    <div class="form-control form-control-picker input-sm"\r\n                         data-role="Resolution"\r\n                         data-url="/api/V3/Enum/GetList"\r\n                         data-combourl="/api/V3/Enum/GetFlatList/"\r\n                         data-disabled="false"\r\n                         data-bind="ciresonDropDownTree: resolutionResultEnumId, value: newResolutionId, options: { showPath: showPath,  mustSelectLeafNode: leafNodeOnly }"></div>\r\n\r\n                </div>\r\n                \x3c!-- resolution description for IR --\x3e\r\n                <div class="form-group">\r\n                    <label class="control-label" data-bind="localize: ResolutionDescription">\r\n                    </label>\r\n                    <textarea class="k-textbox form-control input-sm" rows="5"\r\n                              data-bind="value: resolutionDescription" maxlength="4000"></textarea>\r\n                </div>\r\n\r\n                \x3c!-- resolve child incidents: let analyst decide option--\x3e\r\n                <div class="form-group" data-bind="visible: irResolveChildOption">\r\n                    <div class="checkbox  checkbox-inline ">\r\n                        <input type="checkbox" name="resolveChildIncident" data-bind="checked: resolveChildIncident">\r\n                        <label class="control-label" for="resolveChildIncident">\r\n                            <span data-bind="localize: ResolveChildIncidentMessage" />\r\n                        </label>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div data-bind="visible: srStatusCompleted">\r\n                \x3c!-- SR Implementation Results --\x3e\r\n                <div class="form-group">\r\n                    <label class="control-label">\r\n                        <span data-bind="localize: ImplementationResults"></span>\r\n                    </label>\r\n                    <div class="form-control form-control-picker input-sm"\r\n                         data-role="Resolution"\r\n                         data-url="/api/V3/Enum/GetList"\r\n                         data-combourl="/api/V3/Enum/GetFlatList/"\r\n                         data-disabled="false"\r\n                         data-bind="ciresonDropDownTree: resolutionResultEnumId, value: newResultId, options: { showPath: showPath,  mustSelectLeafNode: leafNodeOnly }"></div>\r\n\r\n                </div>\r\n                \x3c!-- SR Implementation Notes --\x3e\r\n                <div class="form-group">\r\n                    <label class="control-label">\r\n                        <span data-bind="localize: Implementationnotes"></span> (<span data-bind="localize: Required"></span>)\r\n                    </label>\r\n                    <textarea class="k-textbox form-control input-sm" rows="5"\r\n                              data-bind="value: resultNote" maxlength="4000"></textarea>\r\n                </div>\r\n            </div>\r\n            \x3c!-- comment for SR in \'Cancelled\' status --\x3e\r\n            <div class="form-group" data-bind="visible: srStatusCancelled">\r\n                <label class="control-label" data-bind="localize: Comment">\r\n                </label>\r\n                <textarea class="k-textbox form-control input-sm" rows="5"\r\n                          data-bind="value: resultComment" maxlength="4000"></textarea>\r\n            </div>\r\n        </div>\r\n        <div class="cireson-window--footer window-buttons">\r\n            <div id="changeStatusErrorWin" class="error"></div>\r\n            <button data-role="button" class="btn btn-primary"\r\n                    data-bind="enabled: okEnabled,\r\n                           events: { click: okClick }">\r\n                <%= localization.OK %>\r\n            </button>\r\n            <button data-role="button" class="btn btn-default"\r\n                    data-bind="events: { click: cancelClick }">\r\n                <%= localization.Cancel %>\r\n            </button>\r\n        </div>\r\n    </div>\r\n</div>'}),define("text!forms/fields/longstring/view.html",[],function(){return'<div class="form-group <%= visible %>" style="">\r\n\r\n    <label class="control-label" for="<%= PropertyName %>" data-localize="<%= PropertyDisplayName %>">\r\n        <span><% if ( Required ){ %> <%= \'(\' + localization.Required + \')\' %><% } %></span>\r\n    </label>\r\n    <textarea name="<%= PropertyName %>"\r\n              class="k-textbox form-control input-sm"\r\n              rows="<%= Rows %>"\r\n              data-bind="value: <%= PropertyName %><% if ( LimitLength ){ %>, events : { blur: view.longStringController.CheckLength }<% } %>"\r\n        <% if ( LimitLength ){ %>\r\n        maxlength="<%= MaxLength %>"\r\n        <% } %>\r\n\r\n        <% if ( Disabled ){ %>\r\n        readonly\r\n        <% } %>\r\n\r\n        <% if ( Required ){ %>\r\n        required\r\n        <% } %>\r\n\r\n        >\r\n    </textarea>\r\n    <% if ( LimitLength ){ %>\r\n    <p class="help-block validation-summary-errors" style="display: none;"><%= localization.MaxLengthError.replace("{0}", MaxLength) %></p>\r\n    <% } %>\r\n</div>\r\n<script>\r\n    $(\'textarea[name=ResolutionDescription]\').removeClass(\'form-control\');\r\n<\/script>\r\n'}),define("forms/fields/longstring/controller",["require","text!forms/fields/longstring/view.html"],function(e){var t=e("text!forms/fields/longstring/view.html");return{template:t,build:function(e,i,n){var a=i.vm,o=new kendo.View;_.isUndefined(a.view)&&(a.view=[]),a.view.longStringController={CheckLength:function(e){setTimeout(function(){var t=$(e.currentTarget),i=t.next(),n=t.attr("maxlength");t.val().length>n?(t.attr("data-invalid",""),i.show()):(i.hide(),t.removeAttr("data-invalid"),t.data("prevent",!1))},100)}},a.view.buildLongStringView=function(){var e=_.template(t),r=!1;_.isUndefined(i.MinLength)&&_.isUndefined(i.MaxLength)||(r=!0);var l={Required:i.Required,Disabled:i.disabled,MinLength:i.MinLength,MaxLength:i.MaxLength,LimitLength:r,Rows:10,visible:_.isUndefined(i.IsVisible)||0!=i.IsVisible?"":"hidden"};$.extend(!0,l,i),o=new kendo.View(e(l),{wrap:!1,model:a}),n(o.render())},a.view.buildLongStringView()}}}),define("text!forms/fields/boolean/view.html",[],function(){return'<div class="form-group <%= visible %>">\r\n    <% if ( !Inline ){ %>\r\n    <label class="control-label" data-localize="<%= PropertyDisplayName %>"><span><% if ( Required ){ %> <%= \'(\' + localization.Required + \')\' %><% } %></span></label>\r\n    <% } %>\r\n\r\n    <div class="checkbox <% if ( Inline ){ %> checkbox-inline <% } else { %> checkbox-block <% } %>">\r\n        <input type="checkbox"\r\n               name="<%= PropertyName %>"\r\n               id="<%= PropertyName %>"\r\n               data-bind="checked: <%= PropertyName %>"<% if ( Disabled ){ %>\r\n        disabled\r\n        <% } %>\r\n\r\n        />\r\n\r\n\r\n        <label class="control-label" for="<%= PropertyName %>">\r\n            <% if ( Inline ){ %>\r\n            <span data-localize="<%= PropertyDisplayName %>"></span>\r\n            <% } %>\r\n        </label>\r\n\r\n    </div>\r\n</div>'}),define("forms/fields/boolean/controller",["require","text!forms/fields/boolean/view.html"],function(e){var t=e("text!forms/fields/boolean/view.html");return{template:t,build:function(e,i,n){var a=_.template(t),o={Disabled:i.disabled,Required:i.Required,Inline:i.Inline||!1,visible:_.isUndefined(i.IsVisible)||0!=i.IsVisible?"":"hidden"};$.extend(!0,o,i),n(a(o))}}}),define("forms/tasks/changeStatus/controller",["require","text!forms/tasks/anchor/view.html","text!forms/tasks/changeStatus/view.html","text!forms/tasks/changeStatus/view.drawer.html","forms/fields/enum/controller","forms/fields/longstring/controller","forms/fields/boolean/controller","text!forms/tasks/drawerTask/view.html"],function(e){var t=e("text!forms/tasks/anchor/view.html"),i=e("text!forms/tasks/changeStatus/view.html"),n=e("text!forms/tasks/changeStatus/view.drawer.html"),a=e("forms/fields/enum/controller"),o=e("forms/fields/longstring/controller"),r=e("forms/fields/boolean/controller"),l=e("text!forms/tasks/drawerTask/view.html");return{template:i,build:function(e,s,d){"Problem"==e.type&&_.isUndefined(e.viewModel.IsAutoResolve)&&e.viewModel.set("IsAutoResolve",e.viewModel.AutoResolve);var c;if("BulkEdit"!=e.type)var u={Status:_.clone(e.viewModel.Status),ResolutionCategory:_.isUndefined(e.viewModel.ResolutionCategory)?null:_.clone(e.viewModel.ResolutionCategory),ResolutionDescription:_.clone(e.viewModel.ResolutionDescription),ChildWorkItem:_.clone(e.viewModel.ChildWorkItem),Notes:_.clone(e.viewModel.Notes),ImplementationResults:_.isUndefined(e.viewModel.ImplementationResults)?null:_.clone(e.viewModel.ImplementationResults),RelatesToWorkItem:_.clone(e.viewModel.RelatesToWorkItem),Resolution:_.isUndefined(e.viewModel.Resolution)?null:_.clone(e.viewModel.Resolution),AutoResolve:!_.isUndefined(e.viewModel.AutoResolve)&&_.clone(e.viewModel.AutoResolve)};var p=app.constants.workItemStatuses,m=p.Incident.Resolved,f=p.Incident.Active,v=p.Incident.Closed,g=p.Incident.Pending,b=p.ServiceRequest.Cancelled,w=p.ServiceRequest.Completed,h=p.ServiceRequest.Submitted,k=p.ServiceRequest.InProgress,y=p.ServiceRequest.OnHold,I=p.ServiceRequest.Failed,C=p.ServiceRequest.Closed,S=p.ChangeRequest.Failed,x=p.ChangeRequest.Closed,T=p.ChangeRequest.InProgress,M=p.ChangeRequest.OnHold,A=p.ChangeRequest.Cancelled,D=p.ChangeRequest.Submitted,R=p.ChangeRequest.Completed,P=p.Problem.Resolved,N=p.Problem.Closed,z=p.ReleaseRecord.Closed,E=p.ReleaseRecord.Cancelled,F=p.ReleaseRecord.Completed,W=p.ReleaseRecord.Failed,L=p.ReleaseRecord.Editing,B=p.ReleaseRecord.OnHold,O=p.ReleaseRecord.InProgress,U=function(t){return kendo.observable({changeStatus:function(){var i=t.element.clone(),n=i.kendoCiresonWindow({title:localization.ChangeStatusTask,width:600,height:480,actions:[],activate:function(){var t=a.type,i=e.viewModel.Status.Id;q(t,i,r,o,a.enumId)}}).data("kendoWindow"),a=kendo.observable({enumId:s.Configs.statusEnumId,resolutionCategoryEnumId:s.Configs.resolutionCategoryEnumId,type:s.Configs.type,resolveChildSettings:null,letAnalystDecide:!1,workItemModel:e.viewModel,okEnabled:!1,requireResolution:!1,resolveChildIncident:!0,okClick:function(){var t=app.controls.getWorkItemLogType(e.viewModel);if(_.isString(e.viewModel.Status.Name)&&e.viewModel.Status.Name.length<1)e.viewModel.set("Status",{Id:u.Status.Id,Name:u.Status.Name});else if(this.requireResolution&&!_.isUndefined(e.viewModel.ResolutionCategory)&&_.isNull(e.viewModel.ResolutionCategory.Id))i.find("#changeStatusErrorWin").html(localization.RequestCategoryRequiredError);else if(this.requireResolution&&_.isNull(e.viewModel.Notes)&&"ServiceRequest"==e.type)i.find("#changeStatusErrorWin").html(localization.ImplementationNotesRequiredError);else if(e.viewModel.Status.Id===m){e.viewModel.set("ResolvedDate",(new Date).toISOString());var a=$("input[name='ResolvedDate']");"datePicker"==a.attr("data-control")?a.val(kendo.toString(new Date,"d")):"dateTimePicker"==a.attr("data-control")&&a.val(kendo.toString(new Date,"g")),t&&e.viewModel[t].unshift(new app.dataModels.AppliesToTroubleTicket.recordResolved(e.viewModel.ResolutionDescription)),e.viewModel.RelatesToTroubleTicket={BaseId:session.user.Id},e.viewModel.IsParent&&(this.resolveChildSettings.ResolveChildIncident||this.resolveChildSettings.ResolvedLetAnalystDecide&&this.resolveChildIncident)&&ae(this.resolveChildSettings),i.find("#changeStatusErrorWin").html(""),n.close()}else if(e.viewModel.Status.Id===v||e.viewModel.Status.Id===C||e.viewModel.Status.Id===N){e.viewModel.set("ClosedDate",(new Date).toISOString());var o=$("input[name='ClosedDate']");switch("datePicker"==o.attr("data-control")?o.val(kendo.toString(new Date,"d")):"dateTimePicker"==o.attr("data-control")&&o.val(kendo.toString(new Date,"g")),e.viewModel.Status.Id){case N:e.viewModel.RelatesToTroubleTicket_={BaseId:session.user.Id};break;case v:e.viewModel.RelatesToTroubleTicket_={BaseId:session.user.Id},e.viewModel[t].unshift(new app.dataModels.AppliesToTroubleTicket.recordClosed);break;case C:e.viewModel.ClosedByUser={BaseId:session.user.Id}}i.find("#changeStatusErrorWin").html(""),n.close()}else if(e.viewModel.Status.Id===f){e.viewModel.RelatesToTroubleTicket={BaseId:null},e.viewModel.ResolutionCategory.set("Id",null),e.viewModel.ResolutionCategory.set("Name",""),e.viewModel.set("ResolutionDescription",null),e.viewModel.set("ResolvedDate",null);var t=app.controls.getWorkItemLogType(e.viewModel);t&&e.viewModel[t].unshift(new app.dataModels.AppliesToTroubleTicket.recordActivated),i.find("#changeStatusErrorWin").html(""),n.close()}else if(e.viewModel.Status.Id===w){e.viewModel.set("CompletedDate",(new Date).toISOString());var r=$("input[name='CompletedDate']");"datePicker"==r.attr("data-control")?r.val(kendo.toString(new Date,"d")):"dateTimePicker"==r.attr("data-control")&&r.val(kendo.toString(new Date,"g")),i.find("#changeStatusErrorWin").html(""),n.close()}else if(e.viewModel.Status.Id===P){e.viewModel.set("ResolvedDate",(new Date).toISOString());var r=$("input[name='ResolvedDate']");"datePicker"==r.attr("data-control")?r.val(kendo.toString(new Date,"d")):"dateTimePicker"==r.attr("data-control")&&r.val(kendo.toString(new Date,"g")),e.viewModel.RelatesToTroubleTicket={BaseId:session.user.Id},e.viewModel.IsAutoResolve&&oe(),e.viewModel.set("AutoResolve",e.viewModel.IsAutoResolve),i.find("#changeStatusErrorWin").html(""),n.close()}else i.find("#changeStatusErrorWin").html(""),n.close()},cancelClick:function(){e.viewModel.set("Status",{Id:u.Status.Id,Name:u.Status.Name}),"Incident"===s.Configs.type&&(e.viewModel.set("ResolutionCategory",{Id:u.ResolutionCategory.Id,Name:u.ResolutionCategory.Name}),e.viewModel.set("ResolutionDescription",u.ResolutionDescription),e.viewModel.set("ChildWorkItem",u.ChildWorkItem)),"ServiceRequest"===s.Configs.type&&(e.viewModel.set("ImplementationResults",{Id:u.ImplementationResults.Id,Name:u.ImplementationResults.Name}),e.viewModel.set("Notes",u.Notes)),"Problem"===s.Configs.type&&(e.viewModel.set("Resolution",{Id:u.Resolution.Id,Name:u.Resolution.Name}),e.viewModel.set("ResolutionDescription",u.ResolutionDescription),e.viewModel.set("RelatedWorkItems",u.RelatesToWorkItem),e.viewModel.set("AutoResolve",u.AutoResolve),e.viewModel.set("IsAutoResolve",u.AutoResolve)),n.close()},showComment:e.viewModel.Status.Id==b,showResolution:e.viewModel.Status.Id==m||e.viewModel.Status.Id==w||e.viewModel.Status.Id==P,showAutoResolve:e.viewModel.Status.Id==P});kendo.bind(i,a),J(a,i);var o=i.find('div[data-role="Status"]').data().handler._dropdown,r=i.find('div[data-role="Status"]').data().handler._treeview;o.bind("change",function(t){e.viewModel.set("okEnabled",!1),ne(e.viewModel.Status.Id,a)}),r.bind("change",function(t){e.viewModel.set("okEnabled",!1),ne(e.viewModel.Status.Id,a)}),"Incident"===a.type&&K(a,i),"ServiceRequest"===a.type&&H(a,i),"Problem"===a.type&&G(a,i),i.removeClass("hide"),i.show(),n.open()}})},j=function(e){var t=kendo.observable({currentSelection:[],currentSelectionOfParents:[],containsParents:!1,selectedWorkItem:{type:"",trimmedType:"",projectionId:"",currentStatusId:"",currentStatusName:"",statusTypeId:"",resolutionResultEnumId:""},openModal:function(){function t(){var e=o.get("newStatusObj");e&&ie(e.Id,i.selectedWorkItem.currentStatusId,o)}if(this.isEnabled){var i=this,n=e.element.clone(),a=n.kendoCiresonWindow({title:localization.ChangeStatusTask,actions:[],activate:function(){var e=i.selectedWorkItem.trimmedType,t=i.selectedWorkItem.currentStatusId;q(e,t,l,r,i.selectedWorkItem.statusTypeId)}}).data("kendoWindow"),o=kendo.observable({selectedWorkItems:i.currentSelection,selectedParents:i.currentSelectionOfParents,resolveChildSettings:null,resolveChildIncident:!0,newStatusObj:{Id:null,Name:null},newResolutionId:"",resolutionDescription:"",newResultId:"",resultNote:"",resultComment:"",showPath:!1,leafNodeOnly:!1,wiStatusTypeId:i.selectedWorkItem.statusTypeId,resolutionResultEnumId:i.selectedWorkItem.resolutionResultEnumId,irStatusResolved:!1,srStatusCompleted:!1,srStatusCancelled:!1,irCategoryRequired:!1,srNotesRequired:!1,irResolveChildOption:!1,okEnabled:!1,okClick:function(){var e=this;if(le(e,n))if(e.irStatusResolved&&(c.ResolveChildIncident||e.irResolveChildOption&&e.resolveChildIncident)&&i.containsParents)se(i,e,a);else{var t={ProjectionId:i.selectedWorkItem.projectionId,UpdateServiceManagement:!0,ItemIds:_.pluck(e.selectedWorkItems,"BaseId"),EditedFields:ee(e)};de(t,i,a)}},cancelClick:function(){a.close()}});kendo.bind(n,o);var r=n.find('div[data-role="Status"]').data().handler._dropdown,l=n.find('div[data-role="Status"]').data().handler._treeview;r.bind("change",function(e){t()}),l.bind("change",function(e){t()}),"Incident"===i.selectedWorkItem.trimmedType&&i.selectedWorkItem.currentStatusId===app.constants.workItemStatuses.Incident.Resolved&&(o.set("irStatusResolved",!0),o.set("irCategoryRequired",!0)),"ServiceRequest"===i.selectedWorkItem.trimmedType&&(i.selectedWorkItem.currentStatusId===app.constants.workItemStatuses.ServiceRequest.Completed?(o.set("srStatusCompleted",!0),o.set("srStatusCancelled",!1)):i.selectedWorkItem.currentStatusId===app.constants.workItemStatuses.ServiceRequest.Cancelled&&(o.set("srStatusCancelled",!0),o.set("srStatusCompleted",!1))),n.removeClass("hide"),n.show(),a.open()}},isEnabled:!1,showTooltip:!0,setEnabled:function(e){this.set("isEnabled",e),this.set("showTooltip",!e)},targetControlId:"",onTargetControlChange:function(e){t.set("currentSelectionOfParents",[]),t.set("containsParents",!1);var i=[];if(i=app.isMobile()?e:e.select().map(function(t,i){return e.dataItem($(i))}).toArray(),i.length>10&&this.onExceedSelectionCount(),t.set("currentSelection",i),i.length<=0||i.length>10)t.setEnabled(!1);else{var n=_.pluck(i,"WorkItemType"),a=_.pluck(i,"StatusId"),o=_.pluck(i,"Status"),r=_.reduce(n,function(e,t){return e===t&&e});t.set("selectedWorkItem.type",r);var l=_.reduce(a,function(e,t){return e===t&&e}),s=_.reduce(o,function(e,t){return e===t&&e});if(t.set("selectedWorkItem.currentStatusId",l),t.set("selectedWorkItem.currentStatusName",s),l&&r)switch(r){case"System.WorkItem.ServiceRequest":t.setTrimmedWiType(),t.set("selectedWorkItem.projectionId",app.constants.projectionIds.SystemWorkItemServiceRequestViewModel),t.set("selectedWorkItem.statusTypeId",app.constants.workItemStatuses.ServiceRequest.Id),t.set("selectedWorkItem.resolutionResultEnumId",app.constants.enumPickerIds.ServiceRequestImplementationResults),session.consoleSetting.AnalystPortalLicense.IsValid?"Closed"===s?t.setEnabled(!1):t.setEnabled(!0):t.setEnabled(!1);break;case"System.WorkItem.Incident":var d=[];_.each(i,function(e){e.IsParent&&(t.set("containsParents",!0),d.push(e))}),t.set("currentSelectionOfParents",d),t.setTrimmedWiType(),t.set("selectedWorkItem.projectionId",app.constants.projectionIds.SystemWorkItemIncidentViewModel),t.set("selectedWorkItem.statusTypeId",app.constants.workItemStatuses.Incident.Id),t.set("selectedWorkItem.resolutionResultEnumId",app.constants.enumPickerIds.IncidentResolution),t.setEnabled(!0);break;default:t.set("selectedWorkItem.projectionId",""),t.set("selectedWorkItem.statusTypeId",""),t.set("selectedWorkItem.resolutionResultEnumId",""),t.setEnabled(!1)}else t.setEnabled(!1)}},setTrimmedWiType:function(){this.set("selectedWorkItem.trimmedType",this.selectedWorkItem.type.split(/[\s.]+/).pop())},onExceedSelectionCount:function(){kendo.ui.ExtAlertDialog.show({title:localizationHelper.localize("Warning"),message:localizationHelper.localize("BulkEditExceedMessage")})}});return t},q=function(e,t,i,n,a){var o=re(),r=o[e][t];"Incident"==e&&_.isUndefined(r)&&(r={field:"Id",operator:"neq",value:app.constants.workItemStatuses.Incident.Closed}),i.dataSource.options.serverFiltering=!1,i.dataSource.filter(r),$.get("/api/V3/Enum/GetFlatList/",{id:a,itemFilter:""},function(e){var t=new kendo.data.DataSource;t.data(e),t.filter(r),t.view().length>0&&n.setDataSource(t.view())}),c=te()},V={windowEle:function(e){var t=_.template(e),i=new kendo.View(t(),{wrap:!1});return d(i.render()),i},taskListItem:function(e,t,i){$.extend(!0,e,s);var n=_.template(i),a=new kendo.View(n(e),{wrap:!1,model:t});return d(a.render()),a}},G=function(t,i){var n={PropertyName:"Resolution",PropertyDisplayName:"Resolution",Required:!1,EnumId:t.resolutionCategoryEnumId};Q(i.find("#resolutionPicker"),n,e.viewModel);var a={PropertyName:"ResolutionDescription",PropertyDisplayName:"ResolutionDescription",Required:!1,MaxLength:4e3,Rows:5,vm:e};X(i.find("#resolutionDescription"),a,e.viewModel);var o={PropertyName:"IsAutoResolve",PropertyDisplayName:"ProblemAutoResolveIncident",Inline:!0,Disabled:!1};Y(i.find("#autoResolve"),o,e.viewModel)},H=function(t,i){var n={PropertyName:"ImplementationResults",PropertyDisplayName:"ImplementationResults",Required:!1,EnumId:t.resolutionCategoryEnumId};Q(i.find("#resolutionPicker"),n,e.viewModel);var a={PropertyName:"Notes",PropertyDisplayName:"Implementationnotes",Required:!0,MaxLength:4e3,Rows:5,vm:e};X(i.find("#resolutionDescription"),a,e.viewModel);var o={PropertyName:"Notes",PropertyDisplayName:"Comment",Required:!1,MaxLength:4e3,Rows:5,vm:e};X(i.find("#comment"),o,e.viewModel)},K=function(t,i){var n={PropertyName:"ResolutionCategory",PropertyDisplayName:"ResolutionCategory",Required:!0,EnumId:t.resolutionCategoryEnumId};Q(i.find("#resolutionPicker"),n,e.viewModel);var a={PropertyName:"ResolutionDescription",PropertyDisplayName:"ResolutionDescription",Required:!1,MaxLength:4e3,Rows:5,vm:e};X(i.find("#resolutionDescription"),a,e.viewModel);var o={PropertyName:"resolveChildIncident",PropertyDisplayName:"ResolveChildIncidentMessage",Inline:!0,Disabled:!1};Y(i.find("#letAnalystDecide"),o,e.viewModel)},J=function(t,i){var n={PropertyName:"Status",PropertyDisplayName:"Status",EnumId:t.enumId};Q(i.find("#statusPicker"),n,e.viewModel)},Q=function(e,t,i){a.build(i,t,function(t){e.html(t),app.controls.apply(e,{localize:!0,vm:i,bind:!0})})},X=function(e,t,i){o.build(i,t,function(t){e.html(t),app.controls.apply(e,{localize:!0,vm:i,bind:!0})})},Y=function(e,t,i){r.build(i,t,function(t){e.html(t),app.controls.apply(e,{localize:!0,vm:i,bind:!0})})},Z=function(e,t){return[{PropertyName:"Status",PropertyType:"enum",EditedValue:e.get("newStatusObj").Id},{PropertyName:"ResolutionCategory",PropertyType:"enum",EditedValue:t},{PropertyName:"ResolutionDescription",PropertyType:"string",EditedValue:e.get("resolutionDescription")},{PropertyName:"ResolvedDate",PropertyType:"date",EditedValue:(new Date).toISOString()},{PropertyName:"RelatesToTroubleTicket",PropertyType:"singlecardinalityobject",PropertyRelationshipId:"f7d9b385-a84d-3884-7cde-e2c926d931a5",EditedValue:session.user.Id},{PropertyName:"AppliesToTroubleTicket",PropertyType:"multiplecardinalityobject",propertyRelationshipId:"a860c62e-e675-b121-f614-e52fcbd9ef2c",EditedValue:{ActionType:{Id:"5ca2cfee-6740-1576-540B-ce17222840b8",Name:"Record Resolved"},Description:e.get("resolutionDescription"),DescriptionDisplay:e.get("resolutionDescription"),EnteredBy:session.user.Name,EnteredDate:(new Date).toISOString(),LastModified:(new Date).toISOString(),Title:localization.RecordResolved,Image:app.config.iconPath+app.config.icons["Record Resolved"]}}]},ee=function(e){var t=[{PropertyName:"Status",PropertyType:"enum",EditedValue:e.get("newStatusObj").Id}];switch(e.get("newStatusObj").Id){case app.constants.workItemStatuses.Incident.Closed:t.push({PropertyName:"ClosedDate",PropertyType:"date",EditedValue:(new Date).toISOString()},{PropertyName:"RelatesToTroubleTicket_",PropertyType:"singlecardinalityobject",PropertyRelationshipId:"76bc6c3b-a77b-2468-0a63-169d23dfcdf0",EditedValue:session.user.Id});break;case app.constants.workItemStatuses.ServiceRequest.Closed:t.push({PropertyName:"ClosedDate",PropertyType:"date",EditedValue:(new Date).toISOString()},{PropertyName:"ClosedByUser",PropertyType:"singlecardinalityobject",PropertyRelationshipId:"ba8180d3-5bf9-1bbd-ae87-145dd8fc520f",EditedValue:session.user.Id});break;case app.constants.workItemStatuses.Incident.Resolved:t.push({PropertyName:"ResolutionCategory",PropertyType:"enum",EditedValue:e.get("newResolutionId").Id},{PropertyName:"ResolutionDescription",PropertyType:"string",EditedValue:e.get("resolutionDescription")},{PropertyName:"ResolvedDate",PropertyType:"date",EditedValue:(new Date).toISOString()},{PropertyName:"RelatesToTroubleTicket",PropertyType:"singlecardinalityobject",PropertyRelationshipId:"f7d9b385-a84d-3884-7cde-e2c926d931a5",EditedValue:session.user.Id},{PropertyName:"AppliesToTroubleTicket",PropertyType:"multiplecardinalityobject",propertyRelationshipId:"a860c62e-e675-b121-f614-e52fcbd9ef2c",EditedValue:{ActionType:{Id:"5ca2cfee-6740-1576-540B-ce17222840b8",Name:"Record Resolved"},Description:e.get("resolutionDescription"),DescriptionDisplay:e.get("resolutionDescription"),EnteredBy:session.user.Name,EnteredDate:(new Date).toISOString(),LastModified:(new Date).toISOString(),Title:localization.RecordResolved,Image:app.config.iconPath+app.config.icons["Record Resolved"]}});break;case app.constants.workItemStatuses.ServiceRequest.Completed:t.push({PropertyName:"Notes",PropertyType:"string",EditedValue:e.get("resultNote")},{PropertyName:"CompletedDate",PropertyType:"date",EditedValue:(new Date).toISOString()}),_.isUndefined(e.get("newResultId").Id)||t.push({PropertyName:"ImplementationResults",PropertyType:"enum",EditedValue:e.get("newResultId").Id});break;case app.constants.workItemStatuses.ServiceRequest.Cancelled:t.push({PropertyName:"Notes",PropertyType:"string",EditedValue:e.get("resultComment")})}return t},te=function(){$.get("/api/V3/Projection/GetParentWorkItemSettings",{},function(e){c=e})},ie=function(e,t,i){switch(e){case m:i.set("irStatusResolved",!0),i.set("irCategoryRequired",!0),i.set("irResolveChildOption",i.selectedParents.length>0&&c.ResolvedLetAnalystDecide);break;case b:i.set("srStatusCancelled",!0),i.set("srStatusCompleted",!1);break;case w:i.set("srStatusCompleted",!0),i.set("srNotesRequired",!0),i.set("srStatusCancelled",!1);break;default:i.set("irStatusResolved",!1),i.set("irCategoryRequired",!1),i.set("srStatusCancelled",!1),i.set("srStatusCompleted",!1),i.set("srNotesRequired",!1)}i.set("okEnabled",!0)},ne=function(t,i){switch(t){case m:i.set("resolveChildSettings",c),i.set("letAnalystDecide",c.ResolvedLetAnalystDecide&&e.viewModel.IsParent),i.set("requireResolution",!0),i.set("showResolution",!0);break;case b:i.set("showComment",!0);break;case w:i.set("showResolution",!0),i.set("requireResolution",!0);break;case P:i.set("showResolution",!0),i.set("requireResolution",!0),i.set("showAutoResolve",!0);break;default:i.set("showComment",!1),i.set("showResolution",!1),i.set("requireResolution",!1),i.set("showAutoResolve",!1),i.set("letAnalystDecide",!1)}_.isString(e.viewModel.Status.Name)&&e.viewModel.Status.Name.length>0?i.set("okEnabled",!0):i.set("okEnabled",!1)},ae=function(t){var i=t.ChildIncidentResolutionCategorySameAsParent?e.viewModel.ResolutionCategory.Id:t.ChildIncidentResolutionCategory.Id;$.each(e.viewModel.ChildWorkItem,function(t,n){n.set("Status",{Id:e.viewModel.Status.Id,Name:e.viewModel.Status.Name}),n.set("ResolutionCategory",{Id:i}),n.set("ResolutionDescription",e.viewModel.ResolutionDescription),n.set("ResolvedDate",e.viewModel.ResolvedDate)})},oe=function(){$.each(e.viewModel.RelatesToWorkItem,function(t,i){i.set("Status",{Id:e.viewModel.Status.Id,Name:e.viewModel.Status.Name}),i.set("ResolutionDescription",e.viewModel.ResolutionDescription),i.set("ResolvedDate",e.viewModel.ResolvedDate)})},re=function(){var e=new Array;return e.ServiceRequest=new Array,e.ServiceRequest[h]={logic:"or",filters:[{field:"Id",operator:"eq",value:w},{field:"Id",operator:"eq",value:h}]},e.ServiceRequest[k]={logic:"or",filters:[{field:"Id",operator:"eq",value:b},{field:"Id",operator:"eq",value:k},{field:"Id",operator:"eq",value:y}]},e.ServiceRequest[y]={logic:"or",filters:[{field:"Id",operator:"eq",value:y},{field:"Id",operator:"eq",value:b},{field:"Id",operator:"eq",value:k}]},e.ServiceRequest[I]={logic:"or",filters:[{field:"Id",operator:"eq",value:I},{field:"Id",operator:"eq",value:C}]},e.ServiceRequest[b]={logic:"or",filters:[{field:"Id",operator:"eq",value:b},{field:"Id",operator:"eq",value:C}]},e.ServiceRequest[w]={logic:"or",filters:[{field:"Id",operator:"eq",value:w},{field:"Id",operator:"eq",value:C}]},e.ReleaseRecord=new Array,e.ReleaseRecord[O]={logic:"or",filters:[{field:"Id",operator:"eq",value:E},{field:"Id",operator:"eq",value:L},{field:"Id",operator:"eq",value:O},{field:"Id",operator:"eq",value:B}]},e.ReleaseRecord[L]={logic:"or",filters:[{field:"Id",operator:"eq",value:E},{field:"Id",operator:"eq",value:L}]},e.ReleaseRecord[B]={logic:"or",filters:[{field:"Id",operator:"eq",value:E},{field:"Id",operator:"eq",value:L},{field:"Id",operator:"eq",value:O},{field:"Id",operator:"eq",value:B}]},e.ReleaseRecord[W]={logic:"or",filters:[{field:"Id",operator:"eq",value:L},{field:"Id",operator:"eq",value:W},{field:"Id",operator:"eq",value:z}]},e.ReleaseRecord[E]={logic:"or",filters:[{field:"Id",operator:"eq",value:L},{field:"Id",operator:"eq",value:E},{field:"Id",operator:"eq",value:z}]},e.ReleaseRecord[F]={logic:"or",filters:[{field:"Id",operator:"eq",value:L},{field:"Id",operator:"eq",value:z},{field:"Id",operator:"eq",value:F}]},e.ChangeRequest=new Array,e.ChangeRequest[D]={logic:"or",filters:[{field:"Id",operator:"eq",value:R},{field:"Id",operator:"eq",value:D}]},e.ChangeRequest[T]={logic:"or",filters:[{field:"Id",operator:"eq",value:A},{field:"Id",operator:"eq",value:T},{field:"Id",operator:"eq",value:M}]},e.ChangeRequest[M]={logic:"or",filters:[{field:"Id",operator:"eq",value:M},{field:"Id",operator:"eq",value:A},{field:"Id",operator:"eq",value:T}]},e.ChangeRequest[S]={logic:"or",filters:[{field:"Id",operator:"eq",value:S},{field:"Id",operator:"eq",value:x}]},e.ChangeRequest[A]={logic:"or",filters:[{field:"Id",operator:"eq",value:A},{field:"Id",operator:"eq",value:x}]},e.ChangeRequest[R]={logic:"or",filters:[{field:"Id",operator:"eq",value:R},{field:"Id",operator:"eq",value:x}]},e.Incident=new Array,e.Incident[f]={field:"Id",operator:"neq",value:v},e.Incident[g]={field:"Id",operator:"neq",value:v},e.Incident[m]={logic:"or",filters:[{field:"Id",operator:"eq",value:f},{field:"Id",operator:"eq",value:v}]},e.Problem=new Array,e},le=function(e,t){return e.irCategoryRequired&&(_.isUndefined(e.newResolutionId.Id)||e.newResolutionId.Id.length<=0)?(t.find("#changeStatusErrorWin").html(localization.RequestCategoryRequiredError),!1):!(e.srNotesRequired&&e.resultNote.length<=0)||(t.find("#changeStatusErrorWin").html(localization.ImplementationNotesRequiredError),!1)
},se=function(e,t,i){var n=_.pluck(e.currentSelectionOfParents,"BaseId");$.ajax({url:"/api/v3/workitem/GetChildWorkItems/",data:JSON.stringify(n),dataType:"json",contentType:"application/json",type:"POST",success:function(n){if(c.ChildIncidentResolutionCategorySameAsParent){var a=_.pluck(t.selectedWorkItems,"BaseId");_.each(n,function(e){a.push(e)});var o=_.uniq(a),r={ProjectionId:e.selectedWorkItem.projectionId,UpdateServiceManagement:!0,ItemIds:o,EditedFields:ee(t)};de(r,e,i)}else{var l=c.ChildIncidentResolutionCategory.Id,s={ProjectionId:e.selectedWorkItem.projectionId,UpdateServiceManagement:!0,ItemIds:n,EditedFields:Z(t,l)},d={ProjectionId:e.selectedWorkItem.projectionId,UpdateServiceManagement:!0,ItemIds:_.pluck(t.selectedWorkItems,"BaseId"),EditedFields:ee(t)};de(d,e,i,function(t){t&&de(s,e,i)})}}})},de=function(e,t,i,n){i.close(),app.lib.mask.apply(),$.ajax({url:"/api/v3/workitem/BulkEditWorkItems/",data:JSON.stringify(e),dataType:"json",contentType:"application/json",type:"POST",success:function(){_.isUndefined(n)?ce(t):n(!0)},error:function(){_.isUndefined(n)?ue():n(!1)}})},ce=function(e){if(app.isMobile()){$("[data-control-id='"+e.targetControlId+"']").data("kendoListView").dataSource.query()}else{var t=$("#"+e.targetControlId).data("kendoGrid"),i=app.gridUtils.savedState.getCurrentState(e.targetControlId);app.lib.recheckGridState(i,t),t.dataSource.query(i)}app.lib.message.add(localizationHelper.localize("SaveSuccessMessage"),"success"),app.lib.mask.remove(),app.lib.message.show()},ue=function(){app.lib.message.add(localizationHelper.localize("SaveErrorMessage"),"danger"),app.lib.mask.remove(),app.lib.message.show()};"BulkEdit"==e.type?function(){var e=V.windowEle(n),t=j(e),i={onClick:"openModal",titleKey:s.titleKey,toolTipMessage:localizationHelper.localize("MustSelectSameTypeStatus")};V.taskListItem(i,t,l),app.isMobile()?(app.events.subscribe("mobileWiListSelectionChange",function(e,i){_.isUndefined(i)||(t.onTargetControlChange(i.selectedCards),t.targetControlId=i.controlId)}),app.events.subscribe("mobileWiListInit",function(e,i){_.isUndefined(i)||(t.onTargetControlChange(i.selectedCards),t.targetControlId=i.controlId)})):(app.events.subscribe("gridChange",function(e,i){t.onTargetControlChange(i),t.targetControlId=$(i.wrapper).attr("id")}),app.events.subscribe("gridBound",function(e,i){t.onTargetControlChange(i),t.targetControlId=$(i.wrapper).attr("id")}))}():function(){var e=V.windowEle(i),n=U(e),a={Target:"changeStatus"};V.taskListItem(a,n,t)}()}}}),define("forms/tasks/amChangeStatus/controller",["require","text!forms/tasks/anchor/view.html","text!forms/tasks/changeStatus/view.html","forms/fields/enum/controller","forms/fields/longstring/controller","forms/fields/boolean/controller"],function(e){var t=e("text!forms/tasks/anchor/view.html"),i=e("text!forms/tasks/changeStatus/view.html"),n=e("forms/fields/enum/controller");e("forms/fields/longstring/controller"),e("forms/fields/boolean/controller");return{template:i,build:function(e,a,o){var r=localization.ChangeHardwareAssetStatus;"HardwareAsset"==a.Configs.type?"HardwareAssetStatus"==a.Configs.enumName||"HardwareAssetType"==a.Configs.enumName&&(r=localization.ChangeHardwareAssetType):"SoftwareAsset"==a.Configs.type&&("SoftwareAssetStatus"==a.Configs.enumName?r=localization.ChangeSoftwareAssetStatus:"SoftwareAssetType"==a.Configs.enumName&&(r=localization.ChangeSoftwareAssetType));var l={Id:e.viewModel[a.Configs.enumName].Id,Name:e.viewModel[a.Configs.enumName].Name},s=_.template(i),d=new kendo.View(s(p),{wrap:!1});o(d.render());var c=kendo.observable({changeStatus:function(){var t=d.element.clone();win=t.kendoCiresonWindow({title:r,width:600,height:375,actions:[]}).data("kendoWindow");var i=new kendo.observable({enumId:a.Configs.statusEnumId,type:a.Configs.type,workItemModel:e.viewModel,okClick:function(){win.close()},cancelClick:function(){e.viewModel.set(a.Configs.enumName,l),win.close()}});kendo.bind(t,i);var n={PropertyName:a.Configs.enumName,PropertyDisplayName:"Status",EnumId:i.enumId};m(t.find("#statusPicker"),n,e.viewModel),e.viewModel[a.Configs.enumName].bind("change",function(e){e.sender.Id,i.set("okEnabled",!0)}),t.removeClass("hide"),t.show(),win.open()}}),u=_.template(t),p={Target:"changeStatus"};$.extend(!0,p,a),o(new kendo.View(u(p),{wrap:!1,model:c,init:function(e){}}).render());var m=function(e,t,i){n.build(i,t,function(t){e.html(t),app.controls.apply(e,{localize:!0,vm:i,bind:!0})})}}}}),define("text!forms/tasks/acknowledge/view.html",[],function(){return'<div id="AcknowledgeIncidentWindow" class="hide task-window cireson-window defined-form">\r\n    <div class="cireson-window--wrapper">\r\n        <div class="cireson-window--body">\r\n            <div class="inline-spacing">\r\n                <label><%= localization.AcknowledgementTime %> : <span data-bind="html:dateTimeNow"></span></label>\r\n                \r\n            </div>\r\n            <div class="inline-spacing">\r\n                <label><%= localization.AcknowledgementComment %></label>\r\n                <textarea data-bind="value: actionLogComment, events: {keyup:textCounter}"\r\n                          data-value-update="keyup"\r\n                          class="k-textbox" rows=5></textarea>\r\n            </div>\r\n            <div class="inline-spacing">\r\n                <span data-bind="html:charactersRemaining"></span>\r\n                <span><%= localization.CharactersRemaining %></span>\r\n            </div>\r\n            <div class="inline-spacing checkbox checkbox-inline">\r\n                <input id="IsPrivate" type="checkbox" data-bind="checked: isPrivate" />\r\n                <label for="IsPrivate" class="checkbox-label"><%= localization.IsPrivate %></label>\r\n            </div>\r\n\r\n        </div>\r\n        <div class="window-buttons cireson-window--footer">\r\n            <button class="btn btn-primary"\r\n                    data-role="button"\r\n                    data-bind="enabled: okEnabled, events: { click: okClick }">\r\n                <%= localization.OK %>\r\n            </button>\r\n            <button class="btn btn-default"\r\n                    data-role="button"\r\n                    data-bind="events: { click: cancelClick }">\r\n                <%= localization.Cancel %>\r\n            </button>\r\n        </div>\r\n    </div>\r\n</div>'}),define("forms/tasks/acknowledge/controller",["require","text!forms/tasks/anchor/view.html","text!forms/tasks/acknowledge/view.html"],function(e){var t=e("text!forms/tasks/anchor/view.html"),i=e("text!forms/tasks/acknowledge/view.html");return{template:i,build:function(e,n,a){var o=_.template(i),r=new kendo.View(o(d),{wrap:!1});a(r.render());var l=kendo.observable({acknowledge:function(){var t=r.element;win=t.kendoCiresonWindow({title:localization.Acknowledge,actions:[]}).data("kendoWindow");var i=new kendo.observable({dateTimeNow:kendo.toString(new Date,"g"),dateTimeNowUTC:(new Date).toISOString(),actionLogComment:"",isPrivate:!1,charactersRemaining:"4000",textCounter:function(){var e=this.actionLogComment.length;e>4e3?this.actionLogComment.substring(0,4e3):this.set("charactersRemaining",4e3-e)},okClick:function(){if(null==e.viewModel.FirstResponseDate){e.viewModel.FirstResponseDate=this.dateTimeNowUTC;var t=$("input[name='FirstResponseDate']");"datePicker"==t.attr("data-control")?t.val(kendo.toString(new Date,"d")):"dateTimePicker"==t.attr("data-control")&&t.val(kendo.toString(new Date,"g"))}if(this.actionLogComment.length){var i={EnteredBy:session.user.Name,Title:localization.Analyst+" "+localization.Comment,IsPrivate:this.isPrivate,EnteredDate:(new Date).toISOString(),LastModified:(new Date).toISOString(),Description:this.actionLogComment,DescriptionDisplay:this.actionLogComment,Image:this.isPrivate?app.config.iconPath+app.config.icons.privateComment:app.config.iconPath+app.config.icons.comment,ActionType:"AnalystComment"};e.viewModel.ActionLog||(e.viewModel.ActionLog=[]);var n=app.controls.getWorkItemLogType(pageForm.viewModel);n&&pageForm.viewModel[n].push(i)}win.close()},cancelClick:function(){win.close()}});kendo.bind(t,i),t.removeClass("hide"),t.show(),win.open()}}),s=_.template(t),d={Target:"acknowledge"};$.extend(!0,d,n),a(new kendo.View(s(d),{wrap:!1,model:l,init:function(e){}}).render())}}}),define("forms/tasks/convertToParent/controller",["require","text!forms/tasks/anchor/view.html"],function(e){var t=e("text!forms/tasks/anchor/view.html");return{build:function(e,i,n){var a=_.template(t),o={Target:"convertToParent"};$.extend(!0,o,i);var r=kendo.observable({isParent:i.Configs.isParent,confirmTitle:i.Configs.confirmTitle,confirmMessage:i.Configs.confirmMessage,convertToParent:function(){$.when(kendo.ui.ExtYesNoDialog.show({title:this.confirmTitle,message:this.confirmMessage})).done(function(t){"yes"===t.button&&(e.viewModel.IsParent=i.Configs.isParent,e.viewModel.IsParent||null!=e.viewModel.ChildWorkItem&&(e.viewModel.ChildWorkItem=[]),e.save(function(t){switch(app.lib.message.add(localization.ChangesApplied,"success"),pageForm.type){case"ReleaseRecord":location.href="/ReleaseRecord/Edit/"+e.viewModel.Id+"/";break;default:location.href="/Incident/Edit/"+e.viewModel.Id+"/"}},l))})}});n(new kendo.View(a(o),{wrap:!1,model:r}).render());var l=function(e){e==localization.RequiredFieldsErrorMessage?app.lib.message.add(e,"danger"):app.lib.message.add(localization.PleaseCorrectErrors,"danger"),app.lib.message.show()}}}}),define("text!forms/tasks/linkToParent/view.html",[],function(){return'<div id="AssignParentWindow" class="cireson-window defined-form task-window hide">\r\n    <div class="cireson-window--wrapper">\r\n        <div class="cireson-window--body">\r\n            <div class="margin-b20">\r\n                <label><%= localization.SearchText %></label>\r\n                <span class="k-textbox k-space-right">\r\n                    <input type="text" data-bind="value: searchText" />\r\n                    <a data-bind="click: searchClick" href="javascript:void(0)" class="">\r\n                        <i class="fa fa-search"></i>\r\n                    </a>\r\n                </span>\r\n            </div>\r\n            <label><%= localization.SelectParent %></label>\r\n            <div data-role="grid"\r\n                 data-bind="source: dataSource, events: { change: gridChange }"\r\n                 data-selectable="true"\r\n                 data-sortable="true"\r\n                 data-filterable="true"\r\n                 data-scrollable="false"\r\n                 data-column-menu="true"\r\n                 data-pageable="true"\r\n                 data-columns=\'[\r\n                    { field: "Id", title: " <%= localization.Id %>", width: "50px", attributes: {"class": "grid-highlight-column"} },\r\n                    { field: "Title", title: " <%= localization.Title %>", width: "300px", attributes: {"class": "grid-highlight-column"} },\r\n                    { field: "Status", title: " <%= localization.Status %>", width: "100px" }\r\n                    ]\'>\r\n            </div>\r\n        </div>\r\n        <div class="window-buttons cireson-window--footer">\r\n            <button data-role="button"\r\n                    class="btn btn-primary"\r\n                    data-bind="enabled: okEnabled, events: { click: okClick }">\r\n                <%= localization.OK %>\r\n            </button>\r\n            <button data-role="button"\r\n                    class="btn btn-default"\r\n                    data-bind="events: { click: cancelClick }">\r\n                <%= localization.Cancel %>\r\n            </button>\r\n        </div>\r\n    </div>\r\n</div>'}),define("text!forms/header/relationships/view.html",[],function(){return'<div class="parent-header-link" >\r\n    <label data-bind="text: view.controller.parentIncident"></label> :\r\n    <a data-bind="attr: { href: view.controller.editHref}, text: view.controller.editLink" target="_blank"></a>\r\n    <span class="fa fa-trash-o fa-lg cursor-pointer" data-bind="click: view.controller.unlinkParent"></span>\r\n</div>'}),define("forms/tasks/linkToParent/controller",["require","text!forms/tasks/anchor/view.html","text!forms/tasks/linkToParent/view.html","text!forms/header/relationships/view.html"],function(e){var t=e("text!forms/tasks/anchor/view.html"),i=e("text!forms/tasks/linkToParent/view.html");e("text!forms/header/relationships/view.html");return{template:i,build:function(e,n,a){var o=_.template(i),r=new kendo.View(o(d),{wrap:!1});a(r.render());var l=kendo.observable({linkToParent:function(){var t=r.element;win=t.kendoCiresonWindow({title:"d02dc3b6-d709-46f8-cb72-452fa5e082b8"==e.viewModel.ClassId?localization.LinktoNewParentIncident:localization.LinkToNewParentRecord,actions:[],activate:function(){i.refreshDataSource(),u()}}).data("kendoWindow");var i=new kendo.observable({searchText:"",searchClick:function(){var e=this.get("searchText");this.refreshDataSource(),this.dataSource.filter({logic:"or",filters:[{field:"Id",operator:"contains",value:e},{field:"Title",operator:"contains",value:e},{field:"Status.Name",operator:"contains",value:e}]})},okEnabled:!1,okClick:function(){this.selectedRow&&(null==e.viewModel.ParentWorkItem&&(e.viewModel.ParentWorkItem={}),e.viewModel.ParentWorkItem.BaseId=this.selectedRow.BaseId,e.viewModel.ParentWorkItem.Id=this.selectedRow.Id,e.viewModel.ParentWorkItem.Title=this.selectedRow.Title,_.isUndefined(c.ActiveChildIncidentLinkStatus.Id)||e.viewModel.set("Status",{Id:c.ActiveChildIncidentLinkStatus.Id,Name:c.ActiveChildIncidentLinkStatus.Name}),e.view.buildParentHeaderView(function(t){parentView=new kendo.View(t,{wrapper:!1,model:e}),$("#parent-header-space").html(parentView.render()).show()}),this.dataSource.filter([]),win.close())},cancelClick:function(){this.dataSource.filter([]),win.close()},dataSource:new kendo.data.DataSource({transport:{read:{type:"GET",dataType:"json",url:"/Search/GetParentWorkItems",data:{workItemType:e.type},cache:!1}},schema:{model:{fields:{Id:{type:"string"},Title:{type:"string"},Status:{type:"string"},BaseId:{type:"string"}}}},pageSize:5}),selectedRow:null,gridChange:function(e){this.set("okEnabled",!0),this.set("selectedRow",e.sender.dataItem(e.sender.select()))},refreshDataSource:function(){this.dataSource.read()}});kendo.bind(t,i),t.removeClass("hide"),t.show(),win.open()}}),s=_.template(t),d={Target:"linkToParent"};$.extend(!0,d,n),a(new kendo.View(s(d),{wrap:!1,model:l,init:function(e){}}).render());var c,u=function(){$.get("/api/V3/Projection/GetParentWorkItemSettings",{},function(e){c=e})}}}}),define("text!forms/tasks/newStatus/view.html",[],function(){return'<div class="cireson-window defined-form hide">\r\n    <div class="cireson-window--wrapper">\r\n        <div class="cireson-window--body">\r\n            <div class="col-group">\r\n                <span data-bind="html: commentMessage"></span>\r\n            </div>\r\n            <div class="col-group">\r\n                <div class="editor-label">\r\n                    <label><%= localization.Comment %></label>\r\n                </div>\r\n                <div class="editor-field">\r\n                    <textarea data-bind="value: comment, events: {keyup:textCounter}"\r\n                              data-value-update="keyup"\r\n                              class="k-textbox"\r\n                              rows="6" />\r\n                    <div class="inline-spacing">\r\n                        <span data-bind="html:charactersRemaining"></span>\r\n                        <span><%= localization.CharactersRemaining %></span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="cireson-window--footer window-buttons">\r\n            <div id="changeStatusErrorWin" class="error"></div>\r\n            <button data-role="button"\r\n                    class="btn btn-primary"\r\n                    data-bind="enabled: okEnabled, events: { click: okClick }">\r\n                <%= localization.OK %>\r\n            </button>\r\n            <button data-role="button"\r\n                    class="btn btn-default"\r\n                    data-bind="events: { click: cancelClick }">\r\n                <%= localization.Cancel %>\r\n            </button>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("forms/tasks/newStatus/controller",["require","text!forms/tasks/anchor/view.html","text!forms/tasks/newStatus/view.html"],function(e){var t=e("text!forms/tasks/anchor/view.html"),i=e("text!forms/tasks/newStatus/view.html");return{template:i,build:function(e,n,a){var o=_.template(i),r=new kendo.View(o(s),{wrap:!1});a(r.render());var l=_.template(t),s={Target:"setNewStatus"};if($.extend(!0,s,n),_.isUndefined(n.Configs.otherBoundChanges))var d={};else var d=n.Configs.otherBoundChanges;var c=kendo.observable({setNewStatus:function(){"674e87e4-a58e-eab0-9a05-b48881de784c"===n.Configs.newStatusId||"1840bfdc-3589-88a5-cea9-67536fd95a3b"===n.Configs.newStatusId?v(r.element,n.Configs):$.when(kendo.ui.ExtYesNoDialog.show({title:n.Configs.confirmTitle,message:n.Configs.confirmMessage})).done(function(t){if("yes"===t.button){var i=app.controls.getWorkItemLogType(e.viewModel);if(e.viewModel.set("Status",{Id:n.Configs.newStatusId,Name:n.Configs.newStatusName}),e.viewModel.Status.Id==app.constants.workItemStatuses.Incident.Active&&(e.viewModel.set("ResolutionCategory",{Name:null,Id:null}),e.viewModel.set("ResolutionDescription",null),e.viewModel.set("ResolvedDate",null),i&&e.viewModel[i].unshift(new app.dataModels.AppliesToTroubleTicket.recordActivated)),$.each(d,function(t,i){e.viewModel.set(t,i)}),n.Configs.newStatusId==app.constants.workItemStatuses.Incident.Closed||n.Configs.newStatusId==app.constants.workItemStatuses.ServiceRequest.Closed)switch(e.viewModel.set("ClosedDate",(new Date).toISOString()),n.Configs.newStatusId){case app.constants.workItemStatuses.Incident.Closed:e.viewModel.RelatesToTroubleTicket_={BaseId:session.user.Id},e.viewModel[i].unshift(new app.dataModels.AppliesToTroubleTicket.recordClosed);break;case app.constants.workItemStatuses.ServiceRequest.Closed:e.viewModel.ClosedByUser={BaseId:session.user.Id}}"Incident"===e.type&&e.viewModel.IsParent&&"5e2d3932-ca6d-1515-7310-6f58584df73e"==e.viewModel.Status.Id?f():u()}else e.viewModel.set("Status",{Id:e.viewModel.Status.Id,Name:e.viewModel.Status.Name})})}});a(new kendo.View(l(s),{wrap:!1,model:c}).render());var u=function(){e.save(function(t){switch(app.lib.message.add(localization.ChangesApplied,"success"),e.type){case"ChangeRequest":location.href="/ChangeRequest/Edit/"+e.viewModel.Id+"/";break;case"ServiceRequest":location.href="/ServiceRequest/Edit/"+e.viewModel.Id+"/";break;case"Incident":location.href="/Incident/Edit/"+e.viewModel.Id+"/";break;case"ReleaseRecord":location.href="/ReleaseRecord/Edit/"+e.viewModel.Id+"/";break;case"Problem":location.href="/Problem/Edit/"+e.viewModel.Id+"/";break;default:location.href="/WorkItems/MyItems/"}},p)},p=function(e){e==localization.RequiredFieldsErrorMessage?app.lib.message.add(e,"danger"):app.lib.message.add(localization.PleaseCorrectErrors,"danger"),app.lib.message.show()},m=function(){$.each(e.viewModel.ChildWorkItem,function(e,t){t.set("Status",{Name:childIncidentSettings.ChildIncidentReactivatedStatus.Name,Id:childIncidentSettings.ChildIncidentReactivatedStatus.Id}),t.set("ResolutionCategory",{Name:null,Id:null}),t.set("ResolutionDescription",null),t.set("ResolvedDate",null)}),u()},f=function(){var e;$.get("/api/V3/Projection/GetParentWorkItemSettings",{},function(t){e=$.parseJSON(t),e.ReactivateLetAnalystDecide?$.when(kendo.ui.ExtYesNoDialog.show({title:localization.ReactivateChildIncidentTitle,message:localization.ReactivateChildIncidentMessage})).done(function(e){"yes"===e.button?m():u()}):e.ReactivateChildIncident?m():u()})},v=function(t,i){win=t.kendoCiresonWindow({title:localization.Comment,width:500,height:300,actions:[]}).data("kendoWindow");var n=new kendo.observable({comment:"",okEnabled:!1,charactersRemaining:"4000",textCounter:function(){var e=this.comment.length;e>4e3?this.comment.substring(0,4e3):this.set("charactersRemaining",4e3-e),e>0?this.set("okEnabled",!0):this.set("okEnabled",!1)},okClick:function(){e.viewModel.set("Status",{Id:i.newStatusId,Name:i.newStatusName});var t=_.isNull(e.viewModel.Notes)?this.comment:e.viewModel.Notes+"\r\n"+this.comment;e.viewModel.set("Notes",t),win.close(),u()},cancelClick:function(){win.close()},commentMessage:_.isUndefined(i.commentMessage)?localization.CancelledStatusCommentMessage:i.commentMessage});kendo.bind(t,n),t.removeClass("hide"),t.show(),win.open()}}}}),define("text!forms/tasks/sendEmail/mobile_view.html",[],function(){return'<div id="EmailNotificationWindow" class="cireson-window defined-form task-window hide">\n    <div class="cireson-window--wrapper">\n        <div class="cireson-window--body">\n            <div class="col-md-6 pad10">\n                <div class="editor-label">\n                    <label><%= localization.SendEmailTo %></label>\n                </div>\n                <div class="editor-field">\n                    <div class="k-autocomplete">\r\n                        <select id="userPickerTo"></select>\r\n                        <button id="toField" class="searchIcon btn-primary" data-bind="events:{click: openPopup}"><i class="fa fa-search"></i></button>\r\n                    </div>\n                </div>\n            </div>\n            <div class="col-md-6 pad10">\n                <div class="editor-label">\n                    <label><%= localization.SendEmailCC %></label>\n                </div>\n                <div class="editor-field">\n                    <div class="k-autocomplete">\r\n                        <select id="userPickerCc"></select>\r\n                        <button id="ccField" class="searchIcon btn-primary" data-bind="events:{click: openPopup}"><i class="fa fa-search"></i></button>\r\n                    </div>\n                </div>\n            </div>\n            <div class="col-md-12 pad10">\n                <div class="editor-label">\n                    <label><%= localization.Subject %></label>\n                </div>\n                <div class="editor-field">\n                    <input data-bind="value: emailSubject" class=" k-textbox" type="text">\n                </div>\n            </div>\n            \n            <div class="col-md-12 pad10">\n                <div class="editor-label">\n                    <label><%= localization.SendEmailTemplate %></label>\n                </div>\n                <div class="editor-field" id="templateDiv">\n                    <input data-role="combobox"\n                           data-placeholder="<%= localization.ChooseOne %>"\n                           data-value-primitive="true"\n                           data-text-field="Name"\n                           data-value-field="Id"\n                           data-filter="contains"\n                           data-bind="value: emailTemplateValue, source: emailTemplateDataSource, events:{change:emailTemplateChange }"/>\n                </div>\n            </div>\n\n            <div class="col-md-12 pad10">\r\n                <div id="mobileStatusPicker" />\r\n            </div>\n            <div class="col-md-12 pad10">\r\n                <div class="col-md-6 pad0">\r\n                    <label><%= localization.Message %></label>\r\n                </div>\r\n                <div class="col-md-6 pad0">\r\n                    <a href="#" data-bind="events: { click: resizeEditor }" role="button" title="Expand Editor" class="pull-right"><i class="fa fa-expand"></i></a>\r\n                </div>\r\n                <hr>\r\n                <div class="editor-field">\r\n                    <textarea id="messageEditor" class="form-editor hidden" data-bind="value: emailHTMLMessage" />\r\n                </div>\r\n            </div>\n            <div class="col-md-6 pad10">\n                <div id="statusPicker" />\n                <div class="checkbox">\n                    <input id="IsAddToLog" type="checkbox" data-bind="checked: addToLog, enabled: enableAddToLog" />\r\n                    <label for="IsAddToLog" class="control-label ">\n                        <%= localization.SendEmailAddToLog %>\n                    </label>\n                </div>\n                <div class="checkbox col-md-12 margin-l30" data-bind="visible: addToLog">\n                    <input id="setAsPrivate" type="checkbox" data-bind="checked: setAsPrivate" />\n                    <label for="setAsPrivate" class="control-label col-md-10">\n                        <%= localization.SetAsPrivate %>\n                        <i class="fa fa-info-circle info-icon text-primary" data-toggle="tooltip" title="<%= localization.SaveMessageAsPrivateTooltip %>"></i>\n                    </label>\n                </div>\n                <div data-bind="visible: showChangeStatus" class="checkbox">\n                    <input id="SetFirstResponseDate" type="checkbox" data-bind="checked: setFirstResponseDate, enabled:enableFirstResponseDate" />\n                    <label for="SetFirstResponseDate" class="control-label"><%= localization.SetFirstResponseDate %></label>\n                </div>\n            </div>\n            <div class="col-md-6 pad10">\n                <label><%= localization.SendEmailAttachment %></label>\n                <div class="form-group">\r\n                    <div class="drop-zone-element">\r\n                        <div class="text-wrapper">\r\n                            <span class="drag-image-text">\n                                <a class="browse-file"><b><%= localization.Browse %></b></a>\n                                <span data-bind="visible: filesCount > 0"><span class="lowercase"> <%= localization.Or %> </span><a data-bind="events: { click: viewWorkItemFiles }"><b><%= localization.BrowseWorkItemFiles %></b></a></span>\r\n                            </span>\r\n                            <div style="display:none"><input name="files" id="email-attachment" type="file" /></div>\r\n                        </div>\r\n                    </div>\r\n                </div>\n                <div>\r\n                    <div class="fileattachment-list"></div>\r\n                    <div class="fileattachment-img-modal"></div>\r\n                    <script type="text/x-kendo-template" id="fileTemplate">\r\n                        <div class="thumbnail-file">\r\n                            <div class="cursor-pointer thumbnail-img">\r\n                                # if (DisplayName.toLowerCase().match(/\\.(jpg|jpeg|png|gif)$/)) { #\r\n                                <img src="data:image/png;base64,#= Content.data #" onerror="this.onerror = null; this.src = \'/Content/Images/Icons/FileUpload/document.svg\';" alt="#: DisplayName # image" />\r\n                                # } else{ #\r\n                                <img class="default-icon" src="/Content/Images/Icons/FileUpload/document.svg" onerror="this.onerror = null; this.src = \'/Content/Images/Icons/FileUpload/document.svg\'">\r\n                                # } #\r\n                            </div>\r\n                            <div class="thumbnail-caption">\r\n                                <span>#: DisplayName #</span>\r\n                                \x3c!--<div class="overlay transparent">\r\n                                    <span class="pull-right">\r\n                                        <a class="k-delete-button" href="\\\\#" title="<%= localization.Remove %>"><i class="fa fa-trash"></i></a>\r\n                                    </span>\r\n                                </div>--\x3e\r\n                                <div class="overlay">\r\n                                    # if (DisplayName.match(/\\.(jpg|jpeg|png|gif)$/)) { #\r\n                                    <span class="label">\r\n                                        <a class="icon custom-click view" view-image title="View Image">\r\n                                            <i class="fa fa-eye"></i>\r\n                                        </a>\r\n                                    </span>\r\n                                    <span class="label">\r\n                                        <a class="icon custom-click opennewtab" title="Open in New Tab">\r\n                                            <i class="fa fa-external-link"></i>\r\n                                        </a>\r\n                                    </span>\r\n                                    # } #\r\n                                    # if (BaseId!=null) { #\r\n                                    <span class="label">\r\n                                        <a class="icon custom-click download" title="Download">\r\n                                            <i class="fa fa-download"></i>\r\n                                        </a>\r\n                                    </span>\r\n                                    # } #\r\n                                    <span class="label">\r\n                                        <a class="k-delete-button icon" href="\\\\#" title="<%= localization.Remove %>"><i class="fa fa-trash"></i></a>\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n\r\n                        </div>\r\n                    <\/script>\r\n                </div>\n                \x3c!--<input data-bind="value: emailAttachment" class="k-textbox" type="text" readonly="readonly">\n                <span data-bind="text: attachmentErrorMessage" class="send-email-attachment-error"></span>\n                <div>\n                    <input type="file" name="files" id="fileUploader" />\n                    <div class="k-widget k-upload">\n                        <input type="button" value="<%= localization.Remove %>" class="k-button" />\n                    </div>\n                </div>--\x3e\n            </div>\n        </div>\n        <div class="window-buttons cireson-window--footer">\n            <button id="emailOk" data-role="button"\n                    class="btn btn-primary"\n                    data-bind="enabled: okEnabled, events: { click: okClick }">\n                <%= localization.OK %>\n            </button>\n            <button data-role="button"\n                    class="btn btn-default"\n                    data-bind="events: { click: cancelClick }">\n                <%= localization.Cancel %>\n            </button>\n        </div>\n    </div>\n</div>'}),define("text!forms/tasks/sendEmail/view.html",[],function(){
return'<div id="EmailNotificationWindow" tabindex="-1" role="dialog" class="modal right fade">\n    <div class="modal-dialog modal-lg">\n        <div class="modal-content">\n            <div class="modal-header">\n                 <h4 class="modal-title"><%= localization.SendEmail %></h4>\n            </div> \n            <div class="modal-body">\n                <div class="row">\n                    <div class="col-md-6 pad10">\n                        <div class="editor-label">\n                            <label><%= localization.SendEmailTo %></label>\n                        </div>\n                        <div class="editor-field">\n                            <div class="k-autocomplete">\r\n                                <select id="userPickerTo"></select>\r\n                                <button id="toField" class="searchIcon btn-primary" data-bind="events:{click: openPopup}"><i class="fa fa-search"></i></button>\r\n                            </div>\n                        </div>\n                    </div>\n                    <div class="col-md-6 pad10">\r\n                        <div class="editor-label">\n                            <label><%= localization.SendEmailCC %></label>\n                        </div>\n                        <div class="editor-field">\n                            <div class="k-autocomplete">\n                                <select id="userPickerCc"></select>\n                                <button id="ccField" class="searchIcon btn-primary" data-bind="events:{click: openPopup}"><i class="fa fa-search"></i></button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="row">\r\n                    <div class="col-md-6 pad10">\r\n                        <div class="editor-label">\r\n                            <label><%= localization.Subject %></label>\r\n                        </div>\r\n                        <div class="editor-field">\r\n                            <input data-bind="value: emailSubject" class="k-textbox" type="text">\r\n                        </div>\r\n                    </div>\r\n                    <div class="col-md-6 pad10">\r\n                        <div class="editor-label">\r\n                            <label><%= localization.SendEmailTemplate %></label>\r\n                        </div>\r\n                        <div class="editor-field" id="templateDiv">\r\n                            <input data-role="combobox"\r\n                                   data-placeholder="<%= localization.ChooseOne %>"\r\n                                   data-value-primitive="true"\r\n                                   data-text-field="Name"\r\n                                   data-value-field="Id"\r\n                                   data-filter="contains"\r\n                                   data-bind="value: emailTemplateValue, source: emailTemplateDataSource, events:{change:emailTemplateChange }" />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div class="row">\r\n                    <div class="col-md-12 pad10">\r\n                        <div class="col-md-6 pad0">\r\n                            <label><%= localization.Message %></label>\r\n                        </div>\r\n                        <div class="col-md-6 pad0">\r\n                            <a href="#" data-bind="events: { click: resizeEditor }" role="button" title="Expand Editor" class="pull-right"><i class="fa fa-expand"></i></a>\r\n                        </div>\r\n                        <hr>\r\n                        <div class="editor-field">\r\n                            <textarea id="messageEditor" class="form-editor hidden" data-bind="value: emailHTMLMessage" />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div class="row">\r\n                    <div class="col-md-6 pad10">\r\n                        <div id="statusPicker" />\r\n                        <div class="checkbox">\r\n                            <input id="IsAddToLog" type="checkbox" data-bind="checked: addToLog, enabled: enableAddToLog" />\r\n                            <label for="IsAddToLog" class="control-label ">\r\n                                <%= localization.SendEmailAddToLog %>\r\n                            </label>\r\n                        </div>\r\n                        <div class="checkbox col-md-12 margin-l30" data-bind="visible: addToLog">\r\n                            <input id="setAsPrivate" type="checkbox" data-bind="checked: setAsPrivate" />\r\n                            <label for="setAsPrivate" class="control-label col-md-10">\r\n                                <%= localization.SetAsPrivate %>\r\n                                <i class="fa fa-info-circle info-icon text-primary" data-toggle="tooltip" title="<%= localization.SaveMessageAsPrivateTooltip %>"></i>\r\n                            </label>\r\n                        </div>\r\n                        <div data-bind="visible: showChangeStatus" class="checkbox ">\r\n                            <input id="SetFirstResponseDate" type="checkbox" data-bind="checked: setFirstResponseDate, enabled:enableFirstResponseDate" />\r\n                            <label for="SetFirstResponseDate" class="control-label"><%= localization.SetFirstResponseDate %></label>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div class="col-md-6 pad10">\r\n                        <label><%= localization.SendEmailAttachment %></label>\r\n                        <div class="form-group">\r\n                            <div class="drop-zone-element">\r\n                                <div class="text-wrapper">\r\n                                    <span class="drag-image-text">\r\n                                        <img src="/Content/Images/Icons/FileUpload/upload_to_cloud.svg" />\r\n                                        <b><%= localization.DragAndDrop %> </b> <%= localization.YourFilesOr %>\r\n                                        <a class="browse-file"><b><%= localization.Browse %></b></a>\r\n                                        <span data-bind="visible: filesCount > 0">\r\n                                            <span class="lowercase">  <%= localization.Or %>  </span>\r\n                                            <a data-bind="events: { click: viewWorkItemFiles }"><b><%= localization.BrowseWorkItemFiles %></b></a>\r\n                                        </span>\r\n                                    </span>\r\n                                    <div style="display:none"><input name="files" id="email-attachment" type="file" /></div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <div>\r\n                            <div class="fileattachment-list"></div>\r\n                            <div class="fileattachment-img-modal"></div>\r\n                        </div>\r\n                        <script type="text/x-kendo-template" id="fileTemplate">\r\n                            <div class="thumbnail-file">\r\n                                <div class="cursor-pointer thumbnail-img">\r\n                                    # if (DisplayName.toLowerCase().match(/\\.(jpg|jpeg|png|gif)$/)) { #\r\n                                    <img src="data:image/png;base64,#= Content.data #" onerror="this.onerror = null; this.src = \'/Content/Images/Icons/FileUpload/document.svg\';" alt="#: DisplayName # image" />\r\n                                    # } else{ #\r\n                                    <img class="default-icon" src="/Content/Images/Icons/FileUpload/document.svg" onerror="this.onerror = null; this.src = \'/Content/Images/Icons/FileUpload/document.svg\'">\r\n                                    # } #\r\n                                </div>\r\n\r\n                                <div class="thumbnail-caption">\r\n                                    <span>#: DisplayName #</span>\r\n                                    \x3c!--<div class="overlay transparent">\r\n                            <span class="pull-right">\r\n                                <a class="k-delete-button" href="\\\\#" title="<%= localization.Remove %>"><i class="fa fa-trash"></i></a>\r\n                            </span>\r\n                        </div>--\x3e\r\n                                    <div class="overlay">\r\n                                        # if (DisplayName.toLowerCase().match(/\\.(jpg|jpeg|png|gif)$/)) { #\r\n                                        <span class="label">\r\n                                            <a class="icon custom-click view" view-image title="View Image">\r\n                                                <i class="fa fa-eye"></i>\r\n                                            </a>\r\n                                        </span>\r\n                                        <span class="label">\r\n                                            <a class="icon custom-click opennewtab" title="Open in New Tab">\r\n                                                <i class="fa fa-external-link"></i>\r\n                                            </a>\r\n                                        </span>\r\n                                        # } #\r\n                                        # if (BaseId!=null) { #\r\n                                        <span class="label">\r\n                                            <a class="icon custom-click download" title="Download">\r\n                                                <i class="fa fa-download"></i>\r\n                                            </a>\r\n                                        </span>\r\n                                        # } #\r\n                                        <span class="label">\r\n                                            <a class="k-delete-button icon" href="\\\\#" title="<%= localization.Remove %>"><i class="fa fa-trash"></i></a>\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n\r\n                            </div>\r\n                        <\/script>\r\n                    </div>\r\n                </div> \n            </div>\n\n            <div class="modal-footer">\r\n            <button id="emailOk" data-role="button"\n                    class="btn btn-primary"\n                    data-bind="enabled: okEnabled, events: { click: okClick }">\n                <%= localization.OK %>\n            </button>\n            <button data-role="button"\n                    class="btn btn-default"\n                    data-bind="events: { click: cancelClick }">\n                <%= localization.Cancel %>\n            </button>\n        </div>\n    </div>\n</div>\r\n\r\n    <div class="status" style="display:none">\r\n        <div id="SendEmailChangeStatusWindow" class="cireson-window">\r\n            <div class="cireson-window--wrapper">\r\n                <div class="cireson-window--body">\r\n                    \x3c!--<div id="statusPicker" />--\x3e\r\n                    <div id="resolutionPicker" />\r\n                    <div id="resolutionDescription"  />\r\n                </div>\r\n                <div class="cireson-window--footer window-buttons">\r\n                    <div id="changeStatusErrorWin" class="error"></div>\r\n                    <button data-role="button"\r\n                            class="btn btn-primary"\r\n                            id="statusOk">\r\n                        <%= localization.OK %>\r\n                    </button>\r\n                    <button data-role="button"\r\n                            class="btn btn-default"\r\n                            id="statusCancel">\r\n                        <%= localization.Cancel %>\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    \r\n\r\n    \r\n</div>\r\n\r\n\r\n'}),define("text!forms/popups/userPickerPopup/view.html",[],function(){return'<div id="UserPickerPopupWindow" class="cireson-window defined-form task-window">\r\n    <div class="cireson-window--wrapper">\r\n        <div class="cireson-window--body">\r\n            <div class="row">\r\n                <div class="col-md-6">\r\n                    <div class="form-group popup-search-box">\r\n                        <input type="text" data-value-update="keyup" placeholder="<%= localization.SearchText %>" data-bind="value: searchValue, events: { keypress: searchOnEnter }" class="search-input">\r\n                        <span data-bind="events:{click: search}" class="search-icon">\r\n                            <i class="fa fa-search"></i>\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div data-bind="visible: isDesktopView">\r\n                <div data-control-grid="userPickerGrid"></div>\r\n\r\n            </div>\r\n\r\n            <div class="row" data-bind="visible: isMobileView">\r\n                <div class="col-md-4">\r\n                    <div data-role="listview"\r\n                         data-bind="source: userDataSource, events:{change: onListViewChanged}"\r\n                         data-template="user-grid-mobile-template"\r\n                         data-selectable="true"\r\n                         class="user-listBox"></div>\r\n                    <div data-role="pager"\r\n                         data-bind="source: userDataSource"\r\n                         data-numeric="false"></div>\r\n                    <script type="text/x-kendo-template" id="user-grid-mobile-template">\r\n                        <div class="user-info">\r\n                            <dl>\r\n                                <dt>#: FirstName # #: LastName #</dt>\r\n                                <dd>#: UserName # &middot; #: Title #</dd>\r\n                                <dd>#: Domain # &middot; #: Company #</dd>\r\n                            </dl>\r\n                        </div>\r\n\r\n                    <\/script>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="cireson-window--footer window-buttons objectPicker-single-grid">\r\n            <button data-role="button"\r\n                    class="btn btn-primary"\r\n                    data-bind="events: { click: save }">\r\n                <%= localization.OK %>\r\n            </button>\r\n            <button data-role="button"\r\n                    class="btn btn-default"\r\n                    data-bind="events: { click: cancel }">\r\n                <%= localization.Cancel %>\r\n            </button>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n\r\n\r\n'});var __userPickerPopupSingleton;define("forms/popups/userPickerPopup/controller",["require","text!forms/popups/userPickerPopup/view.html"],function(e){var t=e("text!forms/popups/userPickerPopup/view.html"),i=function(e,t){var i=this;this.serverNameProp=e,this.serverIdProp=t;var n={};n[i.serverNameProp],n[i.serverIdProp],this.set={name:function(e){n[i.serverNameProp]=e},id:function(e){n[i.serverIdProp]=e}},this.setObj=function(e,t){i.set.name(e),i.set.id(t)},this.setFromObj=function(e){i.setObj(e[i.serverNameProp],e[i.serverIdProp])},this.get={name:function(){return n[i.serverNameProp]},id:function(){return n[i.serverIdProp]}},this.getFromObj=function(e){return i.setFromObj(e),n},this.getObj=function(e,t){return void 0!==e&&void 0!==t&&i.setObj(e,t),n},this.getGenericFromObj=function(e){return this.setFromObj(e),{name:i.get.name(),id:i.get.id()}}},n=function(e,t){var n,a,o,r=this,l=e,s=e.find("[data-control-grid]"),d=t?"/User/GetUserSearchResults?groupsOnly=true":"/User/GetUserSearchResults",c=new i("Name","Id");this.setSaveCallback=function(e){$(r).unbind("save").bind("save",function(t,i){e(i)})},this.setCancelCallback=function(e){$(r).unbind("cancel").bind("cancel",function(t,i){e(i)})};var u=function(){},p=function(){n.search(o.searchValue)},m=function(e){if(app.isMobileDevice()){if(!_.isNull(o.selectedUser)){var t=c.getGenericFromObj(o.selectedUser);$(r).trigger("save",t),g()}}else{var i=n.kendoGrid.select();if(i){var a=c.getGenericFromObj(n.kendoGrid.dataItem(i));$(r).trigger("save",a),g()}}},f=function(){$(r).trigger("cancel"),g()},v=function(){r.vm.set("searchValue",""),n.kendoDataSource.data([]),a.kendoWindow.open()},g=function(){a.kendoWindow.close()},b=function(){a=new h(t)},w=function(){n=new k({html:s,url:d})},h=function(e){var t,i=this,n=function(){t=l.kendoCiresonWindow({title:e?localization.SelectGroup:localization.SelectUser,content:null,width:680,height:420,actions:["Close"]}).data("kendoWindow")};!function(){n(),i.kendoWindow=t}()},k=function(e){var t,i,n,a=this,r=e.html,l=e.url,s=function(){t.bind("dataBound",function(e){t.pager.element.show()}),t.element.on("dblclick","tbody>tr",d)},d=function(){t.select($(this)),m()},c=function(e){n=e,i.read(),i.page(1),o.set("userDataSource",i)},u=function(){i=new kendo.data.DataSource({transport:{prefix:"",read:{url:l,data:function(){return{userFilter:function(){return n},filterByAnalyst:o.filterByAnalyst}},type:"GET"}},pageSize:app.isMobileDevice?3:15,serverPaging:!0,serverSorting:!0,serverFiltering:!0,serverGrouping:!0,total:0,type:"aspnetmvc-ajax",schema:{data:"Data",total:"Total",errors:"Errors",model:{fields:{Id:{type:"string"},Name:{type:"string"},PrincipalName:{type:"string"},UserName:{type:"string"},Domain:{type:"string"},Company:{type:"string"},Title:{type:"string"},FirstName:{type:"string"},LastName:{type:"string"},EmployeeId:{type:"string"},Analyst:{type:"number"}}}}})},p=function(){t=r.kendoGrid({height:200,dataSource:i,selectable:"Single,Row",sortable:{mode:"multiple"},pageable:!0,filterable:{extra:!1,operators:{string:{startswith:localization.Startswith,contains:localization.Contains,eq:localization.Isequalto,neq:localization.Isnotequalto},date:{gte:localization.GreaterOrEqual,gt:localization.GreaterThan,lte:localization.LessOrEqual,lt:localization.LessThan}}},autoBind:!1,columns:[{title:localization.id,hidden:!0,field:"Id",filterable:{},encoded:!0},{title:localization.FirstName,attributes:{class:"grid-highlight-column"},width:"110px",field:"FirstName",filterable:{},encoded:!0},{title:localization.LastName,attributes:{class:"grid-highlight-column"},width:"110px",field:"LastName",filterable:{},encoded:!0},{title:localization.Title,field:"Title",filterable:{},encoded:!0},{title:localization.UserName,field:"UserName",filterable:{},encoded:!0},{title:localization.Domain,field:"Domain",filterable:{},encoded:!0},{title:localization.Company,field:"Company",filterable:{},encoded:!0}]}).data("kendoGrid")};!function(){u(),p(),t.pager.element.hide(),s(),a.kendoGrid=t,a.kendoDataSource=i,a.search=c}()};!function(){o=kendo.observable({searchText:localization.SearchText,selectUserText:t?localization.SelectGroup:localization.SelectUser,searchValue:"",search:p,searchOnEnter:function(e){13==e.which&&(e.preventDefault(),p())},save:m,cancel:f,userDataSource:new kendo.data.DataSource,onListViewChanged:function(e){var t=e.sender.select().index(),i=e.sender.dataSource.view()[t];this.set("selectedUser",i)},selectedUser:null,isDesktopView:!app.isMobileDevice(),isMobileView:app.isMobileDevice()}),kendo.bind(l,o),b(),w(),u(),r.open=v,r.close=g,r.vm=o}()};return{template:t,getPopup:function(e){if(__userPickerPopupSingleton)return __userPickerPopupSingleton;var i=_.template(t),a=$(i());return $("body").append(a),__userPickerPopupSingleton=new n(a,e)}}}),define("text!forms/popups/multipleObjectPickerPopup/view.html",[],function(){return'<div id="MultiObjectPickerWindow" class="cireson-window defined-form task-window" data-cid="MultiObjectPickerWindow">\r\n    <div class="cireson-window--wrapper">\r\n        <div class="cireson-window--body">\r\n            <div class="row">\r\n                <div class="col-md-5">\r\n                    <div class="form-group">\r\n                        <label><%= localization.SearchText %></label>\r\n                        <span class="k-textbox k-space-right object-picker-search">\r\n                            <input type="text" data-objectpicker-action="search" data-objectpicker-action-value="search" value="" data-cid="MultiObjectPickerWindowSearchBox" />\r\n                            <span data-objectpicker-action="search" class="fa fa-search text-primary cursor-pointer"></span>\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n                <div class="col-md-5">\r\n                    <div class="form-group">\r\n                        <label><%= localization.SearchObjectText %></label>\r\n                        <input type="text" data-objectpicker-control="comboBox">\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n\r\n            <label><%= localization.SelectObjects %></label>\r\n\r\n            <div class="objectPicker-container">\r\n                <div class="k-widget k-grid k-secondary" data-objectpicker-control="objectPickerGrid"></div>\r\n            </div>\r\n\r\n            <div class="objectPicker-actions">\r\n                <button data-objectpicker-action="addObject" class="btn btn-primary k-button" data-cid="multiobject-picker-add-object-btn"><%= localization.Add %></button>\r\n                <button data-objectpicker-action="removeObject" class="btn btn-danger k-button" data-cid="multiobject-picker-remove-object-btn"><%= localization.Remove %></button>\r\n            </div>\r\n\r\n            <div class="k-widget k-grid k-secondary objectPicker-grid2-container" data-objectpicker-control="objectPickerGrid2"></div>\r\n        </div>\r\n        <div class="cireson-window--footer window-buttons">\r\n            <button data-role="button"\r\n                    class="btn btn-primary"\r\n                    data-bind="events: { click: save }"\r\n                    data-cid="multiobject-picker-ok-btn">\r\n                <%= localization.OK %>\r\n            </button>\r\n            <button data-role="button"\r\n                    class="btn btn-default"\r\n                    data-bind="events: { click: cancel }"\r\n                    data-cid="multiobject-picker-cancel-btn">\r\n                <%= localization.Cancel %>\r\n            </button>\r\n        </div>\r\n    </div>\r\n</div>'}),define("forms/popups/multipleObjectPickerPopup/controller",["require","text!forms/popups/multipleObjectPickerPopup/view.html"],function(e){var t=e("text!forms/popups/multipleObjectPickerPopup/view.html"),i=function(e,t,i,n,a,o,r){var l,s,d=this,c=e,t=t,i=i,u=n,p=a,r=r;this.setSaveCallback=function(e){$(d).unbind("save").bind("save",function(t,i){e(i)})},this.setCancelCallback=function(e){$(d).unbind("cancel").bind("cancel",function(t,i){e(i)})};var m=function(){},f=function(){var e=l.grid2.dataSource.data();e&&($.each(e,function(e,t){_.isUndefined(t.BaseId)&&(t.BaseId=t.Id),$(d).trigger("save",t)}),b())},v=function(){$(d).trigger("cancel"),b()},g=function(){l.actions.clearSearchText(),l.gridFunctions.clear(),l.kendoWindow.open()},b=function(){l.kendoWindow.close()},w=function(){l=new h},h=function(){var e,n,a,o,l,s=this,d=_.isUndefined(u)||_.isNull(u)?"/Search/GetSearchObjectsWithEnumObjectByClassId":u,m=new kendo.data.ObservableArray([]),l=new function(){this.addObject=function(){for(var e=n.select(),t=0,i=e.length;t<i;t++){var a=n.dataItem(e[t]);a&&v.addItem(a)}},this.removeObject=function(){for(var e=a.select(),t=0,i=e.length;t<i;t++)a.removeRow(e[t])},this.search=function(){var e=c.find('[data-objectpicker-action-value="search"]');o=e?e.val():"",n.dataSource.read(),_.isUndefined(p)||_.isNull(p)||n.dataSource.filter(p),n.dataSource.page(1)},this.clearSearchText=function(){c.find('[data-objectpicker-action-value="search"]').val(""),o=""}};s.actions=l;var f=new function(){this.searchFilter=function(){return{searchFilter:o,classId:g.getIdValue,columnNames:i}},this.onChange=function(){},this.onDataBound=function(){1==n.dataSource.totalPages()&&n.pager.element.hide()},this.clear=function(){for(s.grid.dataSource.data([]);0!=m.length;)$.each(s.grid2.items(),function(e,t){s.grid2.removeRow(t)})},this.dblClick=function(){v.addItem(n.dataItem($(this)))}};s.gridFunctions=f;var v=new function(){this.addItem=function(e){var t=!0;$.each(m,function(i,n){e.uid==n.uid&&(t=!1)}),t&&m.push(e)}},g=new function(){this.getIdValue=function(){var e=s.combo.value();return _.isNull(e)?t.toLowerCase():e}},b=function(){e=c.kendoCiresonWindow({title:localization.SelectObject,content:null,width:750,height:710,actions:["Close"],activate:function(){s.combo.value(t.toLowerCase())}}).data("kendoWindow")},w=function(){s.combo=c.find("[data-objectpicker-control='comboBox']").kendoComboBox({dataSource:{transport:{prefix:"",read:{url:"/Search/GetSearchClasses",data:{classId:t}}},schema:{errors:"Errors"}},dataTextField:"Item2",autoBind:!0,dataValueField:"Item1",filter:"contains"}).data("kendoComboBox")},h=function(){var e=c.find('[data-objectpicker-control="objectPickerGrid"]');n=e.kendoGrid(function(){var e={transport:{prefix:"",read:{url:d,data:f.searchFilter,type:"GET",cache:!1}},pageSize:5,type:"aspnetmvc-ajax",schema:{data:"Data",total:"Total",errors:"Errors"}},i=[{title:"Id",hidden:!0,field:"Id",filterable:{},encoded:!0},{title:localization.DisplayName,attributes:{class:"grid-highlight-column"},field:"DisplayName",filterable:{},encoded:!0},{title:localization.Class,field:"FullClassName",hidden:app.isMobile(),filterable:{},encoded:!0},{title:localization.Path,field:"Path",hidden:app.isMobile(),filterable:{},encoded:!0}],n=[{title:localization.FirstName,attributes:{class:"grid-highlight-column"},field:"FirstName",filterable:{},encoded:!0},{title:localization.LastName,attributes:{class:"grid-highlight-column"},field:"LastName",filterable:{},encoded:!0},{title:localization.Title,field:"Title",filterable:{},encoded:!0},{title:localization.UserName,field:"UserName",filterable:{},encoded:!0},{title:localization.Domain,field:"Domain",filterable:{},encoded:!0},{title:localization.Company,field:"Company",filterable:{},encoded:!0}],a=[{title:localization.FirstName,attributes:{class:"grid-highlight-column"},field:"FirstName",filterable:{},encoded:!0},{title:localization.LastName,attributes:{class:"grid-highlight-column"},field:"LastName",filterable:{},encoded:!0},{title:localization.Email,field:"Email",filterable:{},encoded:!0},{title:localization.DisplayName,field:"DisplayName",filterable:{},encoded:!0}];return{columns:r?a:"10a7f898-e672-ccf3-8881-360bfb6a8f9a"==t.toLowerCase()?n:i,sortable:{mode:"multiple"},selectable:"Multiple, Row",filterable:{operators:{string:{startswith:localization.Startswith,contains:localization.Contains,eq:localization.Isequalto,neq:localization.Isnotequalto}}},columnMenu:!1,autoBind:!1,dataSource:e,pageable:!0}}()).data("kendoGrid"),f.onDataBound(),e.on("dblclick","tbody>tr",f.dblClick),s.grid=n},k=function(){var e=c.find('[data-objectpicker-control="objectPickerGrid2"]'),i={transport:{prefix:"",read:{url:""}},pageSize:5,type:"aspnetmvc-ajax",data:{Data:m,Total:m.length},schema:{data:"Data",total:"Total",errors:"Errors"}},n=[{title:"Id",hidden:!0,field:"Id",filterable:{},encoded:!0},{title:localization.DisplayName,attributes:{class:"grid-highlight-column"},field:"DisplayName",filterable:{},encoded:!0},{title:localization.Class,field:"FullClassName",hidden:app.isMobile(),filterable:{},encoded:!0},{title:localization.Path,field:"Path",hidden:app.isMobile(),filterable:{},encoded:!0}],o=[{title:localization.FirstName,attributes:{class:"grid-highlight-column"},field:"FirstName",filterable:{},encoded:!0},{title:localization.LastName,attributes:{class:"grid-highlight-column"},field:"LastName",filterable:{},encoded:!0},{title:localization.Title,field:"Title",filterable:{},encoded:!0},{title:localization.UserName,field:"UserName",filterable:{},encoded:!0},{title:localization.Domain,field:"Domain",filterable:{},encoded:!0},{title:localization.Company,field:"Company",filterable:{},encoded:!0}],l=[{title:localization.FirstName,attributes:{class:"grid-highlight-column"},field:"FirstName",filterable:{},encoded:!0},{title:localization.LastName,attributes:{class:"grid-highlight-column"},field:"LastName",filterable:{},encoded:!0},{title:localization.Email,field:"Email",filterable:{},encoded:!0},{title:localization.DisplayName,field:"DisplayName",filterable:{},encoded:!0}];a=e.kendoGrid({columns:r?l:"10a7f898-e672-ccf3-8881-360bfb6a8f9a"==t.toLowerCase()?o:n,pageable:!0,dataSource:i,selectable:"Multiple, Row",filterable:{operators:{string:{startswith:localization.Startswith,contains:localization.contains,eq:localization.Isequalto,neq:localization.Isnotequalto}}},columnMenu:!1}).data("kendoGrid"),s.grid2=a},y=function(){c.find("[data-objectpicker-action]").each(function(e,t){var i=$(this).attr("data-objectpicker-action"),n=t.nodeName.toLowerCase();l[i]||app.lib.exception("The method action."+i+" does not exist"),"input"==n&&"text"==$(this).attr("type").toLowerCase()||"textarea"==n?$(this).bind("enter",l[i]):$(this).click(l[i])})};!function(){b(),w(),h(),k(),y(),s.kendoWindow=e}()};!function(){s=kendo.observable({save:f,cancel:v}),kendo.bind(c,s),w(),m(),d.open=g,d.close=b}()};return{template:t,getPopup:function(e,n,a,o,r,l){var s=_.template(t),d=$(s()),c=$('[datasingleton="objectPickerPopup"]'),u=c.data("objectPickerPopup");return c.length||(c=d,$("body").append(c),u=new i(c,e,n,a,o,r,l),c.data("objectPickerPopup",u)),u}}}),define("text!forms/flyout/fileAttachmentsFlyout/mobile_view.html",[],function(){
return'<div class="cireson-window defined-form task-window hide">\r\n    <div class="cireson-window--wrapper">\r\n        <div class="cireson-window--body">\r\n            <div>\r\n                <div class="fileattachment-list"></div>\r\n                <div class="fileattachment-img-modal"></div>\r\n            </div>\r\n\r\n            <script type="text/x-kendo-template" id="filesTemplate">\r\n                <div class="thumbnail-file">\r\n                    <div class="cursor-pointer thumbnail-img">\r\n                        # if (DisplayName.toLowerCase().match(/\\.(jpg|jpeg|png|gif)$/)) { #\r\n                        <img src="data:image/png;base64,#= Content.data #" onerror="this.onerror = null; this.src = \'/Content/Images/Icons/FileUpload/document.svg\';" alt="#: DisplayName # image" />\r\n                        # } else{ #\r\n                        <img class="default-icon" src="/Content/Images/Icons/FileUpload/document.svg" onerror="this.onerror = null; this.src = \'/Content/Images/Icons/FileUpload/document.svg\'">\r\n                        # } #\r\n                    </div>\r\n                    <div class="thumbnail-caption">\r\n                        <span>#: DisplayName #</span>\r\n                        <div class="overlay">\r\n                            # if (DisplayName.toLowerCase().match(/\\.(jpg|jpeg|png|gif)$/)) { #\r\n                            <span class="label">\r\n                                <a class="icon custom-click" title="View Image" action="view">\r\n                                    <i class="fa fa-eye"></i>\r\n                                </a>\r\n                            </span>\r\n                            <span class="label">\r\n                                <a class="icon custom-click" title="Open in New Tab" action="opennewtab">\r\n                                    <i class="fa fa-external-link"></i>\r\n                                </a>\r\n                            </span>\r\n                            # } #\r\n                            <span class="label">\r\n                                <a class="icon custom-click" title="Download" action="download">\r\n                                    <i class="fa fa-download"></i>\r\n                                </a>\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            <\/script>\r\n            <script>\r\n                function selectFile(el, action) {\r\n                    //var listView = $(".fileattachment-list").data("kendoListView");\r\n                    //var item = $(el).closest("[role=\'option\']");\r\n                    //var dataItem = listView.dataSource.getByUid(item.data("uid"));\r\n\r\n                    //if (action === "download") {\r\n                    //    var downloadUrl = app.config.rootURL + "FileAttachment/ViewFile/";\r\n                    //    location.href = downloadUrl + dataItem.BaseId;\r\n                    //} else if (action === "opennewtab") {\r\n                    //    var win = window.open(\'about:blank\');\r\n                    //    setTimeout(function () { //FireFox seems to require a setTimeout for this to work.\r\n                    //        win.document.body.appendChild(win.document.createElement(\'img\')).src = el.closest(".thumbnail-file").find(".thumbnail-img img")[0].src;\r\n                    //        win.href = el.closest(".thumbnail-file").find(".thumbnail-img img")[0].src;\r\n                    //        win.focus();\r\n                    //    }, 0);\r\n\r\n\r\n                    //} else {\r\n                    //    var dialog = $(\'.fileattachment-img-modal\');\r\n                    //    dialog.kendoDialog({\r\n                    //        modal: true,\r\n                    //        title: dataItem.DisplayName,\r\n                    //        content: "<div class=\'file-img-container\'><img src=\\"data:image/png;base64," + dataItem.Content.data + "\\" onerror=\\"this.onerror = null; this.src = \'/Content/Images/Icons/FileUpload/document.svg\';\\" alt=\\"" + dataItem.DisplayName + "\\" /></div>",\r\n                    //        animation: {\r\n                    //            open: {\r\n                    //                effects: "fade:in"\r\n                    //            }\r\n                    //        }\r\n                    //    });\r\n                    //    $(\'.k-window.k-widget\').addClass(\'acivity-popup-window\');\r\n                    //    dialog.data("kendoDialog").open();\r\n                    //}\r\n                }\r\n\r\n            <\/script>\r\n        </div>\r\n        <div class="window-buttons cireson-window--footer">\r\n            <button data-role="button"\r\n                    class="btn btn-primary"\r\n                    data-bind="events: { click: save }, visible: saveCancelBtn">\r\n                <%= localization.OK %>\r\n            </button>\r\n            <button data-role="button"\r\n                    class="btn btn-default"\r\n                    data-bind="events: { click: cancel }, visible: saveCancelBtn">\r\n                <%= localization.Cancel %>\r\n            </button>\r\n            <button data-role="button"\r\n                    class="btn btn-default"\r\n                    data-bind="events: { click: cancel}, visible: closeBtn ">\r\n                <%= localization.Close %>\r\n            </button>\r\n        </div>\r\n    </div>\r\n</div>'}),define("text!forms/flyout/fileAttachmentsFlyout/view.html",[],function(){return'<div tabindex="-1" role="dialog" class="modal right fade">\r\n    <div class="modal-dialog">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <h4 class="modal-title"><%= localization.FileAttachments %></h4>\r\n            </div>\r\n            <div class="modal-body">\r\n                <div>\r\n                    <div class="fileattachment-list"></div>\r\n                    <div class="fileattachment-img-modal"></div>\r\n                </div>\r\n\r\n                <script type="text/x-kendo-template" id="filesTemplate">\r\n                    <div class="thumbnail-file">\r\n                        <div class="cursor-pointer thumbnail-img">\r\n                            # if (DisplayName.toLowerCase().match(/\\.(jpg|jpeg|png|gif)$/)) { #\r\n                            <img src="data:image/png;base64,#= Content.data #" onerror="this.onerror = null; this.src = \'/Content/Images/Icons/FileUpload/document.svg\';" alt="#: DisplayName # image" />\r\n                            # } else{ #\r\n                            <img class="default-icon" src="/Content/Images/Icons/FileUpload/document.svg" action="download" onerror="    this.onerror = null; this.src = \'/Content/Images/Icons/FileUpload/document.svg\'">\r\n                            # } #\r\n                        </div>\r\n                        <div class="thumbnail-caption">\r\n                            <span>#: DisplayName #</span>\r\n                            <div class="overlay">\r\n                                # if (DisplayName.toLowerCase().match(/\\.(jpg|jpeg|png|gif)$/)) { #\r\n                                <span class="label">\r\n                                    <a class="icon custom-click" view-image action="view" title="View Image">\r\n                                        <i class="fa fa-eye"></i>\r\n                                    </a>\r\n                                </span>\r\n                                <span class="label">\r\n                                    <a class="icon custom-click" title="Open in New Tab" action="opennewtab">\r\n                                        <i class="fa fa-external-link"></i>\r\n                                    </a>\r\n                                </span>\r\n                                # } #\r\n                                # if (BaseId!=null) { #\r\n                                <span class="label">\r\n                                    <a class="icon custom-click" title="Download" action="download">\r\n                                        <i class="fa fa-download"></i>\r\n                                    </a>\r\n                                </span>\r\n                                # } #\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                <\/script>\r\n                \r\n            </div>\r\n            <div class="modal-footer">\r\n                <button data-role="button"\r\n                        class="btn btn-primary"\r\n                        data-bind="events: { click: save }, visible: saveCancelBtn">\r\n                    <%= localization.OK %>\r\n                </button>\r\n                <button data-role="button"\r\n                        class="btn btn-default"\r\n                        data-bind="events: { click: cancel }, visible: saveCancelBtn">\r\n                    <%= localization.Cancel %>\r\n                </button>\r\n                <button data-role="button"\r\n                        class="btn btn-default"\r\n                        data-bind="events: { click: cancel}, visible: closeBtn ">\r\n                    <%= localization.Close %>\r\n                </button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n\r\n\r\n</div>'});var __fileAttachmentsPopupSingleton;define("forms/flyout/fileAttachmentsFlyout/controller",["require","text!forms/flyout/fileAttachmentsFlyout/mobile_view.html","text!forms/flyout/fileAttachmentsFlyout/view.html"],function(e){var t=e(app.isMobile()?"text!forms/flyout/fileAttachmentsFlyout/mobile_view.html":"text!forms/flyout/fileAttachmentsFlyout/view.html"),i=function(e,t,i){var n,a,o=this,r=t,l=[];this.setSaveCallback=function(e){$(o).unbind("save").bind("save",function(t,i){e(i)})},this.setCancelCallback=function(e){$(o).unbind("cancel").bind("cancel",function(t,i){e(i)})};!function(){app.isMobile()&&(a=r.kendoCiresonWindow({title:localization.FileAttachments,width:650,height:740,actions:[]}).data("kendoWindow")),n=kendo.observable({save:function(){app.lib.mask.apply(),_.defer(function(){_.each(n.selectedFiles,function(e){if(null==e.Content.data)return void app.lib.mask.remove();_.filter(l,function(t){return t.id==e.BaseId}).length<=0?$.ajax({type:"GET",async:!1,url:"/FileAttachment/GetFileContent/",data:{id:e.BaseId}}).then(function(t){""!=t&&(l.unshift({id:e.BaseId,img:t}),e.Content.data=t),app.lib.mask.remove()}):app.lib.mask.remove()})}),$(o).trigger("save",{selectedFiles:n.selectedFiles}),n.closeModal()},cancel:function(){$(o).trigger("cancel"),n.closeModal()},isDesktopView:!app.isMobileDevice(),isMobileView:app.isMobileDevice(),selectedFiles:[],onOpenFile:function(e){var t=this.dataSource.view();n.selectedFiles=$.map(this.select(),function(e){return t[$(e).index()]})},saveCancelBtn:i,closeBtn:!i,openModal:function(){app.isMobile()?(r.removeClass("hide"),r.show(),a.open()):r.modal("show")},closeModal:function(){app.isMobile()?a.close():r.modal("hide")},selectFile:function(e,t){function n(){if(app.lib.mask.remove(),"opennewtab"===action){var e=window.open("about:blank");setTimeout(function(){e.document.body.appendChild(e.document.createElement("img")).src="data:image/jpg;base64,"+s.Content.data,e.href="data:image/jpg;base64,"+s.Content.data,e.focus()},0)}else{var t=$(".fileattachment-img-modal");if(t.length>1)for(var i=1;i<t.length;i++)$(t[i]).data("kendoDialog")&&$(t[i]).data("kendoDialog").destroy(),t.eq(i).remove();if(s){var n=$(".acivity-popup-window");if(n.length>1)for(var i=1;i<n.length;i++)n.eq(i).remove();t.kendoDialog({modal:!0,title:s.DisplayName,content:"<div class='file-img-container'><img src=\"data:image/jpg;base64,"+s.Content.data+'" onerror="this.onerror = null; this.src = \'/Content/Images/Icons/FileUpload/document.svg\';" alt="'+s.DisplayName+'" /></div>',animation:{open:{effects:"fade:in"}}}),t.data("kendoDialog").open(),$(".k-overlay").on("click",function(){t.data("kendoDialog").close()})}}}var a=r.find(".fileattachment-list").data("kendoListView"),o=e.closest("[role='option']"),s=a.dataSource.getByUid(o.data("uid"));if(!t||"sendEmail"!=i)if(action=e.attr("action"),"download"===action){var d=app.config.rootURL+"FileAttachment/ViewFile/";location.href=d+s.BaseId}else app.lib.mask.apply(),_.defer(function(){_.filter(l,function(e){return e.id==s.BaseId}).length<=0?$.ajax({type:"GET",async:!1,url:"/FileAttachment/GetFileContent/",data:{id:s.BaseId}}).then(function(e){""==e?n():(l.unshift({id:s.BaseId,img:e}),s.Content.data=e,n())}):n()})}}),kendo.bind(r,n),app.isMobile()||(r.on("shown.bs.modal",function(){$(".modal-backdrop").each(function(e,t){r.before(t)}),$(document).off("focusin.modal")}),r.on("hidden.bs.modal",function(){$(".modal-backdrop").remove()})),o.open=n.openModal,o.close=n.closeModal,o.vm=n,r.find(".fileattachment-list").kendoListView({dataSource:e.viewModel.FileAttachment,template:kendo.template($("#filesTemplate").html()),selectable:i?"multiple":"single",change:n.onOpenFile,dataBound:function(){void 0==i&&"sendEmail"!=i&&r.find("a[view-image]").parent().hide(),r.find(".custom-click").on("click",function(){n.selectFile($(this),!1)}),app.isMobile()||r.find(".thumbnail-img img").on("click",function(){n.selectFile($(this),!0)})}})}()};return{template:t,getPopup:function(e,n){var a=_.template(t),o=$(a());return $("body").append(o),__fileAttachmentsPopupSingleton=new i(e,o,n)}}}),define("CustomSpace/Scripts/forms/tasks/sendEmail/controller",["text!forms/tasks/anchor/view.html","text!forms/tasks/sendEmail/mobile_view.html","text!forms/tasks/sendEmail/view.html","forms/popups/userPickerPopup/controller","forms/popups/multipleObjectPickerPopup/controller","forms/flyout/fileAttachmentsFlyout/controller","forms/fields/enum/controller","forms/fields/longstring/controller"],function(e,t,i,n,a,o,r,l){"use strict";var s=app.isMobile()?t:i;return{template:s,build:function(t,i,n){var d=_.template(s),c=new kendo.View(d(b),{wrap:!1}),u={},p={recipientToList:[],recipientCCList:[]},m=null,f=!1;_.isUndefined(t.viewModel.FileAttachment)&&t.viewModel.set("FileAttachment",[]),n(c.render()),c.destroy();var v=kendo.observable({sendEmail:function(){var e=c.element;if(app.isMobile())var n=e.kendoCiresonWindow({title:localization.SendEmail,width:650,height:740,actions:[],activate:function(){y(s),C(s)}}).data("kendoWindow");var s=new kendo.observable({emailTo:"",emailCC:"",emailSubject:"["+t.viewModel.Id+"] "+t.viewModel.Title,emailHTMLMessage:session.emailBodyTemplate.length>0?$("<div/>").html(session.emailBodyTemplate).text():"",emailTextMessage:"",emailAttachment:"",emailTemplateDataSource:w,emailTemplateValue:"",attachmentErrorMessage:"",addToLog:"true"===session.addToActionLogDefault||"true"===session.forceAddToActionLog,enableAddToLog:"true"!==session.forceAddToActionLog,okEnabled:!0,setAsPrivate:"true"===session.saveMessageAsPrivate,okClick:function(n){var a=e.find("#userPickerTo").data("kendoMultiSelect"),o=e.find("#userPickerCc").data("kendoMultiSelect"),d={recipientToList:a.listView._dataItems,recipientCCList:o.listView._dataItems},c=_.without(d.recipientToList,_.findWhere(d.recipientToList,{Email:""}));c=_.uniq(_.pluck(c,"Email")),s.set("emailTo",c.join(";"));var u=_.without(d.recipientCCList,_.findWhere(d.recipientCCList,{Email:""}));u=_.uniq(_.pluck(u,"Email")),s.set("emailCC",u.join(";"));var p=_.union(c,u);if(c.length<=0)return void kendo.ui.ExtAlertDialog.show({title:localization.InvalidEmailAddress,message:localization.PleaseProvideEmailAddress});var f=S(p);if(null!=f)return void kendo.ui.ExtAlertDialog.show({title:localization.InvalidEmailAddress,message:localization.InvalidEmailAddressMessage.replace("{0}",f)});if(this.addToLog){var v=e.find("#messageEditor").data("kendoEditor");this.set("emailTextMessage",v.body.innerText||v.body.textContent);if((this.emailTextMessage&&_.isString(this.emailTextMessage)?this.emailTextMessage.trim():"").length<=0)return void kendo.ui.ExtAlertDialog.show({title:localization.MessageRequired,message:localization.MessageRequiredWhenAddingLogEntry})}var g=app.constants.workItemStatuses,b=g.ServiceRequest.Completed,w=g.Incident.Resolved;if(("incident"!=t.type.toLowerCase()&&"Incident"!=i.Configs.type||s.Status.id!=w&&s.Status.Id!=w)&&("servicerequest"!=t.type.toLowerCase()&&"ServiceRequest"!=i.Configs.type||s.Status.id!=b&&s.Status.Id!=b))kendo.ui.progress(e,!0),M(this,e);else{var h,k,y,I=e.find("#SendEmailChangeStatusWindow").clone(),C=t.viewModel;"incident"!=t.type.toLowerCase()&&"Incident"!=i.Configs.type||(h={PropertyName:"ResolutionDescription",PropertyDisplayName:"ResolutionDescription",Required:!1,MaxLength:4e3,Rows:5,vm:t},k={PropertyName:"ResolutionCategory",PropertyDisplayName:"ResolutionCategory",Required:!1,EnumId:"72674491-02cb-1d90-a48f-1b269eb83602"},y="ResolvedDate"),"servicerequest"!=t.type.toLowerCase()&&"ServiceRequest"!=i.Configs.type||(h={PropertyName:"Notes",PropertyDisplayName:"Implementationnotes",Required:!0,MaxLength:4e3,Rows:5,vm:t},k={PropertyName:"ImplementationResults",PropertyDisplayName:"ImplementationResults",Required:!1,EnumId:"4ea37c27-9b24-615a-94da-510539371f4c"},y="CompletedDate");var x=I.find("#resolutionDescription");l.build(C,h,function(e){x.html(e),app.controls.apply(x,{localize:!0,vm:C,bind:!0})});var T=I.find("#resolutionPicker");r.build(C,k,function(e){T.html(e),app.controls.apply(T,{localize:!0,vm:C,bind:!0})}),m=I.kendoCiresonWindow({title:localization.Resolution,width:600,height:480,actions:[],activate:function(){}}).data("kendoWindow");var A=this;I.find("#statusOk").click(function(){t.viewModel[y]=(new Date).toISOString(),m.close(),I.remove(),kendo.ui.progress(e,!0),M(A,e)}),I.find("#statusCancel").click(function(){m.close(),I.remove()}),m.open()}},cancelClick:function(i){console.log("cancelClick",i),app.isMobile()?n.close():$.when(kendo.ui.ExtOkCancelDialog.show({title:localization.Warning,message:localization.UnsavedDataMessage,icon:"fa fa-exclamation"})).done(function(i){"ok"===i.button&&(t.widget&&(t.widget.remoteManageRecepient=null),f=!1,e.modal("hide"))})},emailTemplateChange:function(i){var n={field:"Id",operator:"eq",value:i.sender._old};w.filter(n);var a=w.view(),o=a.length>0&&a[0].Subject.replace(/\s/g,"").length>0?"["+t.viewModel.Id+"] "+a[0].Subject:"["+t.viewModel.Id+"] "+t.viewModel.Title,r=a.length>0&&a[0].Content.replace(/\s/g,"").length>0?a[0].Content:"";r=e.find("#messageEditor").html(r).text(),r.match(/<(\w+)((?:\s+\w+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/)||(r=e.find("#messageEditor").html(r).text().replace(/\r\n|\r|\n/g,"<br />")),this.set("emailSubject",o),this.set("emailHTMLMessage",r),w.filter({})},resizeEditor:function(e){e.preventDefault();var t=$(e.currentTarget);t.children("i").hasClass("fa-expand")?(t.children("i").removeClass("fa-expand"),t.children("i").addClass("fa-compress")):t.children("i").hasClass("fa-compress")&&(t.children("i").removeClass("fa-compress"),t.children("i").addClass("fa-expand")),$("#EmailNotificationWindow").find("table.k-editor").toggleClass("editor-expanded")},showChangeStatus:"Incident"===t.type,changeStatus:!1,sendEmailAttachments:[],fromWorkItemAttachementsId:[],setFirstResponseDate:!!_.isNull(t.viewModel.FirstResponseDate),enableFirstResponseDate:!!_.isNull(t.viewModel.FirstResponseDate),openPopup:function(t){console.log("openPopup",t);var i=[{logic:"and",filters:[{field:"Email",operator:"neq",value:""},{field:"Email",operator:"neq",value:null}]}],n=a.getPopup("3567434d-015f-8dcc-f188-0a407f3a2168",null,null,i,null,!0);n.setSaveCallback(function(n){console.log("setSaveCallback",n);var a="toField"===t.currentTarget.id?"recipientToList":"recipientCCList",o="toField"===t.currentTarget.id?e.find("#userPickerTo").data("kendoMultiSelect"):e.find("#userPickerCc").data("kendoMultiSelect"),r={Email:n.Email,Id:n.Id,Name:n.DisplayName};if(!o.dataSource.data().find(function(e){return e.Id===r.Id})){var l=a.toLowerCase().indexOf("to")>-1?"TO":"CC";i[l]=r.Name,o.dataSource.add(r)}p[a].push(r),o.value(_.pluck(p[a],"Id"))}),n.open()},viewWorkItemFiles:function(){var e=o.getPopup(t,"sendEmail");e.setSaveCallback(function(e){for(var t=e.selectedFiles||[],i=0;i<t.length;i++)s.sendEmailAttachments.push(t[i]),s.fromWorkItemAttachementsId.push(t[i].BaseId)}),e.open()},filesCount:t.viewModel.FileAttachment.length||0,users:[],Status:{Id:"",Name:""},changeStatusSetting:{statusTypeId:"",defaultStatusId:"",rootStatusEnumId:"",enableChangeStatus:!0}});kendo.bind(e,s),app.isMobile()?$.get("/api/V3/User/GetUserList",{fetchAll:!0},function(t){var i=$.map(t,function(e,t){return{id:t,name:e.Name,guid:e.Id,email:e.Email}});s.users=i,T(e.find("#userPickerTo"),s,"recipientToList"),T(e.find("#userPickerCc"),s,"recipientCCList"),x(e,s),N(s),C(s),D(e.find("#statusPicker"),s),A(e.find("#messageEditor"),s),$('[data-toggle="tooltip"]').tooltip(),e.removeClass("hide"),e.show(),n.open()}):(e.on("shown.bs.modal",function(){$(this).off("shown.bs.modal"),$("body").addClass("modal-open"),f=!0,$(".modal-backdrop").each(function(t,i){e.before(i)}),$(document).off("focusin.modal"),$('[data-toggle="tooltip"]').tooltip(),!_.isUndefined(t.widget)&&t.widget.remoteManageRecepient&&null!=t.widget.remoteManageRecepient.BaseId?I():y(s),N(s),C(s),A(e.find("#messageEditor"),s),x(e,s),T(e.find("#userPickerTo"),s,"recipientToList"),T(e.find("#userPickerCc"),s,"recipientCCList"),D(e.find("#statusPicker"),s),_.isNull(s.changeStatusSetting.rootStatusEnumId)&&P(e,t,s)}),e.on("hidden.bs.modal",function(){$("body").removeClass("modal-open"),$(".modal-backdrop").remove();var t=e.find("#userPickerTo").data("kendoMultiSelect"),i=e.find("#userPickerCc").data("kendoMultiSelect");t.value(""),i.value(""),u={},p={recipientToList:[],recipientCCList:[]}}),e.on("hide.bs.modal",function(e){if(f&&$("#extOkCancelDialog").length<=1)return s.cancelClick(e),e.preventDefault(),e.stopImmediatePropagation(),!1}),e.modal("show"))}}),g=_.template(e),b={Target:"sendEmail"};$.extend(!0,b,i),n(new kendo.View(g(b),{wrap:!1,model:v,init:function(e){}}).render());var w=new kendo.data.DataSource({transport:{read:"/EmailNotification/GetNotificationTemplates",dataType:"json"},schema:{model:{fields:{Id:{type:"string"},Name:{type:"string"}}}}}),h=function(e,i){var n={EnteredBy:session.user.Name,Title:localization.EMailSent,IsPrivate:i,EnteredDate:(new Date).toISOString(),LastModified:(new Date).toISOString(),Description:e,DescriptionDisplay:e,Image:app.config.iconPath+app.config.icons["E-Mail Sent"],ActionType:{Id:"15e86d4a-1b55-01be-C9fa-660a3cb3fc26",Name:"Email Sent"}};t.viewModel.ActionLog||(t.viewModel.ActionLog=[]);var a=app.controls.getWorkItemLogType(t.viewModel);a&&t.viewModel[a].push(n)},k=function(e){e==localization.RequiredFieldsErrorMessage?app.lib.message.add(e,"danger"):app.lib.message.add(localization.PleaseCorrectErrors,"danger"),app.lib.message.show()},y=function(e){v.RequestedWorkItem&&null!=v.RequestedWorkItem.DisplayName&&(u.TO=t.viewModel.RequestedWorkItem.DisplayName);var i=t.viewModel.RequestedWorkItem?t.viewModel.RequestedWorkItem.BaseId:"";$.ajax({url:"/EmailNotification/GetffectedUserEmail",type:"GET",data:{baseId:i},success:function(e,i,n){if(!_.isUndefined(e)&&""!=e){var a={Id:t.viewModel.RequestedWorkItem.BaseId,Name:t.viewModel.RequestedWorkItem.DisplayName,Email:e},o=$("#userPickerTo").data("kendoMultiSelect");o.dataSource.data().find(function(e){return e.Id===a.Id})||o.dataSource.add(a),p.recipientToList.push(a),o.value(a.Id)}}})},I=function(){$(document).ready(function(){var e={Id:t.widget.remoteManageRecepient.BaseId,Name:t.widget.remoteManageRecepient.DisplayName,Email:t.widget.remoteManageRecepient.Email};u.TO=e.DisplayName;var i=$("#userPickerTo").data("kendoMultiSelect");i.dataSource.data().find(function(t){return t.Id===e.Id})||i.dataSource.add(e),p.recipientToList.push(e),i.value(e.Id)})},C=function(e){var i=e.changeStatusSetting.defaultStatusId;null==i||""==i?(e.Status.set("Id",t.viewModel.Status.Id),e.Status.set("Name",t.viewModel.Status.Name)):$.ajax({url:"/api/V3/Enum/GetEnumDisplayName",type:"GET",data:{id:i},async:!1,success:function(t,n,a){e.Status.set("Id",i),e.Status.set("Name",t)}})},S=function(e){var t=null;for(var i in e){var n=e[i].trim();if(""!=n&&0==app.validateEmail(n)){t=n;break}}return t},x=function(e,i){i.set("sendEmailAttachments",[]),i.set("filesCount",0);var n=function(t){if(t.hasClass("opennewtab")){var i=window.open("about:blank");setTimeout(function(){i.document.body.appendChild(i.document.createElement("img")).src=t.closest(".thumbnail-file").find(".thumbnail-img img")[0].src,i.href=t.closest(".thumbnail-file").find(".thumbnail-img img")[0].src,i.focus()},0)}else{var n=$(".fileattachment-img-modal"),a=app.config.rootURL+"FileAttachment/ViewFile/",o=e.find(".fileattachment-list").data("kendoListView"),r=t.closest("[role='option']"),l=o.dataSource.getByUid(r.data("uid"));if(l.DisplayName.toLowerCase().match(/\.(jpg|jpeg|png|gif)$/)&&!t.hasClass("download"))n.kendoDialog({modal:!0,title:l.DisplayName,content:"<div class='file-img-container'><img src=\"data:image/png;base64,"+l.Content.data+'" onerror="this.onerror = null; this.src = \'/Content/Images/Icons/FileUpload/document.svg\';" alt="'+l.DisplayName+'" /></div>',animation:{open:{effects:"fade:in"}}}),$(".k-window.k-widget").addClass("acivity-popup-window"),n.data("kendoDialog").open();else if(_.isNull(l.BaseId)){if(l.Content.data){var s=l.DisplayName,d=document.createElement("a");document.body.appendChild(d),d.style="display: none",d.href="data:application/octet-stream;charset=utf-16le;base64,"+l.Content.data,d.download=s,d.click(),document.body.removeChild(d)}}else location.href=a+l.BaseId}};e.find(".fileattachment-list").kendoListView({dataSource:i.sendEmailAttachments,template:kendo.template(e.find("#fileTemplate").html()),selectable:"single",dataBound:function(t){e.find(".custom-click").on("click",function(){n($(this))}),app.isMobile()||(e.find("a[view-image]").parent().hide(),e.find(".thumbnail-img").on("click",function(){n($(this))}))},remove:function(e){}});e.find("#email-attachment").kendoUpload({async:{saveUrl:"/FileAttachment/UploadAttachment/"+t.viewModel.BaseId+"?className="+t.viewModel.ClassName+"&count="+t.viewModel.FileAttachment.length,autoUpload:!0},success:function(t){kendo.ui.progress(e.find(".fileattachment-list"),!0);var n=t.response;if("upload"==t.operation)for(var a=0;a<t.files.length;a++){var o=t.files[a].rawFile;o&&(_.isUndefined(n.FileAttachment)?_.isUndefined(n.success)||0!=n.success||(i.set("okEnabled",!1),kendo.ui.ExtAlertDialog.show({title:localization.ErrorDescription,message:n.message,icon:"fa fa-exclamation"})):(i.sendEmailAttachments.push(n.FileAttachment),i.set("attachmentErrorMessage",""),i.set("okEnabled",!0)))}kendo.ui.progress(e.find(".fileattachment-list"),!1)},error:function(e){$.parseJSON(e.XMLHttpRequest.responseText);$.map(e.files,function(e){console.warn("Could not upload "+e.name)})},showFileList:!1,dropZone:".drop-zone-element"}).data("kendoUpload");e.find(".browse-file").click(function(e){$("#email-attachment").trigger("click")})},T=function(e,t,i){if(_.isUndefined(e.data("kendoMultiSelect"))){var n=e[0].id.toLowerCase().indexOf("to")>-1?"TO":"CC",a=e.kendoMultiSelect({placeholder:localization.Search,dataTextField:"Name",dataValueField:"Id",autoBind:!1,filter:"contains",dataSource:new kendo.data.DataSource({transport:{read:{url:"/api/V3/User/GetUserListWithEmail",data:{filterByAnalyst:!1,maxNumberOfResults:1e3,userFilter:function(){return u[n]?u[n]:""}}}},serverFiltering:!0,filter:[{field:"Email",operator:"neq",value:""}]}),filtering:function(e){if(void 0!=e.filter){var t=e.sender.element[0].id.toLowerCase().indexOf("to")>-1?"TO":"CC";u[t]=e.filter.value}},open:function(){this.dataSource.filter()},tagTemplate:"<span title='#: data.Email #'>#: data.Name #;</span>",select:function(e){var t=p[i];t.push(e.dataItem),p[i]=t},deselect:function(e){var t=p[i];e.dataItem.Id&&(t=_.filter(t,function(t){return t.Id!==e.dataItem.Id})),p[i]=t},clearButton:!1}).data("kendoMultiSelect");a.input.on("keydown",function(e){if(9===e.keyCode){var e=jQuery.Event("keydown");e.which=13,e.keyCode=13,a.input.trigger(e)}})}},M=function(e,i){var n=e.changeStatus,a=e.addToLog,o=!1,r=e.sendEmailAttachments.length>0,l=e.sendEmailAttachments.length>0?_.pluck(e.sendEmailAttachments,"DisplayName").join("|"):"",s=encodeURIComponent(e.emailHTMLMessage),d=e.emailTextMessage,c=e.fromWorkItemAttachementsId.length>0?e.fromWorkItemAttachementsId.join(","):"";s=session.emailFooterTemplate.length>0?s+"\r\n"+encodeURIComponent($("<div/>").html(session.emailFooterTemplate).text()):s;var u={To:e.emailTo,Cc:e.emailCC,Subject:e.emailSubject.replace(/</g,"%3C").replace(/>/g,"%3E"),Message:s,AttachedFileNames:l,WorkItemId:t.viewModel.BaseId,workItemFileIds:c},p=e.sendEmailAttachments,m=e.setFirstResponseDate;$.ajax({url:"/EmailNotification/SendEmailNotification",type:"POST",data:u,async:!1,success:function(l,s,c){var u="true"==l.toLowerCase();kendo.ui.progress(i,!1),u?$.when(kendo.ui.ExtAlertDialog.show({title:localization.SendEmail,message:localization.SendEmailSuccessMessage})).done(function(l){null!=e.Status&&""!=e.Status.Id&&(t.viewModel.Status.set("Id",e.Status.Id),n=!0),r&&(_.isUndefined(t.viewModel.FileAttachment)||_.each(p,function(e){t.viewModel.FileAttachment.push(e);var i=app.controls.getWorkItemLogType(t.viewModel);i&&t.viewModel[i].unshift(new app.dataModels[i].fileAdded(e.DisplayName))})),a&&(d=_.isUndefined(d)?"":d.substring(0,4e3),d.length>0?h(d.replace(/</g,"&lt;").replace(/>/g,"&gt;"),e.setAsPrivate):(a=!1,o=!0)),m&&t.viewModel.set("FirstResponseDate",(new Date).toISOString());var s=function(){t.widget&&(t.widget.remoteManageRecepient=null),f=!1,i.modal("hide"),t.save(function(){switch(app.lib.message.add(localization.ChangesApplied,"success"),t.type){case"ChangeRequest":location.href="/ChangeRequest/Edit/"+t.viewModel.Id+"/";break;case"ServiceRequest":location.href="/ServiceRequest/Edit/"+t.viewModel.Id+"/";break;case"Incident":location.href="/Incident/Edit/"+t.viewModel.Id+"/";break;case"Problem":location.href="/Problem/Edit/"+t.viewModel.Id+"/";break;case"ReleaseRecord":location.href="/ReleaseRecord/Edit/"+t.viewModel.Id+"/";break;default:location.href="/View/cca5abda-6803-4833-accd-d59a43e2d2cf/"}},k)};o?$.when(kendo.ui.ExtAlertDialog.show({title:localization.SkippedAddingLogEntryTitle,message:localization.ErrorAddingLogEntryMessage,icon:"fa fa-warning"})).done(function(){s()}):s()}):($.when(kendo.ui.ExtAlertDialog.show({title:localization.SendEmail,message:localization.SendEmailFailedMessage})),kendo.ui.progress(i,!1),console.log(c,s,localization.SendEmailFailedMessage))},error:function(e,t,i){console.log(e,t,i)}})},A=function(e,i){function n(e,i){var n=new Date,a=n.getTime(),o=new FormData;o.append("files",e,"screenshot_"+a+".png"),$.ajax({url:"/FileAttachment/UploadAttachment/"+t.viewModel.BaseId+"?className="+t.viewModel.ClassName+"&count="+t.viewModel.FileAttachment.length,data:o,type:"POST",async:!0,contentType:!1,processData:!1,dataType:"json",success:function(e){_.isUndefined(e.FileAttachment)?(i.set("attachmentErrorMessage",e.message),i.set("okEnabled",!1),i.set("emailAttachment","")):(i.sendEmailAttachments.push(e.FileAttachment),i.set("attachmentErrorMessage",""),i.set("okEnabled",!0))},error:function(e){console.warn(e)}})}function a(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t.toDataURL("image/png")}function o(e){for(var t=atob(e.split(",")[1]),i=e.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(t.length),a=new Uint8Array(n),o=0;o<t.length;o++)a[o]=t.charCodeAt(o);return new Blob([n],{type:i})}
var r=["bold","italic","underline","formatting","foreColor","backColor","justifyLeft","justifyCenter","justifyRight","justifyFull","insertUnorderedList","insertOrderedList","indent","outdent","createLink","unlink","insertImage","viewHtml","createTable","addColumnLeft","addColumnRight","addRowAbove","addRowBelow","deleteRow","deleteColumn",{name:"insertLineBreak",shift:!0},{name:"insertParagraph",shift:!0}],l=["formatting","createLink","unlink","insertImage","viewHtml","bold","italic","underline","insertUnorderedList","insertOrderedList","indent","outdent","createTable","addColumnLeft","addColumnRight","addRowAbove","addRowBelow","deleteRow","deleteColumn",{name:"insertLineBreak",shift:!0},{name:"insertParagraph",shift:!0}],s=e.data("kendoEditor");_.isUndefined(s)&&(s=e.kendoEditor({change:function(e){var t=e.sender.body.innerText||e.sender.body.textContent;i.set("emailTextMessage",t)},tools:app.isMobileDevice()?l:r,stylesheets:["/Content/Styles/cireson.mentions-in-keditor.min.css"],encoded:!0,paste:function(e){},pasteCleanup:{custom:function(e){try{if("IMG"===$(e)[0].tagName){var t,r=$(e).attr("src");if(null===r.match(/^data:image\/(png|jpg);base64,/)){var l=new Image;l.setAttribute("crossOrigin","anonymous"),l.src=r,$(l).one("load",function(){setTimeout(function(){r=a(l),t=o(r),n(t,i)},0)}).each(function(){this.complete&&$(this).load()})}else t=o(r),n(t,i)}}catch(e){}return e}}}))},D=function(e,t){var i="",n=t.changeStatusSetting.rootStatusEnumId;null!=n&&(i=n.toLowerCase()==t.Status.Id.toLowerCase()?n:n+","+t.Status.Id);var a=(t.changeStatusSetting.statusTypeId,{PropertyName:"Status",PropertyDisplayName:"ChangeStatus",EnumId:t.changeStatusSetting.statusTypeId,FilterIds:i,Disabled:!t.changeStatusSetting.enableChangeStatus||!session.user.Analyst||pageForm.newWI});R(e,a,t)},R=function(e,t,i){r.build(i,t,function(t){e.html(t),app.controls.apply(e,{localize:!0,vm:i,bind:!0})})},P=function(e,t,i){var n=t.type,a=t.viewModel.Status.Id,o=i.changeStatusSetting.statusTypeId,r=i.changeStatusSetting.rootStatusEnumId,l=e.find('div[data-role="Status"]').data().handler._dropdown,s=e.find('div[data-role="Status"]').data().handler._treeview,d=app.lib.getChangeStatusRules(),c=d[n][a];"Incident"==n&&_.isUndefined(c)&&(c={field:"Id",operator:"neq",value:app.constants.workItemStatuses.Incident.Closed}),_.isNull(r)||(c={field:"Id",operator:"eq",value:r}),s.dataSource.options.serverFiltering=!1,s.dataSource.filter(c),$.get("/api/V3/Enum/GetFlatList/",{id:o,itemFilter:""},function(e){var t=new kendo.data.DataSource;t.data(e),t.filter(c),t.view().length>0&&l.setDataSource(t.view())})},N=function(e){switch(t.type){case"ServiceRequest":e.changeStatusSetting.statusTypeId=app.constants.workItemStatuses.ServiceRequest.Id,e.changeStatusSetting.rootStatusEnumId=session.consoleSetting.SendEmailServiceRootStatusEnum,e.changeStatusSetting.defaultStatusId=session.consoleSetting.SendEmailServiceDefaultStatusEnum,e.changeStatusSetting.enableChangeStatus=session.consoleSetting.SendEmailServiceAllowAnalystToChangeStatus;break;case"ChangeRequest":e.changeStatusSetting.statusTypeId=app.constants.workItemStatuses.ChangeRequest.Id,e.changeStatusSetting.rootStatusEnumId=session.consoleSetting.SendEmailChangeRootStatusEnum,e.changeStatusSetting.defaultStatusId=session.consoleSetting.SendEmailChangeDefaultStatusEnum,e.changeStatusSetting.enableChangeStatus=session.consoleSetting.SendEmailChangeAllowAnalystToChangeStatus;break;case"Problem":e.changeStatusSetting.statusTypeId=app.constants.workItemStatuses.Problem.Id,e.changeStatusSetting.rootStatusEnumId=session.consoleSetting.SendEmailProblemRootStatusEnum,e.changeStatusSetting.defaultStatusId=session.consoleSetting.SendEmailProblemDefaultStatusEnum,e.changeStatusSetting.enableChangeStatus=session.consoleSetting.SendEmailProblemAllowAnalystToChangeStatus;break;case"ReleaseRecord":e.changeStatusSetting.statusTypeId=app.constants.workItemStatuses.ReleaseRecord.Id,e.changeStatusSetting.rootStatusEnumId=session.consoleSetting.SendEmailReleaseRootStatusEnum,e.changeStatusSetting.defaultStatusId=session.consoleSetting.SendEmailReleaseDefaultStatusEnum,e.changeStatusSetting.enableChangeStatus=session.consoleSetting.SendEmailReleaseAllowAnalystToChangeStatus;break;case"Incident":default:e.changeStatusSetting.statusTypeId=app.constants.workItemStatuses.Incident.Id,e.changeStatusSetting.rootStatusEnumId=session.consoleSetting.SendEmailIncidentRootStatusEnum,e.changeStatusSetting.defaultStatusId=session.consoleSetting.SendEmailIncidentDefaultStatusEnum,e.changeStatusSetting.enableChangeStatus=session.consoleSetting.SendEmailIncidentAllowAnalystToChangeStatus}}}}}),define("forms/tasks/custom/controller",["require","text!forms/tasks/anchor/view.html"],function(e){var t=e("text!forms/tasks/anchor/view.html");return{build:function(e,i,n){if(_.isNull(i.Label))i.Configs.func(e,e.viewModel);else{var a=_.template(t),o={Target:"customFunc"};$.extend(!0,o,i);var r=kendo.observable({customFunc:function(){i.Configs.func(e,e.viewModel)}});n(new kendo.View(a(o),{wrap:!1,model:r}).render())}}}}),define("text!forms/tasks/spacer/view.html",[],function(){return'<div class="form-group">\r\n\r\n</div>'}),define("forms/tasks/spacer/controller",["require","text!forms/tasks/spacer/view.html"],function(e){var t=e("text!forms/tasks/spacer/view.html");return{template:t,build:function(e,i,n){var a=_.template(t),o={};$.extend(!0,o,i),n(new kendo.View(a(o),{wrap:!1}).render())}}}),define("forms/tasks/associateItem/controller",["require","text!forms/tasks/anchor/view.html"],function(e){var t=e("text!forms/tasks/anchor/view.html");return{build:function(e,i,n){var a=kendo.observable({changeStatus:function(){$("input[name='"+i.Configs.relationshipKey+"']").parent().find(".searchIcon").click()}}),o=_.template(t),r={Target:"changeStatus"};$.extend(!0,r,i),n(new kendo.View(o(r),{wrap:!1,model:a,init:function(e){}}).render())}}}),define("text!forms/tasks/setDate/view.html",[],function(){return'<div id="ChangeStatusWindow" class="cireson-window defined-form hide">\r\n    <div class="cireson-window--wrapper">\r\n        <div class="cireson-window--body">\r\n            <div id="datePicker"/>\r\n            <div id="disposalReference"/>\r\n            <div id="autoResolve" class="col-group" data-bind="visible:showAutoResolve"/>\r\n        </div>\r\n        <div class="cireson-window--footer window-buttons">\r\n            <div id="changeStatusErrorWin" class="error"></div>\r\n            <button data-role="button"\r\n                    class="btn btn-primary"\r\n                    data-bind="enabled: okEnabled, events: { click: okClick }">\r\n                <%= localization.OK %>\r\n            </button>\r\n            <button data-role="button"\r\n                    class="btn btn-default"\r\n                    data-bind="events: { click: cancelClick }">\r\n                <%= localization.Cancel %>\r\n            </button>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("text!forms/fields/date/view.html",[],function(){return'<div class="form-group"\r\n    <% if ( Required ){ %>\r\n    required\r\n    <% } %>\r\n    >\r\n    <label class="control-label" for="<%= PropertyName %>" data-localize="<%= PropertyDisplayName %>">\r\n        <span><% if ( Required ){ %> <%= \'(\' + localization.Required + \')\' %><% } %></span>\r\n    </label>\r\n    <input name="<%= PropertyName %>"\r\n           data-control="datePicker"\r\n           data-control-bind="<%= PropertyName %>"\r\n           data-control-from="<%= FromFilter %>"\r\n           data-control-to="<%= ToFilter %>"\r\n           data-control-from-relative="<%= FromRelative %>"\r\n           data-control-to-relative="<%= ToRelative %>"\r\n    <% if ( Disabled ){ %>\r\n    disabled\r\n    <% } %>\r\n\r\n     />\r\n</div>'}),define("forms/fields/date/controller",["require","text!forms/fields/date/view.html"],function(e){var t=e("text!forms/fields/date/view.html");return{template:t,build:function(e,i,n){var a=_.template(t),o={FromFilter:"",ToFilter:"",FromRelative:"",ToRelative:"",Disabled:i.disabled,Required:i.Required};void 0!=i.MinValue&&(-1!=i.MinValue.indexOf(":")?o.FromRelative=i.MinValue:"string"==typeof i.MinValue&&(o.FromFilter=i.MinValue)),void 0!=i.MaxValue&&(-1!=i.MaxValue.indexOf(":")?o.ToRelative=i.MaxValue:"string"==typeof i.MaxValue&&(o.ToFilter=i.MaxValue)),$.extend(!0,o,i),n(a(o))}}}),define("text!forms/fields/string/view.html",[],function(){return'<div class="form-group">\r\n    <label class="control-label" for="<%= PropertyName %>" data-localize="<%= PropertyDisplayName %>">\r\n        <span><% if ( Required ){ %> <%= \'(\' + localization.Required + \')\' %><% } %></span>\r\n    </label>\r\n    <input type="text"\r\n           name="<%= PropertyName %>"\r\n           class="k-textbox form-control input-sm"\r\n           data-bind="value: <%= PropertyName %><% if ( LimitLength ){ %>, events : { blur: view.stringController.CheckLength }<% } %>"\r\n\r\n\r\n    <% if ( LimitLength ){ %>\r\n    maxlength="<%= MaxLength %>"\r\n    <% } %>\r\n\r\n    <% if ( Disabled ){ %>\r\n    disabled\r\n    <% } %>\r\n\r\n    <% if ( Required ){ %>\r\n    required\r\n    <% } %>\r\n\r\n    />\r\n\r\n    <% if ( LimitLength ){ %>\r\n    <p class="help-block validation-summary-errors" style="display: none;"><%= localization.MaxLengthError.replace("{0}", MaxLength) %></p>\r\n    <% } %>\r\n\r\n</div>'}),define("forms/fields/string/controller",["require","text!forms/fields/string/view.html"],function(e){var t=e("text!forms/fields/string/view.html");return{template:t,build:function(e,i,n){var a=i.vm,o=new kendo.View;_.isUndefined(a.view)&&(a.view=[]),a.view.stringController={CheckLength:function(e){setTimeout(function(){var t=$(e.currentTarget),i=t.next(),n=t.attr("maxlength");t.val().length>n?(t.attr("data-invalid",""),i.show()):(i.hide(),t.removeAttr("data-invalid"),t.data("prevent",!1))},100)}},a.view.buildStringView=function(){var e=_.template(t),r=!1;_.isUndefined(i.MinLength)&&_.isUndefined(i.MaxLength)||(r=!0);var l={Required:i.Required,Disabled:i.disabled,MinLength:i.MinLength,MaxLength:i.MaxLength,LimitLength:r};$.extend(!0,l,i),o=new kendo.View(e(l),{wrap:!1,model:a}),n(o.render())},a.view.buildStringView()}}}),define("forms/tasks/setDate/controller",["require","text!forms/tasks/anchor/view.html","text!forms/tasks/setDate/view.html","forms/fields/date/controller","forms/fields/string/controller","forms/fields/longstring/controller","forms/fields/boolean/controller"],function(e){var t=e("text!forms/tasks/anchor/view.html"),i=e("text!forms/tasks/setDate/view.html"),n=e("forms/fields/date/controller"),a=e("forms/fields/string/controller"),o=(e("forms/fields/longstring/controller"),e("forms/fields/boolean/controller"));return{template:i,build:function(e,r,l){var s,d,c=r.Configs.Title,u=_.template(i),p=new kendo.View(u(v),{wrap:!1});l(p.render());var m=kendo.observable({openWindow:function(){var t=p.element.clone();win=t.kendoCiresonWindow({title:c,width:600,height:375,actions:[]}).data("kendoWindow");var i="",n=kendo.observable({type:r.Configs.type,workItemModel:e.viewModel,okClick:function(){switch(r.Configs.viewType){case"hdDisposal":e.viewModel.set("HardwareAssetStatus",{Id:"020822bd-7d3a-4c0f-1be4-325ef1aa52b4",Name:localization.Disposed});break;case"hdREcieveDate":case"MasterContractRenewedOn":e.viewModel.get(d.attr("name"))&&s.val("").blur()}win.close()},cancelClick:function(){var t="";_.isNull(a)||(t=kendo.toString(new Date(a),"g")),$('[name="'+o.PropertyName+'"]').val(t).blur(),"hdDisposal"==r.Configs.viewType?e.viewModel.set("DisposalReference",l):"hdREcieveDate"==r.Configs.viewType?e.viewModel.recieveCheckbox=m:"MasterContractRenewedOn"==r.Configs.viewType&&(e.viewModel.masterContractStartingDateCheckbox=m),win.close()}});"hdDisposal"==r.Configs.viewType?i=localization.DisposalDate:"hdREcieveDate"==r.Configs.viewType?i=localization.ReceiveDate:"MasterContractRenewedOn"==r.Configs.viewType&&(i=localization.StartDate),kendo.bind(t,n);var a=e.viewModel.get(r.Configs.propertyKey),o={PropertyName:r.Configs.propertyKey,PropertyDisplayName:i,vm:e.viewModel,disabled:!1};if(g(t.find("#datePicker"),o,e.viewModel),"hdDisposal"==r.Configs.viewType){var l=e.viewModel.get("DisposalReference"),u={PropertyName:"DisposalReference",PropertyDisplayName:localization.DisposalReference,vm:e.viewModel};b(t.find("#disposalReference"),u,e.viewModel)}else if("hdREcieveDate"==r.Configs.viewType){var m=e.viewModel.recieveCheckbox,f={PropertyName:"recieveCheckbox",PropertyDisplayName:localization.RemoveReceivedDate,Inline:!0};w(t.find("#disposalReference"),f,e.viewModel)}else if("MasterContractRenewedOn"==r.Configs.viewType){var m=e.viewModel.masterContractStartingDateCheckbox,f={PropertyName:"masterContractStartingDateCheckbox",PropertyDisplayName:localization.RemoveMasterLeaseWarrantyStarts,Inline:!0};w(t.find("#disposalReference"),f,e.viewModel)}t.removeClass("hide"),t.show(),win.open()}}),f=_.template(t),v={Target:"openWindow"};$.extend(!0,v,r),l(new kendo.View(f(v),{wrap:!1,model:m,init:function(e){}}).render());var g=function(e,t,i){_.isNull(i[t.PropertyName])||""==i[t.PropertyName]?i.set(t.PropertyName,kendo.toString(new Date,"g")):i.set(t.PropertyName,kendo.toString(new Date(i[t.PropertyName]),"g")),n.build(i,t,function(n){e.html(n),app.controls.apply(e,{localize:!0,vm:i,bind:!0}),s=e.find("input[name='"+t.PropertyName+"']"),s.focus(),s.blur()})},b=function(e,t,i){a.build(i,t,function(t){e.html(t),app.controls.apply(e,{localize:!0,vm:i,bind:!0})})},w=function(t,i,n){o.build(n,i,function(a){t.html(a),app.controls.apply(t,{localize:!0,vm:n,bind:!0}),d=t.find("input[name='"+i.PropertyName+"']"),e.viewModel.set(i.PropertyName,!1),d.click(function(){var e=s.data("kendoDatePicker");this.checked?e.enable(!1):e.enable(!0)})})}}}}),define("forms/tasks/updateAssetManagement/controller",["require","text!forms/tasks/anchor/view.html"],function(e){var t=e("text!forms/tasks/anchor/view.html");return{build:function(e,i,n){!function(){switch(i.Configs.type){case"WarrantyContract":case"SupportAndMaintenance":case"ContractLease":CommonContract.UpdateStatus(e.viewModel,!0)}}();var a=kendo.observable({changeStatus:function(){switch(i.Configs.type){case"License":pageForm.SetSeatsRemaining(pageForm.viewModel);break;case"SoftwareAsset":s(e.viewModel);break;case"Consumables":l(e.viewModel);break;default:CommonContract.SupersedesParent(e.viewModel)}}}),o=_.template(t),r={Target:"changeStatus"};$.extend(!0,r,i),n(new kendo.View(o(r),{wrap:!1,model:a,init:function(e){}}).render());var l=function(e){if(e.CountAssignedConsumableUsers||e.CountAssignedConsumableAssets){var t=0;!_.isNull(e.Target_ConsumableHasAssignedUsers)&&e.CountAssignedConsumableUsers&&(t+=e.Target_ConsumableHasAssignedUsers.length),!_.isNull(e.Target_ConsumableHasAssignedAssets)&&e.CountAssignedConsumableAssets&&(t+=e.Target_ConsumableHasAssignedAssets.length),e.set("AssignedCount",t)}},s=function(e){$.when(kendo.ui.ExtYesNoDialog.show({title:localization.CiresonAssetManagement,message:localization.SoftwareAssetUpdateConfirmationMsg})).done(function(t){"yes"===t.button&&e.save(function(t,i){1==t&&$.ajax({type:"POST",dataType:"json",url:"/AssetManagement/SoftwareAsset/UpdateSoftwareAsset/",data:"formJson="+i+"&id="+e.BaseId,success:function(t,i,n){1==t.Success?$.when(kendo.ui.ExtAlertDialog.show({title:localization.CiresonAssetManagement,message:localization.SoftwareAssetUpdated})).done(function(t){e.set("isDirty",!1),app.lib.message.add(localization.ChangesApplied,"success"),window.location.reload(!0)}):kendo.ui.ExtAlertDialog.show({title:localization.CiresonAssetManagement,message:localization.ErrorOccured})},error:function(e,t,i){failure(),console&&app.lib.log(localization.RequestFailed),app.lib.log(i);var n=e.responseText;app.lib.log(n);var a=localization.RequestFailed;n.exception&&n.exception.length>0&&(a=n.exception),kendo.ui.ExtAlertDialog.show({title:localization.ErrorDescription,message:a,icon:"fa fa-exclamation"})},processData:!1,async:!1})},e.saveFailure,!0)})}}}}),define("forms/tasks/updateSupersededHardware/controller",["require","text!forms/tasks/anchor/view.html"],function(e){var t=e("text!forms/tasks/anchor/view.html");return{build:function(e,i,n){var a=kendo.observable({changeStatus:function(){$.when(kendo.ui.ExtYesNoDialog.show({title:localization.CiresonAssetManagement,message:localization.UpdateSupersedesConfirmation})).done(function(e){"yes"===e.button&&$.post(i.Configs.url,{baseId:i.Configs.baseId},function(e){!0===e.success?kendo.ui.ExtAlertDialog.show({title:localization.UpdatingAssets,message:localization.TotalNumberofAssetsUpdated+": "+e.count}):kendo.ui.ExtAlertDialog.show({title:localization.ServerError,message:e.error})})})}}),o=_.template(t),r={Target:"changeStatus"};$.extend(!0,r,i),n(new kendo.View(o(r),{wrap:!1,model:a,init:function(e){}}).render())}}}),define("text!forms/tasks/copyLicenseAssignments/view.html",[],function(){return'<div id="CopyLicenseAssignmentsWindow" class="cireson-window defined-form hide">\r\n    <div id="windowContent" class="cireson-window--wrapper">\r\n        <div class="cireson-window--body">\r\n            <form>\r\n                <fieldset id="source">\r\n                    <legend><%= localization.RelatedLicenseAssignmentSource %></legend>\r\n                    <label class="control-label">\r\n                        <input class="control-label" type="radio" id="Computers" value="Computers" name="Source" data-bind="checked: selected" />\r\n                        <%= localization.Computers %>\r\n                    </label>\r\n                    <label class="control-label">\r\n                        <input type="radio" id="Users" value="Users" name="Source" data-bind="checked: selected" />\r\n                        <%= localization.Users %>\r\n                    </label>\r\n                    <label class="control-label">\r\n                        <input type="radio" id="Both" value="Both" name="Source" data-bind="checked: selected" />\r\n                        <%= localization.Both %>\r\n                    </label>\r\n                </fieldset>\r\n                <br />\r\n                <br />\r\n                <fieldset id="target">\r\n                    <legend><%= localization.SelectedSoftwareAssetTargetList %></legend>\r\n                    <label class="control-label">\r\n                        <input class="control-label" type="radio" id="AuthorizedList" value="AuthorizedList" name="Target" data-bind="checked: selected" />\r\n                        <%= localization.AuthorizedList %>\r\n                    </label>\r\n                    <label class="control-label">\r\n                        <input type="radio" id="AssignedList" value="AssignedList" name="Target" data-bind="checked: selected" />\r\n                        <%= localization.AssignedListNamedLicenses %>\r\n                    </label>\r\n                    <label class="control-label">\r\n                        <input type="radio" id="Both" value="Both" name="Target" data-bind="checked: selected" />\r\n                        <%= localization.Both %>\r\n                    </label>\r\n                </fieldset>\r\n            </form>\r\n            <div id="autoResolve" class="col-group" data-bind="visible:showAutoResolve" />    \r\n        </div>\r\n        <div class="cireson-window--footer window-buttons">\r\n            <div id="changeStatusErrorWin" class="error"></div>\r\n            <button data-role="button"\r\n                    class="btn btn-primary"\r\n                    data-bind="enabled: okEnabled, events: { click: okClick }">\r\n                <%= localization.OK %>\r\n            </button>\r\n            <button data-role="button"\r\n                    class="btn btn-default"\r\n                    data-bind="events: { click: cancelClick }">\r\n                <%= localization.Cancel %>\r\n            </button>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("forms/tasks/copyLicenseAssignments/controller",["require","text!forms/tasks/anchor/view.html","text!forms/tasks/copyLicenseAssignments/view.html"],function(e){var t=e("text!forms/tasks/anchor/view.html"),i=e("text!forms/tasks/copyLicenseAssignments/view.html");return{template:i,build:function(e,n,a){var o=_.template(i),r=new kendo.View(o(d),{wrap:!1});a(r.render());var l=kendo.observable({openWindow:function(){var t=r.element.clone();win=t.kendoCiresonWindow({title:localization.CopyLicenseAssignments,width:600,height:375,actions:[]}).data("kendoWindow");var i=new kendo.observable({type:n.Configs.type,okClick:function(){$.when(kendo.ui.ExtAlertDialog.show({title:localization.CiresonAssetManagement,message:localization.StartCopyLicenseAsssignements})).done(function(i){$.post("/AssetManagement/SoftwareAsset/CopyLicenseAssignments/",t.find("#windowContent form").serialize()+"&id="+e.viewModel.BaseId,function(t){if(1==t.success){var i=!1,n=!1,r=!1,s=l.selected,d=o.selected,c="AssignedList"==s,u=t.ComputerList,p=t.UserList;"AuthorizedList"==s&&(r=!0),"Users"==d&&(i=!0),"Computers"==d&&(n=!0),"Both"==d&&(i=!0,n=!0),"Both"==s&&(c=!0,r=!0),i&&c&&a(e.viewModel,p,"Target_SoftwareAssetHasAssignedUsers"),n&&c&&a(e.viewModel,u,"Target_SoftwareAssetHasAssignedComputers"),i&&r&&a(e.viewModel,p,"Target_SoftwareAssetHasAuthorisedUser"),n&&r&&a(e.viewModel,u,"Target_SoftwareAssetHasAuthorisedComputer"),kendo.ui.ExtAlertDialog.show({title:localization.CiresonAssetManagement,message:localization.UpdateSoftwareAssetMsg})}else kendo.ui.ExtAlertDialog.show({title:localization.CiresonAssetManagement,message:t.error})})}),win.close()},cancelClick:function(){win.close()}});kendo.bind(t,i);var a=function(e,t,i){var n=e[i],a=!1;for(var o in t){a=!1;for(var r in n)if(n[r].BaseId==t[o].BaseId){a=!0;break}a||n.addItem(t[o])}},o=kendo.observable({selected:"Computers"});kendo.bind(t.find("#source"),o);var l=kendo.observable({selected:"AuthorizedList"});kendo.bind(t.find("#target"),l),t.removeClass("hide"),t.show(),win.open()}}),s=_.template(t),d={Target:"openWindow"};$.extend(!0,d,n),a(new kendo.View(s(d),{wrap:!1,model:l,init:function(e){}}).render())}}}),define("text!CustomSpace/customtasks.tmpl.html",[],function(){return'<div>\r\n<div id="commentHTML" class="form-horiztontal">\r\n<div>\r\n<div class="col-group">\r\n<div class="inline-spacing">\r\n<label>What do you want to search?</label>\r\n</div>\r\n<div class="inline-spacing">\r\n<textarea data-bind="value: comment, events: {keyup:textCounter}"\r\ndata-value-update="keyup"\r\nclass="k-textbox"\r\nrows="7" ></textarea>\r\n<div class="inline-spacing">\r\n<span data-bind="html:charactersRemaining"></span>\r\n<span>characters remaining</span>\r\n</div>\r\n</div>\r\n<div class="window-buttons">\r\n<button data-role="button"\r\nclass="btn btn-primary"\r\ndata-bind="enabled: okEnabled, events: { click: okClick }">\r\nOK\r\n</button>\r\n<button data-role="button"\r\nclass="btn btn-primary"\r\ndata-bind="events: { click: cancelClick }">\r\nCancel\r\n</button>\r\n</div>\r\n</div>\r\n</div>\r\n</div>'}),define("forms/tasks/copyToNewWI/controller",["require","text!forms/tasks/anchor/view.html"],function(e){var t=e("text!forms/tasks/anchor/view.html");return{build:function(e,i,n){var a=_.template(t),o={Target:"copyToNewWI"};$.extend(!0,o,i);var r=(a(o),kendo.observable({copyToNewWI:function(){var t,i;i=$("<form>",{method:"post",target:"_blank"}),t=$("<input>",{type:"hidden",name:"vm"}),i.append(t),$("body").append(i),t.val(JSON.stringify(e.viewModel)),"Incident"==e.type&&i.attr("action","/Incident/New/"),"ServiceRequest"==e.type&&i.attr("action","/ServiceRequest/New/"),i.submit(),i.remove()}}));n(new kendo.View(a(o),{wrap:!1,model:r}).render())}}}),define("text!forms/tasks/increaseAvailableCount/view.html",[],function(){return'<div id="ChangeStatusWindow" class="cireson-window defined-form hide">\r\n    <div class="cireson-window--wrapper">\r\n        <div class="cireson-window--body">\r\n            <div id="increaseAvailableCount"/>\r\n            <div id="commentAvailableCount"/>\r\n            <div id="autoResolve" class="col-group" data-bind="visible:showAutoResolve"/>\r\n        </div>\r\n        <div class="cireson-window--footer window-buttons">\r\n            <div id="changeStatusErrorWin" class="error"></div>\r\n            <button data-role="button"\r\n                    class="btn btn-primary"\r\n                    data-bind="enabled: okEnabled, events: { click: okClick }">\r\n                <%= localization.OK %>\r\n            </button>\r\n            <button data-role="button"\r\n                    class="btn btn-default"\r\n                    data-bind="events: { click: cancelClick }">\r\n                <%= localization.Cancel %>\r\n            </button>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("forms/fields/longString/controller",["require","text!forms/fields/longstring/view.html"],function(e){var t=e("text!forms/fields/longstring/view.html");return{template:t,build:function(e,i,n){var a=i.vm,o=new kendo.View;_.isUndefined(a.view)&&(a.view=[]),a.view.longStringController={CheckLength:function(e){setTimeout(function(){var t=$(e.currentTarget),i=t.next(),n=t.attr("maxlength");t.val().length>n?(t.attr("data-invalid",""),i.show()):(i.hide(),t.removeAttr("data-invalid"),t.data("prevent",!1))},100)}},a.view.buildLongStringView=function(){var e=_.template(t),r=!1;_.isUndefined(i.MinLength)&&_.isUndefined(i.MaxLength)||(r=!0);var l={Required:i.Required,Disabled:i.disabled,MinLength:i.MinLength,MaxLength:i.MaxLength,LimitLength:r,Rows:10,visible:_.isUndefined(i.IsVisible)||0!=i.IsVisible?"":"hidden"};$.extend(!0,l,i),o=new kendo.View(e(l),{wrap:!1,model:a}),n(o.render())},a.view.buildLongStringView()}}}),define("text!forms/fields/numeric/view.html",[],function(){return'<div data-cid="NumericControl" data-cid-propname="<%= PropertyName %>" class="form-group">\r\n    <label class="control-label" for="<%= PropertyName %>" data-localize="<%= PropertyDisplayName %>">\r\n        <span><% if ( Required ){ %> <%= \'(\' + localization.Required + \')\' %><% } %></span>\r\n    </label>\r\n    <input type="number"\r\n           name="<%= PropertyName %>"\r\n           class="form-control form-control-picker input-sm"\r\n           data-control="numericTextBox"\r\n           data-bind="value: <%= PropertyName %>"\r\n           data-control-decimals="<%= DecimalPlaces %>"\r\n           data-control-min="<%= MinValue%>"\r\n           data-control-max="<%= MaxValue %>"\r\n           data-step="<%= StepIncrement %>"\r\n           data-format="<%= Format%>"\r\n\r\n            <% if ( Disabled ){ %>\r\n                disabled\r\n            <% } %>\r\n\r\n            <% if ( Required ){ %>\r\n            required\r\n            <% } %>\r\n\r\n    />\r\n</div>'}),define("forms/fields/numeric/controller",["require","text!forms/fields/numeric/view.html"],function(e){var t=e("text!forms/fields/numeric/view.html");return{template:t,build:function(e,i,n){var a=_.template(t),o={Required:i.Required,DecimalPlaces:2,MinValue:0,MaxValue:100,StepIncrement:1,Disabled:i.disabled,Format:""};$.extend(!0,o,i),n(a(o))}}}),define("forms/tasks/increaseAvailableCount/controller",["require","text!forms/tasks/anchor/view.html","text!forms/tasks/increaseAvailableCount/view.html","forms/fields/longString/controller","forms/fields/numeric/controller"],function(e){var t=e("text!forms/tasks/anchor/view.html"),i=e("text!forms/tasks/increaseAvailableCount/view.html"),n=e("forms/fields/longString/controller"),a=e("forms/fields/numeric/controller");return{template:i,build:function(e,o,r){var l=localization.EditConsumableAvailableCount,s=_.template(i),d=new kendo.View(s(m),{wrap:!1});r(d.render());var c,u=kendo.observable({openWindow:function(){var t=d.element.clone();win=t.kendoCiresonWindow({title:l,width:600,height:380,actions:[],activate:function(){c=new kendo.data.ObservableObject({ClassTypeId:"67ce5b07-835d-246d-478d-29cee397c66e",Comment:"",Target_LogHasCreator:{ClassTypeId:"eca3c52a-f273-5cdc-f165-3eb95a2b26cf",BaseId:session.user.Id},AllowCreatedDate:!0,Name:app.lib.newGUID(),Type:{Id:"884650a1-632a-0532-b0d4-8c6b1d990752",Name:localization.TaskRun}});var e={PropertyName:"zeroCount",PropertyDisplayName:"IncreaseConsumableAvailableCountBy",DecimalPlaces:0,Required:!0,vm:n};f(t.find("#increaseAvailableCount"),e,n);var i={PropertyName:"Comment",PropertyDisplayName:"Comment",Required:!0,vm:c,Rows:5};v(t.find("#commentAvailableCount"),i,c)}}).data("kendoWindow");var i=e.viewModel.get("Count"),n=new kendo.data.ObservableObject({zeroCount:0}),a=new kendo.observable({type:o.Configs.type,workItemModel:e.viewModel,okClick:function(){var t=parseInt(n.get("zeroCount"));if(0==t||""==c.get("Comment"))kendo.ui.ExtAlertDialog.show({title:localization.CiresonAssetManagement,message:localization.RequiredFieldsErrorMessage});else{var a=parseInt(i)+t;e.viewModel.set("Count",a),c.set("Title",localization.IncreasedAvailableCount.replace("{0}",i)+a),c.set("CreatedDate",new Date),e.viewModel.Target_ConsumableHasLogs.unshift(c),win.close()}},cancelClick:function(){win.close()}});kendo.bind(t,a),t.removeClass("hide"),t.show(),win.open()}}),p=_.template(t),m={Target:"openWindow"};$.extend(!0,m,o),r(new kendo.View(p(m),{wrap:!1,model:u,init:function(e){}}).render());var f=function(e,t,i){a.build(i,t,function(t){e.html(t),app.controls.apply(e,{localize:!0,vm:i,bind:!0})})},v=function(e,t,i){n.build(i,t,function(t){e.html(t),app.controls.apply(e,{localize:!0,vm:i,bind:!0})})}}}}),define("text!forms/tasks/decreaseAvailableCount/view.html",[],function(){return'<div id="ChangeStatusWindow" class="cireson-window defined-form hide">\r\n    <div class="cireson-window--wrapper">\r\n        <div class="cireson-window--body">\r\n            <div id="decreaseCount"/>\r\n            <div id="decreaseAvailableCount"/>\r\n            <div id="commentAvailableCount"/>\r\n            <div id="autoResolve" class="col-group" data-bind="visible:showAutoResolve"/>\r\n        </div>\r\n        <div class="cireson-window--footer window-buttons">\r\n            <div id="changeStatusErrorWin" class="error"></div>\r\n            <button data-role="button"\r\n                    class="btn btn-primary"\r\n                    data-bind="enabled: okEnabled, events: { click: okClick }">\r\n                <%= localization.OK %>\r\n            </button>\r\n            <button data-role="button"\r\n                    class="btn btn-default"\r\n                    data-bind="events: { click: cancelClick }">\r\n                <%= localization.Cancel %>\r\n            </button>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("forms/tasks/decreaseAvailableCount/controller",["require","text!forms/tasks/anchor/view.html","text!forms/tasks/decreaseAvailableCount/view.html","forms/fields/longString/controller","forms/fields/numeric/controller"],function(e){var t=e("text!forms/tasks/anchor/view.html"),i=e("text!forms/tasks/decreaseAvailableCount/view.html"),n=e("forms/fields/longString/controller"),a=e("forms/fields/numeric/controller");return{template:i,build:function(e,o,r){var l=localization.EditConsumableAvailableCount,s=_.template(i),d=new kendo.View(s(m),{wrap:!1});r(d.render());var c,u=kendo.observable({openWindow:function(){var t=d.element.clone();win=t.kendoCiresonWindow({title:l,width:600,height:375,actions:[],activate:function(){c=new kendo.data.ObservableObject({ClassTypeId:"67ce5b07-835d-246d-478d-29cee397c66e",Comment:"",Target_LogHasCreator:{ClassTypeId:"eca3c52a-f273-5cdc-f165-3eb95a2b26cf",BaseId:session.user.Id},AllowCreatedDate:!0,Name:app.lib.newGUID(),Type:{Id:"884650a1-632a-0532-b0d4-8c6b1d990752",Name:localization.TaskRun}});var e={PropertyName:"zeroCount",PropertyDisplayName:"DecreaseConsumableCountBy",Required:!0,DecimalPlaces:0,MaxValue:i};f(t.find("#decreaseCount"),e,n);var e={PropertyName:"AvailableCount",PropertyDisplayName:"AvailableCount",DecimalPlaces:0,Disabled:!0,vm:{AvailableCount:i}}
;f(t.find("#decreaseAvailableCount"),e,e.vm);var a={PropertyName:"Comment",PropertyDisplayName:"Comment",Required:!0,vm:c,Rows:5};v(t.find("#commentAvailableCount"),a,c)}}).data("kendoWindow");var i=e.viewModel.get("Count"),n=new kendo.data.ObservableObject({zeroCount:0}),a=new kendo.observable({type:o.Configs.type,workItemModel:e.viewModel,okClick:function(){var t=parseInt(n.get("zeroCount"));if(0==t||""==c.get("Comment"))kendo.ui.ExtAlertDialog.show({title:localization.CiresonAssetManagement,message:localization.RequiredFieldsErrorMessage});else{var a=parseInt(i)-t;e.viewModel.set("Count",a),c.set("Title",localization.DecreasedAvailableCountBy.replace("{0}",i)+a),c.set("CreatedDate",new Date),e.viewModel.Target_ConsumableHasLogs.unshift(c),win.close()}},cancelClick:function(){win.close()}});kendo.bind(t,a),t.removeClass("hide"),t.show(),win.open()}}),p=_.template(t),m={Target:"openWindow"};$.extend(!0,m,o),r(new kendo.View(p(m),{wrap:!1,model:u,init:function(e){}}).render());var f=function(e,t,i){a.build(i,t,function(t){e.html(t),app.controls.apply(e,{localize:!0,vm:i,bind:!0})})},v=function(e,t,i){n.build(i,t,function(t){e.html(t),app.controls.apply(e,{localize:!0,vm:i,bind:!0})})}}}}),define("forms/tasks/print/controller",["require","text!forms/tasks/anchor/view.html"],function(e){var t=e("text!forms/tasks/anchor/view.html");return{build:function(e,i,n){var a=_.template(t),o={Target:"print"};$.extend(!0,o,i);var r=(a(o),kendo.observable({print:function(){window.print()}}));n(new kendo.View(a(o),{wrap:!1,model:r}).render())}}}),define("forms/tasks/addMeToWatchList/controller",["require","text!forms/tasks/anchor/view.html","text!forms/popups/notificationPopup/view.html"],function(e){var t=e("text!forms/tasks/anchor/view.html"),i=e("text!forms/popups/notificationPopup/view.html");return{notificationTemplate:i,build:function(e,n,a){var o=_.template(i),r=new kendo.View(o(d),{wrap:!1});a(r.render());var l=kendo.observable({addMeToWatchList:function(e){if(!_.isUndefined(n.Configs.isAddWatchlist))switch(n.Configs.isAddWatchlist){case!1:this.removeFromWatchList(),n.Configs.isAddWatchlist=!0,$(e.currentTarget).html(localization.AddMeToWatchList);break;case!0:default:this.addToWatchList(),n.Configs.isAddWatchlist=!1,$(e.currentTarget).html(localization.RemoveMeFromWatchList)}},addToWatchList:function(){session.user.BaseId=session.user.Id;var t=r.element,i=t.kendoNotification({height:"80px",templates:[{type:"info",template:"<div class='success k-ext-dialog-content'><div class='k-ext-dialog-icon fa fa-check'></div><div class='k-ext-dialog-message'>#= message #</div></div>"}]}).data("kendoNotification");!_.isUndefined(_.find(e.viewModel.WatchList,function(e){return e.Id==session.user.Id||e.BaseId==session.user.Id}))||(_.isUndefined(e.viewModel.WatchList)&&e.viewModel.set("WatchList",[]),e.viewModel.WatchList.push(session.user));var n=localizationHelper.localize(localization.AddMeToWatchListNotificationMessage,"{0} is added to the watchlist");i.show({message:n.replace("{0}",session.user.Name)},"info")},removeFromWatchList:function(){var t=r.element,i=t.kendoNotification({height:"80px",templates:[{type:"info",template:"<div class='success k-ext-dialog-content'><div class='k-ext-dialog-icon fa fa-check'></div><div class='k-ext-dialog-message'>#= message #</div></div>"}]}).data("kendoNotification"),n=-1;_.find(e.viewModel.WatchList,function(e,t){if(e.Id==session.user.Id||e.BaseId==session.user.Id)return n=t,e}),-1!==n&&e.viewModel.WatchList.splice(n,1);var a=localizationHelper.localize(localization.RemoveMeFromWatchListNotificationMessage,"{0} is removed from the watchlist");i.show({message:a.replace("{0}",session.user.Name)},"info")}}),s=_.template(t),d={Target:"addMeToWatchList"};$.extend(!0,d,n),a(new kendo.View(s(d),{wrap:!1,model:l,init:function(e){}}).render())}}}),define("forms/taskBuilder",["forms/tasks/anchor/controller","forms/tasks/analystByGroup/controller","forms/tasks/assignToMe/controller","forms/tasks/changeStatus/controller","forms/tasks/amChangeStatus/controller","forms/tasks/acknowledge/controller","forms/tasks/convertToParent/controller","forms/tasks/linkToParent/controller","forms/tasks/newStatus/controller","CustomSpace/Scripts/forms/tasks/sendEmail/controller","forms/tasks/custom/controller","forms/tasks/spacer/controller","forms/tasks/associateItem/controller","forms/tasks/setDate/controller","forms/tasks/updateAssetManagement/controller","forms/tasks/updateSupersededHardware/controller","forms/tasks/copyLicenseAssignments/controller","text!CustomSpace/customtasks.tmpl.html","forms/tasks/copyToNewWI/controller","forms/tasks/increaseAvailableCount/controller","forms/tasks/decreaseAvailableCount/controller","forms/tasks/print/controller","forms/tasks/addMeToWatchList/controller"],function(anchor,analystByGroup,assignToMe,changeStatus,amChangeStatus,acknowledge,convertToParent,linkToParent,newStatus,sendEmail,custom,spacer,associateItem,setDate,updateAssetManagement,updateSupersededHardware,copyLicenseAssignments,customTmpl,copyToNewWI,increaseAvailableCount,decreaseAvailableCount,print,addMeToWatchList){var definition={build:function(vm,callback){var ulElement=$("<ul/>");vm.fromDrawerBuilder?(vm.taskTemplate={tasks:vm.tasks},ulElement.addClass("drawer-task-menu dropdown-menu"),ulElement.attr("role","menu")):ulElement.addClass("taskmenu");var taskCallback=function(e){ulElement.append(e)};if(_.each(vm.taskTemplate.tasks,function(task){if(_.isString(task.Access)&&(task.Access=eval(task.Access)),task.Access){if(eval("var _obj = "+task.Task+";"),!_obj)throw Exception(task.Task+" is not part of the templating system");_obj.build(vm,task,function(e){taskCallback(e)})}}),callback(ulElement),!vm.fromDrawerBuilder){var tmpl=$("<div/>").addClass("hide");tmpl.append(customTmpl),callback(tmpl)}}};return definition}),define("text!forms/header/sticky/view.html",[],function(){return'<div class="content-header__container">\r\n    <div class="content-header">\r\n        <div class="content-header__main">\r\n            <div class="content-header__main__title" data-bind="text: viewModel.Title">\r\n            </div>\r\n            <div class="content-header__main__details">\r\n                <div class="content-header__main__breadcrumbs-container">\r\n                    <div class="content-header__main__breadcrumb content-header__main__breadcrumb--button" data-bind="visible: view.controller.isParent">\r\n                        <a class="content-header__main__breadcrumbs__link" data-bind="attr: { href: view.controller.editHref}, text: viewModel.ParentWorkItem.Id">\r\n                        </a>\r\n                        <a class="content-header__main__breadcrumbs__link content-header__main__breadcrumb--button__icon-link" data-bind="click: view.controller.unlinkParent, visible: view.controller.isAnalystUser">\r\n                            <i class="fa fa-unlink"></i>\r\n                        </a>\r\n                    </div>\r\n                    <div class="content-header__main__breadcrumb" data-bind="visible: view.controller.isParent">\r\n                        <strong class="content-header__main__breadcrumbs__link" data-bind="text: viewModel.Id"></strong>\r\n                    </div>\r\n                    <strong class="content-header__main__breadcrumbs__link" data-bind="visible: view.controller.isParent === false, text: viewModel.Id"></strong>\r\n                </div>\r\n                <span class="status-pill status-pill--active" data-bind="visible: view.statusVisible, text: viewModel.Status.Name">\r\n                    Active\r\n                </span>\r\n                <div class="content-header__main__icon-stack hidden-print">\r\n                    <button id="headerAttachmentBtn" class="btn k-button btn-icon-stack" data-bind="click: view.viewAttachments, visible: view.showAttachments">\r\n                        <img src="../../../../Content/Images/Icons/RemoteManage/attach.svg" alt="attach" />\r\n                        <div class="content-header__collapser__icon-badge header-attachment-badge">\r\n                        </div>\r\n                    </button>\r\n                    <button id="remoteManageBtn" class="btn k-button btn-icon-stack" data-bind="click: view.doClick, visible: view.showRemoteManageIcon">\r\n                        <img src="../../../../Content/Images/Icons/RemoteManage/RS-black-simple@32h.png" alt="remote" />\r\n                    </button>\r\n                    <button class="btn k-button btn-icon-stack  visible-xs visible-sm" data-bind="click: view.toggleMore">\r\n                        <span class="fa fa-ellipsis-v"></span>\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="content-header__collapser hidden-xs hidden-sm hidden-print">\r\n            <div class="first-header-slo-container">\r\n            </div>\r\n\r\n            <div class="content-header__collapser__dropdown">\r\n                <div class="header-slo-container">\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div id="content-header-backdrop" class="content-header__flyout__overlay">\r\n</div>\r\n<script id="header-slo-template" type="text/x-kendo-template">\r\n    <div class="content-header__collapser__icon-container">\r\n        <div class="header-slo-icon fa #: imageClass # content-header__collapser__icon">\r\n        </div>\r\n    </div>\r\n    <div class="content-header__collapser__main">\r\n        <div class="content-header__collapser__main__title header-slo-title">#: Title #</div>\r\n        <div class="content-header__collapser__main__datetime header-slo-timer"></div>\r\n    </div>\r\n    # if (index === \'0\') { #\r\n    <button class="content-header__collapser__caret-button fa fa-angle-up" onclick="closeSLODropdown()"></button>\r\n    # } #\r\n<\/script>\r\n<script id="first-header-slo-template" type="text/x-kendo-template">\r\n    <div class="content-header__collapser__icon-container">\r\n        <div class="header-slo-icon fa #: imageClass # content-header__collapser__icon">\r\n        </div>\r\n        # if (count > 1) { #\r\n        <div class="content-header__collapser__icon-badge"> #: count #\r\n        </div>\r\n        # } #\r\n    </div>\r\n    <div class="content-header__collapser__main">\r\n        <div class="content-header__collapser__main__title header-slo-title">#: Title #</div>\r\n        <div class="content-header__collapser__main__datetime header-slo-timer"></div>\r\n    </div>\r\n    # if (count > 1) { #\r\n    <button class="content-header__collapser__caret-button fa fa-angle-down" onclick="closeSLODropdown()"></button>\r\n    # } #\r\n<\/script>\r\n<div id="openmore" tabindex="-1" role="dialog" class="modal right fade" style="display: none">\r\n    <div class="modal-dialog modal-sm">\r\n        <div class="modal-content">\r\n            <div class="content-header__collapser content-header__collapser--side">\r\n                <div class="first-header-slo-container">\r\n                </div>\r\n                <div class="content-header__collapser__dropdown">\r\n                    <div class="header-slo-container">\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("text!forms/flyout/remoteManageWidget/view.html",[],function(){return'<div id="expanded_widget" class="content-header__flyout">\r\n    <h3 class="content-header__flyout__title">\r\n        <span><%= localization.RemoteManagementText %></span>\r\n    </h3>\r\n    <div class="content-header__flyout__section">\r\n        <div class="content-header__flyout__section__title"><%= localization.Users %></div>\r\n        <div class="content-header__flyout__section__main">\r\n        \r\n            <div class="dataUserContainer"></div>\r\n            <div class="addUserContainer"></div>\r\n\r\n            <div data-bind="attr: { class: widget.mainWidgetAttr }">\r\n                <div class="support-tools__widget__selection">\r\n                    <a class="support-tools__widget__select-type" id="affectedUserAddLink" data-bind="click: widget.addForm, value: widget.affectedUser.widgetType">\r\n                        <img alt="" src="../../../../Content/Images/Icons/RemoteManage/affected_user.svg" class="support-tools__widget__select-type__logo"/>\r\n                        <div class="support-tools__widget__select-type__caption">\r\n                            <%= localization.AffectedText  %>\r\n                        </div>\r\n                    </a>\r\n                    <a class="support-tools__widget__select-type" id="assignedUserAddLink" data-bind="click: widget.addForm, value: widget.assignedUser.widgetType">\r\n                        <img alt="" src="../../../../Content/Images/Icons/RemoteManage/assigned_user.svg" class="support-tools__widget__select-type__logo"/>\r\n                        <div class="support-tools__widget__select-type__caption">\r\n                            <%= localization.AssignedText  %>\r\n                        </div>\r\n                    </a>\r\n                    <a class="support-tools__widget__select-type" id="primaryOwnerAddLink" data-bind="click: widget.addForm, value: widget.primaryOwner.widgetType">\r\n                        <img alt="" src="../../../../Content/Images/Icons/RemoteManage/primary_user.svg" class="support-tools__widget__select-type__logo"/>\r\n                        <div class="support-tools__widget__select-type__caption">\r\n                            <%= localization.PrimaryText  %>\r\n                        </div>\r\n                    </a>\r\n                </div>\r\n                <div class="support-tools__widget__label">\r\n                    <div class="support-tools__widget__icon-container">\r\n                        <img alt="" src="../../../../Content/Images/Icons/RemoteManage/add_user.svg" class="support-tools__widget__icon"/>\r\n                    </div>\r\n                    <div class="support-tools__widget__main support-tools__widget__input">\r\n                        <div class="support-tools__widget__input__label">\r\n                            <%= localization.AddaUserText  %>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="content-header__flyout__section" data-bind="visible: widget.showDeviceSection">\r\n        <div class="content-header__flyout__section__title"><%= localization.DevicesText  %></div>\r\n        <div class="content-header__flyout__section__main">\r\n\r\n            <div class="dataDeviceContainer"></div>\r\n            <div class="addDeviceContainer"></div>\r\n    \r\n            <div data-bind="attr: { class: widget.mainWidgetDeviceAttr }, visible: widget.includeComputerAndAsset">\r\n                <div class="support-tools__widget__selection">\r\n                    <a class="support-tools__widget__select-type" data-bind="click: widget.addForm, value: widget.affectedDevice.widgetType">\r\n                        <img alt="" src="../../../../Content/Images/Icons/RemoteManage/affected_device.svg" class="support-tools__widget__select-type__logo"/>\r\n                        <div class="support-tools__widget__select-type__caption">\r\n                            <%= localization.AffectedDeviceText  %>\r\n                        </div>\r\n                    </a>\r\n                    <a class="support-tools__widget__select-type" data-bind="click: widget.addForm, value: widget.relatedDevice.widgetType">\r\n                        <img alt="" src="../../../../Content/Images/Icons/RemoteManage/related_device.svg" class="support-tools__widget__select-type__logo"/>\r\n                        <div class="support-tools__widget__select-type__caption">\r\n                            <%= localization.RelatedDeviceText  %>\r\n                        </div>\r\n                    </a>\r\n                    \x3c!--<a class="support-tools__widget__select-type" data-bind="click: widget.addForm, value: widget.primaryDevice.widgetType">\r\n                        <img alt="" src="../../../../Content/Images/Icons/RemoteManage/primary_device.svg" class="support-tools__widget__select-type__logo"/>\r\n                        <div class="support-tools__widget__select-type__caption">\r\n                            Primary\r\n                        </div>\r\n                    </a>--\x3e\r\n                    <a class="support-tools__widget__select-type" data-bind="click: widget.addForm, value: widget.userDevice.widgetType">\r\n                        <img alt="" src="../../../../Content/Images/Icons/RemoteManage/user_device.svg" class="support-tools__widget__select-type__logo"/>\r\n                        <div class="support-tools__widget__select-type__caption">\r\n                            <%= localization.UserDeviceText  %>\r\n                        </div>\r\n                    </a>\r\n                    <a class="support-tools__widget__select-type" data-bind="click: widget.addForm, value: widget.affectedAsset.widgetType">\r\n                        <img alt="" src="../../../../Content/Images/Icons/RemoteManage/affected_asset.svg" class="support-tools__widget__select-type__logo" />\r\n                        <div class="support-tools__widget__select-type__caption">\r\n                            <%= localization.AffectedAssetText  %>\r\n                        </div>\r\n                    </a>\r\n                    <a class="support-tools__widget__select-type" data-bind="click: widget.addForm, value: widget.relatedAsset.widgetType">\r\n                        <img alt="" src="../../../../Content/Images/Icons/RemoteManage/related_asset.svg" class="support-tools__widget__select-type__logo" />\r\n                        <div class="support-tools__widget__select-type__caption">\r\n                            <%= localization.RelatedAssetText  %>\r\n                        </div>\r\n                    </a>\r\n                </div>\r\n                <div class="support-tools__widget__label">\r\n                    <div class="support-tools__widget__icon-container">\r\n                        <img alt="" src="../../../../Content/Images/Icons/RemoteManage/add_device.svg" class="support-tools__widget__icon"/>\r\n                    </div>\r\n                    <div class="support-tools__widget__main support-tools__widget__input" ng-show="assignedUser1 == null">\r\n                        <div class="support-tools__widget__input__label">\r\n                            <%= localization.AddaDeviceText  %>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div data-bind="attr: { class: widget.mainWidgetDeviceAttr }, visible: widget.includeWindowsComputerOnly">\r\n                <div class="support-tools__widget__selection">\r\n                    <a class="support-tools__widget__select-type" data-bind="click: widget.addForm, value: widget.affectedDevice.widgetType">\r\n                        <img alt="" src="../../../../Content/Images/Icons/RemoteManage/affected_device.svg" class="support-tools__widget__select-type__logo" />\r\n                        <div class="support-tools__widget__select-type__caption">\r\n                            <%= localization.AffectedDeviceText  %>\r\n                        </div>\r\n                    </a>\r\n                    <a class="support-tools__widget__select-type" data-bind="click: widget.addForm, value: widget.relatedDevice.widgetType">\r\n                        <img alt="" src="../../../../Content/Images/Icons/RemoteManage/related_device.svg" class="support-tools__widget__select-type__logo" />\r\n                        <div class="support-tools__widget__select-type__caption">\r\n                            <%= localization.RelatedDeviceText  %>\r\n                        </div>\r\n                    </a>\r\n                    <a class="support-tools__widget__select-type" data-bind="click: widget.addForm, value: widget.userDevice.widgetType">\r\n                        <img alt="" src="../../../../Content/Images/Icons/RemoteManage/user_device.svg" class="support-tools__widget__select-type__logo" />\r\n                        <div class="support-tools__widget__select-type__caption">\r\n                            <%= localization.UserDeviceText  %>\r\n                        </div>\r\n                    </a>                </div>\r\n                <div class="support-tools__widget__label">\r\n                    <div class="support-tools__widget__icon-container">\r\n                        <img alt="" src="../../../../Content/Images/Icons/RemoteManage/add_device.svg" class="support-tools__widget__icon" />\r\n                    </div>\r\n                    <div class="support-tools__widget__main support-tools__widget__input" ng-show="assignedUser1 == null">\r\n                        <div class="support-tools__widget__input__label">\r\n                            <%= localization.AddaDeviceText  %>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div data-bind="attr: { class: widget.mainWidgetDeviceAttr }, visible: widget.includeHardwareAssetOnly" style="min-width: fit-content !important">\r\n                <div class="support-tools__widget__selection">\r\n                    <a class="support-tools__widget__select-type" data-bind="click: widget.addForm, value: widget.affectedAsset.widgetType">\r\n                        <img alt="" src="../../../../Content/Images/Icons/RemoteManage/affected_asset.svg" class="support-tools__widget__select-type__logo" />\r\n                        <div class="support-tools__widget__select-type__caption">\r\n                            <%= localization.AffectedAssetText  %>\r\n                        </div>\r\n                    </a>\r\n                    <a class="support-tools__widget__select-type" data-bind="click: widget.addForm, value: widget.relatedAsset.widgetType">\r\n                        <img alt="" src="../../../../Content/Images/Icons/RemoteManage/related_asset.svg" class="support-tools__widget__select-type__logo" />\r\n                        <div class="support-tools__widget__select-type__caption">\r\n                            <%= localization.RelatedAssetText  %>\r\n                        </div>\r\n                    </a>\r\n                </div>\r\n                <div class="support-tools__widget__label">\r\n                    <div class="support-tools__widget__icon-container">\r\n                        <img alt="" src="../../../../Content/Images/Icons/RemoteManage/add_device.svg" class="support-tools__widget__icon" />\r\n                    </div>\r\n                    <div class="support-tools__widget__main support-tools__widget__input" ng-show="assignedUser1 == null">\r\n                        <div class="support-tools__widget__input__label">\r\n                            <%= localization.AddaDeviceText  %>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<script id="multipleDataTemplate" type="text/x-kendo-template">\r\n    # for (var i = 0; i < devices.length; i++) { #\r\n    # var device = devices[i] #\r\n    <div class="support-tools__widget support-tools__widget--item-selected support-tools__widget--user-selected #:type#dataTemplate" data-bind="click: widget.clickContainer, value: widget.#:type#[#:i#]">\r\n        <div class="support-tools__widget__icon-container">\r\n            <img alt="" src="../../../../Content/Images/Icons/RemoteManage/#:icon#" class="support-tools__widget__icon" />\r\n        </div>\r\n        <div class="support-tools__widget__main">\r\n            <div class="support-tools__widget__selected-item">\r\n                <div class="support-tools__widget__selected-item__title" data-bind="text: widget.#:type#[#:i#].DisplayName">\r\n                </div>\r\n                <div class="support-tools__widget__selected-item__details">\r\n                    #: title #\r\n                </div>\r\n            </div>\r\n            <div class="support-tools__widget__action" data-bind="click: widget.removeItem, value: widget.#:type#[#:i#]">\r\n                <a class="support-tools__widget__action__link">\r\n                    <div class="support-tools__widget__action-icon">\r\n                    </div>\r\n                </a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    # } #\r\n<\/script>\r\n\r\n<script id="dataTemplate" type="text/x-kendo-template">\r\n    <div class="support-tools__widget support-tools__widget--item-selected support-tools__widget--user-selected" id="#:type#dataTemplate" data-bind="click: widget.clickContainer, value: widget.#:type#">\r\n        <div class="support-tools__widget__icon-container">\r\n            <img alt="" src="../../../../Content/Images/Icons/RemoteManage/#:icon#" class="support-tools__widget__icon" />\r\n        </div>\r\n        <div class="support-tools__widget__main">\r\n            <div class="support-tools__widget__selected-item">\r\n                <div class="support-tools__widget__selected-item__title" data-bind="text: widget.#:type#.DisplayName">\r\n                </div>\r\n                <div class="support-tools__widget__selected-item__details">\r\n                    #: title #\r\n                </div>\r\n                <div class="support-tools__widget__selected-item__email" data-bind="visible: widget.#:type#.Email">\r\n                    <a data-bind="click: widget.openSendEmail, value: widget.#:type#">\r\n                        <span data-bind="text: widget.#:type#.Email"></span>\r\n                    </a>\r\n                </div>\r\n            </div>\r\n            <div class="support-tools__widget__action" data-bind="click: widget.removeItem, value: widget.#:type#">\r\n                <a class="support-tools__widget__action__link">\r\n                    <div class="support-tools__widget__action-icon">\r\n                    </div>\r\n                </a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n<\/script>\r\n\r\n<script id="addTemplate" type="text/x-kendo-template">\r\n    <div class="support-tools__widget">\r\n        <div class="support-tools__widget__icon-container">\r\n            <img alt="" src="../../../../Content/Images/Icons/RemoteManage/#:icon#" class="support-tools__widget__icon" />\r\n        </div>\r\n        <div class="support-tools__widget__main support-tools__widget__input">\r\n            <div class="support-tools__widget__input__form">\r\n                <span class="fa fa-search support-tools__widget__input__form__icon" data-bind="click: widget.openCombobox, value: widget.#:type#.widgetType"></span>\r\n                <input id="#:type#Combobox1" class="support-tools__widget__input__form__input" />\r\n                <div id="#:type#Container" class="support-tools__widget__input__form__dropdown"></div>\r\n            </div>\r\n            <div class="support-tools__widget__action" data-bind="click: widget.removeUserCombobox, value: widget.#:type#.widgetType">\r\n                <a class="support-tools__widget__action__link">\r\n                    <div class="support-tools__widget__action-icon">\r\n                    </div>\r\n                </a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n<\/script>\r\n\r\n<script id="comboboxusertemplate" type="text/x-kendo-template">\r\n    <div class="multi-query__list__selected-items multi-query__list__selected-items--no-border">\r\n        <div class="row">\r\n            <div class="col-sm-12">\r\n                <div class="multi-query__list__selected-items__name">#: Name #</div>\r\n                <div class="multi-query__list__selected-items__details">#: (Email) ? Email : "" #</div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n<\/script>\r\n<script id="comboboxdevicetemplate" type="text/x-kendo-template">\r\n    <div class="multi-query__list__selected-items multi-query__list__selected-items--no-border">\r\n        <div class="row">\r\n            <div class="col-sm-12">\r\n                <div class="multi-query__list__selected-items__name">#: DisplayName #</div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n<\/script>\r\n<script id="comboboxuserdevicetemplate" type="text/x-kendo-template">\r\n    <div class="multi-query__list__selected-items multi-query__list__selected-items--no-border">\r\n        <div class="row">\r\n            <div class="col-sm-12">\r\n                <div class="multi-query__list__selected-items__name">#: Text #</div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n<\/script>\r\n<script id="comboboxprimarydevicetemplate" type="text/x-kendo-template">\r\n    <div class="multi-query__list__selected-items multi-query__list__selected-items--no-border">\r\n        <div class="row">\r\n            <div class="col-sm-12">\r\n                <div class="multi-query__list__selected-items__name">#: Name #</div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n<\/script>'});var __remoteManageWidgetSingleton;define("forms/flyout/remoteManageWidget/controller",["require","text!forms/flyout/remoteManageWidget/view.html"],function(e){var t=e("text!forms/flyout/remoteManageWidget/view.html");return{template:t,getWidget:function(e){var i=_.template(t),n=$(i());$(".page_bar.sticky-header").first().children(".row").first().after(n);var a=$(".addUserContainer"),o=kendo.template($("#addTemplate").html()),r=$(".dataUserContainer"),l=kendo.template($("#dataTemplate").html()),s=$(".addDeviceContainer"),d=$(".dataDeviceContainer"),c=kendo.template($("#multipleDataTemplate").html()),u=$('<div class=\'support-tools__widget__action-icon\'><?xml version="1.0" encoding="utf-8"?><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#403f40"><path d="M12,2C6.47,2,2,6.47,2,12s4.47,10,10,10s10-4.47,10-10S17.53,2,12,2z M17,15.59L15.59,17L12,13.41L8.41,17L7,15.59 L10.59,12L7,8.41L8.41,7L12,10.59L15.59,7L17,8.41L13.41,12L17,15.59z" fill="#403f40"/></svg></div>'),p=function(e){N({element:$("#"+e+"Combobox1"),eleContainer:$("#"+e+"Container"),eleTemplate:$("#comboboxusertemplate"),type:"user",dataTextField:"Name"}),$("#"+e+"Combobox1").getKendoComboBox().input.focus()},m=function(e){N({element:$("#"+e+"Combobox1"),eleContainer:$("#"+e+"Container"),eleTemplate:$("#comboboxusertemplate"),type:"primaryuser",dataTextField:"Name"}),$("#"+e+"Combobox1").getKendoComboBox().input.focus()},f=function(t){N({element:$("#"+t+"Combobox1"),eleContainer:$("#"+t+"Container"),eleTemplate:$("#comboboxuserdevicetemplate"),type:"userdevice",affectedUserId:e.widget.affectedUser.BaseId,dataTextField:"Text"}),$("#"+t+"Combobox1").getKendoComboBox().input.focus()},v=function(e){N({element:$("#"+e+"Combobox1"),eleContainer:$("#"+e+"Container"),eleTemplate:$("#comboboxprimarydevicetemplate"),type:"primarydevice",dataTextField:"Name"}),$("#"+e+"Combobox1").getKendoComboBox().input.focus()},g=function(e){N({element:$("#"+e+"Combobox1"),eleContainer:$("#"+e+"Container"),eleTemplate:$("#comboboxdevicetemplate"),type:"device",dataTextField:"DisplayName"}),$("#"+e+"Combobox1").getKendoComboBox().input.focus()},b=function(e){N({element:$("#"+e+"Combobox1"),eleContainer:$("#"+e+"Container"),eleTemplate:$("#comboboxdevicetemplate"),type:"asset",dataTextField:"DisplayName"}),$("#"+e+"Combobox1").getKendoComboBox().input.focus()},w="affectedUser",h="assignedUser",k="primaryOwner",y="affectedDevice",I="primaryDevice",C="userDevice",S="relatedDevice",x="affectedAsset",T="relatedAsset",M=function(e){var t;return e===w?t={type:e,title:localization.AffectedUserAppPage,icon:"affected_user.svg"}:e===h?t={type:e,title:localization.AssignedUser,icon:"assigned_user.svg"}:e===k?t={type:e,
title:localization.PrimaryOwner,icon:"primary_user.svg"}:e===y?t={type:e,title:localization.AffectedDeviceText,icon:"affected_device.svg"}:e===I?t={type:e,title:"Primary Device",icon:"primary_device.svg"}:e===C?t={type:e,title:"User Device",icon:"user_device.svg"}:e===S?t={type:e,title:localization.RelatedDeviceText,icon:"related_device.svg"}:e===x?t={type:e,title:localization.AffectedAssetText,icon:"affected_asset.svg"}:e===T&&(t={type:e,title:localization.RelatedAssetText,icon:"related_asset.svg"}),t},A={},D={},R=function(e,t){e.ul.hide(),e.value(t),e.search(t),setTimeout(function(){e.select(e.ul.find("li").first()),e.trigger("change"),e.close(),e.ul.show()},300)},P=function(t,i){if(D[t]){if($(i).parents(".support-tools__widget").first().remove(),t.toLowerCase().indexOf(w.toLowerCase())>-1)e.widget[w]=_.extend(D[t]||{},{widgetType:w,mailtoLink:D[t].Email?"mailto:"+D[t].Email+"?Subject=["+e.viewModel.Id+"] "+e.viewModel.Title:""}),$("#"+w+"AddLink").addClass("isDisabled"),r.append(l(M(w))),e.viewModel.set("RequestedWorkItem",D[t]),input=$("input[data-control-bind='RequestedWorkItem']").data("kendoAutoComplete"),R(input,D[t].DisplayName),e.widget.mainWidgetAttr="support-tools__widget support-tools__widget--add-item";else if(t.toLowerCase().indexOf(h.toLowerCase())>-1)e.widget[h]=_.extend(D[t]||{},{widgetType:h,mailtoLink:D[t].Email?"mailto:"+D[t].Email+"?Subject=["+e.viewModel.Id+"] "+e.viewModel.Title:""}),$("#"+h+"AddLink").addClass("isDisabled"),r.append(l(M(h))),e.viewModel.set("AssignedWorkItem",D[t]),input=$("input[data-control-bind='AssignedWorkItem']").data("kendoAutoComplete"),R(input,D[t].DisplayName),e.widget.mainWidgetAttr="support-tools__widget support-tools__widget--add-item";else if(t.toLowerCase().indexOf(k.toLowerCase())>-1)e.widget[k]=_.extend(D[t]||{},{widgetType:k,mailtoLink:D[t].Email?"mailto:"+D[t].Email+"?Subject=["+e.viewModel.Id+"] "+e.viewModel.Title:""}),$("#"+k+"AddLink").addClass("isDisabled"),r.append(l(M(k))),e.viewModel.set("RelatesToIncident",D[t]),input=$("input[data-control-bind='RelatesToIncident']").data("kendoAutoComplete"),R(input,D[t].DisplayName),e.widget.mainWidgetAttr="support-tools__widget support-tools__widget--add-item";else if(t.toLowerCase().indexOf(y.toLowerCase())>-1){if(D[t]&&!_.findWhere(e.widget[y+"Arr"],{BaseId:D[t].Id})){var a=_.extend(D[t],{AssetStatus:""});e.viewModel.HasRelatedWorkItems.push(a)}e.widget.mainWidgetDeviceAttr="support-tools__widget support-tools__widget--add-item"}else if(t.toLowerCase().indexOf(I.toLowerCase())>-1){if(D[t]&&!_.findWhere(e.widget[I+"Arr"],{BaseId:D[t].Id})){var a=_.extend(D[t],{AssetStatus:""});e.viewModel.HasRelatedWorkItems.push(a)}e.widget.mainWidgetDeviceAttr="support-tools__widget support-tools__widget--add-item"}else if(t.toLowerCase().indexOf(C.toLowerCase())>-1){if(D[t]&&!_.findWhere(e.widget[y+"Arr"],{BaseId:D[t].Id})){var a=_.extend(D[t],{AssetStatus:""});e.viewModel.HasRelatedWorkItems.push(a)}e.widget.mainWidgetDeviceAttr="support-tools__widget support-tools__widget--add-item"}else if(t.toLowerCase().indexOf(S.toLowerCase())>-1){if(D[t]&&!_.findWhere(e.widget[S+"Arr"],{BaseId:D[t].Id})){var a=_.extend(D[t],{AssetStatus:""});e.viewModel.RelatesToConfigItem.push(a)}e.widget.mainWidgetDeviceAttr="support-tools__widget support-tools__widget--add-item"}else if(t.toLowerCase().indexOf(x.toLowerCase())>-1){if(D[t]&&!_.findWhere(e.widget[x+"Arr"],{BaseId:D[t].Id})){var a=_.extend(D[t],{AssetStatus:""});e.viewModel.HasRelatedWorkItems.push(a)}e.widget.mainWidgetDeviceAttr="support-tools__widget support-tools__widget--add-item"}else if(t.toLowerCase().indexOf(T.toLowerCase())>-1){if(D[t]&&!_.findWhere(e.widget[T+"Arr"],{BaseId:D[t].Id})){var a=_.extend(D[t],{AssetStatus:""});e.viewModel.RelatesToConfigItem.push(a)}e.widget.mainWidgetDeviceAttr="support-tools__widget support-tools__widget--add-item"}D[t]=null,A[t]="",e.widget[w].BaseId&&e.widget[h].BaseId&&e.widget[k].BaseId&&$("#"+k+"AddLink").parents(".support-tools__widget").first().hide(),u.replaceAll(".support-tools__widget__action-icon"),kendo.bind(n,e)}},N=function(e){var t,i=e.element[0].id;if("user"===e.type)t=new kendo.data.DataSource({transport:{read:{url:"/api/V3/User/GetUserList",data:{filterByAnalyst:!1,maxNumberOfResults:1e3,userFilter:function(){return A[i]?A[i]:""}}}},serverFiltering:!0});else if("primaryuser"===e.type)t=new kendo.data.DataSource({transport:{read:{url:"/api/V3/User/GetUserList",data:{filterByAnalyst:!0,maxNumberOfResults:1e3,userFilter:function(){return A[i]?A[i]:""}}}},serverFiltering:!0});else if("device"===e.type||"asset"===e.type){var n="device"===e.type?"7ad221e0-e4bb-39a8-6514-33b60bba46f5":"c0c58e7f-7865-55cc-4600-753305b9be64";t=new kendo.data.DataSource({transport:{read:{url:"/Search/GetSearchObjectsWithEnumObjectByClassId",data:{searchFilter:function(){return A[i]?A[i]:""},classId:n,columnNames:"DisplayName, Id"}}},serverFiltering:!0,schema:{data:function(e){return e.Data}}})}else t="primarydevice"===e.type?new kendo.data.DataSource({transport:{read:{url:session.consoleSetting.TrueControlCenterURL+"/api/CmDevice",data:{search:function(){return A[i]?A[i]:""}},beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+session.consoleSetting.TrueControlCenterAuthToken)}}},serverFiltering:!0,schema:{data:function(e){return e.value}}}):new kendo.data.DataSource({transport:{read:{url:"/ConfigItems/GetAffectedUserConfigItemsList",data:{affectedUserId:e.affectedUserId,className:"Microsoft.Windows.Computer",searchFilter:function(){return A[i]?A[i]:""}}}},serverFiltering:!0});e.element.kendoComboBox({dataSource:t,template:kendo.template(e.eleTemplate.html()),placeholder:localization.Search,dataTextField:e.dataTextField,dataValueField:"Id",autoBind:!1,filter:"contains",suggest:!0,popup:{appendTo:e.eleContainer},filtering:function(e){if(void 0!=e.filter){var t=e.sender.element[0].id;A[t]=e.filter.value}},select:function(t){var i=t.sender.element[0].id;"user"===e.type||"primaryuser"===e.type?D[i]={DisplayName:t.dataItem.Name,BaseId:t.dataItem.Id,Email:t.dataItem.Email,BaseType:t.dataItem.BaseType,Path:""}:"device"===e.type||"asset"===e.type?D[i]=t.dataItem:"primarydevice"===e.type?D[i]={DisplayName:t.dataItem.Name,BaseId:t.dataItem.Guid,BaseType:t.dataItem.BaseType,Path:""}:D[i]={DisplayName:t.dataItem.Text,BaseId:t.dataItem.Id,ClassName:t.dataItem.ClassName,BaseType:t.dataItem.BaseType,Path:""},$(t.item[0]).hasClass("k-state-hover")&&P(i,e.element)}}).data("kendoComboBox").input.on("keydown",function(t){9!==t.keyCode&&13!==t.keyCode||P(i,e.element)})};if(e.widget={open:!1,mainWidgetAttr:"support-tools__widget support-tools__widget--add-item",mainWidgetDeviceAttr:"support-tools__widget support-tools__widget--add-item",addForm:function(t){if(!$(t.currentTarget).hasClass("isDisabled")){var i=t.currentTarget.value;i===w?(a.append(o(M(i))),kendo.bind(a),p(i),e.widget.mainWidgetAttr="support-tools__widget support-tools__widget--add-item support-tools__widget--hide"):i===h?(a.append(o(M(i))),kendo.bind(a),p(i),e.widget.mainWidgetAttr="support-tools__widget support-tools__widget--add-item support-tools__widget--hide"):i===k?(a.append(o(M(i))),kendo.bind(a),m(i),e.widget.mainWidgetAttr="support-tools__widget support-tools__widget--add-item support-tools__widget--hide"):i===y?(s.append(o(M(i))),kendo.bind(s),g(i),e.widget.mainWidgetDeviceAttr="support-tools__widget support-tools__widget--add-item support-tools__widget--hide"):i===I?(s.append(o(M(i))),kendo.bind(s),v(i),e.widget.mainWidgetDeviceAttr="support-tools__widget support-tools__widget--add-item support-tools__widget--hide"):i===C?(s.append(o(M(i))),kendo.bind(s),f(i),e.widget.mainWidgetDeviceAttr="support-tools__widget support-tools__widget--add-item support-tools__widget--hide"):i===S?(s.append(o(M(i))),kendo.bind(s),g(i),e.widget.mainWidgetDeviceAttr="support-tools__widget support-tools__widget--add-item support-tools__widget--hide"):i===x?(s.append(o(M(i))),kendo.bind(s),b(i),e.widget.mainWidgetDeviceAttr="support-tools__widget support-tools__widget--add-item support-tools__widget--hide"):i===T&&(s.append(o(M(i))),kendo.bind(s),b(i),e.widget.mainWidgetDeviceAttr="support-tools__widget support-tools__widget--add-item support-tools__widget--hide"),u.replaceAll(".support-tools__widget__action-icon"),kendo.bind(n,e)}},affectedUser:_.extend(e.viewModel.RequestedWorkItem||{},{widgetType:w,mailtoLink:e.viewModel.RequestedWorkItem&&e.viewModel.RequestedWorkItem.Email?"mailto:"+e.viewModel.RequestedWorkItem.Email+"?Subject=["+e.viewModel.Id+"] "+e.viewModel.Title:""}),assignedUser:_.extend(e.viewModel.AssignedWorkItem||{},{widgetType:h,mailtoLink:e.viewModel.AssignedWorkItem&&e.viewModel.AssignedWorkItem.Email?"mailto:"+e.viewModel.AssignedWorkItem.Email+"?Subject=["+e.viewModel.Id+"] "+e.viewModel.Title:""}),primaryOwner:_.extend(e.viewModel.RelatesToIncident||{},{widgetType:k,mailtoLink:e.viewModel.RelatesToIncident&&e.viewModel.RelatesToIncident.Email?"mailto:"+e.viewModel.RelatesToIncident.Email+"?Subject=["+e.viewModel.Id+"] "+e.viewModel.Title:""}),affectedDevice:{widgetType:y},primaryDevice:{widgetType:I},userDevice:{widgetType:C},relatedDevice:{widgetType:S},affectedAsset:{widgetType:x},relatedAsset:{widgetType:T},relatedDeviceArr:_.filter(e.viewModel.RelatesToConfigItem,function(e){return e=_.extend(e,{widgetType:S}),"Microsoft.Windows.Computer"===e.ClassName}),affectedDeviceArr:_.filter(e.viewModel.HasRelatedWorkItems,function(e){return e=_.extend(e,{widgetType:y}),"Microsoft.Windows.Computer"===e.ClassName}),affectedAssetArr:_.filter(e.viewModel.HasRelatedWorkItems,function(e){return e=_.extend(e,{widgetType:x}),"Cireson.AssetManagement.HardwareAsset"===e.ClassName}),relatedAssetArr:_.filter(e.viewModel.RelatesToConfigItem,function(e){return e=_.extend(e,{widgetType:T}),"Cireson.AssetManagement.HardwareAsset"===e.ClassName}),primaryDeviceArr:[],includeHardwareAssetOnly:"true"===session.includeHardwareAssetinRM&&"false"===session.includeWindowsComputerinRM,includeWindowsComputerOnly:"true"===session.includeWindowsComputerinRM&&"false"===session.includeHardwareAssetinRM,includeComputerAndAsset:"true"===session.includeHardwareAssetinRM&&"true"===session.includeWindowsComputerinRM,showDeviceSection:"true"===session.includeHardwareAssetinRM||"true"===session.includeWindowsComputerinRM,clickContainer:function(e){if("DIV"===e.target.nodeName&&-1===e.target.className.indexOf("multi-query__list__selected-items")){var t=e.currentTarget.value;if(t.BaseId)if(t.widgetType===T||t.widgetType===x)$.get("/Search/GetHardwareAssetDevice",{id:t.BaseId},function(e){var t=app.slideOutNav.getTCCSourceURL(e,"computer"),i={url:t,tooltip:localization.ComputerManagement};app.slideOutNav.show(i)});else{var i=[w,h,k].indexOf(t.widgetType)>-1?"user":"computer",n=app.slideOutNav.getTCCSourceURL(t,i),a={url:n,tooltip:"user"===i?localization.UserManagement:localization.ComputerManagement};app.slideOutNav.show(a)}}},removeUserCombobox:function(t){var i=t.currentTarget.value;$(t.currentTarget).parents(".support-tools__widget").first().remove(),[w,h,k].indexOf(i)>-1?e.widget.mainWidgetAttr="support-tools__widget support-tools__widget--add-item":e.widget.mainWidgetDeviceAttr="support-tools__widget support-tools__widget--add-item",kendo.bind(n,e)},openCombobox:function(e){var t=e.currentTarget.value;$("#"+t+"Combobox1").getKendoComboBox().open()},removeItem:function(t){var i,a=t.currentTarget.value,o=a.widgetType;switch(o){case w:i="RequestedWorkItem",e.viewModel.set(i,{DisplayName:"",BaseId:""}),$("#"+w+"AddLink").removeClass("isDisabled"),e.widget.mainWidgetAttr="support-tools__widget support-tools__widget--add-item";break;case h:i="AssignedWorkItem",e.viewModel.set(i,{DisplayName:"",BaseId:""}),$("#"+h+"AddLink").removeClass("isDisabled"),e.widget.mainWidgetAttr="support-tools__widget support-tools__widget--add-item";break;case k:i="RelatesToIncident",e.viewModel.set(i,{DisplayName:"",BaseId:""}),$("#"+k+"AddLink").removeClass("isDisabled"),e.widget.mainWidgetAttr="support-tools__widget support-tools__widget--add-item";break;case y:var r=_.map(e.viewModel.HasRelatedWorkItems,function(e){return e.BaseId}),l=_.indexOf(r,a.BaseId);e.viewModel.HasRelatedWorkItems.splice(l,1),e.widget[y+"Arr"]=_.filter(e.widget[y+"Arr"],function(e){return e.BaseId!==a.BaseId}),e.widget.mainWidgetDeviceAttr="support-tools__widget support-tools__widget--add-item";break;case I:var r=_.map(e.viewModel.HasRelatedWorkItems,function(e){return e.BaseId}),l=_.indexOf(r,a.BaseId);e.viewModel.HasRelatedWorkItems.splice(l,1),e.widget[I+"Arr"]=_.filter(e.widget[I+"Arr"],function(e){return e.BaseId!==a.BaseId}),e.widget.mainWidgetDeviceAttr="support-tools__widget support-tools__widget--add-item";break;case C:var r=_.map(e.viewModel.HasRelatedWorkItems,function(e){return e.BaseId}),l=_.indexOf(r,a.BaseId);e.viewModel.HasRelatedWorkItems.splice(l,1),e.widget[y+"Arr"]=_.filter(e.widget[y+"Arr"],function(e){return e.BaseId!==a.BaseId}),e.widget.mainWidgetDeviceAttr="support-tools__widget support-tools__widget--add-item";break;case S:var r=_.map(e.viewModel.RelatesToConfigItem,function(e){return e.BaseId}),l=_.indexOf(r,a.BaseId);e.viewModel.RelatesToConfigItem.splice(l,1),e.widget[S+"Arr"]=_.filter(e.widget[S+"Arr"],function(e){return e.BaseId!==a.BaseId}),e.widget.mainWidgetDeviceAttr="support-tools__widget support-tools__widget--add-item";break;case x:var r=_.map(e.viewModel.HasRelatedWorkItems,function(e){return e.BaseId}),l=_.indexOf(r,a.BaseId);e.viewModel.HasRelatedWorkItems.splice(l,1),e.widget[x+"Arr"]=_.filter(e.widget[x+"Arr"],function(e){return e.BaseId!==a.BaseId}),e.widget.mainWidgetDeviceAttr="support-tools__widget support-tools__widget--add-item";break;case T:var r=_.map(e.viewModel.RelatesToConfigItem,function(e){return e.BaseId}),l=_.indexOf(r,a.BaseId);e.viewModel.RelatesToConfigItem.splice(l,1),e.widget[T+"Arr"]=_.filter(e.widget[T+"Arr"],function(e){return e.BaseId!==a.BaseId}),e.widget.mainWidgetDeviceAttr="support-tools__widget support-tools__widget--add-item"}if(i&&i.length>0){var s=$("input[data-control-bind='"+i+"']");s.data("kendoAutoComplete").value("");var d=s.parent().children(".menu-usr-mgt");$(d).hide()}$(t.currentTarget).parents(".support-tools__widget").first().remove(),void 0!==(e.widget[w].BaseId&&e.widget[h].BaseId&&e.widget[k].BaseId)&&$("#"+k+"AddLink").parents(".support-tools__widget").first().show(),kendo.bind(n,e)},remoteManageRecepient:null,openSendEmail:function(t){var i=t.currentTarget.value;e.widget.remoteManageRecepient=i,$('li.link[data-bind="click: sendEmail"]').click()}},e.widget.affectedUser.BaseId&&($("#"+w+"AddLink").addClass("isDisabled"),r.append(l(M(w)))),e.widget.assignedUser.BaseId&&($("#"+h+"AddLink").addClass("isDisabled"),r.append(l(M(h)))),e.widget.primaryOwner.BaseId&&($("#"+k+"AddLink").addClass("isDisabled"),r.append(l(M(k)))),e.widget.relatedDeviceArr.length>0){e.widget.relatedDeviceArr=_.map(e.widget.relatedDeviceArr,function(e){return e.widgetType=S,e});var z={devices:e.widget[S+"Arr"],type:S+"Arr",title:localization.RelatedDeviceText,icon:"related_device.svg"};d.append(c(z)),kendo.bind(d)}if(e.widget.relatedAssetArr.length>0){e.widget.relatedAssetArr=_.map(e.widget.relatedAssetArr,function(e){return e.widgetType=T,e});var E={devices:e.widget[T+"Arr"],type:T+"Arr",title:localization.RelatedAssetText,icon:"related_asset.svg"};d.append(c(E)),kendo.bind(d)}if(e.widget.affectedDeviceArr.length>0){e.widget.affectedDeviceArr=_.map(e.widget.affectedDeviceArr,function(e){return e.widgetType=y,e});var F={devices:e.widget[y+"Arr"],type:y+"Arr",title:localization.AffectedDeviceText,icon:"affected_device.svg"};d.append(c(F)),kendo.bind(d)}if(e.widget.affectedAssetArr.length>0){e.widget.affectedAssetArr=_.map(e.widget.affectedAssetArr,function(e){return e.widgetType=x,e});var W={devices:e.widget[x+"Arr"],type:x+"Arr",title:localization.AffectedAssetText,icon:"affected_asset.svg"};d.append(c(W)),kendo.bind(d)}e.viewModel.hasOwnProperty("RelatesToIncident")||$("#"+k+"AddLink").addClass("isDisabled"),e.viewModel.hasOwnProperty("RequestedWorkItem")||$("#"+w+"AddLink").addClass("isDisabled"),u.replaceAll(".support-tools__widget__action-icon");var L=0;return e.bind("change",function(t){if(t.field.indexOf("RequestedWorkItem")>-1||t.field.indexOf("RelatesToIncident")>-1||t.field.indexOf("AssignedWorkItem")>-1){var i,n;t.field.indexOf("RequestedWorkItem")>-1&&(i="RequestedWorkItem",n=w),t.field.indexOf("RelatesToIncident")>-1&&(i="RelatesToIncident",n=k),t.field.indexOf("AssignedWorkItem")>-1&&(i="AssignedWorkItem",n=h),t.field.indexOf("BaseId")>-1&&L++,t.field.indexOf("DisplayName")>-1&&L++,0!==L&&2!==L||(e.viewModel[i].BaseId?$.getJSON("/api/V3/User/GetUserRelatedInfoByUserId",{userId:e.viewModel[i].BaseId},function(t){t&&(e.widget[n]=_.extend(JSON.parse(t)||{},{widgetType:n}),$("#"+n+"dataTemplate").remove(),L=0,$("#"+n+"AddLink").addClass("isDisabled"),r.append(l(M(n))),kendo.bind(r,e),u.replaceAll(".support-tools__widget__action-icon"))}):($("#"+n+"dataTemplate").remove(),$("#"+n+"AddLink").removeClass("isDisabled"),L=0))}if(t.field.indexOf("RelatesToConfigItem")>-1||t.field.indexOf("HasRelatedWorkItems")>-1){var i,n,a=t.items[0];if(a.ClassName&&("Microsoft.Windows.Computer"===a.ClassName||"Computer"===a.ClassName)){t.field.indexOf("RelatesToConfigItem")>-1&&(i="RelatesToConfigItem",n=S),t.field.indexOf("HasRelatedWorkItems")>-1&&(i="HasRelatedWorkItems",n=y),"add"===t.action&&(a=_.extend(a,{widgetType:n}),e.widget[n+"Arr"].push(a)),"remove"===t.action&&(e.widget[n+"Arr"]=_.filter(e.widget[n+"Arr"],function(e){return e.BaseId!==a.BaseId})),$("."+n+"ArrdataTemplate").remove();var o={devices:e.widget[n+"Arr"],type:n+"Arr",title:t.field.indexOf("RelatesToConfigItem")>-1?localization.RelatedDeviceText:localization.AffectedDeviceText,icon:t.field.indexOf("RelatesToConfigItem")>-1?"related_device.svg":"affected_device.svg"};d.append(c(o)),kendo.bind(d,e),u.replaceAll(".support-tools__widget__action-icon")}if(a.ClassName&&("Cireson.AssetManagement.HardwareAsset"===a.ClassName||"HardwareAsset"===a.ClassName)){t.field.indexOf("RelatesToConfigItem")>-1&&(i="RelatesToConfigItem",n=T),t.field.indexOf("HasRelatedWorkItems")>-1&&(i="HasRelatedWorkItems",n=x),"add"===t.action&&(a=_.extend(a,{widgetType:n}),e.widget[n+"Arr"].push(a)),"remove"===t.action&&(e.widget[n+"Arr"]=_.filter(e.widget[n+"Arr"],function(e){return e.BaseId!==a.BaseId})),$("."+n+"ArrdataTemplate").remove();var o={devices:e.widget[n+"Arr"],type:n+"Arr",title:t.field.indexOf("RelatesToConfigItem")>-1?localization.RelatedAssetText:localization.AffectedAssetText,icon:t.field.indexOf("RelatesToConfigItem")>-1?"related_asset.svg":"affected_asset.svg"};d.append(c(o)),kendo.bind(d,e),u.replaceAll(".support-tools__widget__action-icon")}}}),kendo.bind(n,e),__remoteManageWidgetSingleton},toggle:function(e){e.widget.open=!e.widget.open,e.widget.open?(e.attachmentWidget&&(e.attachmentWidget.open=!1),$("#headerAttachmentBtn").removeClass("btn-icon-stack--active"),$("#attachment_widget").removeClass("content-header__flyout--open"),$("#expanded_widget").addClass("content-header__flyout--open"),$("#content-header-backdrop").addClass("content-header__flyout__overlay--open")):($("#remoteManageBtn").removeClass("btn-icon-stack--active"),$("#expanded_widget").removeClass("content-header__flyout--open"),$("#content-header-backdrop").removeClass("content-header__flyout__overlay--open"))}}}),define("text!forms/flyout/headerAttachmentWidget/view.html",[],function(){return'<div id="attachment_widget" class="content-header__flyout">\r\n    <h3 class="content-header__flyout__title">\r\n        <span><%= localization.FileAttachments %></span>\r\n    </h3>\r\n    <div id="headerAttachmentContainer" class="panel-body"></div>\r\n</div>'}),define("text!forms/predefined/fileAttachmentsDragDrop/view.html",[],function(){return'<div class="form-group" data-bind="visible:isVisible">\r\n    <div class="drop-zone-element hidden-print">\r\n        <div class="text-wrapper">\r\n            <span class="drag-image-text">\r\n                <img data-bind="visible:isDesktop" src="/Content/Images/Icons/FileUpload/upload_to_cloud.svg" />\r\n                <span data-bind="visible:isDesktop"><b><%= localization.DragAndDrop %> </b> <%= localization.YourFilesOr %> <a class="browse-file"><b><%= localization.Browse %></b></a></span>\r\n                <a  data-bind="visible:isMobile" class="browse-file"><b><%= localization.Browse %></b></a>\r\n                <div style="display:none"><input name="files" id="files" type="file"/></div>\r\n            </span>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div>\r\n    <div class="fileattachment-list"></div>\r\n    <div class="fileattachment-img-modal"></div>\r\n</div>\r\n\r\n<script type="text/x-kendo-template" id="fileTemplate">\r\n    <div class="thumbnail-file">\r\n        <div class="cursor-pointer thumbnail-img">\r\n            # if (DisplayName.toLowerCase().match(/\\.(jpg|jpeg|png|gif)$/)) { #\r\n            <img src="data:image/png;base64,#= Content.data #" onerror="this.onerror = null; this.src = \'/Content/Images/Icons/FileUpload/document.svg\';" alt="#: DisplayName # image" />\r\n            # } else{ #\r\n            <img class="default-icon" src="/Content/Images/Icons/FileUpload/document.svg" onerror="this.onerror = null; this.src = \'/Content/Images/Icons/FileUpload/document.svg\'">\r\n            # } #\r\n        </div>\r\n        <div class="thumbnail-caption">\r\n            <span>#: DisplayName #</span>\r\n            <div class="overlay">\r\n                # if (DisplayName.toLowerCase().match(/\\.(jpg|jpeg|png|gif)$/)) { #\r\n                <span class="label">\r\n                    <a class="icon custom-click view" view-image title="View Image">\r\n                        <i class="fa fa-eye"></i>\r\n                    </a>\r\n                </span>\r\n                <span class="label">\r\n                    <a class="icon custom-click opennewtab" title="Open in New Tab">\r\n                        <i class="fa fa-external-link"></i>\r\n                    </a>\r\n                </span>\r\n                # } #\r\n                # if (BaseId!=null) { #\r\n                <span class="label">\r\n                    <a class="icon custom-click download" title="Download">\r\n                        <i class="fa fa-download"></i>\r\n                    </a>\r\n                </span>\r\n                # } #\r\n                <span class="label">\r\n                    <a class="k-delete-button icon" href="\\\\#"  title="<%= localization.Remove %>"><i class="fa fa-trash"></i></a>\r\n                </span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n<\/script>\r\n<style>\r\n\r\n</style>'}),define("forms/predefined/fileAttachmentsDragDrop/controller",["require","text!forms/predefined/fileAttachmentsDragDrop/view.html"],function(e){var t=e("text!forms/predefined/fileAttachmentsDragDrop/view.html");return{template:t,build:function(e,i,n){var a=_.template(t);!_.isUndefined(localization[i.name])&&[i.name].length>0&&(i.name=localization[i.name]),!_.isUndefined(e.FileAttachment)&&e.FileAttachment.length>0&&_.each(e.FileAttachment,function(e){e.DisplayName.toLowerCase().match(/\.(jpg|jpeg|png|gif)$/)&&$.ajax({type:"GET",async:!1,url:"/FileAttachment/GetFileContentInThumbnail/",data:{id:e.BaseId}}).then(function(t){e.Content.data=t})});var o={Required:i.Required,BaseId:e.BaseId,AcceptExtension:_.isUndefined(i.AcceptExtension)?"":e.AcceptExtension,ClassName:e.Clas,Disabled:!1};$.extend(!0,o,i);var r=$(a(o)),l=[],s=new kendo.observable({isDesktop:!app.isMobile(),isMobile:app.isMobile(),isEnabled:!0,isVisible:!e.isDisabled,onSelect:function(e){r.find(".k-file-error").remove(),$.each(e.files,function(t,n){_.isUndefined(i.AcceptExtension)||""==i.AcceptExtension||i.AcceptExtension.toLowerCase().indexOf(n.extension.toLowerCase())>-1||(kendo.ui.ExtAlertDialog.show({title:localization.ErrorDescription,message:localization.FileExtensionInvalid+i.AcceptExtension,icon:"fa fa-exclamation"}),e.preventDefault())})},onUploadSuccess:function(t){var i=(_.isUndefined(e.FileAttachment)||e.FileAttachment,t.response);if("upload"==t.operation)for(var n=0;n<t.files.length;n++){var a=t.files[n].rawFile;if(a)if(_.isUndefined(i.FileAttachment))_.isUndefined(i.success)||0!=i.success||kendo.ui.ExtAlertDialog.show({title:localization.ErrorDescription,message:i.message,icon:"fa fa-exclamation"});else{var o=_.filter(e.FileAttachment,function(e){return e.Content.data===i.FileAttachment.Content.data&&e.BaseId===i.FileAttachment.BaseId});if(0===o.length){e.FileAttachment.push(i.FileAttachment);var r=app.controls.getWorkItemLogType(e);r&&boundObj[r].unshift(new app.dataModels[r].fileAdded(i.FileAttachment.DisplayName))}}}},onUploadError:function(e){$.parseJSON(e.XMLHttpRequest.responseText);$.map(e.files,function(e){console.warn("Could not upload "+e.name)})},onRemove:function(t){$.get("/FileAttachment/RemoveFileUpload/",{BaseId:e.BaseId,fieldName:i.PropertyName},function(t){r.find(".k-file").parent().remove(),r.find("#div"+i.PropertyName).hide(),e[i.PropertyName]=null})},onOpenFile:function(e){function t(){if(app.lib.mask.remove(),e.hasClass("opennewtab")){var t=window.open("about:blank");setTimeout(function(){t.document.body.appendChild(t.document.createElement("img")).src="data:image/jpg;base64,"+d.Content.data,t.href="data:image/jpg;base64,"+d.Content.data,t.focus()},0)}else if(d.DisplayName.toLowerCase().match(/\.(jpg|jpeg|png|gif)$/)&&!e.hasClass("download"))n.kendoDialog({modal:!0,title:d.DisplayName,content:"<div class='file-img-container'><img src=\"data:image/jpg;base64,"+d.Content.data+'" onerror="this.onerror = null; this.src = \'/Content/Images/Icons/FileUpload/document.svg\';" alt="'+d.DisplayName+'" /></div>',animation:{open:{effects:"fade:in"}},show:function(e){},close:function(e){n.remove()}}),n.parent().css("position","fixed"),n.data("kendoDialog").open(),$(".k-overlay").on("click",function(){n.data("kendoDialog").close()});else if(_.isNull(d.BaseId)){if(d.Content.data){var i=d.DisplayName,o=document.createElement("a");document.body.appendChild(o),o.style="display: none",o.href="data:application/octet-stream;charset=utf-16le;base64,"+d.Content.data,o.download=i,o.click(),document.body.removeChild(o)}}else location.href=a+d.BaseId}var i=$(".fileattachment-img-modal"),n=i.clone(),a=app.config.rootURL+"FileAttachment/ViewFile/",o=r.find(".fileattachment-list").data("kendoListView"),s=e.closest("[role='option']"),d=o.dataSource.getByUid(s.data("uid"));app.lib.mask.apply(),_.defer(function(){_.filter(l,function(e){return e.id==d.BaseId}).length<=0?$.ajax({type:"GET",async:!1,url:"/FileAttachment/GetFileContent/",data:{id:d.BaseId}}).then(function(e){""==e?t():(l.unshift({id:d.BaseId,img:e}),d.Content.data=e,t())}):t()})}});_.defer(function(){kendo.bind(r,s),r.find(".fileattachment-list").kendoListView({dataSource:e.FileAttachment,template:kendo.template($("#fileTemplate").html()),selectable:"single",dataBound:function(){r.find(".custom-click").on("click",function(){s.onOpenFile($(this))}),app.isMobile()||(r.find("a[view-image]").parent().hide(),r.find(".thumbnail-img").on("click",function(){s.onOpenFile($(this))}))},remove:function(t){var i=app.controls.getWorkItemLogType(e);i&&boundObj[i].unshift(new app.dataModels[i].fileRemoved(t.model.DisplayName))}}),$("#files").kendoUpload({async:{saveUrl:"/FileAttachment/UploadAttachment/"+e.BaseId+"?className="+e.ClassName,removeUrl:"remove",autoUpload:!0},success:s.onUploadSuccess,error:s.onUploadError,showFileList:!1,dropZone:".drop-zone-element"}),$(".browse-file").off("click").on("click",function(){$("#files").trigger("click")})}),n(r)}}});var __headerAttachmentWidgetSingleton;define("forms/flyout/headerAttachmentWidget/controller",["require","text!forms/flyout/headerAttachmentWidget/view.html","text!forms/predefined/fileAttachmentsDragDrop/view.html","forms/predefined/fileAttachmentsDragDrop/controller"],function(e){var t=e("text!forms/flyout/headerAttachmentWidget/view.html"),i=(e("text!forms/predefined/fileAttachmentsDragDrop/view.html"),e("forms/predefined/fileAttachmentsDragDrop/controller"));return{template:t,getWidget:function(e){var n=_.template(t),a=$(n());$(".page_bar.sticky-header").first().children(".row").first().after(a);var o=function(e){return"string"==typeof e?$(e):e},r=$("#headerAttachmentContainer");return i.build(e.viewModel,{name:"File Attachments",type:"fileAttachmentsDragDrop"},function(e){var t=o(e);r.append(t)}),e.attachmentWidget={open:!1},kendo.bind(a,e),__headerAttachmentWidgetSingleton},toggle:function(e){e.attachmentWidget.open=!e.attachmentWidget.open,e.attachmentWidget.open?(e.widget&&(e.widget.open=!1),$("#remoteManageBtn").removeClass("btn-icon-stack--active"),$("#expanded_widget").removeClass("content-header__flyout--open"),$("#attachment_widget").addClass("content-header__flyout--open"),$("#content-header-backdrop").addClass("content-header__flyout__overlay--open")):($("#headerAttachmentBtn").removeClass("btn-icon-stack--active"),$("#attachment_widget").removeClass("content-header__flyout--open"),$("#content-header-backdrop").removeClass("content-header__flyout__overlay--open"))}}}),define("forms/header/sticky/controller",["require","text!forms/header/sticky/view.html","forms/flyout/fileAttachmentsFlyout/controller","forms/flyout/remoteManageWidget/controller","forms/flyout/headerAttachmentWidget/controller"],function(require){var tpl=require("text!forms/header/sticky/view.html"),attachmentPickerFlyout=require("forms/flyout/fileAttachmentsFlyout/controller"),remoteManageWidget=require("forms/flyout/remoteManageWidget/controller");if(app.featureSet.isActive("HeaderAttachments"))var headerAttachmentWidget=require("forms/flyout/headerAttachmentWidget/controller");var definition={template:tpl,build:function(vm,node,callback){var built=_.template(tpl);_.isUndefined(vm.viewModel.FileAttachment)&&vm.viewModel.set("FileAttachment",[]),vm.view.showAttachments=app.featureSet.isActive("HeaderAttachments"),vm.view.statusVisible=function(){return!vm.newWI},vm.view.showRemoteManageIcon=!(!session.consoleSetting.TrueControlCenterURL||app.isMobile()||!session.user.Analyst);var view=new kendo.View(built(),{wrap:!1,init:function(){setTimeout(function(){DoWork(),0===$("#expanded_widget").length&&vm.view.showRemoteManageIcon&&remoteManageWidget.getWidget(vm),0===$("#attachment_widget").length&&vm.view.showAttachments&&headerAttachmentWidget.getWidget(vm)},100)},model:vm});vm.view.buildParentHeaderView=function(e){var t=_.template(tpl);vm.view.controller={parentIncident:"ReleaseRecord"===vm.type?localization.ParentRecord:localization.Parentincident,editHref:"/"+vm.type+"/Edit/"+vm.viewModel.ParentWorkItem.Id+"/",editLink:vm.viewModel.ParentWorkItem.Id+"-"+vm.viewModel.ParentWorkItem.Title,unlinkParent:function(){$.when(kendo.ui.ExtYesNoDialog.show({title:localization.UnlinkToParent,message:localization.SureUnlinkToParent})).done(function(e){"yes"===e.button&&(delete vm.viewModel.ParentWorkItem,vm.viewModel.set("isDirty",!0),vm.view.controller.isParent=!1,view.destroy(),view=new kendo.View(t(),{wrap:!1,init:function(){setTimeout(function(){DoWork(),0===$("#expanded_widget").length&&vm.view.showRemoteManageIcon&&remoteManageWidget.getWidget(vm),0===$("#attachment_widget").length&&vm.view.showAttachments&&headerAttachmentWidget.getWidget(vm)},100)},model:vm}),callback(view.render()))})},isParent:!!vm.viewModel.ParentWorkItem,isAnalystUser:!!session.user.Analyst},view.destroy(),view=new kendo.View(t(),{wrap:!1,init:function(){setTimeout(function(){DoWork(),0===$("#expanded_widget").length&&vm.view.showRemoteManageIcon&&remoteManageWidget.getWidget(vm),0===$("#attachment_widget").length&&vm.view.showAttachments&&headerAttachmentWidget.getWidget(vm)},100)},model:vm}),e(callback(view.render()))},vm.view.isSLOopen=!1,vm.view.toggleSLODropdown=function(){vm.view.isSLOopen=!vm.view.isSLOopen,
vm.view.isSLOopen?$(".content-header__collapser__dropdown").addClass("content-header__collapser__dropdown--show"):$(".content-header__collapser__dropdown").removeClass("content-header__collapser__dropdown--show")},window.closeSLODropdown=function(){vm.view.toggleSLODropdown()};var DoWork=function(){if(vm.viewModel.SLO&&vm.viewModel.SLO.length>0){var e=[vm.viewModel.SLO[0]],t=$(".first-header-slo-container");DoWorkSLOHeader(!0,t,e,!1);var i=$(".header-slo-container"),n=vm.viewModel.SLO;DoWorkSLOHeader(!1,i,n,!0)}else $(".first-header-slo-container").parent().hide()},DoWorkSLOHeader=function(headerslo,sloContainer,sloObjects,isDropdown){var sloActive="SLAInstance.Status.Active",sloPaused="SLAInstance.Status.Paused",sloMet="SLAInstance.Status.Met",sloWarning="SLAInstance.Status.Warning",sloBreached="SLAInstance.Status.Breached",sloNotReady="SLAInstance.Status.NotReady";for(var key in sloObjects)if(null!=sloObjects[key].DisplayName){var isMet=!1,isPaused=!1,sloTemplate=isDropdown?kendo.template($("#header-slo-template").html()):kendo.template($("#first-header-slo-template").html()),sloObj={};switch(sloObj.index=key,sloObj.count=vm.viewModel.SLO.length,sloObj.Id=sloObjects[key].DisplayName.replace(" ",""),sloObj.Title=sloObjects[key].DisplayName,sloObjects[key].Status){case sloActive:sloObj.imageClass="fa-clock-o text-primary";break;case sloPaused:case sloNotReady:isPaused=!0,sloObj.imageClass="fa-pause text-info";break;case sloMet:sloObj.imageClass="fa-check-circle-o text-success",isMet=!0;break;case sloWarning:sloObj.imageClass="fa-exclamation-circle text-warning";break;case sloBreached:sloObj.imageClass="fa-bell text-danger",isBreach=!0}var sloImg=sloObj.imageClass,addAttr=headerslo?"slo-displayed":"slo-dropdown-"+key,clone=$("<div/>").addClass("content-header__collapser").attr("id",addAttr);clone.html(sloTemplate(sloObj)),SLOCoundown(addAttr,clone,isMet,isPaused,sloObjects[key].Time.Hours,sloObjects[key].Time.Minutes,sloObjects[key].Time.Seconds,eval(sloObjects[key].WarningDate),eval(sloObjects[key].ServerDatetimeNow),!1),sloContainer.append(clone)}},SLOCoundown=function(e,t,i,n,a,o,r,l,s,d){var c=$($("#"+e,t).prevObject);c.find(".header-slo-icon").first().addClass(e),c.find(".header-slo-timer").first().addClass(e);var u=$(".header-slo-icon."+e),p=$(".header-slo-timer."+e);if(!i&&!d&&l<=s&&u.attr("class","header-slo-icon fa fa-exclamation-circle text-warning fa-lg"),!i&&r<=0&&o<=0&&a<=0&&(d=!0,u.attr("class","header-slo-icon fa fa-bell text-danger fa-lg"),p.addClass("text-danger")),i)return void p.html("&nbsp;");var m=Math.abs(r)<10?"0"+Math.abs(r):Math.abs(r),f=Math.abs(o)<10?"0"+Math.abs(o):Math.abs(o),v=Math.abs(a)<10?"0"+Math.abs(a):Math.abs(a);d?p.html(""):p.first().html((d?"-":"")+Math.abs(v)+":"+f+":"+m),n||(s.setSeconds(s.getSeconds()+1),r=parseInt(r)-1,r<=0&&o<=0&&a<=0?(r<=-60&&(r=0,o=parseInt(o)-1),o<=-60&&(o=0,a=parseInt(a)-1)):(o<0&&(o=59,a=parseInt(a)-1),r<0&&(r=59,o=parseInt(o)-1)),setTimeout(function(){SLOCoundown(e,t,i,n,a,o,r,l,s,d)},1e3))};vm.view.doClick=function(e){$(e.currentTarget).hasClass("btn-icon-stack--active")?$(e.currentTarget).removeClass("btn-icon-stack--active"):$(e.currentTarget).addClass("btn-icon-stack--active"),remoteManageWidget.toggle(vm)},vm.view.toggleMore=function(){$("#openmore").modal("show"),$("#openmore").on("shown.bs.modal",function(){$(".modal-backdrop").each(function(e,t){$("#openmore").before(t)})})},vm.view.viewAttachments=function(e){$(e.currentTarget).hasClass("btn-icon-stack--active")?$(e.currentTarget).removeClass("btn-icon-stack--active"):$(e.currentTarget).addClass("btn-icon-stack--active"),headerAttachmentWidget.toggle(vm)},document.title=vm.view.title+" - "+vm.view.id,_.isNull(vm.viewModel.ParentWorkItem)||_.isUndefined(vm.viewModel.ParentWorkItem)?vm.view.controller={isParent:!!vm.viewModel.ParentWorkItem}:vm.view.buildParentHeaderView(function(e){}),_.defer(function(){function e(){vm.viewModel.FileAttachment.length>0?(t.html(vm.viewModel.FileAttachment.length),t.show()):t.hide()}var t=$("#headerAttachmentBtn .content-header__collapser__icon-badge");e(),vm.viewModel.FileAttachment.bind("change",function(t){e()})}),$("body").click(function(e){"expanded_widget"===e.target.id||$(e.target).parents("#expanded_widget").length>0||"remoteManageBtn"===e.target.id||$(e.target).parents("#remoteManageBtn").length>0||$(e.target).hasClass("support-tools__widget__action")||$(e.target).parents(".support-tools__widget__action").length>0||$(e.target).hasClass("multi-query__list__selected-items")||$(e.target).parents(".multi-query__list__selected-items").length>0||"attachment_widget"===e.target.id||$(e.target).parents("#attachment_widget").length>0||"headerAttachmentContainer"===e.target.id||$(e.target).parents("#headerAttachmentContainer").length>0||"headerAttachmentBtn"===e.target.id||$(e.target).parents("#headerAttachmentBtn").length>0||$(e.target).hasClass("thumbnail-file")||$(e.target).parents(".thumbnail-file").length>0||(vm.widget&&(vm.widget.open=!1),$("#remoteManageBtn").removeClass("btn-icon-stack--active"),$("#expanded_widget").removeClass("content-header__flyout--open"),$("#content-header-backdrop").removeClass("content-header__flyout__overlay--open"),vm.attachmentWidget&&(vm.attachmentWidget.open=!1),$("#headerAttachmentBtn").removeClass("btn-icon-stack--active"),$("#attachment_widget").removeClass("content-header__flyout--open"))}),callback(view.render())}};return definition}),define("text!forms/header/stickyCI/view.html",[],function(){return'<div class="content-header__container">\r\n    <div class="content-header">\r\n        <div class="content-header__main">\r\n            <div class="content-header__main__title" data-bind="text: view.Title">\r\n            </div>\r\n            <div class="content-header__main__details">\r\n                <span class="status-pill status-pill--active" data-bind="visible: view.statusVisible, text: view.StatusName">\r\n                    Active\r\n                </span>\r\n                <div class="content-header__main__icon-stack hidden-print">\r\n                    \x3c!--<button id="headerAttachmentBtn" class="btn k-button btn-icon-stack" data-bind="click: view.viewAttachments, visible: view.showAttachments">\r\n                        <img src="../../../../Content/Images/Icons/RemoteManage/attach.svg" alt="attach" />\r\n                    </button>--\x3e\r\n                    <button id="remoteManageBtn" class="btn k-button btn-icon-stack" data-bind="click: view.doClick, visible: view.showRemoteManageIcon">\r\n                        <img src="../../../../Content/Images/Icons/RemoteManage/RS-black-simple@32h.png" alt="remote" />\r\n                    </button>\r\n\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div id="content-header-backdrop" class="content-header__flyout__overlay">\r\n</div>'}),define("forms/header/stickyCI/controller",["require","text!forms/header/stickyCI/view.html","forms/flyout/fileAttachmentsFlyout/controller","forms/flyout/remoteManageWidget/controller","forms/flyout/headerAttachmentWidget/controller"],function(e){var t=e("text!forms/header/stickyCI/view.html"),i=(e("forms/flyout/fileAttachmentsFlyout/controller"),e("forms/flyout/remoteManageWidget/controller"));if(app.featureSet.isActive("HeaderAttachments"))var n=e("forms/flyout/headerAttachmentWidget/controller");return{template:t,build:function(e,a,o){var r=_.template(t);_.isUndefined(e.viewModel.FileAttachment)&&e.viewModel.set("FileAttachment",[]),e.view.showAttachments=app.featureSet.isActive("HeaderAttachments"),e.view.statusVisible=function(){return!e.isNew};var l=["HardwareAsset","Microsoft.Windows.Computer","System.Domain.User"].indexOf(e.type)>-1;e.view.showRemoteManageIcon=!(!session.consoleSetting.TrueControlCenterURL||app.isMobile()||!l||!session.user.Analyst);var s=new kendo.View(r(),{wrap:!1,init:function(){setTimeout(function(){0===$("#expanded_widget").length&&i.getWidget(e),0===$("#attachment_widget").length&&e.view.showAttachments&&n.getWidget(e)},100)},model:e});e.view.doClick=function(t){$(t.currentTarget).hasClass("btn-icon-stack--active")?$(t.currentTarget).removeClass("btn-icon-stack--active"):$(t.currentTarget).addClass("btn-icon-stack--active");var i="System.Domain.User"===e.type?"user":"computer",n="HardwareAsset"===e.type?e.viewModel.Target_HardwareAssetHasAssociatedCI:e.viewModel,a=app.slideOutNav.getTCCSourceURL(n,i),o={url:a,tooltip:"user"===i?localization.UserManagement:localization.ComputerManagement};app.slideOutNav.show(o)},e.view.viewAttachments=function(t){$(t.currentTarget).hasClass("btn-icon-stack--active")?$(t.currentTarget).removeClass("btn-icon-stack--active"):$(t.currentTarget).addClass("btn-icon-stack--active"),n.toggle(e)};var d=function(t,i){e.view.Title=e.view.title+" - "+(_.isEmpty(t.viewModel.DisplayName)?localization.New:t.viewModel.DisplayName),e.view.StatusName=t.viewModel.ObjectStatus?t.viewModel.ObjectStatus.Name:"None",i&&kendo.bind($(".content-header__container"),e)};d(e,!1),document.title=e.view.title+" - "+e.view.id,$("body").click(function(t){"expanded_widget"===t.target.id||$(t.target).parents("#expanded_widget").length>0||"remoteManageBtn"===t.target.id||$(t.target).parents("#remoteManageBtn").length>0||$(t.target).hasClass("support-tools__widget__action")||$(t.target).parents(".support-tools__widget__action").length>0||$(t.target).hasClass("multi-query__list__selected-items")||$(t.target).parents(".multi-query__list__selected-items").length>0||"attachment_widget"===t.target.id||$(t.target).parents("#attachment_widget").length>0||"headerAttachmentContainer"===t.target.id||$(t.target).parents("#headerAttachmentContainer").length>0||"headerAttachmentBtn"===t.target.id||$(t.target).parents("#headerAttachmentBtn").length>0||$(t.target).hasClass("thumbnail-file")||$(t.target).parents(".thumbnail-file").length>0||(e.widget&&(e.widget.open=!1),$("#remoteManageBtn").removeClass("btn-icon-stack--active"),$("#expanded_widget").removeClass("content-header__flyout--open"),$("#content-header-backdrop").removeClass("content-header__flyout__overlay--open"),e.attachmentWidget&&(e.attachmentWidget.open=!1),$("#headerAttachmentBtn").removeClass("btn-icon-stack--active"),$("#attachment_widget").removeClass("content-header__flyout--open"))});var c=0;e.bind("change",function(e){e.field.indexOf("HardwareAssetStatus")>-1&&2===++c&&d(e.sender,!0)}),o(s.render())}}}),define("text!forms/header/status/view.html",[],function(){return'<h1 class="page_title">\r\n    <span data-bind="text: view.title"></span><span>-</span><span class="uppercase" data-bind="text: view.id"></span>\r\n    <span class="cursor-pointer" id="viewAttachments" data-bind="click: view.viewAttachments, visible: view.filesCount > 0"><i class="fa fa-paperclip text-primary" style="font-size: inherit"></i></span>\r\n    <span class="label label-info label-heading" id="statusname" data-bind="visible: view.statusVisible, text: viewModel.Status.Name"></span>\r\n    <span class="label label-heading" data-bind="visible: viewModel.IsParent"><img src="/Content/Images/Icons/WorkItemsStatus/workitem-parent-icon.svg"></span>\r\n</h2>\r\n\r\n\r\n'}),define("forms/header/status/controller",["require","text!forms/header/status/view.html","forms/flyout/fileAttachmentsFlyout/controller"],function(e){var t=e("text!forms/header/status/view.html"),i=e("forms/flyout/fileAttachmentsFlyout/controller");return{template:t,build:function(e,n,a){var o=_.template(t);_.isUndefined(e.viewModel.FileAttachment)&&e.viewModel.set("FileAttachment",[]),e.view.viewAttachments=function(){i.getPopup(e).open()},e.view.filesCount=e.viewModel.FileAttachment.length,e.view.statusVisible=function(){return!e.newWI},document.title=e.view.title+" - "+e.view.id,a(new kendo.View(o(),{wrap:!1,model:e}).render())}}}),define("forms/header/relationships/controller",["require","text!forms/header/relationships/view.html"],function(e){var t=e("text!forms/header/relationships/view.html");return{template:t,build:function(e,i,n){var a=$("<div/>").attr("id","parent-header-space"),o=new kendo.View(a,{wrapper:!1});e.view.buildParentHeaderView=function(i){var n=_.template(t);e.view.controller={parentIncident:"ReleaseRecord"===e.type?localization.ParentRecord:localization.Parentincident,editHref:"/"+e.type+"/Edit/"+e.viewModel.ParentWorkItem.Id+"/",editLink:e.viewModel.ParentWorkItem.Id+"-"+e.viewModel.ParentWorkItem.Title,unlinkParent:function(){$.when(kendo.ui.ExtYesNoDialog.show({title:localization.UnlinkToParent,message:localization.SureUnlinkToParent})).done(function(t){"yes"===t.button&&(delete e.viewModel.ParentWorkItem,e.viewModel.set("isDirty",!0),o.content.hide())})}},i(n())},_.isNull(e.viewModel.ParentWorkItem)||_.isUndefined(e.viewModel.ParentWorkItem)?n(o.render()):e.view.buildParentHeaderView(function(t){o.destroy(),a.append(t),o=new kendo.View(a,{wrapper:!1,model:e}),n(o.render())})}}}),define("text!forms/header/slo/view.html",[],function(){return'<div class="slo-container pull-right">\r\n\r\n</div>\r\n<script id="slo-template" type="text/x-kendo-template">\r\n        <li class="slo-timer"></li>\r\n        <li class="slo-icon fa #: imageClass # fa-lg"></li>\r\n        <li class="slo-title">#: Title #</li>\r\n<\/script>'}),define("forms/header/slo/controller",["require","text!forms/header/slo/view.html"],function(require){var tpl=require("text!forms/header/slo/view.html"),definition={template:tpl,build:function(vm,node,callback){if(vm.isAnalyst){var built=_.template(tpl),view=new kendo.View(built(),{wrap:!1,init:function(){setTimeout(function(){DoWork()},100)},model:vm});view.render();var DoWork=function(){if(null!=vm.viewModel.SLO){var sloViewObj=view.element,sloObjects=vm.viewModel.SLO,sloActive="SLAInstance.Status.Active",sloPaused="SLAInstance.Status.Paused",sloMet="SLAInstance.Status.Met",sloWarning="SLAInstance.Status.Warning",sloBreached="SLAInstance.Status.Breached",sloNotReady="SLAInstance.Status.NotReady",sloContainer=$(".slo-container");for(var key in sloObjects)if(null!=sloObjects[key].DisplayName){var isMet=!1,isPaused=!1,sloTemplate=kendo.template($("#slo-template").html()),sloObj={};switch(sloObj.Id=sloObjects[key].DisplayName.replace(" ",""),sloObj.Title=sloObjects[key].DisplayName,sloObjects[key].Status){case sloActive:sloObj.imageClass="fa-clock-o text-primary";break;case sloPaused:case sloNotReady:isPaused=!0,sloObj.imageClass="fa-pause text-info";break;case sloMet:sloObj.imageClass="fa-check-circle-o text-success",isMet=!0;break;case sloWarning:sloObj.imageClass="fa-exclamation-circle text-warning";break;case sloBreached:sloObj.imageClass="fa-bell text-danger",isBreach=!0}var sloImg=sloObj.imageClass,clone=$("<ul/>").addClass("slo-status-item");clone.html(sloTemplate(sloObj)),SLOCoundown(clone,isMet,isPaused,sloObjects[key].Time.Hours,sloObjects[key].Time.Minutes,sloObjects[key].Time.Seconds,eval(sloObjects[key].WarningDate),eval(sloObjects[key].ServerDatetimeNow),!1),sloContainer.append(clone)}}},SLOCoundown=function(e,t,i,n,a,o,r,l,s){if(!t&&!s&&r<=l&&e.find(".slo-icon").attr("class","slo-icon fa fa-exclamation-circle text-warning fa-lg"),!t&&o<=0&&a<=0&&n<=0&&(s=!0,e.find(".slo-icon").attr("class","slo-icon fa fa-bell text-danger fa-lg"),e.find(".slo-timer").addClass("text-danger")),t)return void e.find(".slo-timer").html("&nbsp;");var d=Math.abs(o)<10?"0"+Math.abs(o):Math.abs(o),c=Math.abs(a)<10?"0"+Math.abs(a):Math.abs(a),u=Math.abs(n)<10?"0"+Math.abs(n):Math.abs(n);s?e.find(".slo-timer").html(""):e.find(".slo-timer").html((s?"-":"")+Math.abs(u)+":"+c+":"+d),i||(l.setSeconds(l.getSeconds()+1),o=parseInt(o)-1,o<=0&&a<=0&&n<=0?(o<=-60&&(o=0,a=parseInt(a)-1),a<=-60&&(a=0,n=parseInt(n)-1)):(a<0&&(a=59,n=parseInt(n)-1),o<0&&(o=59,a=parseInt(a)-1)),setTimeout(function(){SLOCoundown(e,t,i,n,a,o,r,l,s)},1e3))};callback(view.render())}}};return definition}),define("text!forms/header/spacer/view.html",[],function(){return"<div></div>"}),define("forms/header/spacer/controller",["require","text!forms/header/spacer/view.html"],function(e){var t=e("text!forms/header/spacer/view.html");return{template:t,build:function(e,i,n){var a=_.template(t);n(new kendo.View(a(),{model:e}).render())}}}),define("text!forms/header/title/view.html",[],function(){return'<h1 class="page_title">\r\n    <span data-bind="html: title"></span>\r\n</h1>\r\n\r\n'}),define("forms/header/title/controller",["require","text!forms/header/title/view.html"],function(e){var t=e("text!forms/header/title/view.html");return{template:t,build:function(e,i,n){var a=_.template(t);e.title=!_.isUndefined(localization[e.type])&&[e.type].length>0?localization[e.type]:e.type,document.title=e.title,n(new kendo.View(a(),{wrap:!1,model:e}).render())}}}),define("text!forms/header/approval/view.html",[],function(){return'<div class="container-fluid" data-bind="visible: isDesktopView">\r\n    <div class="row">\r\n        <div class="col-md-6 col-xs-12">\r\n            <h1 class="page_title">\r\n                <span data-bind="text: title"></span><span>-</span><span class="uppercase" data-bind="text: workItemId"></span>\r\n                <span class="label label-info label-heading" id="statusName" data-bind="text: statusName"></span>\r\n                <span class="label label-heading" data-bind="visible: isParent"><img src="/Content/Images/Icons/WorkItemsStatus/workitem-parent-icon.svg"></span>\r\n            </h1>\r\n        </div>\r\n        <div class="col-md-6 col-xs-12">       \r\n            <div class="pull-right ra-approval-space">\r\n                \x3c!-- Support group --\x3e\r\n                <div class="pull-left">\r\n                    <div class="form-control-picker input-sm ra-input"\r\n                         data-url="/api/V3/Enum/GetList"\r\n                         data-combourl="/api/V3/Enum/GetFlatList/"\r\n                         data-bind="ciresonDropDownTree: SupportGroupEnumId, value: SupportGroupFieldValue, visible: SupportGroupVisible, click: onChangeSupportGroup, options: {disabled:disabledMAButtons}"\r\n                         data-role="SupportGroupField"\r\n                         data-placeholder="SupportGroup"></div>\r\n                </div>\r\n                <div class="pull-right">\r\n                    \x3c!--RA buttons--\x3e\r\n                    <button class="btn btn-success"\r\n                            data-bind="events: { click: onApproveClick }, disabled:disabledButtons, visible:isReviewActivity">\r\n                        <%= localization.Approve %>\r\n                    </button>\r\n                    <button class="btn btn-danger"\r\n                            data-bind="events: { click: onRejectClick }, disabled:disabledButtons, visible:isReviewActivity">\r\n                        <%= localization.Reject %>\r\n                    </button>\r\n                    \x3c!--RA buttons--\x3e\r\n                    \x3c!--MA buttons--\x3e\r\n                    <button class="btn btn-success"\r\n                            data-bind="events: { click: onCompleteClick }, disabled:disabledMAButtons, visible:isManualActivity">\r\n                        <%= localization.Completed %>\r\n                    </button>\r\n                    <button class="btn btn-danger"\r\n                            data-bind="events: { click: onFailClick }, disabled:disabledMAButtons, visible:isManualActivity">\r\n                        <%= localization.Failed %>\r\n                    </button>\r\n                    \x3c!--MA buttons--\x3e\r\n                    <span>\r\n                        <button class="btn-link" data-bind="disabled:disablePrevious, events:{click: previousClick}"><i class="fa fa-chevron-left"></i></button>\r\n                        <span data-bind="html: pageText"></span>\r\n                        <button class="btn-link" data-bind="disabled:disableNext, events:{click: nextClick}"><i class="fa fa-chevron-right"></i></button>\r\n                    </span>\r\n                </div>\r\n             </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="container-fluid" data-bind="visible: isMobileView">\r\n    <div class="row">\r\n        <div class="col-md-12 col-xs-12">\r\n            <div class="ra-approval-space pull-right">\r\n                <div>\r\n                    <button class="btn-link" data-bind="disabled:disablePrevious, events:{click: previousClick}"><i class="fa fa-chevron-left"></i></button>\r\n                    <span data-bind="html: pageText"></span>\r\n                    <button class="btn-link" data-bind="disabled:disableNext, events:{click: nextClick}"><i class="fa fa-chevron-right"></i></button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="row">\r\n        \x3c!-- Support group --\x3e\r\n        <div class="col-md-12 col-xs-12">\r\n            <div class="form-control-picker ra-input"\r\n                 data-url="/api/V3/Enum/GetList"\r\n                 data-combourl="/api/V3/Enum/GetFlatList/"\r\n                 data-bind="ciresonDropDownTree: SupportGroupEnumId, value: SupportGroupFieldValue, visible: SupportGroupVisible, click: onChangeSupportGroup"\r\n                 data-role="SupportGroupField"\r\n                 data-placeholder="SupportGroup"></div>\r\n        </div>\r\n        \x3c!--RA buttons--\x3e\r\n        <div class="col-md-12 col-xs-12">\r\n            <div class="ra-approval-space">\r\n                <button class="btn btn-success"\r\n                        data-bind="events: { click: onApproveClick }, disabled:disabledButtons, visible:isReviewActivity">\r\n                    <%= localization.Approve %>\r\n                </button>\r\n            </div>\r\n        </div>\r\n        <div class="col-md-12 col-xs-12">\r\n            <div class="ra-approval-space">\r\n                <button class="btn btn-danger"\r\n                        data-bind="events: { click: onRejectClick }, disabled:disabledButtons, visible:isReviewActivity">\r\n                    <%= localization.Reject %>\r\n                </button>\r\n            </div>\r\n        </div>\r\n        \x3c!--RA buttons--\x3e\r\n\r\n        \x3c!--MA buttons--\x3e\r\n        <div class="col-md-12 col-xs-12">\r\n            <div class="ra-approval-space">\r\n                <button class="btn btn-success"\r\n                        data-bind="events: { click: onCompleteClick }, disabled:disabledMAButtons, visible:isManualActivity">\r\n                    <%= localization.Completed %>\r\n                </button>\r\n            </div>\r\n        </div>\r\n        <div class="col-md-12 col-xs-12">\r\n            <div class="ra-approval-space">\r\n                <button class="btn btn-danger"\r\n                        data-bind="events: { click: onFailClick }, disabled:disabledMAButtons, visible:isManualActivity">\r\n                    <%= localization.Failed %>\r\n                </button>\r\n            </div>\r\n        </div>\r\n        \x3c!--MA buttons--\x3e\r\n    </div>\r\n    <div class="row">\r\n        <div class="col-md-6 col-xs-12">\r\n            <h1 class="page_title">\r\n                <span data-bind="text: title"></span><span>-</span><span class="uppercase" data-bind="text: workItemId"></span>\r\n                <span class="label label-info label-heading" id="statusname" data-bind="text: statusName"></span>\r\n                <span class="label label-heading" data-bind="visible: isParent"><img src="/Content/Images/Icons/WorkItemsStatus/workitem-parent-icon.svg"></span>\r\n            </h1>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n'}),define("forms/header/approval/controller",["require","text!forms/header/approval/view.html"],function(e){var t=e("text!forms/header/approval/view.html");return{template:t,build:function(e,i,n){var a=_.template(t),o="107fc6bd-2bb3-0282-4425-f43b5b32ef13",r="0e856c6c-04e5-0a8e-6041-bc7715b4747e",l="dae75d12-89ac-a8d8-4fe3-516c2a6a26f7";e.view.approvalModel=new kendo.observable({decisionEnumId:null,comments:"",onRejectClick:function(){e.view.approvalModel.decisionEnumId=o,this.updateStatus()},onApproveClick:function(){e.view.approvalModel.decisionEnumId=r,this.updateStatus()},onCompleteClick:function(){var t={Id:app.constants.workItemStatuses.ManualActivity.Completed,Name:localization.Completed};e.view.approvalModel.updateManualActivity(t)},onFailClick:function(){var t={Id:app.constants.workItemStatuses.ManualActivity.Failed,Name:localization.Failed};e.view.approvalModel.updateManualActivity(t)},updateStatus:function(){e.view.approvalModel.isReviewActivity&&e.view.approvalModel.updateReviewActivity(),e.view.approvalModel.isManualActivity&&e.view.approvalModel.updateManualActivity()},updateReviewActivity:function(){$.when(app.controls.ReviewDecisionCommentDialog.show({title:localization.Comments,message:localization.DoYouHaveComments,required:!0,height:250})).done(function(t){"yes"===t.button&&(e.view.approvalModel.comments=t.input),_.each(pageForm.viewModel.Reviewer,function(t){var i=_.find(pageForm.userGroup,function(e){return!_.isUndefined(t.User)&&t.User.BaseId==e.Id});if(t.Decision.Id==l&&(!_.isUndefined(t.User)&&t.User.BaseId==session.user.Id||!_.isUndefined(i))){var n="";n=_.isNull(t.Comments)?e.view.approvalModel.comments:t.Comments+" "+e.view.approvalModel.comments,t.VotedBy={},t.VotedBy.BaseId=session.user.Id,t.Decision.set("Id",e.view.approvalModel.decisionEnumId),t.set("Comments",n),t.set("DecisionDate",(new Date).toISOString())}}),pageForm.viewModel.ParentWorkItem&&delete pageForm.viewModel.ParentWorkItem,e.view.approvalModel.save()})},updateManualActivity:function(t){$.when(kendo.ui.ExtYesNoTextAreaDialog.show({title:session.consoleSetting.RequireImplementationNotes?localization.ImplementationdetailsRequired:localization.Implementationdetails,buttons:[{name:localization.Save,click:function(i){var n=$("#extInputDialog .k-ext-input-dialog-input"),a=$("#extInputDialog .k-ext-input-dialog-input").val(),o=_.isNull(pageForm.viewModel.Notes)?"":pageForm.viewModel.Notes;i.dialog.options.required&&0==n.val().length?n.addClass(i.dialog.options.requiredCss):(pageForm.viewModel.ParentWorkItem&&delete pageForm.viewModel.ParentWorkItem,pageForm.viewModel.set("Status",t),pageForm.viewModel.set("ActualEndDate",(new Date).toISOString()),pageForm.viewModel.set("Notes",o+"\n"+a),e.view.approvalModel.save(),i.dialog.close())},cls:"btn-primary"},{name:localization.Cancel,click:function(e){e.dialog.close()}}],required:session.consoleSetting.RequireImplementationNotes,requiredCss:"k-ext-required"}))},save:function(){var t=encodeURIComponent(JSON.stringify({isDirty:!0,current:pageForm.viewModel.toJSON(),original:pageForm.jsonRaw}));$.ajax({type:"POST",dataType:"text",url:pageForm.saveUrl,data:"formJson="+t,success:function(t,i,n){if(location.reload(),t.search("loginForm")<0){var a="0e856c6c-04e5-0a8e-6041-bc7715b4747e"==e.view.approvalModel.decisionEnumId?localization.ReviewActivityApprovedMessage:localization.ReviewActivityRejectedMessage;"System.WorkItem.Activity.ManualActivity"==pageForm.viewModel.ClassName&&(a=pageForm.viewModel.Status.Id==app.constants.workItemStatuses.ManualActivity.Completed?localization.ManualActivityCompletedMessage:localization.ManualActivityFailedMessage),app.lib.message.add(a.replace("{0}",e.viewModel.Id),"success"),app.lib.handleMessages()}else window.location="/Login/Login?ReturnUrl="+window.location.pathname},error:function(e,t,i){if(409==e.status)$.when(kendo.ui.ExtYesNoDialog.show({title:localization.DataConflict,message:localization.DataConflictError+"<br/><br/><small>("+localization.DataConflictDescription+")</small>",icon:"fa fa-exchange text-danger",width:"500px",height:"175px"})).done(function(e){"yes"===e.button?window.open(window.location.pathname):location.href=window.location.pathname});else if(503==e.status){var n=e.responseText;app.lib.log(n);var a=localization.ReconnectRequired;n.exception&&n.exception.length>0&&(a=n.exception),kendo.ui.ExtAlertDialog.show({title:localization.Failed,message:a,icon:"fa fa-times-circle text-danger"})}else if(403==e.status){var n=e.responseText;app.lib.log(n);var a=localization.RequestFailed;n.exception&&n.exception.length>0&&(a=n.exception),kendo.ui.ExtAlertDialog.show({title:localization.Failed,message:a,icon:"fa fa-times-circle text-danger"})}else{console&&app.lib.log(localization.RequestFailed),app.lib.log(i);var n=e.responseText;app.lib.log(n);var a=localization.RequestFailed;n.exception&&n.exception.length>0&&(a=n.exception),kendo.ui.ExtAlertDialog.show({title:localization.ErrorDescription,message:a,icon:"fa fa-exclamation"})}},processData:!1,async:!1})},pageDataSource:new kendo.data.DataSource({serverFiltering:!0,serverSorting:!0,transport:{read:{url:pageForm.viewModel.ClassName.toLowerCase().indexOf("reviewactivity")>-1?"/api/V3/WorkItem/GetGridWorkItemsMyApprovals/":"/api/V3/WorkItem/GetGridWorkItemsMyManualActivities/",data:{userId:session.user.Id,isScoped:session.user.Security.IsWorkItemScoped,showInActives:!1},cache:!1}},requestEnd:function(t){e.view.approvalModel.updatePageDetails(t.response)}}),updatePageDetails:function(t){var i=1,n=t?t.length:0;_.find(t,function(t,n){t.Id==e.viewModel.Id&&(i=n)});var a=i+1+" / "+n;e.view.approvalModel.set("currentPage",i),e.view.approvalModel.set("toatPage",n),e.view.approvalModel.set("pageText",a),e.view.approvalModel.set("disablePrevious",0==i),e.view.approvalModel.set("disableNext",i==n-1);var s="11fc3cef-15e5-bca4-dee0-9c1155ec8d83"===e.viewModel.Status.Id;if(s&&(_.isUndefined(e.viewModel.reviewDetails)||e.viewModel.reviewDetails.fullDetails.Decision.Id!=r&&e.viewModel.reviewDetails.fullDetails.Decision.Id!=o||e.viewModel.reviewDetails.fullDetails.User.BaseId!=session.user.Id)){var d=_.find(pageForm.viewModel.Reviewer,function(e){if(_.isUndefined(e.User))return null;var t=_.find(pageForm.userGroup,function(t){return e.User.BaseId==t.Id});return!(_.isUndefined(e.User)||e.Decision.Id!=l||e.User.BaseId!=session.user.Id&&_.isUndefined(t))});if(!d)return;(!s||_.isUndefined(d)||_.isNull(d))&&e.view.approvalModel.set("disabledButtons",!0)}else e.view.approvalModel.set("disabledButtons",!0)},nextClick:function(){var t=e.view.approvalModel.get("currentPage")+1;e.view.approvalModel.navigate(t)},previousClick:function(){var t=e.view.approvalModel.get("currentPage")-1;e.view.approvalModel.navigate(t)},navigate:function(t){e.view.approvalModel.pageDataSource.read();var i=e.view.approvalModel.pageDataSource.data(),n=i[t],a=e.view.approvalModel.isReviewActivity?"/ReviewActivity/Approval/":"/ManualActivity/Complete/",o=a+n.Id;location.href=o},onChangeSupportGroup:function(){e.viewModel[pageForm.MASupportGroupField]=e.view.approvalModel.SupportGroupFieldValue},currentPage:0,toatPage:0,pageText:"",disablePrevious:!1,disableNext:!1,title:e.view.title,workItemId:e.viewModel.Id,statusVisible:e.view.statusVisible,statusName:e.viewModel.Status.Name,isParent:e.viewModel.IsParent,isDesktopView:!app.isMobile(),isMobileView:app.isMobile(),disabledButtons:!1,reviewResult:null,reviewId:0,SupportGroupVisible:""!==pageForm.MASupportGroupField,SupportGroupEnumId:pageForm.MASupportGroupGuid,SupportGroupFieldValue:e.viewModel[pageForm.MASupportGroupField],isManualActivity:"System.WorkItem.Activity.ManualActivity"==pageForm.viewModel.ClassName,isReviewActivity:"System.WorkItem.Activity.ReviewActivity"==pageForm.viewModel.ClassName,disabledMAButtons:pageForm.viewModel.Status.Id==app.constants.workItemStatuses.ManualActivity.Completed||pageForm.viewModel.Status.Id==app.constants.workItemStatuses.ManualActivity.Failed}),e.view.approvalModel.pageDataSource.read(),n(new kendo.View(a(),{wrap:!1,model:e.view.approvalModel}).render())}}}),
define("forms/headerBuilder",["forms/header/sticky/controller","forms/header/stickyCI/controller","forms/header/status/controller","forms/header/relationships/controller","forms/header/slo/controller","forms/header/spacer/controller","forms/header/title/controller","forms/header/approval/controller"],function(sticky,stickyCI,status,relationships,slo,spacer,title,approval){var definition={build:function(vm,callback){_.each(vm.headerTemplate.rows,function(row){var rowElm=$("<div/>").addClass("row");_.each(row.columns,function(column){var colElm=$("<div/>").addClass(column.Class);if(eval("var _obj = "+column.View+";"),!_obj)throw Exception(column.View+" is not part of the templating system");_obj.build(vm,column,function(e){colElm.append(e),colElm.appendTo(rowElm)})}),callback(rowElm)})}};return definition}),define("text!forms/structure/formPanel/view.html",[],function(){return'<div class="form-panel">\r\n\r\n</div>'}),define("forms/structure/formPanel/controller",["require","text!forms/structure/formPanel/view.html"],function(e){var t=e("text!forms/structure/formPanel/view.html");return{template:t,build:function(e){e(_.template(t)())}}}),define("text!forms/structure/formPanelFull/view.html",[],function(){return'<div class="form-panel">\r\n\r\n</div>'}),define("forms/structure/formPanelFull/controller",["require","text!forms/structure/formPanelFull/view.html"],function(e){var t=e("text!forms/structure/formPanelFull/view.html");return{template:t,build:function(e){e(_.template(t)())}}}),define("text!forms/structure/customFieldGroup/view.html",[],function(){return'<div class="row">\r\n    <div class="panel panel-default no-shadow">\r\n        <div class="panel-heading"><%= name %></div>\r\n        <div class="panel-body append-here">\r\n\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("forms/structure/customFieldGroup/controller",["require","text!forms/structure/customFieldGroup/view.html"],function(e){var t=e("text!forms/structure/customFieldGroup/view.html");return{template:t,build:function(e,i,n){var a=_.template(t);!_.isUndefined(localization[i.name])&&[i.name].length>0&&(i.name=localization[i.name]),(_.isUndefined(i.Visible)||i.Visible)&&n(a(i))}}}),define("text!forms/structure/customFieldGroupRow/view.html",[],function(){return'<div class="row"></div>'}),define("forms/structure/customFieldGroupRow/controller",["require","text!forms/structure/customFieldGroupRow/view.html"],function(e){var t=e("text!forms/structure/customFieldGroupRow/view.html");return{template:t,build:function(e,i,n){n(t)}}}),define("text!forms/structure/columnField/view.html",[],function(){return'<div class="col-md-<%= ColSize %>"></div>'}),define("forms/structure/columnField/controller",["require","text!forms/structure/columnField/view.html"],function(e){var t=e("text!forms/structure/columnField/view.html");return{template:t,build:function(e,i,n){n(_.template(t)(i))}}}),define("text!forms/structure/tab/view.html",[],function(){return'<div class="tab-content"></div>'}),define("forms/structure/tab/controller",["require","text!forms/structure/tab/view.html"],function(e){var t=e("text!forms/structure/tab/view.html");return{template:t,build:function(e,i,n){n(_.template(t)(i))}}}),define("text!forms/structure/tabPane/view.html",[],function(){return'<div class="tab-pane <%= active %>" id="<%= tabId %>"></div>   '}),define("forms/structure/tabPane/controller",["require","text!forms/structure/tabPane/view.html"],function(e){var t=e("text!forms/structure/tabPane/view.html");return{template:t,build:function(e,i,n){n(_.template(t)(i))}}}),define("text!forms/structure/tabNavigation/view.html",[],function(){return'<ul class="nav nav-pills" id="myTab" data-bind="tabDrop:true"></ul>'}),define("text!forms/structure/tabNavigation/mobile.html",[],function(){return'<div class="nav-dropdown">\r\n    <span class="nav-dropdown-default"></span>\r\n    <div class="nav-dropdown-trigger">\r\n        <i class="fa fa-sort-desc"></i>\r\n    </div>\r\n    <div class="nav-dropdown-content">\r\n        <ul id="myTab" data-bind="navDrop:true"></ul>\r\n    </div>\r\n</div>\r\n'}),define("forms/structure/tabNavigation/controller",["require","text!forms/structure/tabNavigation/view.html","text!forms/structure/tabNavigation/mobile.html"],function(e){var t=e("text!forms/structure/tabNavigation/view.html"),i=e("text!forms/structure/tabNavigation/mobile.html"),n=app.isMobile()?i:t;return{template:n,build:function(e,t,i){i(_.template(n)())}}}),define("text!forms/structure/tabData/view.html",[],function(){return'<li class="<%= active %>"><a href="#<%= tabId %>" data-toggle="tab" data-cid="<%= cid %>"><%= name %></a></li>'}),define("text!forms/structure/tabData/mobile.html",[],function(){return'<li value="<%= tabId %>" data-cid="<%= cid %>" data-toggle="tab"\r\n      <% if ( active ){ %>\r\n         class="selected" \r\n       <% } %>\r\n         > <%= name %>\r\n</li>\r\n\r\n'}),define("forms/structure/tabData/controller",["require","text!forms/structure/tabData/view.html","text!forms/structure/tabData/mobile.html"],function(e){var t=e("text!forms/structure/tabData/view.html"),i=e("text!forms/structure/tabData/mobile.html"),n=app.isMobile()?i:t;return{template:n,build:function(e,t,i){var a=_.template(n);t.cid=t.name,!_.isUndefined(localization[t.name])&&[t.name].length>0&&(t.name=localization[t.name]),i(a(t))}}}),define("text!forms/predefined/actionLog/view.html",[],function(){return'<div data-control="actionLog">\r\n    <div class="row hidden-print" data-bind="visible:isDesktop">\r\n        <div class="col-md-12">\r\n            <div class="form-group">\r\n                <label for="commentBoxEditor" data-localize="Comment"></label>\r\n                <textarea id="commentBoxEditor" class="k-textbox form-control input-sm action-log-textarea" data-bind="value: commentBoxHTML"\r\n                <% if ( Disabled ){ %>\r\n                disabled\r\n                <% } %>>\r\n                    </textarea>\r\n            </div>\r\n        </div>\r\n        <div class="col-md-12">\r\n            <div class="pull-left">\r\n                <span data-bind="text: charactersRemaining"></span>\r\n                <span data-localize="CharactersRemaining"> </span>\r\n            </div>\r\n            <div class="pull-right">\r\n                <button type="button" data-bind="click: addComment, enabled: addEnabled" class="k-button btn btn-primary action-log-add-button" data-localize="Add"></button>\r\n            </div>\r\n            <div data-bind="visible: isAnalyst" class="pull-right checkbox action-log-private">\r\n                <input type="checkbox" data-bind="checked: isPrivate" id="actionLogisPrivate" \r\n                       <% if (Disabled) { %>\r\n                        disabled\r\n                    <% } %>>\r\n                </input>\r\n\r\n                <label class="label-middle-align checkbox-inline checkbox-label" data-localize="IsPrivate" for="actionLogisPrivate" />\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="row hidden-print" data-bind="visible:isMobile">\r\n        <div class="action-log-mobile">\r\n            <textarea id="commentBoxEditorMobile" class="k-textbox form-control input-sm action-log-textarea" data-bind="value: commentBoxHTML"\r\n            <% if (Disabled) { %>disabled<% } %>></textarea>\r\n            <div class="action-log-mobile-buttons">\r\n                <button type="button" data-bind="click: addComment" data-localize="Add Comment" class="col-xs-7 btn btn-primary"></button>\r\n                <div data-bind="visible: isAnalyst" class="pull-left checkbox checkbox-inline action-log-mobile-private">\r\n                    <input type="checkbox" data-bind="checked: isPrivate" id="actionLogisPrivate"><% if (Disabled) { %>\r\n                    disabled\r\n                    <% } %>></input>\r\n                    <label class="label-middle-align control-label" data-localize="IsPrivate" for="actionLogisPrivate" />\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="row">\r\n\r\n        <div class="col-md-12" data-bind="visible:isDesktop">\r\n\r\n            <div data-control-grid="actionLogGrid" class="inline-spacing"></div>\r\n\r\n            \x3c!-- kendo details template used by action grid --\x3e\r\n            <script data-id="commentDetailTemplate" type="text/kendo-tmpl">\r\n                <p name="CommentBoxDetail" class="action-log-comment">#=app.lib.decodeHTML(DescriptionDisplay)#</p>\r\n            <\/script>\r\n        </div>\r\n        <div data-bind="visible:isMobile">\r\n            <div data-role="listview" data-bind="source: actionLogSource" data-template="action-log-grid-mobile-template" class="action-log-mobile-grid "></div>\r\n            <script type="text/x-kendo-template" id="action-log-grid-mobile-template">\r\n                <div class="col-md-12 action-log-info">\r\n                    <div class="row">\r\n                        <div class="col-xs-2 action-log-icon">\r\n                            <img src="#:data.Image#" alt="#:data.Image#" />\r\n                        </div>\r\n                        <div class="col-xs-10 action-log-details">\r\n                            <p>\r\n                                #: EnteredBy # &middot; #: (EnteredDate) ? kendo.toString(new Date(EnteredDate), \'d\'):\'\' #\r\n                            </p>\r\n                            <p> #: Title #</p>\r\n                        </div>\r\n                    </div>\r\n                    <div class="row">\r\n                        <div class="col-xs-offset-2 col-xs-10 action-log-content">\r\n                            #: Description #\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            <\/script>\r\n        </div>\r\n    </div>\r\n</div>'}),define("forms/predefined/actionLog/controller",["require","text!forms/predefined/actionLog/view.html"],function(e){var t=e("text!forms/predefined/actionLog/view.html");return{template:t,build:function(e,i,n){var a=_.template(t),o={Disabled:i.disabled};$.extend(!0,o,i),n(a(o))}}}),define("text!forms/predefined/fileAttachments/view.html",[],function(){return'<div class="row">\r\n    <div class="col-md-12 fileAttachmentGrid" data-control="fileAttachmentGrid" data-control-bind="FileAttachment"\r\n\r\n        <% if ( Disabled ){ %>\r\n        disabled\r\n        <% } %>\r\n\r\n        >\r\n    </div>\r\n</div>\r\n'}),define("forms/predefined/fileAttachments/controller",["require","text!forms/predefined/fileAttachments/view.html"],function(e){var t=e("text!forms/predefined/fileAttachments/view.html");return{template:t,build:function(e,i,n){var a=_.template(t);!_.isUndefined(localization[i.name])&&[i.name].length>0&&(i.name=localization[i.name]);var o={Disabled:i.disabled};$.extend(!0,o,i),n(a(o))}}}),define("text!forms/predefined/affectedItems/view.html",[],function(){return'<div data-bind="templateResources:\'resources\'" style="display:none">\r\n    <div data-template-name="mobileGridTemplate" class="">\r\n        \x3c!-- repeated template content here --\x3e\r\n        <div class="gridcard gridcard--form">\r\n            <p class="gridcard__title">#: DisplayName #</p>\r\n            <div class="gridcard__detailblock">\r\n                <p>#: (typeof AssetStatus!="undefined") ? !_.isUndefined(AssetStatus.Name)?AssetStatus.Name:"" : "" #</p>\r\n                <p>#: (Path!=null ) ? Path : "" # </p>\r\n\r\n            </div>\r\n            <div class="gridcard__detailblock hidden-print" data-bind="visible: view.affectedItemController.showAddRemoveButtons">\r\n                <a class="k-delete-button">#: localization.Remove #</a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="row">\r\n    <div class="col-md-12 affecteditems-grid">\r\n        <div class="row hidden-print" data-bind="visible: view.affectedItemController.showAddRemoveButtons">\r\n            <div class="col-md-6">\r\n                <div class="form-group">\r\n                    <label class="control-label"><%= localization.Configurationitem %></label>\r\n                    <div class="two-action-input-group">\r\n                        <input data-role="combobox" class="search-combo"\r\n                               data-placeholder="<%= localization.ChooseOne %>"\r\n                               data-value-primitive="true"\r\n                               data-text-field="Text"\r\n                               data-value-field="Value"\r\n                               data-filter="contains"\r\n                               data-auto-bind="false"\r\n                               data-min-length="3"\r\n                               data-bind="value: view.affectedItemController.selectedConfigItem, source: view.affectedItemController.configItemDataSource, events:{change:view.affectedItemController.onConfigItemChange }"\r\n                               data-cid="ci-searchbox" <% if ( Disabled ){ %> disabled <% } %>/>\r\n                        <span class="search"\r\n                              data-bind="events:{click: view.affectedItemController.searchConfigItem}"\r\n                              data-cid="affecteditemssearchicon" >\r\n                            <i class="fa fa-search" ></i>\r\n                        </span>\r\n                        <button data-role="button" class="search-button two-action-input-group__primary-action"\r\n                                data-bind="events:{click: view.affectedItemController.addConfigItem}"\r\n                                data-cid="affectedItemsSearchBoxAddButton"  <% if ( Disabled ){ %> disabled <% } %>>\r\n                            <%= localization.Add %>\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="col-md-6">\r\n                <div class="form-group affected-user-item-search" data-bind="visible: view.affectedItemController.isUserCIVisible">\r\n                    <label class="control-label"><%= localization.AffectedUserItems %></label>\r\n                    <div class="two-action-input-group">\r\n                        <input data-role="combobox" class="search-combo"\r\n                               data-placeholder="<%= localization.ChooseOne %>"\r\n                               data-value-primitive="true"\r\n                               data-text-field="Text"\r\n                               data-value-field="Value"\r\n                               data-filter="contains"\r\n                               data-auto-bind="false"\r\n                               data-bind="value: view.affectedItemController.selectedUserConfigItem, source: view.affectedItemController.userConfigItemDataSource, events:{change:view.affectedItemController.onUserConfigItemChange }"\r\n                               data-cid="auitems-searchbox" <% if ( Disabled ){ %> disabled <% } %> />\r\n                        <button class="two-action-input-group__primary-action" data-role="button"\r\n                                data-bind="events:{click: view.affectedItemController.addUserConfigItem}"\r\n                                data-cid="affectedItemsComboBoxAddButton" <% if ( Disabled ){ %> disabled <% } %>>\r\n                            <%= localization.Add %>\r\n\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div data-role="grid"\r\n             data-bind="visible: view.affectedItemController.isDesktopView, source: view.affectedItemController.dataSource, events:{dataBinding: view.affectedItemController.onDataBinding}"\r\n             data-selectable="false"\r\n             data-sortable="true"\r\n             data-filterable="true"\r\n             data-scrollable="false"\r\n             data-column-menu="true"\r\n             data-pageable="false"\r\n             data-editable="{mode: \'incell\', create: false, update: false}"\r\n             data-columns=\'[\r\n                    { title: "", width: "1%", template: "\\u003cdiv data-base-id=\\"#=BaseId#\\" base-type=\\"#=BaseType#\\" class=\\"aci-context-menu open-modal pull-right\\" data-bind=\\"visible: view.affectedItemController.isSlideOut\\"\\u003e\\u003ci class=\\"fa fa-info-circle\\"\\u003e\\u003c/i\\u003e\\u003c/div\\u003e\\u003cdiv class=\\"open-modal pull-right\\" data-bind=\\"visible: view.affectedItemController.isMoreInfo, events:{click:view.affectedItemController.showMoreInfo }\\"\\u003e\\u003ci class=\\"fa fa-info-circle\\"/\\u003e\\u003c/i\\u003e\\u003c/div\\u003e"},\r\n                    { field: "DisplayName", title: localization.DisplayName, width: "50%", attributes:{class: (app.featureSet.isActive("CMDBPortalCI")) ? "grid-highlight-column" : ""}, template: "# if \\u0028app.featureSet.isActive\\u0028\\u0022CMDBPortalCI\\u0022\\u0029\\u0029 \\u007b # \\u003ca target=\\u0027_blank\\u0027 href=\\u0027#var url = app.gridUtils.getObjectLinkUrl\\u0028data\\u0029;##=url#\\u0027\\u003e#: DisplayName # \\u003c/a\\u003e\\u003cspan class=\\u0027pull-right relatedItems-grid-links\\u0027\\u003e\\u003ca class=\\u0027highlight-default-icon\\u0027 target=\\u0027_blank\\u0027 href=\\u0027#var url = app.gridUtils.getObjectLinkUrl\\u0028data\\u0029;##=url#\\u0027\\u003e\\u003ci class=\\u0027fa fa fa-external-link\\u0027\\u003e\\u003c/i\\u003e\\u003c/a\\u003e\\u003c/span\\u003e #\\u007d else \\u007b# #: DisplayName # # \\u007d#"},\r\n                    { field: "BaseId", title: localization.BaseId, width: "25%", hidden: true },\r\n                    { field: "Path", title: localization.Path, width: "25%" },\r\n                    { field: "AssetStatus.Name", title: localization.Status, width: "25%" },\r\n                    { title: localization.Actions, width: "15%", command: [{ name: "destroy", buttonType: "ImageAndText", text: localization.Remove, className:"custom__grid-remove"}]}\r\n                ]\'>\r\n        </div>\r\n        <div data-bind="visible: view.affectedItemController.isMobileView">\r\n            <div data-bind="mobileGrid: HasRelatedWorkItems" data-template-name="mobileGridTemplate" class="mobile-grid-parent"></div>\r\n        </div>\r\n        \x3c!--context menu for info icon--\x3e\r\n        <ul id="tccmenu" data-role="contextmenu"\r\n            data-filter=".aci-context-menu"\r\n            data-show-on="click"\r\n            data-bind="events:{select:view.affectedItemController.onContextmenuSelect, activate:view.affectedItemController.onContextmenuActivate}">\r\n        </ul>\r\n   </div>\r\n</div>'}),define("forms/predefined/affectedItems/controller",["require","text!forms/predefined/affectedItems/view.html","forms/popups/multipleObjectPickerPopup/controller"],function(e){var t=e("text!forms/predefined/affectedItems/view.html"),i=e("forms/popups/multipleObjectPickerPopup/controller");return{template:t,build:function(e,n,a){var o=_.template(t),r={Disabled:!_.isUndefined(n.disabled)&&n.disabled};$.extend(!0,r,n);var l=(new kendo.View,!1);_.isUndefined(e.HasRelatedWorkItems)&&e.set("HasRelatedWorkItems",new kendo.data.ObservableArray([]));var s=e.get("HasRelatedWorkItems");e.view.affectedItemController=new kendo.observable({showAddRemoveButtons:!r.Disabled,addConfigItem:function(e){_.isUndefined(this.selectedConfigItemId)||p(this.selectedConfigItemId)},searchConfigItem:function(){var e=i.getPopup("62F0BE9F-ECEA-E73C-F00D-3DD78A7422FC","DisplayName,Path,Status",null,null,!0);e.setSaveCallback(function(e){p(e.BaseId)}),e.open()},selectedConfigItemId:"",selectedConfigItem:"",configItemDataSource:new kendo.data.DataSource({serverFiltering:!0,transport:{read:{url:function(e){return"/api/V3/Config/GetAffectedItemsList?itemFilter="+(e.filter.filters.length>0?e.filter.filters[0].value:"")},dataType:"json"}}}),onConfigItemChange:function(e){var t=e.sender.dataItem(e.sender.selectedIndex);_.isUndefined(t)||(this.selectedConfigItemId=t.Id)},isUserCIVisible:!_.isUndefined(e.RequestedWorkItem),selectedUserConfigItemId:"",selectedUserConfigItem:"",addUserConfigItem:function(e){_.isUndefined(this.selectedUserConfigItemId)||p(this.selectedUserConfigItemId)},userConfigItemDataSource:new kendo.data.DataSource({serverFiltering:!0,transport:{read:{url:"/ConfigItems/GetAffectedUserConfigItemsList",data:{affectedUserId:function(){return _.isUndefined(e.RequestedWorkItem)||_.isNull(e.RequestedWorkItem.BaseId)?"":e.RequestedWorkItem.BaseId}},dataType:"json",type:"GET"},parameterMap:function(e){var t=e.filter&&e.filter.filters.length>0?e.filter.filters[0].value:"";return _.extend(e,{searchFilter:t})}}}),onUserConfigItemChange:function(e){var t=e.sender.dataItem(e.sender.selectedIndex);_.isUndefined(t)||(this.selectedUserConfigItemId=t.Id)},dataSource:new kendo.data.DataSource({schema:{data:"Data",total:"Total",errors:"Errors",model:{id:"BaseId"}},data:{Data:s,Total:s.length}}),showMoreInfo:function(e){var t=$("<div>");t.appendTo("body");var i=t.kendoCiresonWindow({title:"",width:550,height:500,actions:["Close"]}).data("kendoWindow"),n=null,a="";null==e.data&&null!=e.BaseId?(n=e.BaseId,a=e.DisplayName):(n=e.data.BaseId,a=e.data.DisplayName),i.refresh({url:"/Search/ObjectViewer",data:{id:n}}),t.find(".k-content").html("<div style='padding: 55px'>Loading...</div>"),i.title(a).center().open()},onDataBinding:function(t){l=t.sender.table,_.each(s,function(e){e.AssetStatus=_.isUndefined(e.AssetStatus)||_.isNull(e.AssetStatus)?{Id:null,Name:null}:e.AssetStatus,e.Status=_.isUndefined(e.Status)||_.isNull(e.Status)?{Id:null,Name:null}:e.Status}),e.view.affectedItemController.showAddRemoveButtons||t.sender.hideColumn(5)},isDesktopView:!app.isMobileDevice(),isMobileView:app.isMobileDevice(),isWindowsComputer:!1,isHardwareAsset:!1,isUser:!1,isMoreInfo:function(t){return!e.view.affectedItemController.isSlideOut(t)},isSlideOut:function(t){e.view.affectedItemController.isWindowsComputer=!1,e.view.affectedItemController.isHardwareAsset=!1,e.view.affectedItemController.isUser=!1,"computer"==t.BaseType?e.view.affectedItemController.isWindowsComputer=!0:"hardwareasset"==t.BaseType?e.view.affectedItemController.isHardwareAsset=!0:"user"==t.BaseType&&(e.view.affectedItemController.isUser=!0);var i=e.view.affectedItemController.isWindowsComputer,n=e.view.affectedItemController.isHardwareAsset,a=e.view.affectedItemController.isUser,o=!_.isNull(session.consoleSetting.TrueControlCenterURL)&&""!=session.consoleSetting.TrueControlCenterURL;return!!((i||a||n)&&o&&session.user.Analyst)},showTCCInfo:function(t){var i=session.consoleSetting.TrueControlCenterURL&&session.user.Analyst,n=e.view.affectedItemController.isWindowsComputer,a=e.view.affectedItemController.isHardwareAsset,o=e.view.affectedItemController.isUser,r=localization.ComputerManagement;if(n){i=app.slideOutNav.getTCCSourceURL(t,"computer");var l={url:i,tooltip:r};app.slideOutNav.show(l)}else if(a)$.get("/Search/GetHardwareAssetDevice",{id:t.BaseId},function(e){i=app.slideOutNav.getTCCSourceURL(e,"computer");var t={url:i,tooltip:r};app.slideOutNav.show(t)});else if(o){i=app.slideOutNav.getTCCSourceURL(t,"user"),r=localization.UserManagement;var l={url:i,tooltip:r};app.slideOutNav.show(l)}},onContextmenuSelect:function(t){var i=t.item.attributes.custom.value,n=t.target.attributes["data-base-id"].value,a=_.find(t.data.HasRelatedWorkItems,function(e){return e.BaseId==n});"slideout"==i?e.view.affectedItemController.showTCCInfo(a):e.view.affectedItemController.showMoreInfo(a)},onContextmenuActivate:function(t){var i=(t.target.attributes["data-base-id"].value,t.target.attributes["base-type"].value);e.view.affectedItemController.isWindowsComputer=!1,e.view.affectedItemController.isHardwareAsset=!1,e.view.affectedItemController.isUser=!1,"computer"==i?e.view.affectedItemController.isWindowsComputer=!0:"hardwareasset"==i?e.view.affectedItemController.isHardwareAsset=!0:"user"==i&&(e.view.affectedItemController.isUser=!0);var n=localization.UserManagement;(e.view.affectedItemController.isWindowsComputer||e.view.affectedItemController.isHardwareAsset)&&(n=localization.ComputerManagement);var a=[{text:n,imageUrl:"/Content/Images/Icons/Other/control-center-launcher.png",imageAttr:{height:"16px",width:"16px"},attr:{custom:"slideout"}},{text:"<i class='fa fa-info-circle cursor-pointer'></i>"+localization.AdditionalDetails,encoded:!1,attr:{custom:"info"}}];$("#tccmenu").data("kendoContextMenu").setOptions({dataSource:a})}});var d=e.view.affectedItemController;d.dataSource.originalFilter=d.dataSource.filter,d.dataSource.filter=function(){var e=d.dataSource.originalFilter.apply(this,arguments);return arguments.length>0&&this.trigger("filterApplied",arguments),e},d.dataSource.bind("filterApplied",function(){if($.each($(l).find("th a.k-header-column-menu i"),function(){$(this).remove()}),d.dataSource.filter()){var e=d.dataSource.filter().filters||[],t=[];for(var i in e)if(e[i].filters){var n=e[i].filters;for(var a in n)t.push(n[a])}else t.push(e[i]);t=_.uniq(t,function(e){return e.field});for(var i in t)$(l).find("th[data-field="+t[i].field+"] a.k-header-column-menu").append('<i class="fa fa-filter"></i>')}});var c=o(r);new kendo.View(c,{wrap:!0,model:e.view.affectedtemController}),a(c),e.view.affectedItemController.isUserCIVisible&&e.RequestedWorkItem.bind("change",function(t){e.view.affectedItemController.userConfigItemDataSource.read()});var u=function(e){var t=!1;return $.each(s,function(i,n){n.BaseId==e&&(t=!0)}),t},p=function(e){u(e)||$.getJSON("/ConfigItems/GetAffectedItem",{id:e},function(t){var i={BaseId:e,DisplayName:t.DisplayName,ClassName:t.ObjectClassName,Path:t.Path,BaseType:t.BaseType,AssetStatus:_.isUndefined(t.AssetStatus)?{Name:_.isUndefined(t.AssetStatus)?"":t.AssetStatus}:null!=t.AssetStatus?t.AssetStatus:"",Status:_.isUndefined(t.Status)?{Name:_.isUndefined(t.Status)?"":t.Status}:null!=t.Status?t.Status:""};s.push(i)})}}}}),define("text!forms/predefined/relatedItems/view.html",[],function(){
return'<div id="relatedItemTemplate" data-bind="templateResources:\'resources\'" style="display:none">\r\n    <div data-template-name="mobileGridTemplate" class="">\r\n        \x3c!-- repeated template content here --\x3e\r\n        <div class="gridcard gridcard--form">\r\n            <p class="gridcard__title">#: DisplayName #</p>\r\n            <div class="gridcard__detailblock">\r\n                <p>#: (typeof AssetStatus!="undefined") ? !_.isUndefined(AssetStatus.Name)?AssetStatus.Name:"" : "" #</p>\r\n                <p>#: (Path!=null ) ? Path : "" # </p>\r\n                \r\n            </div>\r\n            <div class="gridcard__detailblock hidden-print" data-bind="visible:view.relatedItemController.showAddRemoveButton">\r\n                <a class="k-delete-button">#: localization.Remove #</a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<div class="row">\r\n    <div class="col-md-12 relateditems-grid">\r\n        <div class="row hidden-print" data-bind="visible:view.relatedItemController.showAddRemoveButton">\r\n            <div class="col-md-6">\r\n                <div class="form-group">\r\n                    <label class="control-label"><%= localization.Configurationitem %></label>\r\n                    <div class="two-action-input-group">\r\n                        <input data-role="combobox" class="search-combo"\r\n                               data-placeholder="<%= localization.ChooseOne %>"\r\n                               data-value-primitive="true"\r\n                               data-text-field="Text"\r\n                               data-value-field="Value"\r\n                               data-filter="contains"\r\n                               data-auto-bind="false"\r\n                               data-bind="value: view.relatedItemController.selectedConfigItem, source: view.relatedItemController.configItemDataSource, events:{change:view.relatedItemController.onConfigItemChange }"\r\n                               <% if ( Disabled ){ %> disabled <% } %>/>\r\n\r\n                        <span data-bind="events:{click: view.relatedItemController.searchConfigItem}"\r\n                              data-cid="relatedItemsSearchIcon"\r\n                          <% if ( Disabled ){ %> disabled class="search search-disabled" <% } else{ %> class="search" <% } %>\r\n                          >\r\n                        <i class="fa fa-search"></i>\r\n                    </span>\r\n                        <button data-role="button" class="search-button two-action-input-group__primary-action"\r\n                                data-bind="events:{click: view.relatedItemController.addConfigItem}"\r\n                                data-cid="relatedItemSearchAddBbtn"\r\n                            <% if ( Disabled ){ %> disabled <% } %>\r\n                            >\r\n                        <%= localization.Add %>\r\n                    </button>\r\n                    </div>\r\n                 </div>\r\n            </div>\r\n            <div class="col-md-6">\r\n                <div class="form-group affected-user-item-search" data-bind="visible: view.relatedItemController.isUserCIVisible">\r\n                    <label class="control-label"><%= localization.AffectedUserItems %></label>\r\n                    <div class="two-action-input-group">\r\n                        <input data-role="combobox" class="search-combo"\r\n                               data-placeholder="<%= localization.ChooseOne %>"\r\n                               data-value-primitive="true"\r\n                               data-text-field="Text"\r\n                               data-value-field="Value"\r\n                               data-filter="contains"\r\n                               data-auto-bind="false"\r\n                               data-bind="value: view.relatedItemController.selectedUserConfigItem, source: view.relatedItemController.userConfigItemDataSource, events:{change:view.relatedItemController.onUserConfigItemChange }"\r\n                               data-cid="affectedItemsUserItemBox"\r\n                               <% if ( Disabled ){ %> disabled <% } %> />\r\n\r\n                        <button class="two-action-input-group__primary-action"\r\n                                data-role="button"\r\n                                data-bind="events:{click: view.relatedItemController.addUserConfigItem}"\r\n                            <% if ( Disabled ){ %> disabled <% } %>\r\n                            >\r\n                        <%= localization.Add %>\r\n                    </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div data-role="grid"\r\n             data-bind="visible: view.relatedItemController.isDesktopView, source: view.relatedItemController.dataSource, events:{dataBinding: view.relatedItemController.onDataBinding}"\r\n             data-selectable="false"\r\n             data-sortable="true"\r\n             data-filterable="true"\r\n             data-scrollable="false"\r\n             data-column-menu="true"\r\n             data-pageable="false"\r\n             data-editable="{mode: \'incell\', create: false, update: false}"\r\n             data-columns=\'[\r\n                    { title: "", width: "1%", template: "\\u003cdiv data-base-id=\\"#=BaseId#\\" base-type=\\"#=BaseType#\\" class=\\"ci-context-menu open-modal pull-right\\" data-bind=\\"visible: view.relatedItemController.isSlideOut\\"\\u003e\\u003ci class=\\"fa fa-info-circle\\"\\u003e\\u003c/i\\u003e\\u003c/div\\u003e\\u003cdiv class=\\"open-modal pull-right\\" data-bind=\\"visible: view.relatedItemController.isMoreInfo, events:{click:view.relatedItemController.showMoreInfo }\\"\\u003e\\u003ci class=\\"fa fa-info-circle\\"/\\u003e\\u003c/i\\u003e\\u003c/div\\u003e"},\r\n                    { field: "DisplayName", title: localization.DisplayName, width: "50%", attributes:{class: (app.featureSet.isActive("CMDBPortalCI")) ? "grid-highlight-column" : ""}, template: "# if \\u0028app.featureSet.isActive\\u0028\\u0022CMDBPortalCI\\u0022\\u0029\\u0029 \\u007b # \\u003ca target=\\u0027_blank\\u0027 href=\\u0027#var url = app.gridUtils.getObjectLinkUrl\\u0028data\\u0029;##=url#\\u0027\\u003e#: DisplayName # \\u003c/a\\u003e\\u003cspan class=\\u0027pull-right relatedItems-grid-links\\u0027\\u003e\\u003ca class=\\u0027highlight-default-icon\\u0027 target=\\u0027_blank\\u0027 href=\\u0027#var url = app.gridUtils.getObjectLinkUrl\\u0028data\\u0029;##=url#\\u0027\\u003e\\u003ci class=\\u0027fa fa fa-external-link\\u0027\\u003e\\u003c/i\\u003e\\u003c/a\\u003e\\u003c/span\\u003e #\\u007d else \\u007b# #: DisplayName # # \\u007d#"},\r\n                    { field: "BaseId", title: localization.BaseId, width: "25%", hidden: true },\r\n                    { field: "Path", title: localization.Path, width: "25%" },\r\n                    { field: "AssetStatus.Name", title: localization.Status, width: "25%" },\r\n                    { title: localization.Actions, width: "15%", command: [{ name: "destroy", buttonType: "ImageAndText", text: localization.Remove, className:"custom__grid-remove" }] }\r\n                ]\'>\r\n        </div>\r\n        <div data-bind="visible: view.relatedItemController.isMobileView">\r\n            <div data-bind="mobileGrid: RelatesToConfigItem" data-template-name="mobileGridTemplate" class="mobile-grid-parent"></div>\r\n        </div>\r\n        \x3c!--context menu for info icon--\x3e\r\n        <ul id="tccmenu-related-ci" data-role="contextmenu" \r\n            data-filter=".ci-context-menu"\r\n            data-show-on="click"\r\n            data-bind="events:{select:view.relatedItemController.onContextmenuSelect, activate:view.relatedItemController.onContextmenuActivate}">\r\n        </ul>\r\n    </div>\r\n</div>'}),define("forms/predefined/relatedItems/controller",["require","text!forms/predefined/relatedItems/view.html","forms/popups/multipleObjectPickerPopup/controller"],function(e){var t=e("text!forms/predefined/relatedItems/view.html"),i=e("forms/popups/multipleObjectPickerPopup/controller");return{template:t,build:function(e,n,a){var o=_.template(t),r={Disabled:!_.isUndefined(n.disabled)&&n.disabled};$.extend(!0,r,n);var l=new kendo.View,s=!1;_.isUndefined(e.RelatesToConfigItem)&&e.set("RelatesToConfigItem",new kendo.data.ObservableArray([]));var d=e.get("RelatesToConfigItem");e.view.relatedItemController=new kendo.observable({showAddRemoveButton:!r.Disabled,addConfigItem:function(e){_.isUndefined(this.selectedConfigItemId)||m(this.selectedConfigItemId)},searchConfigItem:function(){var e=i.getPopup("62F0BE9F-ECEA-E73C-F00D-3DD78A7422FC","DisplayName,Path,Status",null,null,!0);e.setSaveCallback(function(e){m(e.BaseId)}),e.open()},selectedConfigItemId:"",selectedConfigItem:"",configItemDataSource:new kendo.data.DataSource({serverFiltering:!0,transport:{read:{url:function(e){return"/api/V3/Config/GetAffectedItemsList?itemFilter="+(e.filter.filters.length>0?e.filter.filters[0].value:"")},dataType:"json"}}}),onConfigItemChange:function(e){var t=e.sender.dataItem(e.sender.selectedIndex);_.isUndefined(t)||(this.selectedConfigItemId=t.Id)},isUserCIVisible:!_.isUndefined(e.RequestedWorkItem),selectedUserConfigItemId:"",selectedUserConfigItem:"",addUserConfigItem:function(e){_.isUndefined(this.selectedUserConfigItemId)||m(this.selectedUserConfigItemId)},userConfigItemDataSource:new kendo.data.DataSource({serverFiltering:!0,transport:{read:{url:"/ConfigItems/GetAffectedUserConfigItemsList",data:{affectedUserId:function(){return _.isUndefined(e.RequestedWorkItem)||_.isNull(e.RequestedWorkItem.BaseId)?"":e.RequestedWorkItem.BaseId}},dataType:"json",type:"GET"},parameterMap:function(e){var t=e.filter&&e.filter.filters.length>0?e.filter.filters[0].value:"";return _.extend(e,{searchFilter:t})}}}),onUserConfigItemChange:function(e){var t=e.sender.dataItem(e.sender.selectedIndex);_.isUndefined(t)||(this.selectedUserConfigItemId=t.Id)},dataSource:new kendo.data.DataSource({schema:{data:"Data",total:"Total",errors:"Errors",model:{id:"BaseId"}},data:{Data:d,Total:d.length}}),showMoreInfo:function(e){var t=$("<div>");t.appendTo("body");var i=t.kendoCiresonWindow({title:"",width:550,height:500,actions:["Close"]}).data("kendoWindow"),n=null,a="";null==e.data&&null!=e.BaseId?(n=e.BaseId,a=e.DisplayName):(n=e.data.BaseId,a=e.data.DisplayName),i.refresh({url:"/Search/ObjectViewer",data:{id:n}}),t.find(".k-content").html("<div style='padding: 55px'>Loading...</div>"),i.title(a).center().open()},onDataBinding:function(t){s=t.sender.table,_.each(d,function(e){e.AssetStatus=_.isUndefined(e.AssetStatus)?{Id:null,Name:null}:e.AssetStatus,e.Status=_.isUndefined(e.Status)?{Id:null,Name:null}:e.Status}),e.view.relatedItemController.showAddRemoveButton||t.sender.hideColumn(5)},isDesktopView:!app.isMobileDevice(),isMobileView:app.isMobileDevice(),isEnabled:!r.Disabled,isWindowsComputer:!1,isHardwareAsset:!1,isUser:!1,isMoreInfo:function(t){return!e.view.relatedItemController.isSlideOut(t)},isSlideOut:function(t){e.view.relatedItemController.isWindowsComputer=!1,e.view.relatedItemController.isHardwareAsset=!1,e.view.relatedItemController.isUser=!1,"computer"==t.BaseType?e.view.relatedItemController.isWindowsComputer=!0:"hardwareasset"==t.BaseType?e.view.relatedItemController.isHardwareAsset=!0:"user"==t.BaseType&&(e.view.relatedItemController.isUser=!0);var i=e.view.relatedItemController.isWindowsComputer,n=e.view.relatedItemController.isHardwareAsset,a=e.view.relatedItemController.isUser,o=!_.isNull(session.consoleSetting.TrueControlCenterURL)&&""!=session.consoleSetting.TrueControlCenterURL;return!!((i||a||n)&&o&&session.user.Analyst)},showTCCInfo:function(t){var i=session.consoleSetting.TrueControlCenterURL&&session.user.Analyst,n=e.view.relatedItemController.isWindowsComputer,a=e.view.relatedItemController.isHardwareAsset,o=e.view.relatedItemController.isUser,r=localization.ComputerManagement;if(n){i=app.slideOutNav.getTCCSourceURL(t,"computer");var l={url:i,tooltip:r};app.slideOutNav.show(l)}else if(a)$.get("/Search/GetHardwareAssetDevice",{id:t.BaseId},function(e){i=app.slideOutNav.getTCCSourceURL(e,"computer");var t={url:i,tooltip:r};app.slideOutNav.show(t)});else if(o){i=app.slideOutNav.getTCCSourceURL(t,"user"),r=localization.UserManagement;var l={url:i,tooltip:r};app.slideOutNav.show(l)}},onContextmenuSelect:function(t){var i=t.item.attributes.custom.value,n=t.target.attributes["data-base-id"].value,a=_.find(t.data.RelatesToConfigItem,function(e){return e.BaseId==n});"slideout"==i?e.view.relatedItemController.showTCCInfo(a):e.view.relatedItemController.showMoreInfo(a)},onContextmenuActivate:function(t){var i=(t.target.attributes["data-base-id"].value,t.target.attributes["base-type"].value);e.view.relatedItemController.isWindowsComputer=!1,e.view.relatedItemController.isHardwareAsset=!1,e.view.relatedItemController.isUser=!1,"computer"==i?e.view.relatedItemController.isWindowsComputer=!0:"hardwareasset"==i?e.view.relatedItemController.isHardwareAsset=!0:"user"==i&&(e.view.relatedItemController.isUser=!0);var n=localization.UserManagement;(e.view.relatedItemController.isWindowsComputer||e.view.relatedItemController.isHardwareAsset)&&(n=localization.ComputerManagement);var a=[{text:n,imageUrl:"/Content/Images/Icons/Other/control-center-launcher.png",imageAttr:{height:"16px",width:"16px"},attr:{custom:"slideout"}},{text:"<i class='fa fa-info-circle cursor-pointer'></i>"+localization.AdditionalDetails,encoded:!1,attr:{custom:"info"}}];$("#tccmenu-related-ci").data("kendoContextMenu").setOptions({dataSource:a})}});var c=e.view.relatedItemController;c.dataSource.originalFilter=c.dataSource.filter,c.dataSource.filter=function(){var e=c.dataSource.originalFilter.apply(this,arguments);return arguments.length>0&&this.trigger("filterApplied",arguments),e},c.dataSource.bind("filterApplied",function(e){if($.each($(s).find("th a.k-header-column-menu i"),function(){$(this).remove()}),c.dataSource.filter()){var t=c.dataSource.filter().filters||[],i=[];for(var n in t)if(t[n].filters){var a=t[n].filters;for(var o in a)i.push(a[o])}else i.push(t[n]);i=_.uniq(i,function(e){return e.field});for(var n in i)$(s).find("th[data-field="+i[n].field+"] a.k-header-column-menu").append('<i class="fa fa-filter"></i>')}});var u=o(r);if(l=new kendo.View(u,{wrap:!0,model:e.view.relatedItemController}),a(u),r.Disabled){$(l.content).find(".search").addClass("search-disabled")}e.view.relatedItemController.isUserCIVisible&&e.RequestedWorkItem.bind("change",function(t){e.view.relatedItemController.userConfigItemDataSource.read()});var p=function(e){var t=!1;return $.each(d,function(i,n){n.BaseId==e&&(t=!0)}),t},m=function(e){p(e)||$.getJSON("/ConfigItems/GetAffectedItem",{id:e},function(t){var i={BaseId:e,DisplayName:t.DisplayName,ClassName:t.ObjectClassName,Path:t.Path,BaseType:t.BaseType,AssetStatus:_.isUndefined(t.AssetStatus)?{Name:_.isUndefined(t.AssetStatus)?"":t.AssetStatus}:null!=t.AssetStatus?t.AssetStatus:"",Status:_.isUndefined(t.Status)?{Name:_.isUndefined(t.Status)?"":t.Status}:null!=t.Status?t.Status:""};d.push(i)})}}}}),define("text!forms/predefined/childWorkItems/view.html",[],function(){return'<div data-bind="templateResources:\'resources\'" style="display:none">\r\n    <div data-template-name="mobileGridTemplate" class="mobile-grid">\r\n        \x3c!-- repeated template content here --\x3e\r\n        <div class="gridcard gridcard--form">\r\n            <p class="gridcard__title">${Id}: ${Title}</p>\r\n            <div class="gridcard__detailblock">\r\n                <p>#: localizationHelper.localize("Status") #: #: Status # </p>\r\n                <p>#: localizationHelper.localize("LastModified") #: #: kendo.toString(kendo.parseDate(LastModified), "g") # </p>\r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n</div>\r\n<div class="row">\r\n    <div class="col-md-12 file-attachments"\r\n         data-control="childWorkItems"\r\n         data-control-bind="ChildWorkItem"\r\n         data-control-show="IsParent"\r\n        <% if ( Disabled ){ %>\r\n        disabled\r\n        <% } %>>\r\n\r\n    <div >\r\n        <button class="btn btn-primary hidden-print" data-role="button" data-click="addClick"><%= localization.Add %> </button>\r\n    </div>\r\n    \r\n    <% if ( IsMobileView == false ){ %>\r\n        <div data-control-grid="objectGrid" class="inline-spacing"></div>\r\n    <% } %>\r\n    \r\n    <% if ( IsMobileView ){ %>\r\n        <div data-template-name="mobileGridTemplate" class="mobile-grid-parent" data-bind="mobileGrid: ChildWorkItem"></div>\r\n    <% } %>\r\n    \r\n    </div>\r\n</div>\r\n'}),define("forms/predefined/childWorkItems/controller",["require","text!forms/predefined/childWorkItems/view.html","forms/popups/multipleObjectPickerPopup/controller"],function(e){var t=e("text!forms/predefined/childWorkItems/view.html"),i=e("forms/popups/multipleObjectPickerPopup/controller"),n=function(e,t,i,n,a){_.isUndefined(t[i])&&t.set(i,new kendo.data.ObservableArray([]));var o=t.get(i),r=function(){},l=function(){var t={addClick:function(){a.setSaveCallback(function(e){d(e.BaseId)||o.push(e)}),a.open()}};e.find("[data-click]").each(function(){t[$(this).attr("data-click")]&&$(this).click(t[$(this).attr("data-click")])})},s=function(){var t=e.find("[data-control-grid]"),i=t.kendoGrid({columns:[{field:"Id",title:localization.Id,attributes:{class:"grid-highlight-column"}},{field:"Title",title:localization.Title},{field:"Status",title:localization.Status,template:"#= (Status.Name)?Status.Name:Status #"},{field:"LastModified",title:localization.LastModified,type:"date",template:"#= (LastModified) ? kendo.toString(new Date(LastModified), 'g'):'' #"},{field:"BaseId",title:"BaseId",hidden:"true"},{width:"105px",command:[{name:"destroy",text:localization.Remove}]}],scrollable:!1,filterable:{extra:!1,messages:{info:localization.Showitemswithvaluethat,and:localization.And,or:localization.Or,filter:localization.Filter,clear:localization.Clear},operators:{string:{startswith:localization.Startswith,contains:localization.Contains,eq:localization.Isequalto,neq:localization.Isnotequalto},date:{gte:localization.GreaterOrEqual,gt:localization.GreaterThan,lte:localization.LessOrEqual,lt:localization.LessThan}}},reorderable:!0,sortable:!0,columnMenu:{messages:{columns:localization.ChooseColumns,filter:localization.Filter,sortAscending:localization.SortAscending,sortDescending:localization.SortDescending}},editable:{confirmDelete:"Delete",cancelDelete:"Cancel",mode:"incell",template:null,create:!0,update:!1,destroy:!0},toolbar:{},dataSource:{transport:{prefix:"",read:{url:""}},type:"aspnetmvc-ajax",schema:{data:"Data",total:"Total",errors:"Errors",model:{id:"BaseId"}},data:{Data:o,Total:o.length}},selectable:!0});t.on("click","td",function(e){if($(e.currentTarget).hasClass("grid-highlight-column")){var t=i.data("kendoGrid"),n=t.dataItem($(e.currentTarget).closest("tr")),a=n.ClassName.split(/[\s.]+/),o=a[a.length-1];window.open("/"+o+"/Edit/"+n.Id+"/","_blank")}})},d=function(e){var t=!1;return $.each(o,function(i,n){n.BaseId==e&&(t=!0)}),t};!function(){l(),r(),s()}()};return{template:t,build:function(e,a,o){boundObj=e;var r={Disabled:!1,PropertyName:"ChildWorkItem",ClassId:"System.WorkItem.ReleaseRecord"===e.ClassName?"d02dc3b6-d709-46f8-cb72-452fa5e082b8":"a604b942-4c7b-2fb2-28dc-61dc6f465c68",PropertyToDisplay:"Id,Title,Status,LastModified",ControllerUrl:"/Search/GetChildWorkItems",IsMobileView:app.isMobileDevice()};$.extend(!0,r,a);var l=_.template(t),s=$(l(r)),d=i.getPopup(r.ClassId,r.PropertyToDisplay,r.ControllerUrl),c=(new n(s.find("[data-control='childWorkItems']"),boundObj,r.PropertyName,r,d),s.find("[data-control='childWorkItems']").attr("data-control-show"));s.find("[data-control='childWorkItems']").attr("data-control","childWorkItemsBound"),o(s),(!1===boundObj[c]||_.isNull(boundObj[c]))&&s.parents(".row").hide()}}}),define("text!forms/predefined/userInput/view.html",[],function(){return'<div>\r\n    <div class="editor-label">\r\n        <label><%= localization.UserInputs %></label>\r\n    </div>\r\n    <div class="editor-field">\r\n        <div data-control="userInputs" data-control-bind="UserInput">\r\n            <div data-control-grid="userInputsGrid" class="inline-spacing"></div>\r\n        </div>    \r\n    </div>\r\n</div>\r\n'}),define("forms/predefined/userInput/controller",["require","text!forms/predefined/userInput/view.html"],function(e){var t=e("text!forms/predefined/userInput/view.html");return{template:t,build:function(e,i,n){n(_.template(t)(i))}}}),define("text!forms/predefined/activities/view.html",[],function(){return'<div data-control="activityDisplay" data-control-bind="Activity" class="activity-list-container"\r\n\r\n    <% if ( Disabled ){ %>\r\n    disabled\r\n    <% } %>\r\n\r\n    >\r\n</div>\r\n'}),define("forms/predefined/activities/controller",["require","text!forms/predefined/activities/view.html"],function(e){var t=e("text!forms/predefined/activities/view.html");return{template:t,build:function(e,i,n){var a=_.template(t),o={Disabled:i.disabled};$.extend(!0,o,i),n(a(o))}}}),define("text!forms/predefined/multipleObjectPicker/view.html",[],function(){return'<div data-bind="templateResources:\'resources\'" style="display:none">\r\n    <div data-template-name="mobileGridTemplate" class="">\r\n        \x3c!-- repeated template content here --\x3e\r\n        <div class="gridcard gridcard--form">\r\n            <p class="gridcard__title">${title}</p>\r\n            <div class="gridcard__detailblock">\r\n                # $.each(details, function (index, item) {\r\n                # <p>${item}</p>  #\r\n                });\r\n                #\r\n            </div>\r\n        </div>\r\n        \r\n    </div>\r\n</div>\r\n<div class="row">\r\n    <div class="col-md-12">\r\n    <div data-control="multipleObjectPicker"\r\n         data-control-bind="HasRelatedWorkItems"\r\n         id="<%= PropertyName %>"\r\n        <% if ( Disabled ){ %>\r\n        disabled\r\n    <% } %>\r\n    >\r\n\r\n        <button data-role="button" class="btn btn-primary hidden-print" data-click="addClick" ><%= localization.Add %> </button>\r\n        <div class="grid-container">\r\n            <% if ( IsMobileView == false ){ %>\r\n            <div data-control-grid="objectGrid" class="inline-spacing"></div>\r\n            <% } %>\r\n\r\n            <% if ( IsMobileView ){ %>\r\n            <div data-template-name="mobileGridTemplate" class="mobile-grid-parent" data-bind="mobileGrid: <%= PropertyName %>" multiple-picker data-columns="<%= ClassProperties %>"></div>\r\n            <% } %>\r\n        </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("forms/predefined/multipleObjectPicker/controller",["require","text!forms/predefined/multipleObjectPicker/view.html","forms/popups/multipleObjectPickerPopup/controller"],function(e){var t=e("text!forms/predefined/multipleObjectPicker/view.html"),i=e("forms/popups/multipleObjectPickerPopup/controller"),n={template:t,Grid:null,build:function(e,n,o){boundObj=n.vm,name=n.PropertyName,!_.isUndefined(localization[n.name])&&[n.name].length>0&&(n.name=localization[n.name]);var r={Disabled:!1,ClassId:"",PropertyToDisplay:[],PropertyName:"",ShowAddButton:!0,ShowRemoveButton:!0,Scoped:!1,ClassProperties:"",SelectableRow:!1,SelectProperty:"Id",ProjectionId:"",HiddenProperty:null,IsMobileView:app.isMobileDevice()};$.extend(!0,r,n),this.Disabled=!1,this.PropertyToDisplay=[];try{r.PropertyToDisplay=JSON.parse(r.PropertyToDisplay)}catch(e){}r.PropertyToDisplay.length<=0&&(r.PropertyToDisplay={DisplayName:"DisplayName",Path:"Path",Status:"Status"});for(var l in r.PropertyToDisplay)r.ClassProperties=r.ClassProperties.concat(l).concat(",");"HasRelatedWorkItems"===r.PropertyName&&r.ClassProperties.indexOf("AssetStatus")<0&&(r.ClassProperties=r.ClassProperties.concat("AssetStatus")),_.isNull(r.HiddenProperty)||(r.ClassProperties+=r.HiddenProperty.concat(",")),"WatchList"===r.PropertyName&&(session.consoleSetting.DashboardsLicense.IsValid&&session.enableWatchlist||(r.Visible=!1),session.user.Analyst||void 0===boundObj.RequestedWorkItem||session.user.Id==boundObj.RequestedWorkItem.BaseId||(r.ShowAddButton=!1,r.ShowRemoveButton=!1));var s=_.template(t),d=$(s(r)),c={field:"BaseId",operator:"neq",value:boundObj.BaseId},u="RelatesToWorkItem"===r.PropertyName?i.getPopup(r.ClassId,r.ClassProperties,null,c):i.getPopup(r.ClassId,r.ClassProperties);new a(d.find("[data-control='multipleObjectPicker']"),boundObj,name,r,u);return d.find("[data-control='multipleObjectPicker']").attr("data-control","multipleObjectPickerBound"),o(d),this.Grid},openObject:function(e){window.open(app.gridUtils.getObjectLinkUrl(e),"_blank")}},a=function(e,t,i,a,o){_.isUndefined(t[i])&&t.set(i,new kendo.data.ObservableArray([]));var r=_.isUndefined(t[i].length)?new kendo.data.ObservableArray([t.get(i)]):t.get(i);r.properties=a;var l=function(){var e=[];for(var t in a.PropertyToDisplay){var i=t.split(".");i.length>1&&e.push(i)}_.each(r,function(t){_.each(e,function(e){var i=e[0],n=e[1];_.isUndefined(t[i])&&(t[i]={},t[i][n]="")})})};r.addItem=function(e){if(!c(e.BaseId))if(_boundArray=this,_.isUndefined(_boundArray.properties.ProjectionId)||_.isNull(_boundArray.properties.ProjectionId)||""==_boundArray.properties.ProjectionId)_boundArray.push(e);else{var t="",i=[];for(var n in _boundArray.properties.PropertyToDisplay){var a=n.split(".");a.length>1&&(i.push(a),t=""==t?n:t+","+n)}$.post("/Search/GetObjectProjectionByCriteria",{baseId:e.BaseId,projectionId:_boundArray.properties.ProjectionId,columnNames:t},function(t){for(index in t.Data)for(propIndex in i){var n=t.Data[index][i[propIndex][0]];_.isUndefined(n[i[propIndex][1]])||(e[i[propIndex][0]]=n)}_boundArray.push(e)})}};var s=function(){var n={addClick:function(){o.setSaveCallback(function(e){for(var n in a.PropertyToDisplay)_.isUndefined(e[n])&&(e[n]=null);r.addItem(e),_.isUndefined(t[i].length)&&(r.shift(),t.set(i,r[0]))}),o.open()}};e.find("[data-click]").each(function(){n[$(this).attr("data-click")]&&$(this).click(n[$(this).attr("data-click")])}),(!a.ShowAddButton||a.Disabled||a.vm.isDisabled)&&e.find("[data-click]").each(function(){$(this).hide()})},d=function(){var t=e.find("[data-control-grid]"),i="WatchList"!==a.PropertyName&&(!a.ShowRemoveButton||a.Disabled||a.vm.isDisabled),o=f(a.PropertyToDisplay),l=u(o,i),s=t.kendoGrid({columns:l,scrollable:!1,filterable:{extra:!1,messages:{info:localization.Showitemswithvaluethat,and:localization.And,or:localization.Or,filter:localization.Filter,clear:localization.Clear},operators:{string:{startswith:localization.Startswith,contains:localization.Contains,eq:localization.Isequalto,neq:localization.Isnotequalto},date:{gte:localization.GreaterOrEqual,gt:localization.GreaterThan,lte:localization.LessOrEqual,lt:localization.LessThan}}},reorderable:!0,sortable:!0,columnMenu:{messages:{columns:localization.ChooseColumns,filter:localization.Filter,sortAscending:localization.SortAscending,sortDescending:localization.SortDescending}},editable:{confirmDelete:"Delete",cancelDelete:"Cancel",mode:"incell",template:null,create:!0,update:!1,destroy:!0},toolbar:{},dataSource:{transport:{prefix:"",read:{url:""}},type:"aspnetmvc-ajax",schema:{data:"Data",total:"Total",errors:"Errors",model:{id:"BaseId",fields:o}},data:{Data:r,Total:r.length}},dataBinding:function(e){!_.isUndefined(e.items)&&e.items.length>0&&p(e,a.ClassProperties)},dataBound:function(e){a.Scoped&&m(this,a.ClassId,a.ClassProperties)},selectable:!!a.SelectableRow&&"multiple row"});n.Grid=s,app.isMobile()||(s.data("kendoGrid").dataSource.originalFilter=s.data("kendoGrid").dataSource.filter,s.data("kendoGrid").dataSource.filter=function(){var e=s.data("kendoGrid").dataSource.originalFilter.apply(this,arguments);return arguments.length>0&&this.trigger("filterApplied",arguments),e},s.data("kendoGrid").dataSource.bind("filterApplied",function(){if($.each($(s).find("th a.k-header-column-menu i"),function(){$(this).remove()}),s.data("kendoGrid").dataSource.filter()){var e=s.data("kendoGrid").dataSource.filter().filters||[];for(var t in e)$(s).find("th[data-field="+e[t].field+"] a.k-header-column-menu").append('<i class="fa fa-filter"></i>')}}))},c=function(e){var t=!1;return $.each(r,function(i,n){n.BaseId==e&&(t=!0)}),t},u=function(e,t){var i=[];for(var n in a.PropertyToDisplay){var o=n,r=a.PropertyToDisplay[n],l=!_.isUndefined(localization[r])&&[r].length>0?localization[r]:r,s=a.SelectableRow&&o===a.SelectProperty?"grid-highlight-column":"",d="date"==e[o].type?"#= ("+o+") ? kendo.toString(new Date("+o+"), kendo.culture().calendar.patterns.g) : '' #":"#= ("+o+") ? "+o+" : '' #",c=a.SelectableRow&&o===a.SelectProperty?"<a target='_blank' href='#var url = app.gridUtils.getObjectLinkUrl(data);##=url#'> "+d+" </a><span class='pull-right relatedItems-grid-links'><a class='highlight-default-icon' target='_blank' href='#var url = app.gridUtils.getObjectLinkUrl(data);##=url#'><i class='fa fa fa-external-link'></i></a></span>":d;i.push({title:l,width:"210px",field:o,filterable:{},encoded:!0,attributes:{class:s},template:c})}return i.push({title:localization.BaseId,width:"210px",field:"BaseId",filterable:{},encoded:!0,hidden:!0}),i.push({width:"105px",command:[{name:"destroy",text:localization.Remove}],hidden:t}),i},p=function(e,t){var i=e.items[0];$.each(t.split(","),function(t,n){$.each(r,function(t,a){if(n.indexOf(".")>0){var o=n.split(".")[0];if(_.isUndefined(a[o]))if(2===n.split(".").length)r[t][o]={Id:"",Name:""};else{var l="";$.each(n.split(".").reverse(),function(e,t){l=0===e?'{"'+t+'":'+a[n]+"}":'{"'+t+'":'+l+"}"}),r[t]=$.extend(r[t],JSON.parse(l))}}i.BaseId!=a.BaseId&&"add"==e.action||_.isUndefined(a[n])||_.isNull(a[n])||_.isBoolean(a[n])||_.isNumber(a[n])||_.isUndefined(a[n].Name)||(r[t][n]=a[n].Name)})})},m=function(e,t,i){""!==t&&$.ajax({url:"/Search/GetSearchObjectsByClassId",data:{searchFilter:"",classId:t,columnNames:i},async:!1,timeout:3e3,success:function(t){var i=[];$.each(t.Data,function(e,t){i.push(t.BaseId)}),$.each(e._data,function(t,n){if(!_.contains(i,this.BaseId)){e.tbody.find("tr[data-uid='"+this.uid+"']").hide()}})}})},f=function(e){var t={};for(var i in e)i.indexOf("Date")>-1||"LastModified"==i?t[i]={type:"date",parse:function(e){return _.isNull(e)||_.isUndefined(e)?"":new Date(e.toString().split(".")[0].concat("Z"))}}:t[i]={type:"string"};return t};!function(){l(),s(),d()}()};return n}),define("text!CustomSpace/Scripts/forms/predefined/history/view.html",[],function(){
return'<div id="historyController" data-role="historyController">\r\n  <div class="row">\r\n    <div class="col-md-12">\r\n      <div class="form-group">\r\n        <div class="input-group">\r\n          <div\r\n            id="showHistoryDropDown"\r\n            data-role="dropdownlist"\r\n            data-text-field="text"\r\n            data-value-field="value"\r\n            data-template="dropDownHistoryTemplate"\r\n            data-bind="source: dropDownDataSource, value: selectedDropDown"\r\n          ></div>\r\n          <span class="input-group-btn">\r\n            <button data-role="button" class="btn btn-primary k-button" data-bind="click: loadHistory">\r\n              <span class="fa cursor-pointer"></span><%= localizationHelper.localize(\'ShowHistory\', \'Show History\') %>\r\n            </button>\r\n          </span>\r\n        </div>\r\n      </div>\r\n      <div class="editor-label">\r\n        <label id="showHistoryTitle" data-bind="source: historyLabel" data-template="labelHistoryTemplate"></label>\r\n      </div>\r\n      <div id="historyView" data-bind="visible: showHistory"></div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n\x3c!--kendo templates--\x3e\r\n<script type="text/x-kendo-template" id="labelHistoryTemplate">\r\n  # if (typeof type !== \'undefined\') { #\r\n    # if (type == "loading") { #\r\n      <span class=\'k-icon k-loading\'></span>\r\n    # } else if (type == "error") { #\r\n      <span class=\'fa fa-warning\'></span> Unable to load history. Please try again.\r\n    # } else if (type == "info") { #\r\n      #: text #\r\n    # } #\r\n  # } #\r\n<\/script>\r\n<script type="text/x-kendo-template" id="dropDownHistoryTemplate">\r\n  <span style=\'white-space: pre;\'>#= data.text #</span>\r\n<\/script>\r\n<script type="text/x-kendo-template" id="viewHistoryTemplate">\r\n  <ul class=\'timeline\' data-template=\'propertyHistoryTemplate\' data-bind=\'source: timelineDataSource\'></ul>\r\n<\/script>\r\n<script type="text/x-kendo-template" id="propertyHistoryTemplate">\r\n  # if ((!_.isUndefined(ClassHistory) && ClassHistory.length > 0) || RelationshipHistory.length > 0) { #\r\n    <li>\r\n    # if (RelationshipHistory.length > 0) { #\r\n      <div class="timeline-badge primary">\r\n        <i class="fa fa-code-fork"></i>\r\n      </div>\r\n    # } else { #\r\n      <div class="timeline-badge">\r\n        <i class="fa"></i>\r\n      </div>\r\n    # } #\r\n      <div class="timeline-panel">\r\n        <div class="timeline-heading">\r\n          <a><h4 class="timeline-title">#: UserName #</h4></a>\r\n          <p><small class="text-muted"><i class="fa fa-clock-o"></i>#: kendo.toString(new Date(DateOccurred),\'g\') #</small></p>\r\n        </div>\r\n        <div class="timeline-body">\r\n          # if ((!_.isUndefined(ClassHistory) && ClassHistory.length > 0)) { #\r\n            <h5><%= localization.PropertyChanges %>:</h5>\r\n            <div class="table-responsive">\r\n              <table class="table">\r\n                <thead>\r\n                  <tr>\r\n                    <th><%= localization.Property %></th>\r\n                    <th><%= localization.OldValue %></th>\r\n                    <th><%= localization.NewValue %></th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  # for (var i = 0; i < ClassHistory.length; i++) { #\r\n                    <tr>\r\n                      <td>#: localizationHelper.localize(ClassHistory[i].Key.replace(/ /g,""), ClassHistory[i].Key) #</td>\r\n                      <td>#: ClassHistory[i].BeforeValue && ClassHistory[i].IsDate ? kendo.toString(new Date(ClassHistory[i].BeforeValue),\'g\') : localizationHelper.localize(ClassHistory[i].BeforeValue.replace(/ /g,""), ClassHistory[i].BeforeValue) #</td>\r\n                      <td>#: ClassHistory[i].AfterValue && ClassHistory[i].IsDate ? kendo.toString(new Date(ClassHistory[i].AfterValue),\'g\') : localizationHelper.localize(ClassHistory[i].AfterValue.replace(/ [0-9]/g,""), ClassHistory[i].AfterValue) #</td>\r\n                    </tr>\r\n                  # } #\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          # } #\r\n          # if (RelationshipHistory.length > 0) { #\r\n            <h5><%= localization.RelationshipChanges %>:</h5>\r\n            <div class="table-responsive">\r\n              <table class="table">\r\n                <thead>\r\n                  <tr>\r\n                    <th></th>\r\n                    <th><%= localization.RelationshipClass %></th>\r\n                    <th><%= localization.Item %></th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  # for (var i = 0; i < RelationshipHistory.length; i++) { #\r\n                    <tr>\r\n                      # if (RelationshipHistory[i].ChangeType === "Insert") { #\r\n                        <td><i class="fa fa-plus text-success"></i></td>\r\n                        <td>#: localizationHelper.localize(RelationshipHistory[i].RelationshipName.replace(/\\./g,". ").replace(/ /g,""), RelationshipHistory[i].RelationshipName.replace(/\\./g,". ")) #</td>\r\n                        <td>#: localizationHelper.localize(RelationshipHistory[i].Item.replace(/ /g,""), RelationshipHistory[i].Item) #</td>\r\n                      # } #\r\n\r\n                      # if (RelationshipHistory[i].ChangeType === "Delete") { #\r\n                        <td><i class="fa fa-minus text-danger"></i></td>\r\n                        <td>#: localizationHelper.localize(RelationshipHistory[i].RelationshipName.replace(/\\./g,". ").replace(/ /g,""), RelationshipHistory[i].RelationshipName.replace(/\\./g,". ")) #</td>\r\n                        <td>#: localizationHelper.localize(RelationshipHistory[i].Item.replace(/ /g,""), RelationshipHistory[i].Item) #</td>\r\n                      # } #\r\n\r\n                      # if (RelationshipHistory[i].ChangeType === "Update") { #\r\n                        <td><i class="fa fa-exchange text-info"></i></td>\r\n                        <td>#: localizationHelper.localize(RelationshipHistory[i].RelationshipName.replace(/\\./g,". ").replace(/ /g,""), RelationshipHistory[i].RelationshipName.replace(/\\./g,". ")) #</td>\r\n                        <td><strike class="text-danger">#: localizationHelper.localize(RelationshipHistory[i].PreviousItem.replace(/ /g,""), RelationshipHistory[i].PreviousItem) #</strike> <span class="text-success">#: localizationHelper.localize(RelationshipHistory[i].Item.replace(/ /g,""), RelationshipHistory[i].Item) #</span></td>\r\n                      # } #\r\n                    </tr>\r\n                  # } #\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          # } #\r\n        </div>\r\n      </div>\r\n    </li>\r\n  # } #\r\n  # for (var i = 0; i < ActionLogHistory.length; i++) { #\r\n    <li class="timeline-inverted">\r\n      <div class="timeline-badge info"><i class="fa fa-user"></i></div>\r\n      <div class="timeline-panel">\r\n        <div class="timeline-heading">\r\n          <h4 class="timeline-title">#: localizationHelper.localize(ActionLogHistory[i].EnteredBy.replace(/ /g,""), ActionLogHistory[i].EnteredBy) #</h4>\r\n          <p><small class="text-muted"><i class="fa fa-clock-o"></i> #: kendo.toString(new Date(DateOccurred),\'g\') #</small></p>\r\n        </div>\r\n        <div class="timeline-body">\r\n          <h5>#: localizationHelper.localize(ActionLogHistory[i].ActionType.replace(/ /g,""), ActionLogHistory[i].ActionType) #</h5>\r\n          <blockquote>#: localizationHelper.localize(ActionLogHistory[i].Description.replace(/ /g,""), ActionLogHistory[i].Description) #</blockquote>\r\n        </div>\r\n      </div>\r\n    </li>\r\n  # } #\r\n<\/script>\r\n'}),define("CustomSpace/Scripts/forms/predefined/history/controller",["text!CustomSpace/Scripts/forms/predefined/history/view.html"],function(e){"use strict";return{template:e,build:function(t,i,n){function a(){function e(t,n){n=n||"",i.push({text:n+t.Id+" - "+t.Title,value:t.BaseId}),void 0!==t.Activity&&t.Activity.length>0&&_.each(t.Activity,function(t){e(t,n+"    ")})}var i=[];return e(t),i}function o(e){return void 0!==e&&e.length>0}function r(){return d.dropdownQuery.value}function l(){!_.isUndefined(app.storage.custom)&&app.storage.custom.get("DEBUG_ENABLED")&&app.custom.utils.log("historyController:getHistoryViewModel");var e={historyLabel:{type:"info",text:""},showHistory:!1,dropdownQuery:{},dropDownDataSource:new kendo.data.DataSource({data:[{text:t.Id+" - "+t.Title,value:t.BaseId}]}),timelineDataSource:new kendo.data.DataSource({serverFiltering:!1,transport:{read:{url:"/Search/GetObjectHistory",data:{id:r},dataType:"json",type:"GET"}},filter:{logic:"or",filters:[{field:"RelationshipHistory",operator:o},{field:"ClassHistory",operator:o},{field:"ActionLogHistory",operator:o}]},requestStart:function(){d.set("historyLabel",{type:"loading"}),d.set("showHistory",!1)},change:function(e){d.set("historyLabel",{type:"info",text:d.dropdownQuery.text}),d.set("showHistory",!0)},error:function(){d.set("historyLabel",{type:"error"})}}),loadHistory:function(){!_.isUndefined(app.storage.custom)&&app.storage.custom.get("DEBUG_ENABLED")&&app.custom.utils.log("historyController:loadHistory");var e=$("#showHistoryDropDown").data("kendoDropDownList"),t=e.dataItem();t&&d.getObjectHistory(t)},getObjectHistory:function(e){!_.isUndefined(app.storage.custom)&&app.storage.custom.get("DEBUG_ENABLED")&&app.custom.utils.log("historyController:getObjectHistory",{dataItem:e});var t=this;t.set("dropdownQuery",e),void 0===t.historyView?(t.historyView=new kendo.View("viewHistoryTemplate",{wrap:!1,model:t}),t.historyView.render($("#historyView"))):t.timelineDataSource.read()}};return kendo.observable(e)}function s(t){var i=_.template(e),o=$(i(t)),r=new kendo.View(o,{model:t,wrap:!1});return _.defer(function(){r.render();var e=o.find("#showHistoryDropDown").data("kendoDropDownList");e.bind("select",function(e){var i=this.dataItem(e.item);t.getObjectHistory(i)}),e.bind("open",function(e){t.dropDownDataSource.data(a())}),e.select(0)}),t.view=r,t.dropDownDataSource.data(a()),"function"==typeof n&&n(o),o}!_.isUndefined(app.storage.custom)&&app.storage.custom.get("debug")&&app.custom.utils.log("historyController:build",{vm:t,node:i,callback:n});var d;return function(){return!_.isUndefined(app.storage.custom)&&app.storage.custom.get("debug")&&app.custom.utils.log("historyController:initHistory"),t.view.historyController=d=l(),s(d)}()}}}),define("text!forms/predefined/billableTime/view.html",[],function(){return'<div>\r\n    <div data-control="billableTime" data-control-bind="AppliesToWorkItem"\r\n        <% if ( Disabled ){ %>\r\n        disabled\r\n        <% } %>\r\n\r\n        >\r\n    <div class="row hidden-print" data-bind="visible: view.billableTimeController.isVisible">\r\n        <div class="col-md-3">\r\n            <div class="form-group" data-cid="work-itemBillableTime" data-cid-propname="hours">\r\n                <label for="hourNumeric"><%= localization.hours %></label>\r\n                <div class="form-control form-control-picker input-sm">\r\n                    <input id="hourNumeric" data-role="numerictextbox"\r\n                           data-format="#.##"\r\n                           data-min="0"\r\n                           data-bind="value: view.billableTimeController.btHour,\r\n                               events: {spin: view.billableTimeController.onHourSpin }"/>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="col-md-3">\r\n            <div class="form-group" data-cid="work-itemBillableTime" data-cid-propname="minutes">\r\n                <label for="minuteNumeric"><%= localization.minutes %></label>\r\n                <div class="form-control form-control-picker input-sm">\r\n                    <input id="minuteNumeric" data-role="numerictextbox"\r\n                           data-format="#.##"\r\n                           data-min="0"\r\n                           data-bind="value: view.billableTimeController.btMinute,\r\n                               events: {spin: view.billableTimeController.onMinuteSpin }"/>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="col-md-6 margin-t30">\r\n            <button class="btn btn-primary" data-role="button" data-bind="events: {click: view.billableTimeController.onAddClick}" data-cid="billableTimeAddButton"><%= localization.Add %> </button>\r\n            <button class="btn btn-default" data-role="button" data-bind="events: {click: view.billableTimeController.onSubtractClick}" data-cid="billableTimeSubtractButton"><%= localization.Subtract %> </button>\r\n        </div>\r\n    </div>\r\n    <div class="row">\r\n        <div class="col-md-12">\r\n            <div data-control="grid"></div>\r\n            <div data-role="grid" class="billable-time-grid"\r\n                 data-bind="source: view.billableTimeController.dataSource, events:{dataBinding: view.billableTimeController.onDataBinding, dataBound: view.billableTimeController.onDataBound, cellClose: view.billableTimeController.onCellClose, remove: view.billableTimeController.remove}"\r\n                 data-selectable="false"\r\n                 data-sortable="true"\r\n                 data-filterable="true"\r\n                 data-scrollable="false"\r\n                 data-column-menu="true"\r\n                 data-pageable="false"\r\n                 data-editable="{mode: \'incell\'}"\r\n                 data-columns=\'[\r\n                { field: "BillableTime.DisplayName", title: localization.Analyst, width: "300px", attributes: { "class": "grid-highlight-column" } },\r\n                { field: "BaseId", title: localization.BaseId, width: "30px", hidden: true },\r\n                { field: "LastUpdatedDisplay", title: localization.LastUpdated, width: "100px" },\r\n                { field: "TimeInMinutes", title: localization.TimeInMinutes, width: "100px", attributes: { "class": "pull-right" } },\r\n                <% if ( !Disabled ){ %>\r\n                 { width: "100px", command: [{ name: "destroy", buttonType: "ImageAndText", text: localization.Remove}]}\r\n                <% } %>\r\n            ]\'>\r\n            </div>\r\n            <div class="pull-right">\r\n                <label id="btTotalTimeInString" data-bind="html: view.billableTimeController.btTotalTimeInString"></label>\r\n            </div>\r\n        </div>\r\n        </div>\r\n</div>\r\n</div>'}),define("forms/predefined/billableTime/controller",["require","text!forms/predefined/billableTime/view.html"],function(e){var t=e("text!forms/predefined/billableTime/view.html");return{template:t,build:function(e,i,n){var a=_.template(t),o={Disabled:i.disabled,PropertyName:"AppliesToWorkItem"};$.extend(!0,o,i);var r=o.PropertyName;_.isUndefined(e[r])&&e.set(r,new kendo.data.ObservableArray([]));var l=e.get(r);l.LastUpdatedDisplay="",e.view.billableTimeController=new kendo.observable({btHour:0,btMinute:0,btTotalTime:0,btTotalTimeInString:"",onHourSpin:function(t){e.view.billableTimeController.set("btHour",t.sender.value())},onMinuteSpin:function(t){e.view.billableTimeController.set("btMinute",t.sender.value())},dataSource:new kendo.data.DataSource({schema:{data:"Data",total:"Total",errors:"Errors",model:{id:"BaseId"}},data:{Data:l,Total:l.length}}),onCellClose:function(t){e.view.billableTimeController.computeTotalTime()},remove:function(t){e.view.billableTimeController.computeTotalTime()},onDataBinding:function(e){$.each(l,function(e,t){_.isUndefined(t.BillableTime)&&(t.BillableTime={BasedId:null,DisplayName:null}),t.LastUpdatedDisplay=_.isUndefined(t.LastUpdated)?null:kendo.toString(new Date(t.LastUpdated),"g")})},onDataBound:function(t){for(var i in t.sender._data){var n=t.sender._data[i];if(_.isNull(n.BillableTime.BasedId)){t.sender.tbody.find("tr[data-uid='"+n.uid+"']").hide()}}e.view.billableTimeController.computeTotalTime()},onAddClick:function(t){var i=e.view.billableTimeController.btHour,n=e.view.billableTimeController.btMinute,a=(e.view.billableTimeController.btTotalTime,!1);if($.each(l,function(e,t){if(t.BillableTime.BaseId===session.user.Id)return t.set("LastUpdated",(new Date).toISOString()),t.set("TimeInMinutes",parseInt(t.get("TimeInMinutes"))+60*i+n),a=!0,!1}),!a){var o={BillableTime:{BaseId:session.user.Id,DisplayName:session.user.Name},LastUpdated:(new Date).toISOString(),LastModified:(new Date).toISOString(),TimeInMinutes:60*i+n,BasedId:app.lib.newGUID(),Image:app.config.iconPath+app.config.icons.comment,EnteredDate:(new Date).toISOString(),ClassTypeId:"6645cdbe-78a3-ab81-7de9-638b733214fe",EnteredBy:session.user.Name,Title:null,Description:null};l.push(o)}e.view.billableTimeController.computeTotalTime(),e.view.billableTimeController.resetTime()},onSubtractClick:function(t){var i=e.view.billableTimeController.btHour,n=e.view.billableTimeController.btMinute,a=e.view.billableTimeController.btTotalTime;a<60*i||a<n?kendo.ui.ExtAlertDialog.show({title:localization.SubtractTimeTitle,message:localization.SubtractTimeMessage}):($.each(l,function(e,t){t.BillableTime.BaseId===session.user.Id&&(t.set("LastUpdated",(new Date).toISOString()),t.set("TimeInMinutes",parseInt(t.get("TimeInMinutes"))-60*i-n),isExisting=!0)}),e.view.billableTimeController.computeTotalTime(),e.view.billableTimeController.resetTime())},computeTotalTime:function(t){var i=0;$.each(l,function(e,t){"6645cdbe-78a3-ab81-7de9-638b733214fe"===t.get("ClassTypeId")&&(i+=parseInt(t.get("TimeInMinutes")))}),e.view.billableTimeController.btTotalTime=i,e.view.billableTimeController.btTotalTimeInString="{0} : {1} {2}".replace("{0}",localization.Totaltime).replace("{1}",e.view.billableTimeController.btTotalTime).replace("{2}",localization.minutes),kendo.bind($("#btTotalTimeInString"),e)},resetTime:function(){$("#hourNumeric").data("kendoNumericTextBox").value(0),e.view.billableTimeController.set("btHour",0),$("#minuteNumeric").data("kendoNumericTextBox").value(0),e.view.billableTimeController.set("btMinute",0)},isVisible:!e.isDisabled}),n(new kendo.View(a(o),{wrap:!1,model:e}).render())}}}),define("text!forms/predefined/knowledgeArticle/view.html",[],function(){return'<div data-bind="templateResources:\'resources\'" style="display:none">\r\n    <div data-template-name="mobileHTMLGridTemplate" class="">\r\n        \x3c!-- repeated template content here --\x3e\r\n        <div class="gridcard gridcard--form">\r\n            <p class="gridcard__title">${KnowledgeArticleID}: ${Title}</p>\r\n            <div class="gridcard__detailblock">\r\n                # if ( Category && Category.length > 0 ){ #\r\n                <p>#: localizationHelper.localize("Category") #: #: Category # </p>\r\n                # } #\r\n                # if ( Type && Type.length > 0 ){ #\r\n                <p>#: localizationHelper.localize("Type") #: #: Type # </p>\r\n                # } #\r\n            </div>\r\n            <div class="gridcard__detailblock">\r\n                <a class="k-delete-button">#: localization.Remove #</a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<div class="row">\r\n    <div class="col-md-12 file-attachments"\r\n        <% if ( Disabled ){ %>\r\n        disabled\r\n        <% } %>>\r\n        \r\n    <div data-bind="visible: view.knowledgeArticleModel.showAddButton">\r\n        <button class="btn btn-primary hidden-print" data-role="button" data-bind="events:{click: view.knowledgeArticleModel.addClick}"><%= localization.Add %> </button>\r\n    </div>\r\n    \r\n    <% if ( IsMobileView == false ){ %>\r\n        <div data-role="grid"\r\n            data-bind="source: RelatedHTMLKB, events:{remove: view.knowledgeArticleModel.removeRelatedKB}"\r\n            data-selectable="true"\r\n            data-sortable="true"\r\n            data-filterable="true"\r\n            data-scrollable="false"\r\n            data-column-menu="true"\r\n            data-pageable="false"\r\n            data-editable="{mode: \'incell\', create: false, update: false}"\r\n            data-columns=\'[\r\n                { field: "KnowledgeArticleID", title: localization.Id, width: "10%", attributes:{class:"grid-highlight-column"}},\r\n                { field: "Title", title: localization.Title, width: "50%", attributes:{class:"grid-highlight-column"}, template: "\\u003ca target=\\u0027_blank\\u0027 href=\\u0027#var url = \\u0022/KnowledgeBase/View/\\u0022 + data.KnowledgeArticleID##=url#\\u0027\\u003e#: Title # \\u003c/a\\u003e\\u003cspan class=\\u0027pull-right relatedItems-grid-links\\u0027\\u003e\\u003ca class=\\u0027highlight-default-icon\\u0027 target=\\u0027_blank\\u0027 href=\\u0027#var url = \\u0022/KnowledgeBase/View/\\u0022 + data.KnowledgeArticleID;##=url#\\u0027\\u003e\\u003ci class=\\u0027fa fa fa-external-link\\u0027\\u003e\\u003c/i\\u003e\\u003c/a\\u003e\\u003c/span\\u003e"},\r\n                { field: "Category", title: localization.Category, width: "20%" },\r\n                { field: "Type", title: localization.Type, width: "20%" },\r\n                { width: "4%", command: [{ name: "destroy", buttonType: "ImageAndText", text: localization.Remove }] }\r\n                ]\'>\r\n        </div>\r\n    <% } %>\r\n    <% if ( IsMobileView ){ %>\r\n        <div data-role="listview" data-template="mobileHTMLGridTemplate" data-bind="source: RelatedHTMLKB, events: {remove: view.knowledgeArticleModel.removeRelatedKB}" class="mobile-grid-parent"></div>\r\n    <% } %>\r\n</div>\r\n'}),define("text!forms/predefined/knowledgeArticle/popup.html",[],function(){return'<div class="cireson-window defined-form task-window hide">\r\n    <div class="cireson-window--wrapper">\r\n        <div class="cireson-window--body">\r\n            <div class="row">\r\n                <div class="col-md-5">\r\n                    <div class="form-group">\r\n                        <label><%= localization.SearchText %></label>\r\n                        <span class="k-textbox k-space-right">\r\n                            <input type="text" data-bind="value: searchText" />\r\n                            <span data-bind="events:{click: search}" class="fa fa-search cursor-pointer">&nbsp;</span>\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <label><%= localization.SelectObjects %></label>\r\n\r\n            <div class="objectPicker-container">\r\n                <div class="k-widget k-grid k-secondary"\r\n                     data-role="grid"\r\n                     data-bind="source: dataSource"\r\n                     data-selectable="multiple, row"\r\n                     data-sortable="true"\r\n                     data-filterable="true"\r\n                     data-scrollable="false"\r\n                     data-column-menu="true"\r\n                     data-pageable="true"\r\n                     data-editable="{mode: \'incell\', create: false, update: false}"\r\n                     data-columns=\'[\r\n                { field: "ArticleId", title: localization.Id, width: "10%"},\r\n                { field: "Title", title: localization.Title, width: "90%"}\r\n                ]\'>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="objectPicker-actions">\r\n                <button data-role="button" data-bind="events:{click: add}" class="btn btn-primary k-button"><%= localization.Add %> </button>\r\n                <button data-role="button" data-bind="events:{click: remove}" class="btn btn-danger k-button"><%= localization.Remove %> </button>\r\n            </div>\r\n\r\n            <div class="k-widget k-grid k-secondary objectPicker-grid2-container"\r\n                 data-role="grid"\r\n                 data-bind="source: selectedItems"\r\n                 data-selectable="multiple, row"\r\n                 data-sortable="true"\r\n                 data-filterable="true"\r\n                 data-scrollable="false"\r\n                 data-column-menu="true"\r\n                 data-pageable="true"\r\n                 data-editable="{mode: \'incell\', create: false, update: false}"\r\n                 data-columns=\'[\r\n                { field: "ArticleId", title: localization.Id, width: "10%"},\r\n                { field: "Title", title: localization.Title, width: "90%"}\r\n                ]\'>\r\n            </div>\r\n\r\n        </div>\r\n        <div class="cireson-window--footer window-buttons">\r\n            <button data-role="button"\r\n                    class="btn btn-primary"\r\n                    data-bind="events: { click: save }">\r\n                <%= localization.OK %>\r\n            </button>\r\n            <button data-role="button"\r\n                    class="btn btn-default"\r\n                    data-bind="events: { click: cancel }">\r\n                <%= localization.Cancel %>\r\n            </button>\r\n        </div>\r\n    </div>\r\n    \r\n</div>\r\n'}),define("forms/predefined/knowledgeArticle/controller",["require","text!forms/predefined/knowledgeArticle/view.html","text!forms/predefined/knowledgeArticle/popup.html"],function(e){var t=e("text!forms/predefined/knowledgeArticle/view.html"),i=e("text!forms/predefined/knowledgeArticle/popup.html");return{template:t,build:function(e,n,a){var o={Disabled:!1,IsMobileView:app.isMobileDevice()};$.extend(!0,o,n);var r=_.template(i),l=new kendo.View(r(o),{wrap:!1});a(l.render()),e.view.knowledgeArticleModel=kendo.observable({addClick:function(t){var i=l.element;win=i.kendoCiresonWindow({title:localization.SelectObject,width:750,height:710,actions:[]}).data("kendoWindow");var n=new kendo.observable({dataSource:new kendo.data.DataSource({transport:{read:{url:"/api/V3/KnowledgeBase/GetHTMLArticles",dataType:"json",data:{userId:session.user.Id},cache:!1}},schema:{model:{fields:{ArticleId:{type:"string"},Title:{type:"string"},Category:{type:"string"},Type:{type:"string"}}}},pageSize:5}),selectedItems:new kendo.data.ObservableArray([]),searchText:"",search:function(e){var t=this.get("searchText");this.dataSource.read(),this.dataSource.filter({logic:"or",filters:[{field:"ArticleId",operator:"contains",value:t},{field:"Title",operator:"contains",value:t},{field:"Category",operator:"contains",value:t},{field:"Type",operator:"contains",value:t}]})},add:function(e){for(var t=i.find('[data-role="grid"]').first(),n=t.data("kendoGrid"),a=n.select(),o=0;o<a.length;o++){var r=n.dataItem(a[o]);if(r){var l=_.pluck(this.selectedItems,"ArticleId");_.contains(l,r.ArticleId)||this.selectedItems.push(r)}}i.find('[data-role="grid"]').last().data("kendoGrid").dataSource.query({page:1,pageSize:5})},remove:function(e){for(var t=i.find('[data-role="grid"]').last(),n=t.data("kendoGrid"),a=n.select(),o=0;o<a.length;o++){var r=n.dataItem(a[o]);this.selectedItems.pop(r)}},save:function(t){var i=_.isUndefined(e.get("RelatedHTMLKB"))?[]:e.get("RelatedHTMLKB");_.each(this.selectedItems,function(t){i.push({KnowledgeArticleID:t.ArticleId,WorkItemID:-1!=e.ClassName.indexOf("WorkItem")?e.BaseId:null,WorkItemId:-1!=e.ClassName.indexOf("WorkItem")?e.Id:null,AssetID:-1!=e.ClassName.indexOf("AssetManagement")?e.BaseId:null,AssetId:-1!=e.ClassName.indexOf("AssetManagement")?e.Id:null,Title:t.Title,Category:t.Category,Type:t.Type})}),e.set("RelatedHTMLKB",i),win.close()},cancel:function(e){win.close()}});kendo.bind(i,n),i.removeClass("hide"),i.show(),win.open()},bindRowClick:function(e){var t=s.element.find('[data-role="grid"]').first();if(!app.isMobile()){var i=t.data("kendoGrid");i.dataSource.originalFilter=i.dataSource.filter,i.dataSource.filter=function(){var e=i.dataSource.originalFilter.apply(this,arguments);return arguments.length>0&&this.trigger("filterApplied",arguments),e},i.dataSource.bind("filterApplied",function(){if($.each($(t).find("th a.k-header-column-menu i"),function(){$(this).remove()}),i.dataSource.filter()){var e=i.dataSource.filter().filters||[],n=[];for(var a in e)if(e[a].filters){var o=e[a].filters;for(var r in o)n.push(o[r])}else n.push(e[a]);n=_.uniq(n,function(e){return e.field});for(var a in n)$(t).find("th[data-field="+n[a].field+"] a.k-header-column-menu").append('<i class="fa fa-filter"></i>')}})}},getAllRelatedWorkItems:function(t){var i=_.isUndefined(e.get("RelatedHTMLKB"))?new kendo.data.ObservableArray([]):e.get("RelatedHTMLKB"),n="";-1!=e.ClassName.indexOf("WorkItem")?n=app.lib.addUrlParam("/api/V3/Article/GetArticlesRelatedToWorkItem","workItemId",e.BaseId):-1!=e.ClassName.indexOf("AssetManagement")&&(n=app.lib.addUrlParam("/api/V3/Article/GetArticlesRelatedToAsset","assetId",e.BaseId)),$.ajax({url:n,dataType:"json",type:"POST",success:function(t){_.each(t,function(t){i.push({KnowledgeArticleID:t.ArticleID,WorkItemID:-1!=e.ClassName.indexOf("WorkItem")?e.BaseId:null,WorkItemId:-1!=e.ClassName.indexOf("WorkItem")?e.Id:null,AssetID:-1!=e.ClassName.indexOf("AssetManagement")?e.BaseId:null,AssetId:-1!=e.ClassName.indexOf("AssetManagement")?e.Id:null,Title:t.Title,Category:t.CategoryName,Type:t.TypeName})}),i.length>0&&e.set("RelatedHTMLKB",i)},error:function(e){app.lib.log(e.errorThrown+" - When retrieving data from /api/V3/Article/GetArticlesRelatedToWorkItem")}})},removeRelatedKB:function(t){var i=_.isUndefined(e.get("RemoveRelatedHTMLKB"))?new kendo.data.ObservableArray([]):e.get("RemoveRelatedHTMLKB");i.push(t.model),e.set("RemoveRelatedHTMLKB",i)},showAddButton:!e.isDisabled});var r=_.template(t),s=new kendo.View(r(o),{wrap:!1,model:e.view.knowledgeArticleModel});a(s.render()),e.view.knowledgeArticleModel.getAllRelatedWorkItems(),e.view.knowledgeArticleModel.bindRowClick()}}}),define("text!forms/predefined/serviceComponents/view.html",[],function(){return'<div class="configItemComponents">\r\n    <div class="configItemComponentsTreeView">\r\n        <div data-role="treeview"\r\n             data-drag-and-drop="false"\r\n             data-text-field="DisplayName"\r\n             data-spritecssclass-field="type"\r\n             data-bind="source: items, events: { select: onSelect }">\r\n        </div>\r\n\r\n    </div>\r\n\r\n    <div class="propSelectedItem">Properties Of Selected Item</div>\r\n    <hr />\r\n    <div class="row">\r\n        <div class="col-md-3">\r\n            <div class="form-group">\r\n                <label class="control-label"><span>Name</span></label>\r\n                <div class="display-field name"></div>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="col-md-3">\r\n            <div class="form-group">\r\n                <label class="control-label"><span>Class Name</span></label>\r\n                <div class="display-field className"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n\r\n    \r\n    <div class="relatedWorkItemsForSelectedItem">Related Work Items For Selected Item</div>\r\n    <hr class="relatedWorkItemsForSelectedItem-hr" />\r\n</div>\r\n\r\n'}),define("forms/predefined/serviceComponents/controller",["require","text!forms/predefined/serviceComponents/view.html","forms/predefined/multipleObjectPicker/controller"],function(e){var t=e("text!forms/predefined/serviceComponents/view.html"),i=e("forms/predefined/multipleObjectPicker/controller");return{template:t,build:function(e,n,a){var o=_.template(t),r={Disabled:!0,ProjectionId:""};$.extend(!0,r,n);var l=$(o(r));a(l),n.Disabled=!0,n.PropertyToDisplay={DisplayName:"Title",Status:"Status",LastModified:"LastModified"},n.ClassId="F59821E2-0364-ED2C-19E3-752EFBB1ECE9",n.SelectableRow=!0,n.SelectProperty="DisplayName",n.PropertyName="scopeIsAboutConfigItems";i.build(e,n,a);_.defer(function(){$.get("/configItems/GetConfigItemComponents",{id:e.BaseId},function(t){e.view.treeController=kendo.observable({isVisible:!0,onSelect:function(t){var i=t.sender,a=i.dataItem(t.node);l.find(".name").html(a.DisplayName),l.find(".className").html(a.ClassName),$.get("/configItems/GetWorkItemsRelatedToConfigItem",{id:a.Id
},function(t){var i=e.get(n.PropertyName);_.each(i,function(t){e[n.PropertyName].shift(t)}),_.each(t,function(t){t.LastModified=kendo.toString(new Date(t.LastModified),"g"),e[n.PropertyName].unshift(t)})})},items:JSON.parse(t)}),kendo.bind(l,e.view.treeController)})})}}}),define("text!forms/predefined/dependentComponents/view.html",[],function(){return"<div>\r\n\r\n</div>\r\n\r\n"}),define("forms/predefined/dependentComponents/controller",["require","text!forms/predefined/dependentComponents/view.html","forms/predefined/multipleObjectPicker/controller"],function(e){var t=e("text!forms/predefined/dependentComponents/view.html"),i=e("forms/predefined/multipleObjectPicker/controller");return{template:t,build:function(e,n,a){var o=_.template(t),r={Disabled:!0,ProjectionId:""};$.extend(!0,r,n);var l=$(o(r));a(l),n.PropertyToDisplay={DisplayName:"Name",ClassName:"Class Name",IsAffectedByCR:"Affected By Change",IsAffectedByIR:"Affected By Incident"},n.ClassId="62F0BE9F-ECEA-E73C-F00D-3DD78A7422FC",n.PropertyName="ConfigItem",n.SelectableRow=!0,n.SelectProperty="DisplayName";var s=i.build(e,n,a);s.on("click","td",function(t){var i=s.data("kendoGrid"),n=i.dataItem($(t.currentTarget).closest("tr"));$.get("/configItems/GetWorkItemsRelatedToConfigItem",{id:n.BaseId},function(t){var i=e.get("ConfigItemRelatedWI");_.each(i,function(t){e.ConfigItemRelatedWI.shift(t)}),_.each(t,function(t){t.LastModified=kendo.toString(new Date(t.LastModified),"g"),e.ConfigItemRelatedWI.unshift(t)})})}),_.defer(function(){var t=e.get(n.PropertyName);$.get("/configItems/GetDependentComponents",{id:e.BaseId},function(e){_.each(e,function(e){for(var i in t)if(t[i].ClassName==e.ClassName){t[i].set("IsAffectedByCR",e.IsAffectedByCR?"Yes":"None"),t[i].set("IsAffectedByIR",e.IsAffectedByIR?"Yes":"None");break}})})}),_.defer(function(){n.Disabled=!0,n.PropertyToDisplay={DisplayName:"Title",Status:"Status",LastModified:"LastModified"},n.ClassId="F59821E2-0364-ED2C-19E3-752EFBB1ECE9",n.PropertyName="ConfigItemRelatedWI",n.SelectProperty="DisplayName";var t=i.build(e,n,a);_.defer(function(){t.closest("#ConfigItemRelatedWI").parent().prepend('<div class="configItemComponents"><div class="relatedWorkItemsForSelectedItem">Related Work Items For Selected Item</div><hr class="relatedWorkItemsForSelectedItem-hr" /></div>')})})}}}),define("text!forms/fields/display/view.html",[],function(){return'<div class="form-group">\r\n    <% if ( !HideLabel ){ %>\r\n    <label class="control-label" for="<%= PropertyName %>" data-localize="<%= PropertyDisplayName %>"></label>\r\n    <% } %>\r\n    <div class="display-field" data-bind="text: <%= PropertyName %>"></div>\r\n</div>'}),define("forms/fields/display/controller",["require","text!forms/fields/display/view.html"],function(e){var t=e("text!forms/fields/display/view.html");return{template:t,build:function(e,i,n){var a=_.template(t),o={HideLabel:!1};$.extend(!0,o,i),n(a(o))}}}),define("text!forms/fields/spacer/view.html",[],function(){return'<div class="form-group">\r\n\r\n</div>'}),define("forms/fields/spacer/controller",["require","text!forms/fields/spacer/view.html"],function(e){var t=e("text!forms/fields/spacer/view.html");return{template:t,build:function(e,i,n){var a=_.template(t),o={};$.extend(!0,o,i),n(a(o))}}}),define("forms/fields/int/controller",["require","text!forms/fields/numeric/view.html"],function(e){var t=e("text!forms/fields/numeric/view.html"),i=function(e,t,i){if(app.isMobile()){e.data();setTimeout(function(){var n=e.parent().find("input[type='number']");n.change(function(){t.set(i.PropertyName,n.val())})},100)}};return{template:t,build:function(e,n,a){var o=_.template(t),r=n.vm,l={Required:n.Required,DecimalPlaces:0,MinValue:-2147483648,MaxValue:2147483648,StepIncrement:1,Disabled:n.disabled,Format:""};$.extend(!0,l,n);var s=$(o(l));new i(s.find("[data-control='numericTextBox']"),r,n),a(s)}}}),define("forms/fields/decimal/controller",["require","text!forms/fields/numeric/view.html"],function(e){var t=e("text!forms/fields/numeric/view.html");return{template:t,build:function(e,i,n){var a=_.template(t),o={DecimalPlaces:20,MinValue:"",MaxValue:"",StepIncrement:1,Disabled:i.disabled,Required:i.Required,Format:""};$.extend(!0,o,i),n(a(o))}}}),define("forms/fields/double/controller",["require","text!forms/fields/numeric/view.html"],function(e){var t=e("text!forms/fields/numeric/view.html");return{template:t,build:function(e,i,n){var a=_.template(t),o={DecimalPlaces:19,MinValue:"",MaxValue:"",StepIncrement:1,Disabled:i.disabled,Required:i.Required,Format:""};$.extend(!0,o,i),n(a(o))}}}),define("text!forms/fields/datetime/view.html",[],function(){return'<div class="form-group">\r\n    <label class="control-label" for="<%= PropertyName %>" data-localize="<%= PropertyDisplayName %>">\r\n        <span><% if ( Required ){ %> <%= \'(\' + localization.Required + \')\' %><% } %></span>\r\n    </label>\r\n\r\n    <input name="<%= PropertyName %>"\r\n           data-control="dateTimePicker"\r\n           data-control-bind="<%= PropertyName %>"\r\n           data-control-from="<%= FromFilter %>"\r\n           data-control-to="<%= ToFilter %>"\r\n           data-control-from-relative="<%= FromRelative %>"\r\n           data-control-to-relative="<%= ToRelative %>"\r\n    \r\n    <% if ( Disabled ){ %>\r\n    disabled\r\n    <% } %>\r\n\r\n    <% if ( Required ){ %>\r\n    required\r\n    <% } %>\r\n\r\n    >\r\n</div>'}),define("forms/fields/datetime/controller",["require","text!forms/fields/datetime/view.html"],function(e){var t=e("text!forms/fields/datetime/view.html");return{template:t,build:function(e,i,n){var a=_.template(t),o={FromFilter:"",ToFilter:"",FromRelative:"",ToRelative:"",Disabled:i.disabled,Required:i.Required};"string"==typeof i.MinValue&&(-1!=i.MinValue.indexOf(":")?o.FromRelative=i.MinValue:o.FromFilter=i.MinValue),"string"==typeof i.MaxValue&&(-1!=i.MaxValue.indexOf(":")?o.ToRelative=i.MaxValue:o.ToFilter=i.MaxValue),$.extend(!0,o,i),n(a(o))}}}),define("text!forms/fields/userPicker/view.html",[],function(){return'<div class="form-group" data-cid="userpicker" data-cid-propname="<%= PropertyName %>"\r\n            <% if ( Required ){ %>\r\n            required\r\n            <% } %>>\r\n    <label class="control-label" for="<%= PropertyName %>" data-localize="<%= PropertyDisplayName %>">\r\n        <span><% if ( Required ){ %> <%= \'(\' + localization.Required + \')\' %><% } %></span>\r\n    </label>\r\n    <input class="input-userpicker"\r\n           data-control="userPicker"\r\n           data-control-bind="<%= PropertyName %>"\r\n           data-control-extra="<%= ExtraProps %>"\r\n           data-control-delay="<%= Delay %>"\r\n           data-control-minlength="<%= MinLength %>"\r\n           data-control-filterbyanalyst="<%= FilterByAnalyst%>"\r\n           data-control-maxnumberofresults="<%= MaxNumberOfResults%>"\r\n           type="text"\r\n           name="<%= PropertyName %>"\r\n            <% if ( Disabled ){ %>\r\n            disabled\r\n            <% } %>\r\n\r\n    />\r\n</div>'}),define("forms/fields/userPicker/controller",["require","text!forms/fields/userPicker/view.html","forms/popups/userPickerPopup/controller"],function(e){var t=e("text!forms/fields/userPicker/view.html"),i=e("forms/popups/userPickerPopup/controller"),n={template:t,build:function(e,n,a){_.isUndefined(n.vm)?(boundObj=n,name=n.PropertyName):(boundObj=n.vm,name=n.PropertyName);var r={Required:n.Required,Disabled:n.disabled,ExtraProps:!1,Delay:200,MinLength:3,FilterByAnalyst:!1,MaxNumberOfResults:10};$.extend(!0,r,n);var l=_.template(t),s=$(l(r)),d=i.getPopup();new o(s.find("[data-control='userPicker']"),boundObj,name,d);s.find("[data-control='userPicker']").attr("data-control","userPickerBound"),a(s)}},a=function(e,t){var i=this;this.serverNameProp=e,this.serverIdProp=t;var n={};n[i.serverNameProp],n[i.serverIdProp],this.set={name:function(e){n[i.serverNameProp]=e},id:function(e){n[i.serverIdProp]=e}},this.setObj=function(e,t){i.set.name(e),i.set.id(t)},this.setFromObj=function(e){i.setObj(e[i.serverNameProp],e[i.serverIdProp])},this.get={name:function(){return n[i.serverNameProp]},id:function(){return n[i.serverIdProp]}},this.getFromObj=function(e){return i.setFromObj(e),n},this.getObj=function(e,t){return void 0!==e&&void 0!==t&&i.setObj(e,t),n},this.getGenericFromObj=function(e){return this.setFromObj(e),{name:i.get.name(),id:i.get.id()}}},o=function(e,t,i,n){var e=e,o=e.attr("data-control-extra"),r=e.attr("data-control-delay"),l=e.attr("data-control-minlength"),s=e.attr("data-control-filterByAnalyst"),d=e.attr("data-control-maxNumberOfResults"),t=t,c=i,n=n,u=new a("DisplayName","BaseId");app.lib.forceKendoProp(t,c,kendo.observable(u.getObj(null,null)));var p,m,f={obj:function(){return t[c]},name:function(){return t[c].DisplayName},id:function(){return t[c].BaseId}},v={obj:function(e,i){t[c].set("BaseId",i),t[c].set("DisplayName",e)}},g=function(){t[i].bind("change",function(){S()})},b=function(e){e?v.obj(e.name,e.id):v.obj(null,null)},w=function(){n.setSaveCallback(function(e){v.obj(e.name,e.id)}),n.vm.filterByAnalyst=s,n.open()},h=function(){return!!(t&&t[i]&&f.name()&&f.id())},k=function(){return!!(t&&t[i]&&_.isNull(f.name())&&_.isNull(f.id()))},y=function(){return o&&"false"!=o},I=function(){y()&&(p=new x({url:"/Search/GetObjectPropertiesByProjection?projectionId=490ab845-b14c-1d91-c39f-bb9e8a350933&id=",container:e.parent(),props:o.split(",")}))},C=function(){m=new T({url:"/api/V3/User/GetUserList",detailsUrl:"/Search/ObjectViewer",targetEle:e,delay:r,minLength:l,callback:b,maxNumberOfResults:d})},S=function(){h()?(p&&p.setDisplay(f.id()),m&&m.setValue(f.name(),f.id())):k()&&m&&m.setValue("",null)},x=function(e){var t,i,n=this,a=e.container,o=e.url,r=e.props,l=function(){i.bind("change",function(e){"extraPropText"==e.field?i.set("isVisible",i.extraPropText.length>0):"data"==e.field&&p()})},s=function(){t=$("<span>",{class:"help-block","data-bind":"text: extraPropText, visible: isVisible"}),setTimeout(function(){a.append(t)},100)},d=function(){i=kendo.observable({isVisible:!1,extraPropText:"",data:{},getUserObjectData:c}),kendo.bind(t,i)},c=function(e){$.get(o+e,function(e){e&&e[0]&&(e=e[0]),i.set("data",e),p()})},u=function(e){var t="";return _.isUndefined(e.Name)||_.isNull(e.Name)||(t=e.Name),_.isUndefined(e.DisplayName)||_.isNull(e.DisplayName)||(t=e.DisplayName),t},p=function(){var e="";$.each(r,function(t,n){var a=i.data[n];a&&(e+=(_.isObject(a)?u(a):a)+", ")}),i.set("extraPropText",e.substring(0,e.length-2))};!function(){s(),d(),l(),n.setDisplay=i.getUserObjectData}()},T=function(e){var t,i,n,o,r,l,d=this,c=e.targetEle,u=e.url,p=e.detailsUrl,m=e.callback,f=e.delay,v=e.minLength,g=c.attr("disabled")?"":localization.SearchButton,b=!1,h=new a("Name","Id"),k=!_.isNull(session.consoleSetting.TrueControlCenterURL)&&""!=session.consoleSetting.TrueControlCenterURL&&session.user.Analyst,y=function(){t.bind("select",function(e){var t=this.dataItem(e.item.index());m(h.getGenericFromObj(t))}),t.bind("change",function(e){P(),m(h.getGenericFromObj(N(t.value())))}),t.bind("dataBound",function(e){e.sender.ul.find("li").first().addClass("k-state-hover")}),c.on("keyup",function(e){40!=e.which||t.ul.is(":visible")?13!=e.which&&9!=e.which&&(b=E(),P()):(t.search(t.value()),P())}),c.on("keydown",function(e){if(13==e.which){if(t.ul.children().length&&t.ul.is(":visible")){var i=!1!==b?b:0;t.select(t.ul.children().eq(i)),t.trigger("change"),P()}else t.search(t.value())}}),c.on("blur",function(e){b=E(),P(!0)}),c.on("input propertychange",function(e){""!=e.currentTarget.value&&(t.search(e.currentTarget.value),P())}),l.bind("close",function(){r.find(".k-content").html("")}),n.click(w),o.click(I)},I=function(e){k?e.stopPropagation():S()},C=function(e){var t={BaseId:h.get.id(),Name:h.get.name()},i=app.slideOutNav.getTCCSourceURL(t,"user"),n={url:i,tooltip:localization.UserManagement};app.slideOutNav.show(n)},S=function(e){l.refresh({url:p,data:{id:h.get.id()}}),r.find(".k-content").html("<div style='padding: 55px'>Loading...</div>"),l.title(h.get.name()).center().open()},x=function(){n=$("<div>",{class:"searchIcon","data-control-action":"userPickerWindow"});var e=c.attr("disabled")?"":"text-primary",t=$("<i>",{class:"fa fa-search cursor-pointer "+e});n.append(t),c.attr("disabled")&&!app.isMobileDevice()||n.insertAfter(c)},T=function(){var e=c.attr("disabled")?"":"text-primary";o=$("<i>",{class:"fa fa-info-circle cursor-pointer info-icon "+e}),o.insertBefore(c),o.hide()},M=function(){c.attr("disabled");o=$("<ul>",{class:"menu-usr-mgt"}),o.insertBefore(c),o.hide(),o.kendoMenu({dataSource:[{text:"<i class='fa fa-info-circle cursor-pointer'></i>",encoded:!1,items:[{text:localization.UserManagement,imageUrl:"/Content/Images/Icons/Other/control-center-launcher.png",imageAttr:{height:"16px",width:"16px"},attr:{custom:"tcc"}},{text:"<i class='fa fa-info-circle cursor-pointer' style='margin: -2px 7px 0 -3px;'></i>"+localization.AdditionalDetails,encoded:!1,attr:{custom:"info"}}]}],select:function(e){if(!_.isUndefined(e.item.attributes.custom)){"tcc"==e.item.attributes.custom.value?C():S()}},openOnClick:!0})},A=function(){i=new kendo.data.DataSource({transport:{read:{url:u,data:{userFilter:function(){return t.value()},filterByAnalyst:s,maxNumberOfResults:e.maxNumberOfResults}}},serverFiltering:!0})},D=function(){t=c.kendoAutoComplete({dataTextField:"Name",suggest:!0,placeholder:g+"...",valuePrimitive:!1,dataSource:i,delay:f,minLength:v,enable:!c.attr("disabled"),clearButton:!1}).data("kendoAutoComplete")},R=function(){r=$("<div>"),r.appendTo("body"),l=r.kendoCiresonWindow({title:"",width:550,height:500,actions:["Close"]}).data("kendoWindow")},P=function(e){N(t.value())||""==t.value()?(c.removeAttr("data-invalid",""),""===t.value()?o.hide():(o.show(),c.css({"text-decoration":"underline"}))):(o.hide(),c.is(":focus")&&!e?c.css({"text-decoration":"none"}):(c.css({"text-decoration":"none","background-color":"#FBE3E4"}),c.attr("data-invalid","")))},N=function(e){var t=_.clone(i),n=t.view(),a=!1;return $.each(n,function(t,i){i.Name.toLowerCase()==e.toLowerCase()&&(a=i)}),a},z=function(e,n){i.add(h.getObj(e,n)),t.value(e),P()},E=function(){var e=t.ul.find(".k-state-focused");return!!e.length&&e.index()};!function(){A(),D(),x(),k?M():T(),R(),y(),d.setValue=z}()};!function(){I(),C(),S(),g()}()};return n}),define("text!forms/fields/objectPicker/view.html",[],function(){return'<div class="form-group" data-cid="objectpicker" data-cid-propname="<%= PropertyName %>">\r\n    <label class="control-label" for="<%= PropertyName %>" data-localize="<%= PropertyDisplayName %>">\r\n        <span><% if ( Required ){ %> <%= \'(\' + localization.Required + \')\' %><% } %></span>\r\n    </label>\r\n    <input class="input-userpicker"\r\n           data-control="objectPicker"\r\n           data-control-bind="<%= PropertyName %>"\r\n           data-control-extra="<%= ExtraProps %>"\r\n           type="text"\r\n           name="<%= PropertyName %>"\r\n            <% if ( Disabled ){ %>\r\n            disabled\r\n            <% } %>\r\n\r\n            <% if ( Required ){ %>\r\n            required\r\n            <% } %>\r\n    />\r\n</div>'}),define("text!forms/popups/objectPickerPopup/view.html",[],function(){return'<div id="ObjectPickerPopupWindow" class="cireson-window defined-form task-window">\r\n    <div class="cireson-window--wrapper">\r\n        <div class="cireson-window--body">\r\n            <div class="col-group">\r\n                <div class="c2">\r\n                    <label data-bind="text: searchText"></label>\r\n                    <span class="k-textbox">\r\n                        <input class="textbox-padding-right" type="text" data-value-update="keyup" data-bind="value: searchValue, events: { keypress: searchOnEnter }">\r\n                        <a data-bind="click: search" class="cursor-pointer fa fa-search"></a>\r\n                    </span>\r\n                </div>\r\n            </div>\r\n            <div>\r\n                <label data-bind="text: selectObjectText"></label>\r\n                <div data-control-grid="userPickerGrid"></div>\r\n            </div>\r\n        </div>\r\n        \r\n        <div class="cireson-window--footer window-buttons objectPicker-single-grid">\r\n            <button data-role="button"\r\n                    class="btn btn-primary"\r\n                    data-bind="events: { click: save }">\r\n                <%= localization.OK %>\r\n            </button>\r\n            <button data-role="button"\r\n                    class="btn btn-default"\r\n                    data-bind="events: { click: cancel }">\r\n                <%= localization.Cancel %>\r\n            </button>\r\n        </div>\r\n    </div>\r\n</div>'});var __objectPickerPopupSingleton;define("forms/popups/objectPickerPopup/controller",["require","text!forms/popups/objectPickerPopup/view.html"],function(e){var t=e("text!forms/popups/objectPickerPopup/view.html"),i=function(e,t){var i=this;this.serverNameProp=e,this.serverIdProp=t;var n={};n[i.serverNameProp],n[i.serverIdProp],this.set={name:function(e){n[i.serverNameProp]=e},id:function(e){n[i.serverIdProp]=e}},this.setObj=function(e,t){i.set.name(e),i.set.id(t)},this.setFromObj=function(e){i.setObj(e[i.serverNameProp],e[i.serverIdProp])},this.get={name:function(){return n[i.serverNameProp]},id:function(){return n[i.serverIdProp]}},this.getFromObj=function(e){return i.setFromObj(e),n},this.getObj=function(e,t){return void 0!==e&&void 0!==t&&i.setObj(e,t),n},this.getGenericFromObj=function(e){return this.setFromObj(e),{name:i.get.name(),id:i.get.id()}}},n=function(e,t,n){var a,o,r,l=this,s=e,t=t,d=e.find("[data-control-grid]"),c=new i("DisplayName","Id");this.setSaveCallback=function(e){$(l).unbind("save").bind("save",function(t,i){e(i)})},this.setCancelCallback=function(e){$(l).unbind("cancel").bind("cancel",function(t,i){e(i)})};var u=function(){},p=function(){a.search(r.searchValue)},m=function(){var e=a.kendoGrid.select();if(e){var t=c.getGenericFromObj(a.kendoGrid.dataItem(e));$(l).trigger("save",t),g()}},f=function(){$(l).trigger("cancel"),g()},v=function(){l.vm.set("searchValue",""),a.kendoDataSource.data([]),o.kendoWindow.open()},g=function(){o.kendoWindow.close()},b=function(){o=new h},w=function(){a=new k({html:d,url:"/ConfigItems/GetObjectSearchResults"})},h=function(){var e,t=this,i=function(){e=s.kendoCiresonWindow({title:localization.SelectObject,content:null,width:680,height:400,actions:["Close"]}).data("kendoWindow")};!function(){i(),t.kendoWindow=e}()},k=function(e){var i,a,o,r=this,l=e.html,s=e.url,d=function(){i.bind("dataBound",function(e){i.pager.element.show()}),i.element.on("dblclick","tbody>tr",c)},c=function(){i.select($(this)),m()},u=function(e){o=e,a.read(),_.isUndefined(n)&&""==n||i.dataSource.filter([{field:"Id",operator:"neq",value:n}]),a.page(1)},p=function(){a=new kendo.data.DataSource({transport:{prefix:"",read:{url:s,data:function(){return{searchFilter:function(){return o},classId:function(){return t},groupFilter:""}},type:"GET"}},pageSize:15,page:1,total:0,type:"aspnetmvc-ajax",schema:{data:"Data",total:"Total",errors:"Errors",model:{fields:{Id:{type:"string"},ObjectClassId:{type:"number"},ObjectClassName:{type:"string"},DisplayName:{type:"string"},Path:{type:"string"},Hosted:{type:"number"},LastModified:{type:"date"},Status:{type:"string"}}}}})},f=function(){i=l.kendoGrid({height:150,dataSource:a,selectable:"Single,Row",sortable:{mode:"multiple"},pageable:!0,filterable:{extra:!1,operators:{string:{startswith:localization.Startswith,contains:localization.Contains,eq:localization.Isequalto,neq:localization.Isnotequalto},date:{gte:localization.GreaterOrEqual,gt:localization.GreaterThan,lte:localization.LessOrEqual,lt:localization.LessThan}}},autoBind:!1,columns:[{title:"Id",hidden:!0,field:"Id",filterable:{},encoded:!0},{title:localization.DisplayName,attributes:{class:"grid-highlight-column"},field:"DisplayName",filterable:{},encoded:!0},{title:localization.Class,field:"ObjectClassName",filterable:{},encoded:!0},{title:localization.Path,field:"Path",filterable:{},encoded:!0}]}).data("kendoGrid")};!function(){p(),f(),i.pager.element.hide(),d(),r.kendoGrid=i,r.kendoDataSource=a,r.search=u}()};!function(){r=kendo.observable({searchText:localization.SearchText,selectObjectText:localization.SelectObject,searchValue:"",okText:localization.OK,cancelText:localization.Cancel,search:p,searchOnEnter:function(e){13==e.which&&(e.preventDefault(),p())},save:m,cancel:f}),kendo.bind(s,r),b(),w(),u(),l.open=v,l.close=g,l.vm=r}()};return{template:t,getPopup:function(e,i){if(__objectPickerPopupSingleton&&__objectPickerPopupSingleton[e])return __objectPickerPopupSingleton[e];var a=_.template(t),o=$(a()),e=e;o.data("objectPickerPopup");return $("body").append(o),__objectPickerPopupSingleton=new n(o,e,i)}}}),define("forms/fields/objectPicker/controller",["require","text!forms/fields/objectPicker/view.html","forms/popups/objectPickerPopup/controller"],function(e){var t=e("text!forms/fields/objectPicker/view.html"),i=e("forms/popups/objectPickerPopup/controller"),n={template:t,build:function(e,n,a){boundObj=n.vm,name=n.PropertyName;var r={Required:n.Required,Disabled:n.disabled,ExtraProps:!1,ClassId:!1};$.extend(!0,r,n);var l=_.template(t),s=$(l(r)),d=i.getPopup(r.ClassId,boundObj.BaseId);new o(s.find("[data-control='objectPicker']"),boundObj,name,d,r.ClassId,a);s.find("[data-control='objectPicker']").attr("data-control","objectPickerBound"),a(s)}},a=function(e,t){var i=this;this.serverNameProp=e,this.serverIdProp=t;var n={};n[i.serverNameProp],n[i.serverIdProp],this.set={name:function(e){n[i.serverNameProp]=e},id:function(e){n[i.serverIdProp]=e}},this.setObj=function(e,t){i.set.name(e),i.set.id(t)},this.setFromObj=function(e){i.setObj(e[i.serverNameProp],e[i.serverIdProp])},this.get={name:function(){return n[i.serverNameProp]},id:function(){return n[i.serverIdProp]}},this.getFromObj=function(e){return i.setFromObj(e),n},this.getObj=function(e,t){return void 0!==e&&void 0!==t&&i.setObj(e,t),n},this.getGenericFromObj=function(e){return this.setFromObj(e),{name:i.get.name(),id:i.get.id()}}},o=function(e,t,i,n,o,r){var e=e,l=e.attr("data-control-extra"),t=t,s=i,n=n,o=o,d=new a("DisplayName","BaseId");app.lib.forceKendoProp(t,s,kendo.observable(d.getObj(null,null)));var c,u,p={obj:function(){return t[s].length>0?f(t[s],null):t[s]},name:function(){return t[s].length>0?f(t[s],"DisplayName"):t[s].DisplayName},id:function(){return t[s].length>0?f(t[s],"BaseId"):t[s].BaseId}},m={obj:function(e,i){t[s].length>0?(t[s][0].set("BaseId",i),t[s][0].set("DisplayName",e)):(t[s].set("BaseId",i),t[s].set("DisplayName",e))}},f=function(e,t){var i=e[0];return o.toLowerCase()==i.ClassTypeId.toLowerCase()?null!=t?i[t]:i:null},v=function(){t[i].bind("change",function(){I()})},g=function(e){e?m.obj(e.name,e.id):m.obj(null,null)},b=function(){n.setSaveCallback(function(e){t.BaseId!=e.id&&m.obj(e.name,e.id)}),n.open()},w=function(){return!!(t&&t[i]&&p.name()&&p.id())},h=function(){return l&&"false"!=l},k=function(){h()&&(c=new C({url:"/Search/GetObjectPropertiesByProjection?projectionId=490ab845-b14c-1d91-c39f-bb9e8a350933&id=",container:e.parent(),props:l.split(",")}))},y=function(){u=new S({url:"/ConfigItems/GetObjectSearchResults",detailsUrl:"/Search/ObjectViewer",targetEle:e,callback:g})},I=function(){w()&&(c&&c.setDisplay(p.id()),u&&u.setValue(p.name(),p.id()))},C=function(e){var t,i,n=this,a=e.container,o=e.url,r=e.props,l=function(){i.bind("change",function(e){"extraPropText"==e.field?i.set("isVisible",i.extraPropText.length>0):"data"==e.field&&u()})},s=function(){t=$("<span>",{class:"help-block","data-bind":"text: extraPropText, visible: isVisible"}),setTimeout(function(){a.append(t)},100)},d=function(){i=kendo.observable({isVisible:!1,extraPropText:"",data:{},getUserObjectData:c}),kendo.bind(t,i)},c=function(e){$.get(o+e,function(e){e&&e[0]&&(e=e[0]),i.set("data",e),u()})},u=function(){var e="";$.each(r,function(t,n){i.data[n]&&(e+=i.data[n]+", ")}),i.set("extraPropText",e.substring(0,e.length-2))};!function(){s(),d(),l(),n.setDisplay=i.getUserObjectData}()},S=function(e){var i,n,r,l,s,d,c=this,u=e.targetEle,p=e.url,m=e.detailsUrl,f=u.attr("disabled")?"":localization.SearchPlaceholder,v=e.callback,g=!1,w=new a("DisplayName","Id"),h=function(){i.bind("select",function(e){var t=this.dataItem(e.item.index());v(w.getGenericFromObj(t))}),i.bind("change",function(e){M(),v(w.getGenericFromObj(A(i.value())))}),i.bind("dataBound",function(e){e.sender.ul.find("li").first().addClass("k-state-hover")}),u.on("keyup",function(e){40!=e.which||i.ul.is(":visible")?13!=e.which&&(g=R(),M()):(i.search(i.value()),M())}),u.on("keydown",function(e){if(13==e.which){if(i.ul.children().length){var t=!1!==g?g:0;i.select(i.ul.children().eq(t)),M()}}}),u.on("input propertychange",function(e){i.search(e.currentTarget.value),M()}),d.bind("close",function(){s.find(".k-content").html("")}),t.isDisabled&&r.hide(),r.click(b),l.click(k)},k=function(){d.refresh({url:m,data:{id:w.get.id()}}),s.find(".k-content").html("<div style='padding: 55px'>Loading...</div>"),d.title(w.get.name()).center().open()},y=function(){r=$("<div>",{class:"searchIcon","data-control-action":"userPickerWindow"});var e=u.attr("disabled")?"":"text-primary",t=app.isMobileDevice()?$("<i>",{class:"fa fa-search cursor-pointer "+e}):$("<div>",{class:"search fa fa-search cursor-pointer "+e});r.append(t),r.insertAfter(u)},I=function(){var e=u.attr("disabled")?"":"text-primary";l=app.isMobileDevice()?$("<i>",{class:"fa fa-info-circle cursor-pointer info-icon "+e}):$("<div>",{class:"open-modal fa fa-info-circle"}),l.insertBefore(u),l.hide()},C=function(){n=new kendo.data.DataSource({transport:{read:{url:p,data:{searchFilter:function(){return i.value()},classId:o},type:"GET"}},schema:{data:"Data",total:"Total",errors:"Errors"},serverFiltering:!0})},S="init",x=function(){i=u.kendoAutoComplete({dataTextField:"DisplayName",suggest:!1,placeholder:f,valuePrimitive:!1,dataSource:n,close:function(e){$(window).scrollTop()+$(window).height()==$(document).height()&&"open"==S&&(e.preventDefault(),S="close")},change:function(e){S="change",e.sender.close()},open:function(e){S="open"},enable:!u.attr("disabled"),clearButton:!1}).data("kendoAutoComplete")},T=function(){s=$("<div>"),s.appendTo("body"),d=s.kendoCiresonWindow({title:"",width:550,height:400,actions:["Close"]}).data("kendoWindow")},M=function(){A(i.value())?(l.show(),u.css({"text-decoration":"underline","background-color":"#fff"})):(l.hide(),u.is(":focus")?u.css({"text-decoration":"none","background-color":"#fff"}):u.css({"text-decoration":"none","background-color":"#FBE3E4"}))},A=function(e){var t=_.clone(n),i=t.view(),a=!1;return $.each(i,function(t,i){i.DisplayName.toLowerCase()==e.toLowerCase()&&(a=i)}),a},D=function(e,t){n.add(w.getObj(e,t)),i.value(e),M()},R=function(){var e=i.ul.find(".k-state-focused");return!!e.length&&e.index()};!function(){C(),x(),y(),I(),T(),h(),c.setValue=D}()};!function(){k(),y(),I(),v()}()};return n}),define("text!forms/fields/button/view.html",[],function(){return'<div class="form-group">\r\n    <input type="button"\r\n           name="<%= PropertyName %>"\r\n           class="button btn btn-<%= ButtonType %> btn-<%= ButtonSize %>"\r\n           value="<%= PropertyDisplayName %>"\r\n           data-bind="click: <%= Action %>"\r\n\r\n            <% if ( Disabled ){ %>\r\n            disabled\r\n            <% } %>\r\n\r\n    />\r\n</div>'}),define("forms/fields/button/controller",["require","text!forms/fields/button/view.html"],function(e){var t=e("text!forms/fields/button/view.html");return{template:t,build:function(e,i,n){var a=_.template(t),o={PropertyName:"defaultButton",ButtonType:i.ButtonType?i.ButtonType:"default",ButtonSize:i.ButtonSize?i.ButtonSize:"sm",Disabled:i.disabled};$.extend(!0,o,i),n(a(o))}}}),define("text!forms/fields/editor/view.html",[],function(){return'<div class="form-group">\r\n    <label class="control-label" for="<%= PropertyName %>" data-localize="<%= PropertyDisplayName %>">\r\n        <span><% if ( Required ){ %> <%= \'(\' + localization.Required + \')\' %><% } %></span>\r\n    </label>\r\n    <textarea class="form-editor" data-control="editor" style="height:<%= Height %>px" name="<%= PropertyName %>">\r\n        <%= Content %>\r\n    </textarea>\r\n</div>\r\n\r\n\r\n'}),define("forms/fields/editor/controller",["require","text!forms/fields/editor/view.html"],function(e){var t=e("text!forms/fields/editor/view.html"),i=function(e,t,i){if(null==i.Options){var n=["bold","italic","underline","strikethrough","justifyLeft","justifyCenter","justifyRight","justifyFull","insertUnorderedList","insertOrderedList","indent","outdent","createLink","unlink","insertImage","superscript","subscript","createTable","addColumnLeft","addColumnRight","addRowAbove","addRowBelow","deleteRow","deleteColumn","viewHtml","formatting","foreColor","backColor"],a=["formatting","createLink","unlink","insertImage","viewHtml","bold","italic","underline","insertUnorderedList","insertOrderedList","indent","outdent","createTable","addColumnLeft","addColumnRight","addRowAbove","addRowBelow","deleteRow","deleteColumn"];i.Options=app.isMobileDevice()?a:n}var t=t;setTimeout(function(){e.kendoEditor({change:function(n){t.set(i.PropertyName,e.val())},tools:i.Options,encoded:!1,stylesheets:["/Content/Styles/cireson.main.min.css?v="+session.staticFileVersion]});var n=e.data("kendoEditor");t.bind("change",function(e){n.value(t[i.PropertyName])}),$(n.body).addClass("k-editor-content-body")},100)};return{template:t,build:function(e,n,a){var o=_.template(t);boundObj=n.vm;var r={Required:n.Required,Disabled:n.disabled,Content:boundObj[n.PropertyName]?$("<div/>").text(boundObj[n.PropertyName]).html():boundObj[n.PropertyName],Height:null==n.Height?440:n.Height};$.extend(!0,r,n);var l=$(o(r));new i(l.find("[data-control='editor']"),boundObj,n),a(l)}}}),define("text!forms/fields/combo/view.html",[],function(){return'<div class="form-group" data-bind="ciresonCombo: ControlObject"\r\n\r\n<% if ( Required ){ %>\r\n    required\r\n<% } %>\r\n    >\r\n    <label data-template-part="labelPart" class="control-label" for="<%= PropertyName %>">\r\n    </label>\r\n\r\n    <input class="form-control form-control-picker input-sm" data-template-part="inputControlPart" data-control-bind="<%= PropertyName %>"\r\n        <% if ( Required ){ %>\r\n        required\r\n        <% } %>\r\n         >\r\n    </input>\r\n</div>\r\n'}),define("forms/fields/combo/controller",["require","text!forms/fields/combo/view.html"],function(e){var t=e("text!forms/fields/combo/view.html");return{template:t,build:function(e,i,n){var a=_.template(t);!_.isUndefined(localization[i.name])&&[i.name].length>0&&(i.name=localization[i.name]);var o={PropertyName:i.PropertyName,PropertyDisplayName:i.PropertyDisplayName,DataSource:{},IsCascading:!_.isUndefined(i.IsCascading)&&i.IsCascading,Cascade:{},Required:!_.isUndefined(i.Required)&&i.Required,Disabled:!_.isUndefined(i.Disabled)&&i.Disabled,ControlObject:null,serverFiltering:!_.isUndefined(i.serverFiltering)&&i.serverFiltering,pageSize:_.isUndefined(i.pageSize)?1e3:i.pageSize};$.extend(!0,o,i),n(new kendo.View(a(o),{wrap:!1,model:kendo.observable(o)}).render())}}}),define("text!forms/fields/dropDownList/view.html",[],function(){return'<div class="form-group" data-bind="ciresonDropDownList: ControlObject"\r\n\r\n<% if ( Required ){ %>\r\n    required\r\n<% } %>\r\n    >\r\n    <label data-template-part="labelPart" class="control-label" for="<%= PropertyName %>">\r\n    </label>\r\n\r\n    <input class="form-control form-control-picker input-sm" data-template-part="inputControlPart" data-control-bind="<%= PropertyName %>"\r\n        <% if ( Required ){ %>\r\n        required\r\n        <% } %>\r\n         >\r\n    </input>\r\n</div>\r\n'}),define("forms/fields/dropDownList/controller",["require","text!forms/fields/dropDownList/view.html"],function(e){
var t=e("text!forms/fields/dropDownList/view.html");return{template:t,build:function(e,i,n){var a=_.template(t);!_.isUndefined(localization[i.name])&&[i.name].length>0&&(i.name=localization[i.name]);var o={PropertyName:i.PropertyName,PropertyDisplayName:i.PropertyDisplayName,DataSource:{},Required:!_.isUndefined(i.Required)&&i.Required,Disabled:!_.isUndefined(i.Disabled)&&i.Disabled,ControlObject:null};$.extend(!0,o,i),n(new kendo.View(a(o),{wrap:!1,model:kendo.observable(o)}).render())}}}),define("text!forms/fields/bundle/view.html",[],function(){return'<div class="form-group">\r\n\r\n    <button data-role="button"\r\n            class="btn btn-primary"\r\n            data-sprite-css-class="k-icon k-edit"\r\n            data-bind="events: { click: view.onClick }">\r\n        <%= localization.Bundle %>\r\n    </button>\r\n\r\n    <div id="Bundle" class="cireson-window defined-form hide">\r\n        <div class="cireson-window--wrapper">\r\n            <div class="cireson-window--body">\r\n\r\n\r\n                <div id="bundleGrid">\r\n                    <div style="width: 800px; height: 200px"\r\n                         data-role="grid"\r\n                         data-bind="source: products,\r\n                                visible: isVisible,\r\n                                events: {\r\n                                  save: onSave\r\n                                }"\r\n                         date-scrollable="true"\r\n                         data-editable="{mode:\'inline\', confirmation:false}"\r\n                         data-toolbar="[{name:\'create\', text:\'<%= localization.Create %>\'}]"\r\n                         data-columns="[\r\n                            { \'field\': \'SoftwarePatternName\', title: \'<%= localization.SoftwarePatternName %>\', \'width\': 150 },\r\n                            { \'field\': \'SoftwarePattern\', title: \'<%= localization.SoftwarePattern %>\', \'width\': 150 },\r\n                            { \'field\': \'VersionPattern\', title: \'<%= localization.VersionPattern %>\', \'width\': 150 },\r\n                            { \'field\': \'ExclusionPattern\', title: \'<%= localization.ExclusionPattern %>\', \'width\': 150 },\r\n                            { command:[{name:\'edit\', text:\'<%= localization.Edit %>\'}, {name:\'destroy\', text:\'<%= localization.Delete %>\'}], title: \' \', width: \'150\'}\r\n                        ]">\r\n                        \r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="cireson-window--footer window-buttons">\r\n                <div id="changeStatusErrorWin" class="error"></div>\r\n                <button data-role="button"\r\n                        class="btn btn-primary"\r\n                        data-bind="enabled: okEnabled, events: { click: okClick }">\r\n                    <%= localization.OK %>\r\n                </button>\r\n                <button data-role="button"\r\n                        class="btn btn-default"\r\n                        data-bind="events: { click: cancelClick }">\r\n                    <%= localization.Cancel %>\r\n                </button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n\r\n</div>\r\n\r\n\r\n'}),define("forms/fields/bundle/controller",["require","text!forms/fields/bundle/view.html"],function(e){var t=e("text!forms/fields/bundle/view.html");return{template:t,build:function(e,i,n){var a=_.template(t);!_.isUndefined(localization[i.name])&&[i.name].length>0&&(i.name=localization[i.name]);var o={Disabled:i.disabled};$.extend(!0,o,i);var r,l=$(a(o)),s=[],d=l.find("#Bundle").clone(),c=d.kendoCiresonWindow({title:localization.createOrEditSoftwareBundle,width:850,height:375,actions:[],activate:function(){}}).data("kendoWindow"),u=new kendo.observable({okClick:function(){for(var t=r.products._data,i="",n="",a="",o=0;o<t.length;o++)""!=t[o].SoftwarePatternName&&(t.length-1==o?(i=i+t[o].SoftwarePatternName+"__"+t[o].SoftwarePattern,n+=t[o].ExclusionPattern,a+=t[o].VersionPattern):(i=i+t[o].SoftwarePatternName+"__"+t[o].SoftwarePattern+"|",n=n+t[o].ExclusionPattern+"|",a=a+t[o].VersionPattern+"|"));e.set("SoftwarePattern",i),e.set("ExclusionPattern",n),e.set("VersionPattern",a);var l=$("input[name='SoftwarePattern']"),s=$("input[name='ExclusionPattern']"),d=$("input[name='VersionPattern']");""!=e.SoftwarePattern?(e.set("IsBundle",!0),p(l,!1),p(s,!1),p(d,!1)):(e.set("IsBundle",!1),p(l,!0),p(s,!0),p(d,!0)),c.close()},cancelClick:function(){c.close()}});kendo.bind(d,u);var p=function(e,t){t?e.prop("disabled",!1).removeClass("k-state-disabled"):e.prop("disabled",!0).addClass("k-state-disabled").closest(".has-error").removeClass("has-error")};e.view.onClick=function(){s=[];var t=new Array,i=new Array,n=new Array;if(_.isNull(e.SoftwarePattern)||""==e.SoftwarePattern||(t=""==e.SoftwarePattern?"":e.SoftwarePattern.split("|")),_.isNull(e.ExclusionPattern)||""==e.ExclusionPattern||(i=""==e.ExclusionPattern?"":e.ExclusionPattern.split("|")),_.isNull(e.VersionPattern)||""==e.VersionPattern||(n=""==e.VersionPattern?"":e.VersionPattern.split("|")),e.IsBundle)for(var a in t){var o=t[a].split("__");s.push({SoftwarePatternName:o[0],SoftwarePattern:o[1],VersionPattern:n[a],ExclusionPattern:i[a]})}r=kendo.observable({isVisible:!0,onSave:function(e){},products:new kendo.data.DataSource({schema:{model:{id:"SoftwarePatternName",fields:{SoftwarePatternName:{editable:!0,validation:{SoftwarePatternNamevalidation:function(e){return!e.is("[name='SoftwarePatternName']")||""!=e.val()||(e.attr("data-SoftwarePatternNamevalidation-msg",localization.EnterRequiredFields),!1)}}},SoftwarePattern:{editable:!0,type:"string",validation:{SoftwarePatternvalidation:function(e){return!e.is("[name='SoftwarePattern']")||""!=e.val()||(e.attr("data-SoftwarePatternvalidation-msg",localization.EnterRequiredFields),!1)}}},VersionPattern:{editable:!0,type:"string",validation:{required:!1}},ExclusionPattern:{editable:!0,type:"string",validation:{required:!1}}}}},batch:!1,data:s})}),kendo.bind(d.find("#bundleGrid"),r),d.removeClass("hide"),d.show(),c.open()},n(l)}}}),define("text!forms/fields/fileUpload/view.html",[],function(){return'<div class="form-group">\r\n    <label class="control-label" for="<%= PropertyName %>" data-localize="<%= PropertyDisplayName %>">\r\n        <span><% if ( Required ){ %> <%= \'(\' + localization.Required + \')\' %><% } %></span>\r\n    </label>\r\n\r\n    <input id="<%= PropertyName %>" type="file"\r\n           accept="<%= AcceptExtension %>"\r\n           data-role="upload"\r\n           name="files"\r\n           data-async="{ saveUrl: \'/FileAttachment/FileUpload/?BaseId=<%= BaseId %>&fieldName=<%= PropertyName %>\', autoUpload: true }"\r\n           class="k-textbox form-control input-sm"\r\n           data-bind="events: { select: onSelect, complete:complete, success:success }" />\r\n    <br />\r\n    <div id="div<%= PropertyName %>">\r\n        <div data-role="button"\r\n                data-sprite-css-class="k-icon k-edit"\r\n                data-bind="events: { click: onRemove }">\r\n            <i class="fa fa-close"></i>\r\n        </div>\r\n        <div>\r\n        <img />\r\n        </div>\r\n    </div>\r\n\r\n</div>\r\n\r\n'}),define("forms/fields/fileUpload/controller",["require","text!forms/fields/fileUpload/view.html"],function(e){var t=e("text!forms/fields/fileUpload/view.html");return{template:t,build:function(e,i,n){var a=i.vm;new kendo.View;_.isUndefined(a.view)&&(a.view=[]);var o=_.template(t),r={Required:i.Required,BaseId:a.BaseId,AcceptExtension:_.isUndefined(i.AcceptExtension)?"":a.AcceptExtension};$.extend(!0,r,i);var l=$(o(r)),e=new kendo.observable({isEnabled:!0,isVisible:!0,onSelect:function(e){l.find(".k-file-error").remove(),$.each(e.files,function(t,n){_.isUndefined(i.AcceptExtension)||""==i.AcceptExtension||i.AcceptExtension.toLowerCase().indexOf(n.extension.toLowerCase())>-1||(kendo.ui.ExtAlertDialog.show({title:localization.ErrorDescription,message:localization.FileExtensionInvalid+i.AcceptExtension,icon:"fa fa-exclamation"}),e.preventDefault())})},complete:function(e){l.find(".k-file").length>1&&l.find(".k-file:first").remove()},success:function(e){l.find("img").attr("src","data:image/png;base64,"+e.response),a[i.PropertyName]={streamId:null,data:"stream",bufferedMode:!0,streamLength:0},l.find("#div"+i.PropertyName).show()},onRemove:function(e){$.get("/FileAttachment/RemoveFileUpload/",{BaseId:a.BaseId,fieldName:i.PropertyName},function(e){l.find(".k-file").parent().remove(),l.find("#div"+i.PropertyName).hide(),a[i.PropertyName]=null})}});$.get("/api/V3/Projection/GetBase64String",{BaseId:a.BaseId,PropertyName:i.PropertyName},function(e){var t=l.find("#div"+i.PropertyName);""!=e?(l.find("img").attr("src","data:image/png;base64,"+e),t.show()):t.hide()}),_.defer(function(){kendo.bind(l,e)}),n(l)}}}),define("text!forms/fields/urlTextbox/view.html",[],function(){return'<div class="form-group">\r\n    <label class="control-label" for="<%= PropertyName %>" data-localize="<%= PropertyDisplayName %>">\r\n        <span><% if ( Required ){ %> <%= \'(\' + localization.Required + \')\' %><% } %></span>\r\n    </label>\r\n    <input type="text"\r\n           name="<%= PropertyName %>"\r\n           class="k-textbox form-control input-sm"\r\n           data-bind="value: <%= PropertyName %>, events:{change:textChange}" <% if ( Disabled ){ %>\r\n        disabled\r\n        <% } %>\r\n\r\n        <% if ( Required ){ %>\r\n        required\r\n        <% } %>\r\n\r\n        />\r\n    <div data-role="button"\r\n         data-sprite-css-class="k-icon k-edit"\r\n         class="urlTextboxIcon"\r\n         data-bind="events: { click: openURL }">\r\n        <i class="fa fa-external-link nav-icon-color"></i>\r\n    </div>\r\n</div>'}),define("forms/fields/urlTextbox/controller",["require","text!forms/fields/urlTextbox/view.html"],function(e){var t=e("text!forms/fields/urlTextbox/view.html");return{template:t,build:function(e,i,n){var a=i.vm,o=new kendo.View;_.isUndefined(a.view)&&(a.view=[]),a.view.buildURLTextbox=function(){var e=_.template(t),r=new RegExp(/^((ftp|http|https?):\/\/)?([w|W]{3}\.)*?[a-zA-Z0-9\-\.]{3,}\.[a-zA-Z]{2,}(\.[a-zA-Z]{2,})?$/),l="urlTextboxButtonDisabled",s=a.get(i.PropertyName),d={Required:i.Required,Disabled:i.disabled};$.extend(!0,d,i);var c=$(e(d)),u=c.find("input"),p=c.find(".urlTextboxIcon"),m=function(){var e=!0;return s=a.get(i.PropertyName),p.removeClass(l),u.removeClass("input-error"),""==s||_.isNull(s)?(e=!1,p.addClass(l)):r.test(s)||(p.addClass(l),u.addClass("input-error"),e=!1),e};m(),a.textChange=function(e){m()},a.openURL=function(e){if(m()){s.match(/^ftp|http([s]?):\/\/.*/)||(s="http://"+s);window.open(s,"_blank").focus()}},o=new kendo.View(c,{wrap:!1,model:a}),n(o.render())},a.view.buildURLTextbox()}}}),define("forms/fields/percentage/controller",["require","text!forms/fields/numeric/view.html"],function(e){var t=e("text!forms/fields/numeric/view.html");return{template:t,build:function(e,i,n){var a=_.template(t),o={DecimalPlaces:2,MinValue:"",MaxValue:"",StepIncrement:.01,Disabled:i.disabled,Required:i.Required,Format:"P0"};$.extend(!0,o,i),n(a(o))}}}),define("forms/formBuilder",["forms/structure/formPanel/controller","forms/structure/formPanelFull/controller","forms/structure/customFieldGroup/controller","forms/structure/customFieldGroupRow/controller","forms/structure/columnField/controller","forms/structure/tab/controller","forms/structure/tabPane/controller","forms/structure/tabNavigation/controller","forms/structure/tabData/controller","forms/predefined/actionLog/controller","forms/predefined/fileAttachments/controller","forms/predefined/affectedItems/controller","forms/predefined/relatedItems/controller","forms/predefined/childWorkItems/controller","forms/predefined/userInput/controller","forms/predefined/activities/controller","forms/predefined/multipleObjectPicker/controller","CustomSpace/Scripts/forms/predefined/history/controller","forms/predefined/billableTime/controller","forms/predefined/knowledgeArticle/controller","forms/predefined/fileAttachmentsDragDrop/controller","forms/predefined/serviceComponents/controller","forms/predefined/dependentComponents/controller","forms/fields/string/controller","forms/fields/longstring/controller","forms/fields/boolean/controller","forms/fields/display/controller","forms/fields/spacer/controller","forms/fields/numeric/controller","forms/fields/int/controller","forms/fields/decimal/controller","forms/fields/double/controller","forms/fields/date/controller","forms/fields/datetime/controller","forms/fields/enum/controller","forms/fields/userPicker/controller","forms/fields/objectPicker/controller","forms/fields/button/controller","forms/fields/editor/controller","forms/fields/combo/controller","forms/fields/dropDownList/controller","forms/fields/bundle/controller","forms/fields/fileUpload/controller","forms/fields/urlTextbox/controller","forms/fields/percentage/controller"],function(formPanel,formPanelFull,customFieldGroup,customFieldGroupRow,columnField,tab,tabPane,tabNavigation,tabData,actionLog,fileAttachments,affectedItems,relatedItems,childWorkItems,userInput,activities,multipleObjectPicker,history,billableTime,knowledgeArticle,fileAttachmentsDragDrop,serviceComponents,dependentComponents,String,LongString,Boolean,Display,Spacer,Numeric,Int32,Decimal,Double,Date,DateTime,Enum,UserPicker,ObjectPicker,Button,Editor,Combo,DropDownList,Bundle,FileUpload,UrlTextbox,Percentage){var mainContainer,jsonTemplate,viewModel,definition={build:function(vm,callback){if(viewModel=vm.viewModel,jsonTemplate=vm.formTemplate,_.isUndefined(jsonTemplate))return void console.log("Form ID not found.","You must add a template with the key of 'Default'. This is used for fallback if a specific template is not found.");eval("var _obj = "+jsonTemplate.layoutType+";"),_obj||(_obj=formPanel),_obj.build(function(e){mainContainer=$(e)}),readTemplate(mainContainer,jsonTemplate),callback(mainContainer),$("a[selected='selected']").tab("show")}},readTemplate=function(e,t,i){var i=void 0!=i&&!1!==i&&i;$.each(t,function(t,n){"layoutType"!=t&&jsonDecision(e,t,n,i)})},mutationLogic={all:function(e){e.vm=viewModel},tabList:function(e){jsonTemplate.tabNavigation={nodeCount:e.length,tabData:[]},tabNavigation.build(viewModel,jsonTemplate,function(t){var i=$(t),n=!1;$.each(e,function(e,t){var a=app.getParameterByName("tab").toLowerCase(),o=t.name;t.tabId=app.lib.newGUID(),t.active=0==e?"active":"",t.content.tabId=t.tabId,t.content.active=t.active,tabData.build(viewModel,t,function(e){var r=$(e);if(app.isMobile()?i.children(".nav-dropdown-content").find("ul").append(r):i.append(r),!app.isMobile()&&!n&&a.length>0)switch(o.toLowerCase()===a&&(r.find("a").attr("selected","true"),n=!0),a){case"activity":$.each(t.content,function(e,t){$.each(t.customFieldGroupList,function(e,t){"activities"===t.type&&(r.find("a").attr("selected","true"),n=!0)})})}})}),mainContainer.append(i)})},columnFieldList:function(e){app.lib.setColumnSizes(e)}},getContainer=function(e){return"string"==typeof e?$(e):e},chooseNextAction=function(e,t,i,n){t.content?jsonDecision(e,i+"Pane",t.content):t.type?jsonDecision(e,t.type,t):t.DataType?jsonDecision(e,t.DataType,t):t.rows?jsonDecision(e,i+"Row",t.rows):readTemplate(e,t,n)},jsonDecision=function(propContainer,propName,propValue,columns){var objectName=propName,list=!1,row=!1,pane=!1,columnCount=void 0!=columns&&columns;if(mutationLogic[propName]&&mutationLogic[propName](propValue),mutationLogic.all(propValue),propValue.push&&(propName.indexOf("List")>-1?(list=!0,objectName=propName.split("List")[0]):propName.indexOf("Row")>-1?(row=!0,columnCount=propValue.length):propName.indexOf("Pane")>-1&&(pane=!0)),eval("var _obj = "+objectName+";"),!_obj)throw Exception(objectName+" is not part of the templating system");list||row||pane?_obj==tab?_obj.build(viewModel,propValue,function(e){var t=getContainer(e);propContainer.append(t),$.each(propValue,function(e,i){chooseNextAction(t,i,objectName)})}):$.each(propValue,function(e,t){"columnField"==objectName&&(t.columnCount=columnCount),_obj==tabPane?_obj.build(viewModel,propValue,function(e){var i=getContainer(e);propContainer.append(i),readTemplate(i,t,columnCount)}):_obj.build(viewModel,t,function(e){var i=getContainer(e);propContainer.append(i),0!=i.find(".append-here").length?chooseNextAction(i.find(".append-here"),t,objectName,columnCount):chooseNextAction(i,t,objectName,columnCount)})}):(!_.isUndefined(viewModel)&&viewModel.isDisabled&&(propValue.disabled=!0),_obj.build(viewModel,propValue,function(e){var t=getContainer(e);propContainer.append(t)}))};return definition}),define("forms/formHelper",[],function(){return{manageDirty:function(e){e.set("isDirty",!1),e.bind("change",function(t){var i=["isDirty","HistoryButton","ConfigItemRelatedWI","ConfigItem","Activity"];_.contains(i,t.field)||e.set("isDirty",!0)}),window.onbeforeunload=function(){if(e.get("isDirty"))return localization.UnsavedDataMessage}},mobileDrawerTaskButton:function(e){function t(){app.isMobile()?i.show():i.hide()}var i=drawermenu.addButton(localization.Tasks,"fa fa-tasks",function(){});app.lib.makeDrawer("bottom",e,i,!0),$(window).resize(function(){t()}),t()},makeFormPristine:function(e){var t=function(e){for(var i in e)if("view"!=i&&"_events"!=i&&"_handlers"!=i&&"[object Function]"!==Object.prototype.toString.call(e[i])&&(e.isDirty&&(e.isDirty=!1),"Activity"==i))for(var n in e[i])t(e[i][n]),e[i][n].isDirty=!1};t(e)}}}),require.config({waitSeconds:0,urlArgs:"v="+session.staticFileVersion,baseUrl:"/Scripts/",paths:{text:"require/text"},shim:{}}),app.lib.mask.apply(),$("body").css("cursor","wait"),$(document).ajaxStop(function(){$("body").css("cursor","auto")}),require(["forms/taskBuilder","forms/headerBuilder","forms/formBuilder","forms/formHelper"],function(e,t,i,n,a){var o=pageForm.saveUrl,r=$(pageForm.container),l=$('<div class="task-panel task-panel-narrow"></div>'),s=$(".page_bar").empty(),d=$("<div/>").addClass("page-form"),c=pageForm.type,u=pageForm.viewModel;pageForm.jsonRaw;if(!_.isUndefined(pageForm.viewModel.WorkItemErrorMessage)){var p=$("<div/>").addClass("jumbotron");return p.append($("<h1 />").addClass("error uppercase").html("<i class='fa fa-frown-o'></i> "+localization.Failed)),p.append($("<p />").addClass("error").html(pageForm.viewModel.WorkItemErrorMessage)),r.append(p),app.lib.mask.remove(),void $("body").css("cursor","auto")}var m=[];pageForm.boundReady=function(e){m.push(e)};var f=[];pageForm.boundChange=function(e,t){f[e]=t};var v=app.custom.actionMethod.get(c);_.isArray(v)&&(u.custom={},$.each(v,function(e,t){_.isFunction(t.func)&&(u.custom[t.index]=t.func)})),pageForm.headerTemplate={rows:[{columns:[{View:"stickyCI",Class:""}]}]},pageForm.taskTemplate={},pageForm.taskTemplate.tasks=[];var g=app.custom.formTasks.get(pageForm.type);_.isArray(g)&&$.each(g,function(e,t){pageForm.taskTemplate.tasks.push({Task:"custom",Type:pageForm.type,Label:t.label,Access:!0,Configs:{func:t.func}})});var b=app.custom.formTasks.get("ConfigItem");_.isArray(b)&&$.each(b,function(e,t){pageForm.taskTemplate.tasks.push({Task:"custom",Type:pageForm.type,Label:t.label,Access:!0,Configs:{func:t.func}})});var w=function(){var e=c,t=pageForm.formTemplate,i="A 'Default' template is required.",n=" \r\r When creating a JSON template for '"+e+"' you must add a template with the key of 'Default'. This is used for fallback if a specific template is not found. No Default key is found on the custom template, default template will be used.",a=" \r\r When creating a JSON template for '"+e+"' you must add a template with the key of 'Default'. This is used for fallback if a specific template is not found.";null!=t.customTemplate&&""!=t.customTemplate?(t=pageForm.formTemplate.customTemplate,t.Default||(e&&(i+=n),t=pageForm.formTemplate.defaultTemplate,t.Default||e&&(i+=a),session.user.IsAdmin?alert(i):console.log(i))):(t=pageForm.formTemplate,t.Default||(e&&(i+=a),session.user.IsAdmin?alert(i):console.log(i))),pageForm.formTemplate=t[pageForm.CustomFormName]},h=function(){var e=function(e){e==localization.RequiredFieldsErrorMessage?app.lib.message.add(e,"danger"):app.lib.message.add(localization.PleaseCorrectErrors,"danger"),app.lib.message.show(),window.scrollTo(0,0)};drawermenu.addButton(localization.Save,"fa fa-check",function(){k(function(e){message=localization.ChangeRequestSavedMessage,link="/DynamicData/Edit/"+u.BaseId+"/",app.lib.message.add(message+"&nbsp;&nbsp;<a href='"+link+"'><strong> CI - "+u.DisplayName+"</strong></a> ","success"),app.lib.gotoFormReturnUrl()},e)}),drawermenu.addButton(localization.Apply,"fa fa-pencil",function(){k(function(e){app.lib.message.add(localization.ChangesApplied,"success"),location.reload()},e)}),drawermenu.addButton(localization.Cancel,"fa fa-times",function(){if(!u.get("isDirty"))return void app.lib.gotoFormReturnUrl();$.when(kendo.ui.ExtOkCancelDialog.show({title:localization.Warning,message:localization.UnsavedDataMessage,icon:"fa fa-exclamation"})).done(function(e){if("ok"===e.button)return u.set("isDirty",!1),void app.lib.gotoFormReturnUrl()})}),n.mobileDrawerTaskButton(l)},k=function(e,t){app.lib.mask.apply();var i=!0;if(d.find(".form-group").removeClass("has-error"),d.find("[required]").each(function(){var e=$(this),t=_.isUndefined(e.attr("data-control-bind"))?e[0].name:e.attr("data-control-bind");if((_.isUndefined(t)||""!=t)&&(_.isUndefined(e[0].kendoBindingTarget)||_.isUndefined(e[0].kendoBindingTarget.options)||(t=e[0].kendoBindingTarget.options.propertyName)),!_.isUndefined(t)){var n=_.isObject(pageForm.viewModel[t])&&!_.isUndefined(pageForm.viewModel[t].Id);(_.isNull(pageForm.viewModel[t])||""===pageForm.viewModel[t]||_.isObject(pageForm.viewModel[t])&&n&&(_.isNull(pageForm.viewModel[t].Id)||""===pageForm.viewModel[t].Id)||_.isObject(pageForm.viewModel[t])&&!n&&(_.isUndefined(pageForm.viewModel[t].BaseId)||_.isNull(pageForm.viewModel[t].BaseId)))&&(i=!1,e.parents(".form-group").addClass("has-error"))}var a=e[0].nodeName.toLowerCase();"input"!=a&&"textarea"!=a&&(e=e.find("input")),""==e.val()&&(i=!1,e.parents(".form-group").addClass("has-error"))}),d.find(".input-error").each(function(){i=!1}),d.find("[data-invalid]").each(function(){i=!1;var e=$(this);e.parents(".form-group").addClass("has-error"),e.css({"background-color":"#FBE3E4"})}),!i)return t(localization.PleaseCorrectErrors),void app.lib.mask.remove();if(u.get("commentDirty"))return app.lib.message.add("<strong>"+localization.UnAddedActionLogComment+"</strong>","warning"),u.set("commentDirty",!1),app.lib.message.show(),window.scrollTo(0,0),void app.lib.mask.remove();var n=u.toJSON();0==pageForm.newWI&&app.lib.optimizeFormMultiObject.BeforeSave(n,pageForm.jsonRaw);var a=encodeURIComponent(JSON.stringify({isDirty:!0,current:n,original:pageForm.jsonRaw}));$.ajax({type:"POST",dataType:"text",url:o,data:"formJson="+a,success:function(t,i,n){$.post("/platform/api/CacheSync",{},function(i){t=JSON.stringify(t),u.set("isDirty",!1),t.search("loginForm")<0?e(t):window.location="/Login/Login?ReturnUrl="+window.location.pathname})},error:function(e,i,n){if(409==e.status)$.when(kendo.ui.ExtYesNoDialog.show({title:localization.DataConflict,message:localization.DataConflictError+"<br/><br/><small>("+localization.DataConflictDescription+")</small>",icon:"fa fa-exchange text-danger",width:"500px",height:"175px"})).done(function(e){"yes"===e.button?window.open(window.location.pathname):location.href=window.location.pathname});else if(503==e.status){var a=e.responseText;app.lib.log(a);var o=JSON.parse(a),r=localization.RequestFailed;o.exception&&o.exception.length>0&&(r=o.exception),kendo.ui.ExtAlertDialog.show({title:localization.Failed,message:r,icon:"fa fa-times-circle text-danger"})}else if(403==e.status){var a=e.responseText;app.lib.log(a);var o=JSON.parse(a),r=localization.RequestFailed;o.exception&&o.exception.length>0&&(r=o.exception),kendo.ui.ExtAlertDialog.show({title:localization.Failed,message:r,icon:"fa fa-times-circle text-danger"})}else{t(),console&&app.lib.log(localization.RequestFailed),app.lib.log(n);var a=e.responseText;app.lib.log(a);var o=JSON.parse(a),r=localization.RequestFailed;o.exception&&o.exception.length>0&&(r=o.exception),kendo.ui.ExtAlertDialog.show({title:localization.ErrorDescription,message:r,icon:"fa fa-exclamation"})}},processData:!1,async:!0})};pageForm.save=k;var y=function(e){app.lib.optimizeFormMultiObject.OnVmChange(e)};pageForm.onVmChange=y;var I=function(e){if(_.isNull(e))return"";var t=/\{\*?\\[^{}]+;}|[{}]|\\[A-Za-z]+\n?(?:-?\d+)?[ ]?/g,i=/\\\n/g,n=/\n\\f[0-9]\s/g;return(_.isNull(e)?"":e).replace(n,"").replace(t,"").replace(i,"\n").trim()};!function(){for(var a in u)a.indexOf("Notes")>-1&&(_.isUndefined(u[a])||(u[a]=I(u[a])));w(),$("#alertMessagesContainer").addClass("sticky-header"),d.addClass("sticky-header"),l.addClass("sticky-header"),s.addClass("sticky-header"),app.isMobile()?(r.append(d),r.after(l)):(r.append(d),r.before(l)),l.append("<h2>"+localization.Tasks+"</h2>"),e.build(pageForm,function(e){l.append(e)}),t.build(pageForm,function(e){s.append(e)}),i.build(pageForm,function(e){if(d.append(e),app.controls.apply(d,{localize:!0,vm:u,bind:!0}),d.show(),"undefined"!=typeof drawermenu?h():app.events.subscribe("drawerCreated",function(){h()}),app.lib.handleMessages(),u.bind("change",function(e){y(e)}),_.each(m,function(e,t){_.isFunction(e)&&e()}),d.on("keypress",function(e){app.lib.stopEnterKeySubmitting(e)}),!app.isMobileDevice()){var t=$(".task-panel").first();t.affix({offset:{top:t[0].getBoundingClientRect().top-84}}),kendo.data.binders.yScrollOnResize(t[0],{yScrollOnResize:{path:{top:"auto",bottom:50}}},{})}n.manageDirty(u)}),app.lib.mask.remove()}()}),define("forms/configItemMain",function(){});
//# sourceMappingURL=/CustomSpace/Scripts/forms/configItemMain-built.min.js.map